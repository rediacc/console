import{j as e,u as a}from"./chunk-DXw4Pgvm.js";import{f as t,g as s,r as n,R as i}from"./chunk-DZuWtVpy.js";import{P as o}from"./chunk-Cu1lLf6R.js";import{r as l,a as r,b as c,c as d,u as m,o as u,W as h,f as p,M as g,m as x,h as y,K as j,l as b,D as N,s as v,k as f,H as k,I as C,p as w,q as S}from"../index-CPnZeLBe.js";import{D as _}from"./chunk-Z0TSE2Iv.js";import{C as $,D as T}from"./chunk-B3eshzUJ.js";import{C as I}from"./chunk-vWlxqR9N.js";import{R as A}from"./chunk-BCTCcKaa.js";import{D as M,u as R,s as V,d as z,a as F}from"./chunk-CohcIhyg.js";import{M as L,d as P,e as E,f as B,g as D,F as O,E as K,h as q,i as G,j as W,k as U,u as H,l as X,m as Q,n as Z,o as J,p as Y,q as ee,r as ae,s as te,t as se,v as ne,b as ie,c as oe,A as le,R as re,V as ce,w as de,x as me,y as ue,z as he,B as pe,C as ge,D as xe,T as ye}from"./chunk-D75llXCc.js";import{R as je,Q as be}from"./chunk-COYgpkGA.js";import{E as Ne}from"./chunk-2gdvOj65.js";import{T as ve}from"./chunk-huyDvUHn.js";import{A as fe}from"./chunk-XHf0oGRp.js";import{u as ke}from"./chunk-CM3g5OHp.js";import{p as Ce,S as we,E as Se,a as _e,T as $e,g as Te,M as Ie,V as Ae,B as Me,w as Re,W as Ve,k as ze,D as Fe,h as Le,i as Pe,X as Ee,Y as Be,Z as De,_ as Oe,$ as Ke,a0 as qe,a1 as Ge,a2 as We,a3 as Ue,a4 as He,a5 as Xe,a6 as Qe,a7 as Ze,a8 as Je,a9 as Ye,aa as ea,N as aa,ab as ta,ac as sa,o as na,q as ia,s as oa,u as la,I as ra}from"./chunk-CSjZqX98.js";import{a as ca}from"./chunk-xSw6NTs2.js";import{S as da}from"./chunk-BBXucgqH.js";import{E as ma}from"./chunk-Cv5GtfPB.js";import{F as ua}from"./chunk-BBtBrklK.js";import"./chunk-BNqsZZGB.js";import"./chunk-C0XEpv6B.js";import"./chunk-DpKu7j1T.js";import"./chunk-BHNikne1.js";import"./chunk-DATOoulk.js";import"./forkTokenService.ts-CunLLqWt.js";import"./chunk-BaK2xAEp.js";import"./chunk-B6DwdnHp.js";import"./chunk-BmDHQHCT.js";var ha,pa,ga,xa={exports:{}},ya={},ja={};function ba(){if(ha)return ja;ha=1,Object.defineProperty(ja,"__esModule",{value:!0});return ja.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M553.1 509.1l-77.8 99.2-41.1-52.4a8 8 0 00-12.6 0l-99.8 127.2a7.98 7.98 0 006.3 12.9H696c6.7 0 10.4-7.7 6.3-12.9l-136.5-174a8.1 8.1 0 00-12.7 0zM360 442a40 40 0 1080 0 40 40 0 10-80 0zm494.6-153.4L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-image",theme:"outlined"},ja}function Na(){if(pa)return ya;pa=1;var e=l().default,a=r().default;Object.defineProperty(ya,"__esModule",{value:!0}),ya.default=void 0;var s=a(c()),n=e(t()),i=a(ba()),o=a(d()),m=function(e,a){return n.createElement(o.default,(0,s.default)({},e,{ref:a,icon:i.default}))},u=n.forwardRef(m);return ya.default=u,ya}function va(){return ga||(ga=1,function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var t;const s=(t=Na())&&t.__esModule?t:{default:t};a.default=s,e.exports=s}(xa,xa.exports)),xa.exports}const fa=s(va()),{Text:ka}=$e,{Option:Ca}=we,wa=({machines:a,value:t=[],onChange:s,loading:n=!1,placeholder:i,disabled:o=!1,showAssignmentStatus:l=!0,allowSelectAssigned:r=!1,maxSelection:c,style:d})=>{const{t:g}=ke(["machines","common"]),x=m(),y=u();return n?e.jsx("div",{style:x.flexCenter,children:e.jsx(Ce,{})}):e.jsx(we,{mode:"multiple",style:{width:"100%",...y.formInput,...d},placeholder:i||g("machines:selectMachines"),value:t,onChange:e=>{c&&e.length>c||s?.(e)},disabled:o,loading:n,filterOption:(e,t)=>{const s=a.find(e=>e.machineName===t.value);return!!s&&!!(s.machineName.toLowerCase().includes(e.toLowerCase())||s.teamName.toLowerCase().includes(e.toLowerCase())||s.bridgeName&&s.bridgeName.toLowerCase().includes(e.toLowerCase()))},showSearch:!0,optionLabelProp:"label","data-testid":"available-machines-selector",notFoundContent:0===a.length?e.jsx(Se,{description:e.jsx("span",{style:x.body,children:g("machines:noAvailableMachines")})}):e.jsx(Se,{description:e.jsx("span",{style:x.body,children:g("common:noMatchingResults")})}),children:a.map(a=>{const t=a.distributedStorageClusterName||"AVAILABLE"!==a.assignmentStatus?.assignmentType,s=!r&&t;return e.jsx(Ca,{value:a.machineName,disabled:s,"data-testid":`available-machines-option-${a.machineName}`,children:e.jsxs("div",{style:{...x.flexBetween,width:"100%"},"data-testid":`available-machines-option-content-${a.machineName}`,children:[e.jsxs(_e,{children:[e.jsx(I,{style:x.icon.small}),e.jsx(ka,{strong:!s,style:{...x.body,opacity:s?.6:1},children:a.machineName}),e.jsx(Te,{color:"#8FBC8F",style:{borderRadius:"var(--border-radius-sm)",...x.caption},"data-testid":`available-machines-team-tag-${a.machineName}`,children:a.teamName}),a.bridgeName&&e.jsx(Te,{color:"green",style:{borderRadius:"var(--border-radius-sm)",...x.caption},"data-testid":`available-machines-bridge-tag-${a.machineName}`,children:a.bridgeName})]}),l&&e.jsx("div",{style:{marginLeft:"auto"},children:t?a.distributedStorageClusterName?e.jsx(Te,{color:"blue",icon:e.jsx(h,{style:x.icon.small}),style:{borderRadius:"var(--border-radius-sm)",...x.caption},"data-testid":`available-machines-cluster-tag-${a.machineName}`,children:e.jsxs("span",{style:x.caption,children:[g("machines:assignmentStatus.cluster"),": ",a.distributedStorageClusterName]})}):a.assignmentStatus?e.jsx(L,{assignmentType:a.assignmentStatus.assignmentType,assignmentDetails:a.assignmentStatus.assignmentDetails,size:"small"}):null:e.jsx(Te,{color:"green",icon:e.jsx(p,{style:x.icon.small}),style:{borderRadius:"var(--border-radius-sm)",...x.caption},"data-testid":`available-machines-available-tag-${a.machineName}`,children:e.jsx("span",{style:x.caption,children:g("machines:assignmentStatus.available")})})})]})},a.machineName)})})},Sa=({open:a,clusterName:t,teamName:s,onCancel:l,onSuccess:r})=>{const{t:c}=ke(["distributedStorage","machines","common"]),[d,m]=n.useState("assign"),[u,h]=n.useState([]),[p,x]=n.useState([]),[y,j]=n.useState(!1),[b,N]=n.useState(!1),{data:v=[],isLoading:f,refetch:k}=P(t,a),{data:C=[],isLoading:w}=E(s,a&&"assign"===d),S=B(),$=D();i.useEffect(()=>{a||(m("assign"),h([]),x([]))},[a]);const T=async()=>{0!==p.length?Ie.confirm({title:c("machines:removeFromCluster"),content:c("machines:removeFromClusterWarning",{count:p.length}),okText:c("common:actions.remove"),okType:"danger",cancelText:c("common:actions.cancel"),onOk:async()=>{N(!0);try{const e=await Promise.allSettled(p.map(e=>$.mutateAsync({teamName:s,machineName:e}))),a=e.filter(e=>"fulfilled"===e.status).length;a===p.length?(Ve.success(c("machines:bulkOperations.removalSuccess",{count:a})),x([]),k(),r&&r()):(Ve.warning(c("machines:bulkOperations.assignmentPartial",{success:a,total:e.length})),k())}finally{N(!1)}}}):Ve.warning(c("machines:validation.noMachinesSelected"))},A=[{title:c("machines:machineName"),dataIndex:"machineName",key:"machineName",render:a=>e.jsxs(_e,{children:[e.jsx(_,{}),e.jsx("strong",{children:a})]})},{title:c("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",render:a=>e.jsx(Te,{color:"green",children:a})},{title:c("machines:assignedDate"),dataIndex:"assignedDate",key:"assignedDate",render:e=>e?ca(e,"datetime"):"-"}];return e.jsx(Ie,{title:e.jsxs(_e,{children:[e.jsx(I,{}),c("clusters.assignedMachines"),": ",t]}),open:a,onCancel:l,className:g.Large,"data-testid":"ds-manage-cluster-machines-modal",footer:[e.jsx(Me,{onClick:l,"data-testid":"ds-manage-machines-cancel",children:c("common:actions.cancel")},"cancel"),"assign"===d&&e.jsx(Me,{type:"primary",icon:e.jsx(o,{}),loading:y,disabled:0===u.length,onClick:async()=>{if(0!==u.length){j(!0);try{const e=await Promise.allSettled(u.map(e=>S.mutateAsync({teamName:s,machineName:e,clusterName:t}))),a=e.filter(e=>"fulfilled"===e.status).length;0===e.filter(e=>"rejected"===e.status).length?(Ve.success(c("machines:bulkOperations.assignmentSuccess",{count:a})),h([]),k(),r&&r()):(Ve.warning(c("machines:bulkOperations.assignmentPartial",{success:a,total:e.length})),k())}finally{j(!1)}}else Ve.warning(c("machines:bulkOperations.selectMachines"))},"data-testid":"ds-manage-machines-assign-button",children:c("machines:assignToCluster")},"assign")].filter(Boolean),children:e.jsx(Ae,{activeKey:d,onChange:e=>m(e),"data-testid":"ds-manage-machines-tabs",items:[{key:"assign",label:e.jsx("span",{"data-testid":"ds-manage-machines-tab-assign",children:c("machines:assignToCluster")}),children:w?e.jsx(Ce,{}):e.jsxs(_e,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx("p",{children:c("machines:selectMachines")}),e.jsx(wa,{machines:C,value:u,onChange:h})]}),u.length>0&&e.jsx("div",{children:e.jsx(Te,{color:"blue",children:c("machines:bulkOperations.selectedCount",{count:u.length})})})]})},{key:"manage",label:e.jsx("span",{"data-testid":"ds-manage-machines-tab-manage",children:c("clusters.assignedMachines")}),children:(()=>{if(f)return e.jsx(Ce,{});if(0===v.length)return e.jsx(Se,{description:c("clusters.noMachinesAssigned")});const a={selectedRowKeys:p,onChange:e=>{x(e)}};return e.jsxs(_e,{direction:"vertical",size:"large",style:{width:"100%"},children:[p.length>0&&e.jsxs("div",{children:[e.jsx(Te,{color:"orange",children:c("machines:bulkOperations.selectedCount",{count:p.length})}),e.jsx(Me,{type:"primary",danger:!0,icon:e.jsx(M,{}),onClick:T,loading:b,style:{marginLeft:8},"data-testid":"ds-manage-machines-remove-button",children:c("machines:removeFromCluster")})]}),e.jsx(Re,{rowSelection:a,columns:A,dataSource:v,rowKey:"machineName",size:"small",pagination:!1,"data-testid":"ds-manage-machines-assigned-table"})]})})()}]})})},_a=({cluster:a})=>{const{data:t=[]}=P(a.clusterName,!0),s=x();return e.jsx(Le,{count:t.length,showZero:!0,style:{backgroundColor:t.length>0?"var(--color-success)":"var(--color-fill-quaternary)",color:t.length>0?"var(--color-white)":"var(--color-text-secondary)"},children:e.jsx(ve,{style:s.icon.medium})})},$a=({clusters:a,loading:t,onCreateCluster:s,onEditCluster:i,onDeleteCluster:o,onRunFunction:l})=>{const{t:r}=ke(["distributedStorage","common","machines"]),c=x(),[d,m]=n.useState([]),[u,h]=n.useState(null),[p,g]=n.useState(!1),[b,N]=n.useState({open:!1,entityType:null,entityIdentifier:null}),v=[{title:r("clusters.clusterName"),dataIndex:"clusterName",key:"clusterName",ellipsis:!0,render:(a,t)=>{const s=d.includes(t.clusterName);return e.jsxs(_e,{children:[e.jsx("span",{style:{display:"inline-block",width:12,transition:"transform 0.3s ease",transform:s?"rotate(90deg)":"rotate(0deg)"},children:e.jsx(je,{style:{...c.icon.small,color:"var(--color-text-tertiary)"}})}),e.jsx(I,{style:{...c.icon.medium,color:"var(--color-primary)"}}),e.jsx("strong",{style:{color:"var(--color-text-primary)"},children:a})]})}},{title:r("common:general.team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:a=>e.jsx(Te,{color:"green",children:a})},{title:r("machines:title"),key:"machineCount",width:120,align:"center",render:(a,t)=>e.jsxs(_e,{size:"small",children:[e.jsx(_a,{cluster:t}),e.jsx(Me,{type:"link",size:"small","data-testid":`ds-cluster-manage-machines-${t.clusterName}`,onClick:e=>{e.stopPropagation(),h(t),g(!0)},children:r("machines:manage")})]})},{title:r("common:general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:a=>e.jsx(Te,{color:"blue",children:r("common:general.versionFormat",{version:a})})},{title:r("common:table.actions"),key:"actions",width:250,render:(a,t)=>e.jsxs(_e,{children:[e.jsx(ze,{title:r("common:actions.edit"),children:e.jsx(Me,{type:"primary",size:"small",icon:e.jsx(Ne,{}),"data-testid":`ds-cluster-edit-${t.clusterName}`,onClick:()=>i(t),style:c.tableActionButton,"aria-label":r("common:actions.edit")})}),e.jsx(Fe,{menu:{items:[{key:"status",label:r("functions.cluster_status"),icon:e.jsx(K,{})},{key:"dashboard",label:r("functions.cluster_dashboard"),icon:e.jsx(j,{})},{type:"divider"},{key:"advanced",label:r("common:actions.advanced"),icon:e.jsx(O,{})}],onClick:({key:e})=>{l("advanced"===e?t:{...t,preselectedFunction:e})}},trigger:["click"],children:e.jsx(ze,{title:r("common:actions.remote"),children:e.jsx(Me,{type:"primary",size:"small",icon:e.jsx(O,{}),"data-testid":`ds-cluster-function-dropdown-${t.clusterName}`,style:c.tableActionButton,"aria-label":r("common:actions.remote")})})}),e.jsx(ze,{title:r("common:actions.trace"),children:e.jsx(Me,{type:"default",size:"small",icon:e.jsx(y,{}),"data-testid":`ds-cluster-trace-${t.clusterName}`,onClick:()=>{N({open:!0,entityType:"DistributedStorageCluster",entityIdentifier:t.clusterName,entityName:t.clusterName})},style:c.tableActionButton,"aria-label":r("common:actions.trace")})}),e.jsx(ze,{title:r("common:actions.delete"),children:e.jsx(Me,{type:"primary",danger:!0,size:"small",icon:e.jsx(M,{}),"data-testid":`ds-cluster-delete-${t.clusterName}`,onClick:()=>{return e=t,void Ie.confirm({title:r("clusters.confirmDelete"),content:r("clusters.deleteWarning",{name:e.clusterName}),okText:r("common:actions.delete"),okType:"danger",cancelText:r("common:actions.cancel"),onOk:()=>o(e)});var e},style:c.tableActionButton,"aria-label":r("common:actions.delete")})})]})}];return e.jsxs(e.Fragment,{children:[0!==a.length||t?e.jsx("div",{style:c.tableContainer,children:e.jsx(Re,{"data-testid":"ds-cluster-table",columns:v,dataSource:a,rowKey:"clusterName",loading:t,scroll:{x:"max-content"},pagination:{showSizeChanger:!0,showTotal:(e,a)=>r("common:table.showingRecords",{start:a[0],end:a[1],total:e})},expandable:{expandedRowRender:a=>e.jsx(Ta,{cluster:a}),expandedRowKeys:d,onExpandedRowsChange:e=>m(e),expandIcon:()=>null,expandRowByClick:!1},onRow:e=>({"data-testid":`ds-cluster-row-${e.clusterName}`,onClick:a=>{const t=a.target;if(t.closest("button")||t.closest(".ant-dropdown-trigger"))return;const s=d.includes(e.clusterName);m(s?d.filter(a=>a!==e.clusterName):[...d,e.clusterName])},style:{cursor:"pointer",transition:"background-color 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-fill-tertiary)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=""}})})}):e.jsx(Se,{description:r("clusters.noClusters"),style:{marginTop:48},children:e.jsx(Me,{type:"primary","data-testid":"ds-create-cluster-empty",onClick:s,children:r("clusters.create")})}),e.jsx(fe,{open:b.open,onCancel:()=>N({open:!1,entityType:null,entityIdentifier:null}),entityType:b.entityType,entityIdentifier:b.entityIdentifier,entityName:b.entityName}),u&&e.jsx(Sa,{open:p,clusterName:u.clusterName,teamName:u.teamName||"",onCancel:()=>{g(!1),h(null)},onSuccess:()=>{g(!1),h(null),d.includes(u.clusterName)&&(m([]),setTimeout(()=>{m([u.clusterName])},100))}})]})},Ta=({cluster:a})=>{const{t:t}=ke(["distributedStorage","common"]),s=x(),{data:n=[],isLoading:i}=P(a.clusterName,!0),o=[{title:t("machines.machineName"),dataIndex:"machineName",key:"machineName",render:a=>e.jsxs(_e,{children:[e.jsx(_,{style:{...s.icon.medium,color:"var(--color-primary)"}}),e.jsx("strong",{style:{color:"var(--color-text-primary)"},children:a})]})},{title:t("machines.bridgeName"),dataIndex:"bridgeName",key:"bridgeName",render:a=>e.jsx(Te,{color:"green",children:a})},{title:t("machines.assignedDate"),dataIndex:"assignedDate",key:"assignedDate",render:a=>e.jsx("span",{style:{color:"var(--color-text-secondary)"},children:a?ca(a,"datetime"):"-"})}];return e.jsxs("div",{style:{...s.padding.md,background:"var(--color-fill-quaternary)"},"data-testid":`cluster-expanded-row-${a.clusterName}`,children:[e.jsx("h4",{style:{...s.heading4,...s.marginBottom.sm},children:t("clusters.assignedMachines")}),0!==n.length||i?e.jsx("div",{style:s.tableContainer,children:e.jsx(Re,{"data-testid":`ds-cluster-machines-table-${a.clusterName}`,columns:o,dataSource:n,rowKey:"machineName",loading:i,size:"small",pagination:!1})}):e.jsx(Se,{description:t("clusters.noMachinesAssigned")})]})},{Text:Ia}=$e,Aa=({open:a,image:t,teamName:s,poolName:i,onCancel:o,onSuccess:l})=>{const{t:r}=ke(["distributedStorage","machines","common"]),[c,d]=n.useState(""),h=q(),p=m(),x=u(),{data:y=[],isLoading:j}=E(s,a&&!!t);n.useEffect(()=>{a||d("")},[a]);return e.jsx(Ie,{title:e.jsxs(_e,{style:p.flexStart,children:[e.jsx(fa,{style:p.icon.medium}),e.jsx("span",{style:p.heading4,children:r("distributedStorage:images.reassignMachine")})]}),open:a,onOk:async()=>{if(t&&c)try{await h.mutateAsync({teamName:s,poolName:i,imageName:t.imageName,newMachineName:c}),l&&l(),o()}catch(e){}},onCancel:o,okText:r("common:actions.save"),cancelText:r("common:actions.cancel"),confirmLoading:h.isPending,okButtonProps:{disabled:!c||c===t?.machineName,"data-testid":"image-reassign-submit",style:{...p.buttonPrimary,...p.touchTarget}},cancelButtonProps:{"data-testid":"image-reassign-cancel",style:{...p.buttonSecondary,...p.touchTarget}},className:g.Medium,"data-testid":"image-reassign-modal",children:t&&e.jsxs(_e,{direction:"vertical",size:"large",style:{width:"100%",...p.padding.md},children:[e.jsxs("div",{children:[e.jsxs(Ia,{strong:!0,style:p.label,children:[r("distributedStorage:images.image"),": "]}),e.jsx(Ia,{style:p.body,children:t.imageName})]}),e.jsxs("div",{children:[e.jsxs(Ia,{strong:!0,style:p.label,children:[r("distributedStorage:pools.pool"),": "]}),e.jsx(Ia,{style:p.body,children:i})]}),t.machineName&&e.jsx(Pe,{message:e.jsx("span",{style:p.body,children:r("machines:currentMachineAssignment",{machine:t.machineName})}),type:"info",showIcon:!0,icon:e.jsx(I,{style:p.icon.small}),style:{borderRadius:"var(--border-radius-lg)"},"data-testid":"image-reassign-current-machine-info"}),e.jsxs("div",{children:[e.jsxs(Ia,{strong:!0,style:{display:"block",...p.marginBottom.xs,...p.label},children:[r("distributedStorage:images.selectNewMachine"),":"]}),j?e.jsx("div",{style:p.flexCenter,children:e.jsx(Ce,{"data-testid":"image-reassign-loading"})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{style:{width:"100%",...x.formInput},placeholder:r("machines:selectMachine"),value:c,onChange:d,showSearch:!0,optionFilterProp:"children",notFoundContent:0===y.length?e.jsx("span",{style:p.body,children:r("machines:noAvailableMachines")}):e.jsx("span",{style:p.body,children:r("common:noMatchingResults")}),"data-testid":"image-reassign-machine-select",children:[t.machineName&&e.jsx(we.Option,{value:t.machineName,disabled:!0,"data-testid":`image-reassign-machine-option-${t.machineName}`,children:e.jsxs("span",{style:{...p.body,opacity:.6},children:[t.machineName," (",r("common:current"),")"]})},t.machineName),y.map(a=>e.jsx(we.Option,{value:a.machineName,"data-testid":`image-reassign-machine-option-${a.machineName}`,children:e.jsx("span",{style:p.body,children:a.machineName})},a.machineName))]}),e.jsx(Ia,{type:"secondary",style:{display:"block",...p.marginBottom.xs,...p.caption},children:r("distributedStorage:images.reassignmentInfo")})]})]}),e.jsx(Pe,{message:e.jsx("span",{style:p.label,children:r("common:important")}),description:e.jsx("span",{style:p.body,children:r("distributedStorage:images.reassignmentWarning")}),type:"warning",showIcon:!0,style:{borderRadius:"var(--border-radius-lg)"},"data-testid":"image-reassign-warning"})]})})},{Text:Ma}=$e,Ra=({open:a,clone:t,poolName:s,imageName:i,snapshotName:o,teamName:l,onCancel:r,onSuccess:c})=>{const{t:d}=ke(["distributedStorage","machines","common"]),u=m(),[h,p]=n.useState([]),[g,x]=n.useState([]),[y,j]=n.useState("assign"),{data:k=[],isLoading:C}=E(l,a&&!!t),{data:w=[],isLoading:S,refetch:_}=G(t?.cloneName||"",o,i,s,l,a&&!!t),T=W(),A=U();n.useEffect(()=>{a&&(p([]),x([]),j("assign"))},[a]);return e.jsx(Ie,{"data-testid":"assign-clone-modal",title:e.jsxs(_e,{children:[e.jsx($,{}),d("distributedStorage:clones.manageMachines"),t&&e.jsx(Te,{color:"orange",children:t.cloneName})]}),open:a,onCancel:r,style:b(N.DIMENSIONS.MODAL_WIDTH_LG),footer:"assign"===y?[e.jsx(Me,{onClick:r,"data-testid":"assign-clone-cancel",style:u.buttonSecondary,children:d("common:actions.cancel")},"cancel"),e.jsx(Me,{type:"primary",loading:T.isPending,disabled:0===h.length,onClick:async()=>{if(t&&0!==h.length)try{await T.mutateAsync({teamName:l,poolName:s,imageName:i,snapshotName:o,cloneName:t.cloneName,machineNames:h.join(",")}),f("success",d("distributedStorage:clones.machinesAssignedSuccess")),_(),p([]),c?.()}catch(e){}},"data-testid":"assign-clone-submit",style:u.buttonPrimary,children:d("distributedStorage:machines.assignMachine")},"assign")]:[e.jsx(Me,{onClick:r,"data-testid":"assign-clone-cancel",style:u.buttonSecondary,children:d("common:actions.cancel")},"cancel"),e.jsx(Me,{type:"primary",danger:!0,loading:A.isPending,disabled:0===g.length,onClick:async()=>{if(t&&0!==g.length)try{await A.mutateAsync({teamName:l,poolName:s,imageName:i,snapshotName:o,cloneName:t.cloneName,machineNames:g.join(",")}),f("success",d("distributedStorage:clones.machinesRemovedSuccess")),_(),x([]),c?.()}catch(e){}},"data-testid":"assign-clone-remove-submit",style:u.buttonPrimary,children:d("distributedStorage:machines.unassignMachine")},"remove")],children:e.jsx(Ae,{activeKey:y,onChange:e=>j(e),"data-testid":"assign-clone-tabs",items:[{key:"assign",label:d("distributedStorage:clones.assignMachines"),children:C?e.jsx(Ce,{}):0===k.length?e.jsx(Se,{description:d("machines:noAvailableMachinesForClone"),style:{marginTop:v("XL")}}):e.jsxs(_e,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(Pe,{message:d("distributedStorage:clones.assignMachinesInfo"),type:"info",showIcon:!0}),e.jsxs("div",{children:[e.jsxs(Ma,{strong:!0,style:{display:"block",marginBottom:v("XS")},children:[d("distributedStorage:machines.selectMachines"),":"]}),e.jsx(we,{mode:"multiple",style:{width:"100%"},placeholder:d("machines:selectMachines"),value:h,onChange:p,showSearch:!0,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),options:k.map(e=>({label:e.machineName,value:e.machineName})),"data-testid":"assign-clone-machine-select"}),e.jsx(Ma,{type:"secondary",style:{display:"block",marginTop:v("XS")},"data-testid":"assign-clone-selected-count",children:d("machines:bulkOperations.selectedCount",{count:h.length})})]})]})},{key:"manage",label:d("distributedStorage:clones.assignedMachines"),children:(()=>{if(S)return e.jsx(Ce,{});if(0===w.length)return e.jsx(Se,{description:d("distributedStorage:clones.noMachinesAssigned"),style:{marginTop:v("XL")}});const a=[{title:d("machines:machineName"),dataIndex:"machineName",key:"machineName",render:a=>e.jsxs(_e,{children:[e.jsx(I,{}),e.jsx(Ma,{children:a})]})},{title:d("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",render:a=>e.jsx(Te,{color:"green",children:a})}];return e.jsxs(_e,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(Pe,{message:d("distributedStorage:clones.removeMachinesInfo"),type:"warning",showIcon:!0}),e.jsx(Re,{rowSelection:{selectedRowKeys:g,onChange:e=>x(e),getCheckboxProps:e=>({"data-testid":`assign-clone-machine-checkbox-${e.machineName}`})},columns:a,dataSource:w,rowKey:"machineName",size:"small",pagination:!1,scroll:{y:300},"data-testid":"assign-clone-machines-table"}),e.jsx(Ma,{type:"secondary","data-testid":"assign-clone-remove-selected-count",children:d("machines:bulkOperations.selectedCount",{count:g.length})})]})})()}]})})},{Text:Va}=$e,za=({snapshot:a,image:t,pool:s})=>{const{t:i}=ke("distributedStorage"),[o,l]=n.useState({open:!1,mode:"create"}),[r,c]=n.useState(!1),[d,m]=n.useState(""),[u,h]=n.useState({open:!1,clone:null}),[p,g]=n.useState([]),x=H(),{buildQueueVault:y}=R(),{data:j=[],isLoading:b}=X(a.snapshotGuid),N=Q(),v=Z(),f=J(),k=async(e,n)=>{try{const i=await y({functionName:e,teamName:s.teamName,params:{cluster_name:s.clusterName,pool_name:s.poolName,image_name:t.imageName,snapshot_name:a.snapshotName,clone_name:n?.cloneName||""},priority:3,description:`Execute ${e}`,addedVia:"DistributedStorage"}),o=(await x.mutateAsync({teamName:s.teamName,machineName:s.clusterName,bridgeName:"default",queueVault:i,priority:3})).taskId;o&&C(o)}catch(o){Ve.error(i("queue.createError"))}},C=e=>{m(e),c(!0),Ve.success(i("queue.itemCreated"))},w=e=>{h({open:!0,clone:e})},S=n=>[{key:"edit",label:i("clones.edit"),icon:e.jsx(qe,{}),onClick:()=>(e=>{l({open:!0,mode:"edit",data:{...e,vaultContent:e.vaultContent||e.cloneVault}})})(n),"data-testid":`clone-list-edit-${n.cloneName}`},{key:"manageMachines",label:i("clones.manageMachines"),icon:e.jsx(Ge,{}),onClick:()=>w(n),"data-testid":`clone-list-manage-machines-${n.cloneName}`},{type:"divider"},{key:"flatten",label:i("clones.flatten"),icon:e.jsx(We,{}),onClick:()=>k("distributed_storage_rbd_flatten",n),"data-testid":`clone-list-flatten-${n.cloneName}`},{key:"split",label:i("clones.split"),icon:e.jsx(Ue,{}),onClick:()=>k("distributed_storage_rbd_clone_split",n),"data-testid":`clone-list-split-${n.cloneName}`},{type:"divider"},{key:"export",label:i("clones.export"),icon:e.jsx(Be,{}),onClick:()=>k("distributed_storage_rbd_export",n),"data-testid":`clone-list-export-${n.cloneName}`},{key:"info",label:i("clones.info"),icon:e.jsx(He,{}),onClick:()=>k("distributed_storage_rbd_info",n),"data-testid":`clone-list-info-${n.cloneName}`},{type:"divider"},{key:"delete",label:i("clones.delete"),icon:e.jsx(Xe,{}),danger:!0,onClick:()=>(e=>{N.mutate({cloneName:e.cloneName,snapshotName:a.snapshotName,imageName:t.imageName,poolName:s.poolName,teamName:e.teamName})})(n),"data-testid":`clone-list-delete-${n.cloneName}`}],_=({clone:a,snapshot:t,image:s,pool:n})=>{const{data:o=[],isLoading:l}=G(a.cloneName,t.snapshotName,s.imageName,n.poolName,n.teamName,!0);return l?e.jsx(Ce,{}):0===o.length?e.jsxs("div",{style:{padding:"16px",textAlign:"center"},children:[e.jsx(Se,{description:i("clones.noMachinesAssigned")}),e.jsx(Me,{type:"primary",icon:e.jsx(Ge,{}),onClick:()=>w(a),style:{marginTop:16},"data-testid":`clone-list-assign-machines-empty-${a.cloneName}`,children:i("clones.assignMachines")})]}):e.jsx("div",{style:{padding:"16px"},"data-testid":`clone-list-machines-container-${a.cloneName}`,children:e.jsxs(_e,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(_e,{children:[e.jsx(Ge,{}),e.jsxs(Va,{strong:!0,children:[i("clones.assignedMachines"),":"]}),e.jsxs(Te,{"data-testid":`clone-list-machine-count-${a.cloneName}`,children:[o.length," ",i("machines:machines")]})]}),e.jsx(_e,{wrap:!0,children:o.map(t=>e.jsx(Te,{icon:e.jsx(Ke,{}),color:"blue","data-testid":`clone-list-machine-tag-${a.cloneName}-${t.machineName}`,children:t.machineName},t.machineName))}),e.jsx(Me,{icon:e.jsx(Ge,{}),onClick:()=>w(a),"data-testid":`clone-list-manage-machines-button-${a.cloneName}`,children:i("clones.manageMachines")})]})})},$=({clone:n})=>{const{data:i=[]}=G(n.cloneName,a.snapshotName,t.imageName,s.poolName,s.teamName,!0);return e.jsx(Le,{count:i.length,showZero:!0,style:{backgroundColor:i.length>0?"#52c41a":"#d9d9d9"},"data-testid":`clone-list-machine-badge-${n.cloneName}`,children:e.jsx(Ke,{style:{fontSize:16}})})},T=[{title:i("clones.name"),dataIndex:"cloneName",key:"cloneName",render:(a,t)=>e.jsxs(_e,{"data-testid":`clone-list-item-${t.cloneName}`,children:[e.jsx(Ee,{}),e.jsx("span",{children:a}),t.vaultContent&&e.jsx(ze,{title:i("common.hasVault"),children:e.jsx(Te,{color:"blue","data-testid":`clone-list-vault-tag-${t.cloneName}`,children:i("common.vault")})})]})},{title:i("clones.guid"),dataIndex:"cloneGuid",key:"cloneGuid",width:300,render:a=>e.jsx(ze,{title:a,children:e.jsxs("span",{style:{fontFamily:"monospace",fontSize:"12px"},children:[a.substring(0,8),"..."]})})},{title:i("machines:machines"),key:"machines",width:100,align:"center",render:(a,t)=>e.jsx($,{clone:t})},{title:i("common.actions"),key:"actions",width:150,render:(a,t)=>e.jsxs(_e,{children:[e.jsx(Me,{size:"small",icon:e.jsx(Be,{}),onClick:()=>k("distributed_storage_rbd_info",t),"data-testid":`clone-list-remote-${t.cloneName}`,children:i("common.remote")}),e.jsx(Fe,{menu:{items:S(t)},trigger:["click"],children:e.jsx(Me,{size:"small",icon:e.jsx(De,{}),"data-testid":`clone-list-actions-${t.cloneName}`})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"16px 16px 16px 32px",backgroundColor:"#fafafa"},"data-testid":"clone-list-container",children:[e.jsx("h5",{children:i("clones.title")}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(Me,{type:"primary",icon:e.jsx(Oe,{}),onClick:()=>{l({open:!0,mode:"create"})},size:"small","data-testid":"clone-list-create-button",children:i("clones.create")})}),e.jsx(Re,{columns:T,dataSource:j,rowKey:"cloneGuid",loading:b,size:"small",pagination:!1,"data-testid":"clone-list-table",expandable:{expandedRowRender:n=>e.jsx(_,{clone:n,snapshot:a,image:t,pool:s}),rowExpandable:()=>!0,expandedRowKeys:p,onExpandedRowsChange:e=>g(e)}})]}),e.jsx(V,{open:o.open,onCancel:()=>l({open:!1,mode:"create"}),resourceType:"clone",mode:o.mode,existingData:{...o.data,teamName:s.teamName,poolName:s.poolName,imageName:t.imageName,snapshotName:a.snapshotName,pools:[s],images:[t],snapshots:[a],vaultContent:o.data?.vaultContent||o.data?.cloneVault},teamFilter:s.teamName,onSubmit:async e=>{"create"===o.mode?await v.mutateAsync({snapshotName:a.snapshotName,imageName:t.imageName,poolName:s.poolName,teamName:s.teamName,cloneName:e.cloneName,cloneVault:e.cloneVault}):"edit"===o.mode&&await f.mutateAsync({poolName:s.poolName,teamName:s.teamName,poolVault:e.cloneVault,vaultVersion:o.data?.vaultVersion||0}),l({open:!1,mode:"create"})},isSubmitting:v.isPending||f.isPending}),e.jsx(be,{visible:r,onClose:()=>c(!1),taskId:d}),e.jsx(Ra,{open:u.open,clone:u.clone,poolName:s.poolName,imageName:t.imageName,snapshotName:a.snapshotName,teamName:s.teamName,onCancel:()=>h({open:!1,clone:null}),onSuccess:()=>{h({open:!1,clone:null})}})]})},Fa=({image:a,pool:t,teamFilter:s})=>{const{t:i}=ke("distributedStorage"),o=x(),l=m(),[r,c]=n.useState([]),[d,u]=n.useState({open:!1,mode:"create"}),[h,p]=n.useState(!1),[g,y]=n.useState(""),j=H(),{buildQueueVault:b}=R(),{data:N=[],isLoading:v}=Y(a.imageGuid),f=ee(),k=ae(),C=J(),w=async(e,s)=>{try{const n=await b({functionName:e,teamName:t.teamName,params:{cluster_name:t.clusterName,pool_name:t.poolName,image_name:a.imageName,snapshot_name:s?.snapshotName||""},priority:3,description:`Execute ${e}`,addedVia:"DistributedStorage"}),i=(await j.mutateAsync({teamName:t.teamName,machineName:t.clusterName,bridgeName:"default",queueVault:n,priority:3})).taskId;i&&S(i)}catch(n){Ve.error(i("queue.createError"))}},S=e=>{y(e),p(!0),Ve.success(i("queue.itemCreated"))},_=s=>[{key:"edit",label:e.jsx("span",{"data-testid":`snapshot-list-edit-${s.snapshotName}`,children:i("snapshots.edit")}),icon:e.jsx(qe,{}),onClick:()=>(e=>{u({open:!0,mode:"edit",data:{...e,vaultContent:e.vaultContent||e.snapshotVault}})})(s)},{type:"divider"},{key:"clone",label:e.jsx("span",{"data-testid":`snapshot-list-clone-${s.snapshotName}`,children:i("snapshots.createClone")}),icon:e.jsx(Ee,{}),onClick:()=>w("distributed_storage_rbd_clone_create",s)},{key:"rollback",label:e.jsx("span",{"data-testid":`snapshot-list-rollback-${s.snapshotName}`,children:i("snapshots.rollback")}),icon:e.jsx(Ze,{}),onClick:()=>w("distributed_storage_rbd_snapshot_rollback",s)},{type:"divider"},{key:"export",label:e.jsx("span",{"data-testid":`snapshot-list-export-${s.snapshotName}`,children:i("snapshots.export")}),icon:e.jsx(Be,{}),onClick:()=>w("distributed_storage_rbd_export",s)},{key:"diff",label:e.jsx("span",{"data-testid":`snapshot-list-diff-${s.snapshotName}`,children:i("snapshots.diff")}),icon:e.jsx(He,{}),onClick:()=>w("distributed_storage_rbd_diff",s)},{type:"divider"},{key:"protect",label:e.jsx("span",{"data-testid":`snapshot-list-protect-${s.snapshotName}`,children:i("snapshots.protect")}),icon:e.jsx(Je,{}),onClick:()=>w("distributed_storage_rbd_snapshot_protect",s)},{key:"unprotect",label:e.jsx("span",{"data-testid":`snapshot-list-unprotect-${s.snapshotName}`,children:i("snapshots.unprotect")}),icon:e.jsx(Je,{}),onClick:()=>w("distributed_storage_rbd_snapshot_unprotect",s)},{type:"divider"},{key:"delete",label:e.jsx("span",{"data-testid":`snapshot-list-delete-${s.snapshotName}`,children:i("snapshots.delete")}),icon:e.jsx(Xe,{}),danger:!0,onClick:()=>(e=>{f.mutate({snapshotName:e.snapshotName,imageName:a.imageName,poolName:t.poolName,teamName:e.teamName})})(s)}],$=[{title:i("snapshots.name"),dataIndex:"snapshotName",key:"snapshotName",render:(a,t)=>e.jsxs(_e,{"data-testid":`snapshot-list-item-${t.snapshotName}`,children:[e.jsx(Qe,{style:{...o.icon.medium,color:"var(--color-primary)"}}),e.jsx("span",{style:{color:"var(--color-text-primary)"},children:a}),t.vaultContent&&e.jsx(ze,{title:i("common.hasVault"),children:e.jsx(Te,{color:"blue","data-testid":`snapshot-list-vault-indicator-${t.snapshotName}`,children:i("common.vault")})})]})},{title:i("snapshots.guid"),dataIndex:"snapshotGuid",key:"snapshotGuid",width:300,render:a=>e.jsx(ze,{title:a,children:e.jsxs("span",{style:{fontFamily:"monospace",fontSize:"12px",color:"var(--color-text-secondary)"},children:[a.substring(0,8),"..."]})})},{title:i("common.actions"),key:"actions",width:150,render:(a,t)=>e.jsxs(_e,{children:[e.jsx(ze,{title:i("common.remote"),children:e.jsx(Me,{size:"small",icon:e.jsx(Be,{}),onClick:()=>w("distributed_storage_rbd_snapshot_list",t),"data-testid":`snapshot-list-remote-${t.snapshotName}`,style:o.tableActionButton,"aria-label":i("common.remote")})}),e.jsx(Fe,{menu:{items:_(t)},trigger:["click"],children:e.jsx(Me,{size:"small",icon:e.jsx(De,{}),"data-testid":`snapshot-list-menu-${t.snapshotName}`,style:o.tableActionButton})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{...l.padding.md,background:"var(--color-fill-quaternary)"},"data-testid":"snapshot-list-container",children:[e.jsx("h4",{style:{...l.heading4,...l.marginBottom.sm},children:i("snapshots.title")}),e.jsx("div",{style:l.marginBottom.md,children:e.jsx(ze,{title:i("snapshots.create"),children:e.jsx(Me,{type:"primary",icon:e.jsx(Oe,{}),onClick:()=>{u({open:!0,mode:"create"})},size:"small","data-testid":"snapshot-list-create-button",style:l.touchTarget,"aria-label":i("snapshots.create")})})}),e.jsx("div",{style:o.tableContainer,children:e.jsx(Re,{columns:$,dataSource:N,rowKey:"snapshotGuid",loading:v,size:"small",pagination:!1,"data-testid":"snapshot-list-table",expandable:{expandedRowRender:n=>e.jsx(za,{snapshot:n,image:a,pool:t,teamFilter:s}),expandedRowKeys:r,onExpandedRowsChange:e=>c(e),expandIcon:({expanded:a,onExpand:t,record:s})=>e.jsx(Me,{size:"small",icon:e.jsx(Ee,{}),onClick:e=>t(s,e),style:{...o.tableActionButton,marginRight:8},"data-testid":`snapshot-list-expand-${s.snapshotName}`})}})})]}),e.jsx(V,{open:d.open,onCancel:()=>u({open:!1,mode:"create"}),resourceType:"snapshot",mode:d.mode,existingData:{...d.data,teamName:t.teamName,poolName:t.poolName,imageName:a.imageName,pools:[t],images:[a],vaultContent:d.data?.vaultContent||d.data?.snapshotVault},teamFilter:t.teamName,onSubmit:async e=>{"create"===d.mode?await k.mutateAsync({imageName:a.imageName,poolName:t.poolName,teamName:t.teamName,snapshotName:e.snapshotName,snapshotVault:e.snapshotVault}):"edit"===d.mode&&await C.mutateAsync({poolName:t.poolName,teamName:t.teamName,poolVault:e.snapshotVault,vaultVersion:d.data?.vaultVersion||0}),u({open:!1,mode:"create"})},isSubmitting:k.isPending||C.isPending,"data-testid":`snapshot-list-modal-${d.mode}`}),e.jsx(be,{visible:h,onClose:()=>p(!1),taskId:g,"data-testid":"snapshot-list-queue-modal"})]})},La=({pool:a,teamFilter:t})=>{const{t:s}=ke("distributedStorage"),i=x(),o=m(),[l,r]=n.useState([]),[c,d]=n.useState({open:!1,mode:"create"}),[u,h]=n.useState(!1),[p,g]=n.useState(""),[y,j]=n.useState({open:!1,image:null}),b=H(),{buildQueueVault:N}=R(),{data:v=[],isLoading:f}=te(a.poolGuid),k=se(),C=ne(),w=J(),{data:S=[]}=E(a.teamName,c.open&&"create"===c.mode),_=async(e,t)=>{try{const s=await N({functionName:e,teamName:a.teamName,params:{cluster_name:a.clusterName,pool_name:a.poolName,image_name:t?.imageName||""},priority:3,description:`Execute ${e}`,addedVia:"DistributedStorage"}),n=(await b.mutateAsync({teamName:a.teamName,machineName:a.clusterName,bridgeName:"default",queueVault:s,priority:3})).taskId;n&&$(n)}catch(n){Ve.error(s("queue.createError"))}},$=e=>{g(e),h(!0),Ve.success(s("queue.itemCreated"))},T=t=>[{key:"edit",label:e.jsx("span",{"data-testid":`rbd-edit-action-${t.imageName}`,children:s("images.edit")}),icon:e.jsx(qe,{}),onClick:()=>(e=>{d({open:!0,mode:"edit",data:{...e,vaultContent:e.vaultContent||e.imageVault}})})(t)},{key:"reassignMachine",label:e.jsx("span",{"data-testid":`rbd-reassign-action-${t.imageName}`,children:s("images.reassignMachine")}),icon:e.jsx(Ke,{}),onClick:()=>(e=>{j({open:!0,image:e})})(t)},{type:"divider"},{key:"snapshot",label:e.jsx("span",{"data-testid":`rbd-snapshot-action-${t.imageName}`,children:s("images.createSnapshot")}),icon:e.jsx(Qe,{}),onClick:()=>_("distributed_storage_rbd_snapshot_create",t)},{key:"clone",label:e.jsx("span",{"data-testid":`rbd-clone-action-${t.imageName}`,children:s("images.clone")}),icon:e.jsx(Ee,{}),onClick:()=>_("distributed_storage_rbd_clone",t)},{key:"resize",label:e.jsx("span",{"data-testid":`rbd-resize-action-${t.imageName}`,children:s("images.resize")}),icon:e.jsx(ea,{}),onClick:()=>_("distributed_storage_rbd_resize",t)},{type:"divider"},{key:"export",label:e.jsx("span",{"data-testid":`rbd-export-action-${t.imageName}`,children:s("images.export")}),icon:e.jsx(Be,{}),onClick:()=>_("distributed_storage_rbd_export",t)},{key:"import",label:e.jsx("span",{"data-testid":`rbd-import-action-${t.imageName}`,children:s("images.import")}),icon:e.jsx(aa,{}),onClick:()=>_("distributed_storage_rbd_import",t)},{type:"divider"},{key:"info",label:e.jsx("span",{"data-testid":`rbd-info-action-${t.imageName}`,children:s("images.info")}),icon:e.jsx(He,{}),onClick:()=>_("distributed_storage_rbd_info",t)},{key:"status",label:e.jsx("span",{"data-testid":`rbd-status-action-${t.imageName}`,children:s("images.status")}),icon:e.jsx(ta,{}),onClick:()=>_("distributed_storage_rbd_status",t)},{type:"divider"},{key:"map",label:e.jsx("span",{"data-testid":`rbd-map-action-${t.imageName}`,children:s("images.map")}),icon:e.jsx(sa,{}),onClick:()=>_("distributed_storage_rbd_map",t)},{key:"unmap",label:e.jsx("span",{"data-testid":`rbd-unmap-action-${t.imageName}`,children:s("images.unmap")}),icon:e.jsx(sa,{}),onClick:()=>_("distributed_storage_rbd_unmap",t)},{key:"showmapped",label:e.jsx("span",{"data-testid":`rbd-showmapped-action-${t.imageName}`,children:s("images.showMapped")}),icon:e.jsx(sa,{}),onClick:()=>_("distributed_storage_rbd_showmapped",t)},{type:"divider"},{key:"flatten",label:e.jsx("span",{"data-testid":`rbd-flatten-action-${t.imageName}`,children:s("images.flatten")}),icon:e.jsx(We,{}),onClick:()=>_("distributed_storage_rbd_flatten",t)},{type:"divider"},{key:"delete",label:e.jsx("span",{"data-testid":`rbd-delete-action-${t.imageName}`,children:s("images.delete")}),icon:e.jsx(Xe,{}),danger:!0,onClick:()=>(e=>{k.mutate({imageName:e.imageName,poolName:a.poolName,teamName:e.teamName})})(t)}],I=[{title:s("images.name"),dataIndex:"imageName",key:"imageName",render:(a,t)=>e.jsxs(_e,{"data-testid":`rbd-image-name-${t.imageName}`,children:[e.jsx(Ye,{style:{...i.icon.medium,color:"var(--color-primary)"}}),e.jsx("span",{style:{color:"var(--color-text-primary)"},children:a}),t.vaultContent&&e.jsx(ze,{title:s("common.hasVault"),children:e.jsx(Te,{color:"blue","data-testid":`rbd-vault-tag-${t.imageName}`,children:s("common.vault")})})]})},{title:s("images.guid"),dataIndex:"imageGuid",key:"imageGuid",width:300,render:a=>e.jsx(ze,{title:a,children:e.jsxs("span",{style:{fontFamily:"monospace",fontSize:"12px",color:"var(--color-text-secondary)"},children:[a.substring(0,8),"..."]})})},{title:s("images.assignedMachine"),dataIndex:"machineName",key:"machineName",width:200,render:(a,t)=>a?e.jsx(Te,{icon:e.jsx(Ke,{}),color:"blue","data-testid":`rbd-machine-tag-${t.imageName}`,children:a}):e.jsx(Te,{color:"default","data-testid":`rbd-machine-none-${t.imageName}`,children:s("common.none")})},{title:s("common.actions"),key:"actions",width:150,render:(a,t)=>e.jsxs(_e,{"data-testid":`rbd-image-actions-${t.imageName}`,children:[e.jsx(ze,{title:s("common.remote"),children:e.jsx(Me,{size:"small",icon:e.jsx(Be,{}),onClick:()=>_("distributed_storage_rbd_info",t),"data-testid":`rbd-remote-button-${t.imageName}`,style:i.tableActionButton,"aria-label":s("common.remote")})}),e.jsx(Fe,{menu:{items:T(t)},trigger:["click"],children:e.jsx(Me,{size:"small",icon:e.jsx(De,{}),"data-testid":`rbd-actions-dropdown-${t.imageName}`,style:i.tableActionButton})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:o.marginBottom.md,"data-testid":"rbd-image-list-container",children:e.jsx(Me,{type:"primary",icon:e.jsx(Oe,{}),onClick:()=>{d({open:!0,mode:"create"})},"data-testid":"rbd-create-image-button",style:o.touchTarget,children:s("images.create")})}),e.jsx("div",{style:i.tableContainer,children:e.jsx(Re,{columns:I,dataSource:v,rowKey:"imageGuid",loading:f,size:"small",pagination:!1,"data-testid":"rbd-image-table",onRow:e=>({"data-testid":`rbd-image-row-${e.imageName}`}),expandable:{expandedRowRender:s=>e.jsx("div",{"data-testid":`rbd-snapshot-list-${s.imageName}`,children:e.jsx(Fa,{image:s,pool:a,teamFilter:t})}),expandedRowKeys:l,onExpandedRowsChange:e=>r(e),expandIcon:({expanded:a,onExpand:t,record:s})=>e.jsx(Me,{size:"small",icon:e.jsx(Qe,{}),onClick:e=>t(s,e),style:{...i.tableActionButton,marginRight:8},"data-testid":`rbd-expand-snapshots-${s.imageName}`})}})}),e.jsx(V,{open:c.open,onCancel:()=>d({open:!1,mode:"create"}),resourceType:"image",mode:c.mode,existingData:{...c.data,teamName:a.teamName,poolName:a.poolName,pools:[a],availableMachines:S,vaultContent:c.data?.vaultContent||c.data?.imageVault},teamFilter:a.teamName,onSubmit:async e=>{"create"===c.mode?await C.mutateAsync({poolName:a.poolName,teamName:a.teamName,imageName:e.imageName,machineName:e.machineName,imageVault:e.imageVault}):"edit"===c.mode&&await w.mutateAsync({poolName:a.poolName,teamName:a.teamName,poolVault:e.imageVault,vaultVersion:c.data?.vaultVersion||0}),d({open:!1,mode:"create"})},isSubmitting:C.isPending||w.isPending}),e.jsx(be,{visible:u,onClose:()=>h(!1),taskId:p}),e.jsx(Aa,{open:y.open,image:y.image,teamName:a.teamName,poolName:a.poolName,onCancel:()=>j({open:!1,image:null}),onSuccess:()=>{j({open:!1,image:null})}})]})},Pa=({pools:a,clusters:t,loading:s,onCreatePool:i,onEditPool:l,onDeletePool:r,onRunFunction:c})=>{const{t:d}=ke(["distributedStorage","common"]),u=x(),h=m(),[p,g]=n.useState([]),[j,b]=n.useState({open:!1,entityType:null,entityIdentifier:null}),N=a.reduce((e,a)=>(e[a.clusterName]||(e[a.clusterName]=[]),e[a.clusterName].push(a),e),{}),v=[{title:d("pools.poolName"),dataIndex:"poolName",key:"poolName",ellipsis:!0,render:(a,t)=>{const s=p.includes(t.poolGuid||"");return e.jsxs(_e,{children:[e.jsx("span",{style:{display:"inline-block",width:12,transition:"transform 0.3s ease",transform:s?"rotate(90deg)":"rotate(0deg)"},children:e.jsx(je,{style:{...u.icon.small,color:"var(--color-text-tertiary)"}})}),e.jsx(T,{style:{...u.icon.medium,color:"var(--color-primary)"}}),e.jsx("strong",{style:{color:"var(--color-text-primary)"},children:a})]})}},{title:d("common:general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:a=>e.jsx(Te,{color:"blue",children:d("common:general.versionFormat",{version:a})})},{title:d("common:table.actions"),key:"actions",width:250,render:(a,t)=>e.jsxs(_e,{children:[e.jsx(Me,{type:"primary",size:"small",icon:e.jsx(Ne,{}),onClick:()=>l(t),"data-testid":`ds-pool-edit-${t.poolName}`,style:u.tableActionButton,children:d("common:actions.edit")}),e.jsx(Fe,{menu:{items:[{key:"list",label:d("functions.pool_list"),icon:e.jsx(T,{})},{key:"image_create",label:d("functions.image_create"),icon:e.jsx(o,{})},{type:"divider"},{key:"advanced",label:d("common:actions.advanced"),icon:e.jsx(O,{})}],onClick:({key:e})=>{c("advanced"===e?t:{...t,preselectedFunction:e})}},trigger:["click"],children:e.jsx(Me,{type:"primary",size:"small",icon:e.jsx(O,{}),"data-testid":`ds-pool-function-dropdown-${t.poolName}`,style:u.tableActionButton,children:d("common:actions.remote")})}),e.jsx(Me,{type:"default",size:"small",icon:e.jsx(y,{}),"data-testid":`ds-pool-trace-${t.poolName}`,onClick:()=>{b({open:!0,entityType:"DistributedStoragePool",entityIdentifier:t.poolName||"",entityName:t.poolName})},style:u.tableActionButton,children:d("common:actions.trace")}),e.jsx(Me,{type:"primary",danger:!0,size:"small",icon:e.jsx(M,{}),onClick:()=>{return e=t,void Ie.confirm({title:d("pools.confirmDelete"),content:d("pools.deleteWarning",{name:e.poolName}),okText:d("common:actions.delete"),okType:"danger",cancelText:d("common:actions.cancel"),onOk:()=>r(e)});var e},"data-testid":`ds-pool-delete-${t.poolName}`,style:u.tableActionButton,children:d("common:actions.delete")})]})}],f=a=>{const t=a.teamName;return e.jsx(La,{pool:a,teamFilter:t})};return 0!==a.length||s?e.jsxs(e.Fragment,{children:[Object.entries(N).map(([a,n])=>{const i=t.find(e=>e.clusterName===a);return e.jsx(na,{title:e.jsxs(_e,{children:[e.jsx(I,{style:{...u.icon.medium,color:"var(--color-primary)"}}),e.jsxs("span",{children:[d("pools.clusterPrefix"),": ",e.jsx("strong",{style:{color:"var(--color-text-primary)"},children:a})]}),i&&e.jsx(Te,{color:"green",children:i.teamName})]}),style:{...h.card,...h.marginBottom.md},children:e.jsx("div",{style:u.tableContainer,children:e.jsx(Re,{columns:v,dataSource:n,rowKey:"poolGuid",loading:s,scroll:{x:"max-content"},pagination:!1,"data-testid":`ds-pool-table-${a}`,expandable:{expandedRowRender:f,expandedRowKeys:p,onExpandedRowsChange:e=>g(e),expandIcon:()=>null,expandRowByClick:!1},onRow:e=>({"data-testid":`ds-pool-row-${e.poolName}`,onClick:a=>{const t=a.target;if(t.closest("button")||t.closest(".ant-dropdown-trigger"))return;const s=p.includes(e.poolGuid??"");g(s?p.filter(a=>a!==e.poolGuid):[...p,e.poolGuid??""])},style:{cursor:"pointer",transition:"background-color 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-fill-tertiary)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=""}})})})},a)}),e.jsx(fe,{open:j.open,onCancel:()=>b({open:!1,entityType:null,entityIdentifier:null}),entityType:j.entityType||"",entityIdentifier:j.entityIdentifier||"",entityName:j.entityName})]}):e.jsx(Se,{description:d("pools.noPools"),style:h.marginBottom.xl,children:e.jsx(Me,{type:"primary",onClick:i,"data-testid":"ds-create-pool-empty",style:h.touchTarget,children:d("pools.create")})})},Ea=({machines:a,loading:t=!1,selectedRowKeys:s=[],onSelectionChange:n,showSelection:i=!1,expandedRowKeys:o=[],onExpandedRowsChange:l,refreshKeys:r={}})=>{const{t:c}=ke(["machines","distributedStorage"]),d=x(),u=m(),h=[{title:c("machines:machineName"),dataIndex:"machineName",key:"machineName",ellipsis:!0,sorter:(e,a)=>e.machineName.localeCompare(a.machineName)},{title:c("machines:team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:a=>e.jsx(Te,{color:"green",children:a}),sorter:(e,a)=>e.teamName.localeCompare(a.teamName)},{title:c("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",width:150,ellipsis:!0,render:a=>e.jsx(Te,{color:"green",children:a}),sorter:(e,a)=>e.bridgeName.localeCompare(a.bridgeName)},{title:c("distributedStorage:assignment.status"),key:"assignmentStatus",width:200,ellipsis:!0,render:(a,t)=>e.jsx(ie,{machine:t})},{title:c("machines:queueItems"),dataIndex:"queueCount",key:"queueCount",width:100,align:"center",sorter:(e,a)=>e.queueCount-a.queueCount,render:a=>e.jsx(Le,{count:a,showZero:!0,style:{backgroundColor:a>0?"var(--color-success)":"var(--color-fill-quaternary)",color:a>0?"var(--color-white)":"var(--color-text-secondary)"}})}],p=i?{selectedRowKeys:s,onChange:e=>{n?.(e)}}:void 0;return e.jsx("div",{style:d.tableContainer,children:e.jsx(Re,{columns:h,dataSource:a,rowKey:"machineName",loading:t,rowSelection:p,"data-testid":"ds-machines-table",expandable:{expandedRowKeys:o,onExpandedRowsChange:l?e=>l(e):void 0,expandedRowRender:a=>e.jsx("div",{style:{...u.padding.md,background:"var(--color-fill-quaternary)"},children:e.jsx(oe,{machine:a,refreshKey:r[a.machineName]})}),rowExpandable:e=>e.queueCount>0},scroll:{x:800},pagination:{showSizeChanger:!0,showTotal:(e,a)=>c("machines:showingMachines",{start:a[0],end:a[1],total:e})}})})},Ba=({teamFilter:a,onRefresh:t})=>{const{t:s}=ke(["distributedStorage","machines"]),{data:n=[],isLoading:o,refetch:l}=z(a),r=i.useMemo(()=>{const e={total:n.length,available:0,cluster:0,image:0,clone:0};return n.forEach(a=>{a.distributedStorageClusterName?e.cluster++:e.available++}),e},[n]);return o?e.jsx(na,{style:{marginBottom:16},children:e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(Ce,{})})}):e.jsx(na,{title:s("machines.summary.title"),extra:e.jsx(A,{style:{cursor:"pointer"},onClick:()=>{l(),t?.()},spin:o,"data-testid":"ds-machines-summary-refresh"}),style:{marginBottom:16},"data-testid":"ds-machines-summary-card",children:e.jsxs(ia,{gutter:16,children:[e.jsx(oa,{xs:24,sm:12,md:8,lg:4,children:e.jsx(na,{size:"small",style:{textAlign:"center"},"data-testid":"ds-machines-summary-total",children:e.jsx(la,{title:s("machines.summary.total"),value:r.total,prefix:e.jsx(_,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(oa,{xs:24,sm:12,md:8,lg:5,children:e.jsx(na,{size:"small",style:{textAlign:"center"},"data-testid":"ds-machines-summary-available",children:e.jsx(la,{title:s("machines.summary.available"),value:r.available,prefix:e.jsx(p,{}),valueStyle:{color:"#52c41a"},suffix:e.jsxs("span",{style:{fontSize:14,color:"#666"},children:["(",r.total>0?Math.round(r.available/r.total*100):0,"%)"]})})})}),e.jsx(oa,{xs:24,sm:12,md:8,lg:5,children:e.jsx(na,{size:"small",style:{textAlign:"center"},"data-testid":"ds-machines-summary-clusters",children:e.jsx(la,{title:s("machines.summary.assignedToClusters"),value:r.cluster,prefix:e.jsx(I,{}),valueStyle:{color:"#1890ff"},suffix:e.jsxs("span",{style:{fontSize:14,color:"#666"},children:["(",r.total>0?Math.round(r.cluster/r.total*100):0,"%)"]})})})}),e.jsx(oa,{xs:24,sm:12,md:8,lg:5,children:e.jsx(na,{size:"small",style:{textAlign:"center"},"data-testid":"ds-machines-summary-images",children:e.jsx(la,{title:s("machines.summary.assignedToImages"),value:r.image,prefix:e.jsx(k,{}),valueStyle:{color:"#fa8c16"},suffix:e.jsxs("span",{style:{fontSize:14,color:"#666"},children:["(",r.total>0?Math.round(r.image/r.total*100):0,"%)"]})})})}),e.jsx(oa,{xs:24,sm:12,md:8,lg:5,children:e.jsx(na,{size:"small",style:{textAlign:"center"},"data-testid":"ds-machines-summary-clones",children:e.jsx(la,{title:s("machines.summary.assignedToClones"),value:r.clone,prefix:e.jsx($,{}),valueStyle:{color:"#722ed1"},suffix:e.jsxs("span",{style:{fontSize:14,color:"#666"},children:["(",r.total>0?Math.round(r.clone/r.total*100):0,"%)"]})})})})]})})},{Search:Da}=ra,Oa=({teamFilter:t})=>{const{t:s}=ke(["distributedStorage","machines","common"]),o=m(),l="expert"===a(e=>e.ui.uiMode),[r,c]=n.useState(""),[d,u]=n.useState("all"),[h,p]=n.useState([]),[g,x]=n.useState([]),[y,j]=n.useState({}),[b,N]=n.useState({open:!1,machine:null}),[v,k]=n.useState(!1),[w,S]=n.useState(!1),[_,$]=n.useState(!1),{data:T=[],isLoading:A,refetch:M}=z(t),R=i.useMemo(()=>{if(!T||!Array.isArray(T))return[];let e=T;return r&&(e=e.filter(e=>e.machineName.toLowerCase().includes(r.toLowerCase())||e.teamName.toLowerCase().includes(r.toLowerCase())||e.bridgeName.toLowerCase().includes(r.toLowerCase()))),"all"!==d&&(e=e.filter(e=>{switch(d){case"available":return!e.distributedStorageClusterName;case"cluster":return!!e.distributedStorageClusterName;case"image":case"clone":return!1;default:return!0}})),e},[T,r,d]);return e.jsxs(e.Fragment,{children:[e.jsx(Ba,{teamFilter:t,onRefresh:()=>{M(),j({})}}),e.jsx(na,{style:{...o.card,...o.marginBottom.md},children:e.jsxs(ia,{gutter:[16,16],align:"middle",children:[e.jsx(oa,{xs:24,sm:12,lg:8,children:e.jsx(Da,{placeholder:s("machines.filters.searchPlaceholder"),value:r,onChange:e=>c(e.target.value),prefix:e.jsx(da,{}),allowClear:!0,"data-testid":"ds-machines-search",style:o.input})}),e.jsx(oa,{xs:24,sm:12,lg:8,children:e.jsxs(we,{style:{width:"100%",...o.input},placeholder:s("machines.filters.assignmentStatus"),value:d,onChange:u,suffixIcon:e.jsx(ua,{}),"data-testid":"ds-machines-filter-assignment",children:[e.jsx(we.Option,{value:"all",children:s("machines.filters.allStatuses")}),e.jsx(we.Option,{value:"available",children:s("assignment.available")}),e.jsx(we.Option,{value:"cluster",children:s("assignment.assignedToCluster")}),e.jsx(we.Option,{value:"image",children:s("assignment.assignedToImage")}),e.jsx(we.Option,{value:"clone",children:s("assignment.assignedToClone")})]})}),e.jsx(oa,{xs:24,lg:8,style:{textAlign:"right"},children:e.jsx(_e,{children:e.jsx(Me,{icon:e.jsx(ma,{}),onClick:()=>{const e=[["Machine Name","Team","Bridge","Assignment Status","Assigned To"],...R.map(e=>[e.machineName,e.teamName,e.bridgeName,e.distributedStorageClusterName?"Cluster":"Available",e.distributedStorageClusterName||""])].map(e=>e.join(",")).join("\n"),a=new Blob([e],{type:"text/csv"}),t=URL.createObjectURL(a),n=document.createElement("a");n.href=t,n.download=`distributed-storage-machines-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),f("success",s("common:export.success"))},"data-testid":"ds-machines-export-button",style:o.touchTarget,children:s("machines.actions.exportReport")})})})]})}),l&&0!==h.length?e.jsxs("div",{style:{...o.marginBottom.md,...o.padding.md,background:"var(--color-fill-quaternary)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(_e,{children:[e.jsx("span",{style:{...o.label,fontWeight:500},children:s("machines:bulkActions.selected",{count:h.length})}),e.jsx(Me,{size:"small",onClick:()=>p([]),"data-testid":"ds-machines-clear-selection",style:o.touchTarget,children:s("common:actions.clearSelection")})]}),e.jsxs(_e,{children:[e.jsx(Me,{type:"primary",icon:e.jsx(I,{}),onClick:()=>k(!0),"data-testid":"ds-machines-bulk-assign-cluster",style:o.touchTarget,children:s("machines:bulkActions.assignToCluster")}),e.jsx(Me,{icon:e.jsx(I,{}),onClick:()=>S(!0),"data-testid":"ds-machines-bulk-remove-cluster",style:o.touchTarget,children:s("machines:bulkActions.removeFromCluster")}),e.jsx(Me,{icon:e.jsx(C,{}),onClick:()=>$(!0),"data-testid":"ds-machines-bulk-view-status",style:o.touchTarget,children:s("machines:bulkActions.viewAssignmentStatus")})]})]}):null,e.jsx(na,{style:o.card,children:e.jsx(Ea,{machines:R,loading:A,selectedRowKeys:h,onSelectionChange:p,showSelection:l,expandedRowKeys:g,onExpandedRowsChange:x,refreshKeys:y})}),e.jsx(le,{open:b.open||v,onCancel:()=>{N({open:!1,machine:null}),k(!1)},machine:b.machine,machines:v&&T&&Array.isArray(T)?T.filter(e=>h.includes(e.machineName)):void 0,onSuccess:()=>{N({open:!1,machine:null}),k(!1),p([]),M()}}),e.jsx(re,{open:w,onCancel:()=>S(!1),selectedMachines:h,allMachines:T,onSuccess:()=>{S(!1),p([]),M()}}),e.jsx(ce,{open:_,onCancel:()=>$(!1),selectedMachines:h,allMachines:T})]})},{Title:Ka}=$e,qa=()=>{const{t:a}=ke(["distributedStorage","common"]),t=m(),[s,l]=n.useState([]),[r,c]=n.useState("clusters"),[d,u]=n.useState({open:!1,type:"cluster",mode:"create"}),[h,p]=n.useState({visible:!1,taskId:null}),{data:g,isLoading:x}=F(),y=g||[],{data:j}=w(),b=j?.activeSubscription?.PlanName,N="ELITE"===b?.toUpperCase()||"PREMIUM"===b?.toUpperCase(),{data:v=[],isLoading:k,refetch:C}=de(s.length>0?s:void 0,N&&!!j),{data:$=[],isLoading:M,refetch:z}=me(s.length>0?s:void 0,N&&"pools"===r&&!!j),L=ue(),P=he(),E=pe(),B=J(),D=ge(),O=xe();H(),R();const K=n.useRef(!1);if(i.useEffect(()=>{!x&&!K.current&&y&&y.length>0&&(K.current=!0,l([y[0].teamName]))},[y,x]),!j)return e.jsx(ia,{gutter:24,children:e.jsx(oa,{span:24,children:e.jsx(na,{style:t.card,children:e.jsx(Pe,{message:"Loading company data...",type:"info",showIcon:!0})})})});const q=(e,a,t)=>{u({open:!0,type:e,mode:a,data:t})},G=()=>{u({open:!1,type:"cluster",mode:"create",data:void 0})},W=async(e,a)=>{try{"cluster"===e?await D.mutateAsync({clusterName:a.clusterName}):"pool"===e&&await O.mutateAsync({poolName:a.poolName,teamName:a.teamName})}catch{}},U=[{key:"clusters",label:e.jsxs("span",{"data-testid":"ds-tab-clusters",children:[e.jsx(I,{}),a("tabs.clusters")]}),children:e.jsx($a,{clusters:v,loading:k,onCreateCluster:()=>q("cluster","create"),onEditCluster:e=>q("cluster","edit",e),onDeleteCluster:e=>W("cluster",e),onRunFunction:e=>q("cluster","create",{...e,isFunction:!0})})},{key:"pools",label:e.jsxs("span",{"data-testid":"ds-tab-pools",children:[e.jsx(T,{}),a("tabs.pools")]}),children:e.jsx(Pa,{pools:$,clusters:v,loading:M,onCreatePool:()=>q("pool","create"),onEditPool:e=>q("pool","edit",e),onDeletePool:e=>W("pool",e),onRunFunction:e=>q("pool","create",{...e,isFunction:!0})})},{key:"machines",label:e.jsxs("span",{"data-testid":"ds-tab-machines",children:[e.jsx(_,{}),a("tabs.machines")]}),children:e.jsx(Oa,{teamFilter:s.length>0?s:void 0})}];return N?e.jsxs(e.Fragment,{children:[e.jsx(ia,{gutter:24,children:e.jsx(oa,{span:24,children:e.jsxs(na,{style:t.card,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:"1 1 auto",minWidth:0},children:[e.jsx(Ka,{level:4,style:{...t.heading4,margin:0,flexShrink:0},children:a("title")}),e.jsx(ye,{teams:y,selectedTeams:s,onChange:l,loading:x,placeholder:a("selectTeamToView"),style:{minWidth:250,maxWidth:400,width:"100%"},"data-testid":"ds-team-selector"})]}),s.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,flexShrink:0},children:["machines"!==r&&e.jsx(ze,{title:a("clusters"===r?"clusters.create":"pools.create"),children:e.jsx(Me,{type:"primary",icon:e.jsx(o,{}),style:{...t.buttonPrimary,...t.touchTarget,background:"#556b2f",borderColor:"#556b2f"},onClick:()=>{"clusters"===r?q("cluster","create"):"pools"===r&&q("pool","create")},"data-testid":"clusters"===r?"ds-create-cluster-button":"ds-create-pool-button","aria-label":a("clusters"===r?"clusters.create":"pools.create")})}),e.jsx(ze,{title:a("common:actions.refresh"),children:e.jsx(Me,{icon:e.jsx(A,{}),style:t.touchTarget,onClick:()=>{"clusters"===r?C():"pools"===r&&z()},"data-testid":"ds-refresh-button","aria-label":a("common:actions.refresh")})})]})]})}),0===s.length?e.jsx(Se,{image:Se.PRESENTED_IMAGE_SIMPLE,description:a("selectTeamPrompt"),style:{padding:"40px 0"}}):e.jsx(Ae,{activeKey:r,onChange:c,items:U,"data-testid":"ds-tabs"})]})})}),e.jsx(V,{open:d.open,onCancel:G,resourceType:d.type,mode:d.mode,"data-testid":"ds-resource-modal",existingData:{...d.data,teamName:s[0],clusters:v,pools:$,vaultContent:d.data?.vaultContent||d.data?.[`${d.type}Vault`]},teamFilter:s[0],onSubmit:async e=>{try{const{type:a,mode:t}=d;"create"===t?"cluster"===a?await L.mutateAsync({clusterName:e.clusterName,clusterVault:e.clusterVault}):"pool"===a&&await P.mutateAsync({teamName:e.teamName,clusterName:e.clusterName,poolName:e.poolName,poolVault:e.poolVault}):"edit"!==t&&"vault"!==t||("cluster"===a?await E.mutateAsync({clusterName:e.clusterName,clusterVault:e.clusterVault,vaultVersion:e.vaultVersion}):"pool"===a&&await B.mutateAsync({poolName:e.poolName,teamName:e.teamName,poolVault:e.poolVault,vaultVersion:e.vaultVersion})),G()}catch{}},onFunctionSubmit:async e=>{f("info","Function execution coming soon"),G()},onUpdateVault:async(e,a)=>{const t=d.data||{};"cluster"===d.type?await E.mutateAsync({clusterName:t.clusterName,clusterVault:e,vaultVersion:a}):"pool"===d.type&&await B.mutateAsync({teamName:s[0],poolName:t.poolName,poolVault:e,vaultVersion:a})},isSubmitting:L.isPending||P.isPending,isUpdatingVault:E.isPending||B.isPending,functionCategories:d.data?.isFunction?[d.type]:[],hiddenParams:d.data?.isFunction?"cluster"===d.type?["cluster_name"]:["cluster_name","pool_name"]:[],defaultParams:d.data?.isFunction?"cluster"===d.type?{cluster_name:d.data.clusterName}:{cluster_name:d.data.clusterName,pool_name:d.data.poolName}:{},preselectedFunction:d.data?.preselectedFunction}),e.jsx(be,{taskId:h.taskId,visible:h.visible,"data-testid":"ds-queue-trace-modal",onClose:()=>{p({visible:!1,taskId:null}),"clusters"===r?C():"pools"===r&&z()}})]}):e.jsx(ia,{gutter:24,children:e.jsx(oa,{span:24,children:e.jsx(na,{style:t.card,children:e.jsx(Pe,{message:a("accessDenied.title"),description:e.jsxs(e.Fragment,{children:[a("accessDenied.description"),e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Debug Info:"}),e.jsx("br",{}),"Current Plan: ",b||"No plan detected",e.jsx("br",{}),"Has Access: ",String(N),e.jsx("br",{}),"Company Data: ",JSON.stringify(j,null,2)]}),type:"warning",showIcon:!0,icon:e.jsx(S,{})})})})})};export{qa as default};

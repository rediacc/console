import{f as e,g as t,r as s}from"./chunk-DZuWtVpy.js";import{r as a,a as i,b as n,c as r,k as o,i as l,x as u,u as c,e as d,l as h,C as m,W as f,E as p,s as g,D as x,U as y,h as I,g as j,T,y as k}from"../index-4JeGDNMa.js";import{u as S,j as v}from"./chunk-DXw4Pgvm.js";import{T as E}from"./chunk-sYvc2Cs9.js";import{S as C}from"./chunk-BsdCfluv.js";import{R as D}from"./chunk-DjYUElpC.js";import{d as N,e as q,c as R,C as b,S as _,Q as P,R as A}from"./chunk-BbZU7JC1.js";import{C as L}from"./chunk-B5mJ0Ouc.js";import{F as M}from"./chunk-CPqA7Rd7.js";import{f as w,M as O,q as G,j as F,B,p as U,a as H,T as z,o as Q,P as Y,s as V,u as $,h as K,ae as X,ah as W,v as J,l as Z,i as ee,x as te,W as se,E as ae,V as ie,n as ne}from"./chunk-DcXv3kLI.js";import{a as re}from"./chunk-xSw6NTs2.js";import{u as oe}from"./chunk-CM3g5OHp.js";var le,ue,ce,de={exports:{}},he={},me={};function fe(){if(le)return me;le=1,Object.defineProperty(me,"__esModule",{value:!0});return me.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 385.6a446.7 446.7 0 00-96-142.4 446.7 446.7 0 00-142.4-96C631.1 123.8 572.5 112 512 112s-119.1 11.8-174.4 35.2a446.7 446.7 0 00-142.4 96 446.7 446.7 0 00-96 142.4C75.8 440.9 64 499.5 64 560c0 132.7 58.3 257.7 159.9 343.1l1.7 1.4c5.8 4.8 13.1 7.5 20.6 7.5h531.7c7.5 0 14.8-2.7 20.6-7.5l1.7-1.4C901.7 817.7 960 692.7 960 560c0-60.5-11.9-119.1-35.2-174.4zM761.4 836H262.6A371.12 371.12 0 01140 560c0-99.4 38.7-192.8 109-263 70.3-70.3 163.7-109 263-109 99.4 0 192.8 38.7 263 109 70.3 70.3 109 163.7 109 263 0 105.6-44.5 205.5-122.6 276zM623.5 421.5a8.03 8.03 0 00-11.3 0L527.7 506c-18.7-5-39.4-.2-54.1 14.5a55.95 55.95 0 000 79.2 55.95 55.95 0 0079.2 0 55.87 55.87 0 0014.5-54.1l84.5-84.5c3.1-3.1 3.1-8.2 0-11.3l-28.3-28.3zM490 320h44c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8h-44c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8zm260 218v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8h-80c-4.4 0-8 3.6-8 8zm12.7-197.2l-31.1-31.1a8.03 8.03 0 00-11.3 0l-56.6 56.6a8.03 8.03 0 000 11.3l31.1 31.1c3.1 3.1 8.2 3.1 11.3 0l56.6-56.6c3.1-3.1 3.1-8.2 0-11.3zm-458.6-31.1a8.03 8.03 0 00-11.3 0l-31.1 31.1a8.03 8.03 0 000 11.3l56.6 56.6c3.1 3.1 8.2 3.1 11.3 0l31.1-31.1c3.1-3.1 3.1-8.2 0-11.3l-56.6-56.6zM262 530h-80c-4.4 0-8 3.6-8 8v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8z"}}]},name:"dashboard",theme:"outlined"},me}function pe(){if(ue)return he;ue=1;var t=a().default,s=i().default;Object.defineProperty(he,"__esModule",{value:!0}),he.default=void 0;var o=s(n()),l=t(e()),u=s(fe()),c=s(r()),d=function(e,t){return l.createElement(c.default,(0,o.default)({},e,{ref:t,icon:u.default}))},h=l.forwardRef(d);return he.default=h,he}function ge(){return ce||(ce=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=pe())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(de,de.exports)),de.exports}const xe=t(ge());var ye,Ie,je,Te={exports:{}},ke={},Se={};function ve(){if(ye)return Se;ye=1,Object.defineProperty(Se,"__esModule",{value:!0});return Se.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},Se}function Ee(){if(Ie)return ke;Ie=1;var t=a().default,s=i().default;Object.defineProperty(ke,"__esModule",{value:!0}),ke.default=void 0;var o=s(n()),l=t(e()),u=s(ve()),c=s(r()),d=function(e,t){return l.createElement(c.default,(0,o.default)({},e,{ref:t,icon:u.default}))},h=l.forwardRef(d);return ke.default=h,ke}function Ce(){return je||(je=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Ee())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Te,Te.exports)),Te.exports}const De=t(Ce());var Ne,qe,Re,be={exports:{}},_e={},Pe={};function Ae(){if(Ne)return Pe;Ne=1,Object.defineProperty(Pe,"__esModule",{value:!0});return Pe.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M742 318V184h86c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H196c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h86v134c0 81.5 42.4 153.2 106.4 194-64 40.8-106.4 112.5-106.4 194v134h-86c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h632c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-86V706c0-81.5-42.4-153.2-106.4-194 64-40.8 106.4-112.5 106.4-194zm-72 388v134H354V706c0-42.2 16.4-81.9 46.3-111.7C430.1 564.4 469.8 548 512 548s81.9 16.4 111.7 46.3C653.6 624.1 670 663.8 670 706zm0-388c0 42.2-16.4 81.9-46.3 111.7C593.9 459.6 554.2 476 512 476s-81.9-16.4-111.7-46.3A156.63 156.63 0 01354 318V184h316v134z"}}]},name:"hourglass",theme:"outlined"},Pe}function Le(){if(qe)return _e;qe=1;var t=a().default,s=i().default;Object.defineProperty(_e,"__esModule",{value:!0}),_e.default=void 0;var o=s(n()),l=t(e()),u=s(Ae()),c=s(r()),d=function(e,t){return l.createElement(c.default,(0,o.default)({},e,{ref:t,icon:u.default}))},h=l.forwardRef(d);return _e.default=h,_e}function Me(){return Re||(Re=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Le())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(be,be.exports)),be.exports}const we=t(Me());var Oe,Ge,Fe,Be={exports:{}},Ue={},He={};function ze(){if(Oe)return He;Oe=1,Object.defineProperty(He,"__esModule",{value:!0});return He.default={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"},He}function Qe(){if(Ge)return Ue;Ge=1;var t=a().default,s=i().default;Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var o=s(n()),l=t(e()),u=s(ze()),c=s(r()),d=function(e,t){return l.createElement(c.default,(0,o.default)({},e,{ref:t,icon:u.default}))},h=l.forwardRef(d);return Ue.default=h,Ue}function Ye(){return Fe||(Fe=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Qe())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Be,Be.exports)),Be.exports}const Ve=t(Ye());var $e,Ke,Xe,We={exports:{}},Je={},Ze={};function et(){if($e)return Ze;$e=1,Object.defineProperty(Ze,"__esModule",{value:!0});return Ze.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"},Ze}function tt(){if(Ke)return Je;Ke=1;var t=a().default,s=i().default;Object.defineProperty(Je,"__esModule",{value:!0}),Je.default=void 0;var o=s(n()),l=t(e()),u=s(et()),c=s(r()),d=function(e,t){return l.createElement(c.default,(0,o.default)({},e,{ref:t,icon:u.default}))},h=l.forwardRef(d);return Je.default=h,Je}function st(){return Xe||(Xe=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=tt())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(We,We.exports)),We.exports}const at=t(st());const it=new class{queue=[];activeTasks=new Map;taskIdToBridge=new Map;isProcessing=!1;processingInterval=null;MAX_RETRIES=3;SUBMISSION_DELAY=100;HIGHEST_PRIORITY=1;listeners=[];constructor(){this.isExtensionContext()?setTimeout(()=>this.startProcessing(),1200):this.startProcessing()}isExtensionContext(){try{return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.id}catch{return!1}}hasActivePriority1Task(e,t){const s=this.activeTasks.get(e);if(s&&s.priority===this.HIGHEST_PRIORITY)return!0;return!!this.queue.find(s=>s.id!==t&&s.data.bridgeName===e&&s.data.priority===this.HIGHEST_PRIORITY&&["pending","submitting"].includes(s.status))}cancelExistingTasks(e,t){this.queue.forEach(s=>{s.data.bridgeName===e&&s.data.machineName===t&&"pending"===s.status&&(s.status="cancelled")})}trackActiveTask(e){const t=e.bridgeName;this.activeTasks.set(t,e),e.priority===this.HIGHEST_PRIORITY&&this.taskIdToBridge.set(e.taskId,e.bridgeName)}_removeActiveTaskByBridge(e){return this.activeTasks.delete(e)}async startMonitoringTask(e,t){try{rt.addTask(e,t.teamName,t.machineName,"PENDING",void 0,void 0,t.bridgeName,t.priority)}catch(s){}}async addToQueue(e,t){const s=`queue-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,a={id:s,data:e,retryCount:0,status:"pending",timestamp:Date.now(),submitFunction:t};if(e.priority===this.HIGHEST_PRIORITY){if(this.hasActivePriority1Task(e.bridgeName))throw o("warning",`You already have a highest priority task running on bridge ${e.bridgeName}. Please wait for it to complete.`),new Error("Already have a priority 1 task on this bridge");this.cancelExistingTasks(e.bridgeName,e.machineName),this.queue.push(a),this.notifyListeners(),o("info",`Highest priority task queued. Position: ${this.queue.length}`),this.isProcessing||this.startProcessing()}else try{a.status="submitting";const i=await t(e);return a.status="submitted",i.taskId||s}catch(i){throw a.status="failed",i}return s}getQueue(){return[...this.queue]}getQueueStats(){return{total:this.queue.length,pending:this.queue.filter(e=>"pending"===e.status).length,submitting:this.queue.filter(e=>"submitting"===e.status).length,submitted:this.queue.filter(e=>"submitted"===e.status).length,failed:this.queue.filter(e=>"failed"===e.status).length,highestPriority:this.queue.filter(e=>e.data.priority===this.HIGHEST_PRIORITY).length}}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){const e=this.getQueue();this.listeners.forEach(t=>t(e))}startProcessing(){this.isProcessing||(this.isProcessing=!0,this.processingInterval=setInterval(()=>{this.processQueue()},this.SUBMISSION_DELAY))}stopProcessing(){this.isProcessing=!1,this.processingInterval&&(clearInterval(this.processingInterval),this.processingInterval=null)}async processQueue(){const e=this.queue.find(e=>"pending"===e.status);if(!e)return this.queue=this.queue.filter(e=>"pending"===e.status||"submitting"===e.status),0===this.queue.length&&this.stopProcessing(),void this.notifyListeners();if(e.data.priority===this.HIGHEST_PRIORITY&&this.hasActivePriority1Task(e.data.bridgeName,e.id))return e.status="cancelled",this.notifyListeners(),void o("info","Task cancelled: Already have a priority 1 task on this bridge");e.status="submitting",this.notifyListeners();try{const t=await e.submitFunction(e.data);if(e.taskId=t.taskId||t.id,e.data.priority===this.HIGHEST_PRIORITY&&e.taskId){const t={bridgeName:e.data.bridgeName,machineName:e.data.machineName,taskId:e.taskId,priority:e.data.priority,status:"pending",timestamp:Date.now()};this.trackActiveTask(t),this.startMonitoringTask(e.taskId,e.data)}e.status="submitted",this.notifyListeners(),o("success","Queue item submitted successfully"+(e.taskId?` (ID: ${e.taskId})`:""))}catch(t){e.retryCount++,e.retryCount<this.MAX_RETRIES?(e.status="pending",o("warning",`Queue submission failed, will retry (${e.retryCount}/${this.MAX_RETRIES})`)):(e.status="failed",o("error",`Queue submission failed after ${this.MAX_RETRIES} attempts: ${t.message}`)),this.notifyListeners()}}removeFromQueue(e){this.queue=this.queue.filter(t=>t.id!==e),this.notifyListeners()}retryItem(e){const t=this.queue.find(t=>t.id===e);t&&"failed"===t.status&&(t.status="pending",t.retryCount=0,this.notifyListeners(),this.isProcessing||this.startProcessing())}clearCompleted(){this.queue=this.queue.filter(e=>"pending"===e.status||"submitting"===e.status),this.notifyListeners()}getQueuePosition(e){const t=this.queue.filter(e=>"pending"===e.status).findIndex(t=>t.id===e);return-1===t?-1:t+1}getQueueItem(e){return this.queue.find(t=>t.id===e)}subscribeToQueueItem(e,t){const s=s=>{const a=s.find(t=>t.id===e);t(a)};return this.listeners.push(s),s(this.queue),()=>{this.listeners=this.listeners.filter(e=>e!==s)}}updateTaskStatus(e,t){let s=null;const a=this.taskIdToBridge.get(e);if(a){const i=this.activeTasks.get(a);i&&i.taskId===e&&("completed"!==t&&"failed"!==t&&"cancelled"!==t||(this.activeTasks.delete(a),this.taskIdToBridge.delete(e),s=a))}if(!s)for(const[i,n]of this.activeTasks)if(n.taskId===e&&n.priority===this.HIGHEST_PRIORITY&&("completed"===t||"failed"===t||"cancelled"===t)){this.activeTasks.delete(i),this.taskIdToBridge.delete(e),s=i;break}if(!s){const a=this.queue.find(t=>t.taskId===e);if(a&&a.data.priority===this.HIGHEST_PRIORITY){const i=a.data.bridgeName;if(this.activeTasks.has(i)){const t=this.activeTasks.get(i);t&&t.taskId===e&&(this.activeTasks.delete(i),this.taskIdToBridge.delete(e),s=i)}"completed"!==t&&"failed"!==t&&"cancelled"!==t||(a.status="submitted")}}this.notifyListeners()}getActiveTasks(){return Array.from(this.activeTasks.values())}canSubmitTask(e,t){return t!==this.HIGHEST_PRIORITY||!this.hasActivePriority1Task(e)}clearCancelled(){this.queue=this.queue.filter(e=>"cancelled"!==e.status),this.notifyListeners()}clearBridgeTask(e){const t=this.activeTasks.get(e);return!!t&&(this.activeTasks.delete(e),t.priority===this.HIGHEST_PRIORITY&&this.taskIdToBridge.delete(t.taskId),this.notifyListeners(),!0)}clearAllStuckTasks(){let e=0;const t=[];for(const[s,a]of this.activeTasks)a.priority===this.HIGHEST_PRIORITY&&t.push(s);for(const s of t){const t=this.activeTasks.get(s);t&&(this.activeTasks.delete(s),this.taskIdToBridge.delete(t.taskId),e++)}return e>0&&this.notifyListeners(),e}getDebugInfo(){return{activeTasks:Array.from(this.activeTasks.entries()).map(([e,t])=>({key:e,...t,age:Math.floor((Date.now()-t.timestamp)/1e3)+" seconds"})),taskIdMappings:Array.from(this.taskIdToBridge.entries()).map(([e,t])=>({taskId:e,bridge:t})),queuedTasks:this.queue.filter(e=>e.data.priority===this.HIGHEST_PRIORITY&&["pending","submitting"].includes(e.status)).map(e=>({id:e.id,status:e.status,bridgeName:e.data.bridgeName,machineName:e.data.machineName,taskId:e.taskId}))}}getActivePriority1CountByBridge(){const e=new Map;for(const t of this.activeTasks.values())if(t.priority===this.HIGHEST_PRIORITY){const s=e.get(t.bridgeName)||0;e.set(t.bridgeName,s+1)}return this.queue.forEach(t=>{if(t.data.priority===this.HIGHEST_PRIORITY&&["pending","submitting","submitted"].includes(t.status)){const s=e.get(t.data.bridgeName)||0;e.set(t.data.bridgeName,s+1)}}),e}};"undefined"!=typeof window&&(window.queueInfo=()=>it.getDebugInfo(),window.clearStuckTasks=()=>it.clearAllStuckTasks());class nt{static instance;monitoredTasks=new Map;intervalId=null;CHECK_INTERVAL_MS=5e3;STALE_TASK_THRESHOLD_MS=864e5;STALE_PROCESSING_MINUTES=5;MAX_RETRY_COUNT=3;STORAGE_KEY="queue_monitored_tasks";constructor(){this.loadFromStorage(),this.isExtensionContext()?setTimeout(()=>this.startMonitoring(),1e3):this.startMonitoring()}isExtensionContext(){try{return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.id}catch{return!1}}static getInstance(){return nt.instance||(nt.instance=new nt),nt.instance}loadFromStorage(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){JSON.parse(e).forEach(e=>{Date.now()-e.startTime<this.STALE_TASK_THRESHOLD_MS&&this.monitoredTasks.set(e.taskId,e)})}}catch(e){}}saveToStorage(){try{const e=Array.from(this.monitoredTasks.values());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){}}startMonitoring(){this.intervalId&&clearInterval(this.intervalId),this.checkAllTasks(),this.intervalId=setInterval(()=>{this.checkAllTasks()},this.CHECK_INTERVAL_MS)}stopMonitoring(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}addTask(e,t,s,a,i,n,r,o){if(["COMPLETED","CANCELLED","FAILED"].includes(a))return;if("PENDING"===a&&i&&i>=this.MAX_RETRY_COUNT&&n)return;const l={taskId:e,teamName:t,machineName:s,bridgeName:r,priority:o,lastStatus:a,startTime:Date.now(),checkInterval:this.CHECK_INTERVAL_MS,lastCheckTime:Date.now()};this.monitoredTasks.set(e,l),this.saveToStorage(),setTimeout(()=>{this.checkTask(l)},1e3)}removeTask(e){this.monitoredTasks.delete(e),this.saveToStorage()}isTaskMonitored(e){return this.monitoredTasks.has(e)}async checkAllTasks(){const e=Date.now(),t=Array.from(this.monitoredTasks.values()).filter(t=>e-t.lastCheckTime>=t.checkInterval);for(const s of t)await this.checkTask(s)}async checkTask(e){try{let s;if(e.lastCheckTime=Date.now(),this.isExtensionContext())try{s=await Promise.race([l.get("/GetQueueItemTrace",{taskId:e.taskId}),new Promise((e,t)=>setTimeout(()=>t(new Error("Chrome extension timeout")),8e3))])}catch(t){if("Chrome extension timeout"===t.message)return;throw t}else s=await l.get("/GetQueueItemTrace",{taskId:e.taskId});const a=this.extractQueueDetails(s);if(!a)return;const i=a.status||a.Status;if(a.permanentlyFailed){it.updateTaskStatus(e.taskId,"failed");const t=this.getLastFailureReason(a);return t?u("error","queue:monitoring.permanentlyFailedWithReason",{taskId:e.taskId,reason:t,teamName:e.teamName,machineName:e.machineName}):u("error","queue:monitoring.permanentlyFailed",{taskId:e.taskId,attempts:this.MAX_RETRY_COUNT,teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId)}if(i!==e.lastStatus){const t=e.lastStatus;if(e.lastStatus=i,"COMPLETED"===i)return it.updateTaskStatus(e.taskId,"completed"),u("success","queue:monitoring.completed",{taskId:e.taskId,teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId);if("CANCELLED"===i)return it.updateTaskStatus(e.taskId,"cancelled"),u("warning","queue:monitoring.cancelled",{taskId:e.taskId,teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId);if("CANCELLING"===i&&"CANCELLING"!==t)u("info","queue:monitoring.cancelling",{taskId:e.taskId,teamName:e.teamName,machineName:e.machineName}),this.monitoredTasks.set(e.taskId,e),this.saveToStorage();else if("FAILED"===i){const t=this.getRetryCount(a),s=this.getLastFailureReason(a);if(this.isPermanentFailure(s))return it.updateTaskStatus(e.taskId,"failed"),u("error","queue:monitoring.permanentlyFailedWithReason",{taskId:e.taskId,reason:s||"",teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId);if(t>=this.MAX_RETRY_COUNT)return it.updateTaskStatus(e.taskId,"failed"),u("error","queue:monitoring.permanentlyFailed",{taskId:e.taskId,attempts:this.MAX_RETRY_COUNT,teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId);u("warning","queue:monitoring.failedWaitingRetry",{taskId:e.taskId,attempt:t,maxAttempts:this.MAX_RETRY_COUNT,teamName:e.teamName,machineName:e.machineName}),this.monitoredTasks.set(e.taskId,e),this.saveToStorage()}else if("PROCESSING"===i&&"PROCESSING"!==t)u("info","queue:monitoring.startedProcessing",{taskId:e.taskId,teamName:e.teamName,machineName:e.machineName}),this.monitoredTasks.set(e.taskId,e),this.saveToStorage();else if("ASSIGNED"===i&&"PENDING"===t)u("info","queue:monitoring.assigned",{taskId:e.taskId,teamName:e.teamName,machineName:e.machineName}),this.monitoredTasks.set(e.taskId,e),this.saveToStorage();else if("PENDING"===i&&"PENDING"!==t&&this.getRetryCount(a)>0){const t=this.getRetryCount(a),s=this.getLastFailureReason(a);if(this.isPermanentFailure(s))return u("error","queue:monitoring.permanentlyFailedWithReason",{taskId:e.taskId,reason:s||"",teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId);if(t>=this.MAX_RETRY_COUNT&&s)return u("error","queue:monitoring.permanentlyFailed",{taskId:e.taskId,attempts:this.MAX_RETRY_COUNT,teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId);u("info","queue:monitoring.queuedForRetry",{taskId:e.taskId,attempt:t,maxAttempts:this.MAX_RETRY_COUNT,teamName:e.teamName,machineName:e.machineName}),this.monitoredTasks.set(e.taskId,e),this.saveToStorage()}else if("PENDING"===i){const t=this.getRetryCount(a),s=this.getLastFailureReason(a);if(this.isPermanentFailure(s))return u("error","queue:monitoring.permanentlyFailedWithReason",{taskId:e.taskId,reason:s||"",teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId);if(t>=this.MAX_RETRY_COUNT&&s)return u("error","queue:monitoring.permanentlyFailed",{taskId:e.taskId,attempts:this.MAX_RETRY_COUNT,teamName:e.teamName,machineName:e.machineName}),void this.removeTask(e.taskId)}}"PROCESSING"===i&&a.minutesSinceAssigned&&a.minutesSinceAssigned>this.STALE_PROCESSING_MINUTES&&(u("error","queue:monitoring.staleTask",{taskId:e.taskId,minutes:a.minutesSinceAssigned}),e.checkInterval=2*this.CHECK_INTERVAL_MS,this.monitoredTasks.set(e.taskId,e),this.saveToStorage())}catch(s){404===s.response?.status&&(u("error","queue:monitoring.taskNotFound",{taskId:e.taskId}),this.removeTask(e.taskId))}}getMonitoredTasks(){return Array.from(this.monitoredTasks.values())}extractQueueDetails(e){let t=null;return e.resultSets?.forEach(e=>{e.data&&e.data.length>0&&1===e.resultSetIndex&&(t=e.data[0])}),t}getRetryCount(e){return e.retryCount||e.RetryCount||0}getLastFailureReason(e){return e.lastFailureReason||e.LastFailureReason}isPermanentFailure(e){if(!e)return!1;return["Bridge reported failure","Task permanently failed","Fatal error"].some(t=>e.includes(t))}clearOldTasks(){const e=Date.now(),t=[];this.monitoredTasks.forEach((s,a)=>{e-s.startTime>this.STALE_TASK_THRESHOLD_MS&&t.push(a)}),t.forEach(e=>this.removeTask(e))}}const rt=nt.getInstance();"undefined"!=typeof window&&(window.queueMonitoringDebug={getTasks:()=>Array.from(rt.monitoredTasks.entries()),checkTask:e=>{const t=rt.monitoredTasks.get(e);t&&rt.checkTask(t)}}),w.extend(k);const{Text:ot,Title:lt}=z,{Panel:ut}=X,{Step:ct}=Q,dt=(e,...t)=>{if(!e)return null;for(const s of t)if(void 0!==e[s]&&null!==e[s])return e[s];return null},ht=e=>{if(e<60)return`${e} seconds`;const t=Math.floor(e/60);return`${t} minute${1!==t?"s":""}`},mt=(e,t,s)=>{if(!e||0===e.length)return null;let a=e.find(e=>dt(e,"action","Action")===t);if(!a&&s&&(a=e.find(e=>dt(e,"action","Action")===s)),a){const e=dt(a,"timestamp","Timestamp");return e?re(e,"time"):null}return null},ft=({content:e,theme:t,consoleOutputRef:s,isEmpty:a})=>a||!e?v.jsx(ae,{description:"No console output available"}):v.jsx("div",{ref:s,"data-testid":"queue-trace-console-output",style:{backgroundColor:"dark"===t?"#1f1f1f":"#f5f5f5",border:"1px solid "+("dark"===t?"#303030":"#d9d9d9"),borderRadius:"4px",padding:"12px",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-word",height:"400px",overflowY:"scroll"},children:e}),pt=({taskId:e,visible:t,onClose:a,onTaskStatusChange:i})=>{const{t:n}=oe(["queue","common"]),r=S(e=>e.ui.uiMode),l=c(),[u,k]=s.useState(null),[z,le]=s.useState(!1),[ue,ce]=s.useState(["overview"]),[de,he]=s.useState(!0),[me,fe]=s.useState(""),[pe,ge]=s.useState(""),[ye,Ie]=s.useState(null),[je,Te]=s.useState(null),[ke,Se]=s.useState(!1),[ve,Ee]=s.useState(!1),{data:Ce,isLoading:De,refetch:Ne}=N(e,t),{mutate:qe,isPending:Re}=q(),{mutate:be,isPending:_e}=R(),{theme:Pe}=d(),Ae=s.useRef(null);s.useEffect(()=>{Ce&&t&&k(w())},[Ce,t]),s.useEffect(()=>{Ae.current&&me&&(Ae.current.scrollTop=Ae.current.scrollHeight)},[me]),s.useEffect(()=>{if(Ce?.responseVaultContent?.hasContent&&Ce.responseVaultContent.vaultContent)try{const t="string"==typeof Ce.responseVaultContent.vaultContent?JSON.parse(Ce.responseVaultContent.vaultContent):Ce.responseVaultContent.vaultContent||{};if("completed"===t.status){let s="";if(t.result&&"string"==typeof t.result)try{const e=JSON.parse(t.result);s=e.command_output||"",!s&&e.message&&(s=`[${e.status}] ${e.message}`,void 0!==e.exit_code&&(s+=` (exit code: ${e.exit_code})`))}catch(e){s=t.result}fe(s),ge("completed")}else if("in_progress"===t.status&&t.message){const e=t.message;e&&"completed"!==pe&&(fe(t=>{if(e.startsWith(t)){return t+e.substring(t.length)}return e}),ge("in_progress"))}else if(!me){let s="";if(t.result&&"string"==typeof t.result)try{const e=JSON.parse(t.result);s=e.command_output||"",!s&&e.message&&(s=`[${e.status}] ${e.message}`,void 0!==e.exit_code&&(s+=` (exit code: ${e.exit_code})`))}catch(e){s=t.result}else if(t.result&&"object"==typeof t.result){const e=t.result;s=e.command_output||"",!s&&e.message&&(s=`[${e.status}] ${e.message}`,void 0!==e.exit_code&&(s+=` (exit code: ${e.exit_code})`))}s&&fe(s)}}catch(t){}},[Ce?.responseVaultContent,pe,me]),s.useEffect(()=>{const e=(e=>{if(!e)return null;let t=null,s=-1;const a=[...e.matchAll(/-\s+(\d+(?:\.\d+)?)%/g)];if(a.length>0){const e=a[a.length-1];t=parseFloat(e[1]),s=e.index||-1}const i=[...e.matchAll(/\s+(\d+)%\s+[\d.,]+[KMG]?B\/s/g)];if(i.length>0){const e=i[i.length-1],a=e.index||-1;a>s&&(t=parseFloat(e[1]),s=a)}return null===t?null:Math.min(100,Math.max(0,t))})(me),t=(e=>{if(!e)return null;const t=e.split("\n");let s=null,a=-1;const i=/^(.+)\s+-\s+\d+(?:\.\d+)?%\s*$/;for(let o=t.length-1;o>=0;o--){const e=t[o].trim();if(!e)continue;const n=e.match(i);if(n&&n[1]){const e=n[1].replace(/\x1b\[[0-9;]*m/g,"").replace(/[\u{1F300}-\u{1F9FF}]/gu,"").trim();if(e){s=e,a=o;break}}}const n=/([\d.]+[KMG]?)\s+(\d+)%\s+([\d.]+[KMG]?B\/s)\s+(\d+:\d+:\d+)/,r=/Transferred:\s+([\d.]+[KMG]?)\s+\/\s+([\d.]+\s*[KMG]?Bytes?),\s+(\d+)%,\s+([\d.]+\s*[KMG]?Bytes?\/s)/i;for(let o=t.length-1;o>=0;o--){const e=t[o].trim();if(!e)continue;const s=e.match(n);if(s&&o>a)return s[0];const i=e.match(r);if(i&&o>a)return i[0]}return s})(me);Ie(e),Te(t)},[me]),s.useEffect(()=>{t&&e&&(k(null),le(rt.isTaskMonitored(e)),ce(["overview"]),he(!0),fe(""),ge(""),Ie(null),Te(null),Se(!1),Ee(!1))},[e,t,r]),s.useEffect(()=>{if(Ce?.queueDetails&&e&&i){const t=dt(Ce.queueDetails,"status","Status");"FAILED"!==t&&"COMPLETED"!==t&&"CANCELLED"!==t||i(t,e)}},[Ce?.queueDetails,e,i]);const Le=()=>{e&&be(e,{onSuccess:()=>{Ne()}})},Me=()=>{if(e&&z&&Ce?.queueDetails){const t=dt(Ce.queueDetails,"status","Status"),s=dt(Ce.queueDetails,"retryCount","RetryCount")||0,a=dt(Ce.queueDetails,"permanentlyFailed","PermanentlyFailed"),i=dt(Ce.queueDetails,"lastFailureReason","LastFailureReason");"COMPLETED"===t||"CANCELLED"===t||"FAILED"===t&&(a||s>=2)||"PENDING"===t&&s>=2&&i||o("info",`Task ${e} will continue to be monitored in the background`)}a()},Oe=()=>{if(!Ce?.queueDetails)return{status:"unknown",color:"default",icon:null};const e=dt(Ce.queueDetails,"status","Status"),t=dt(Ce.queueDetails,"retryCount","RetryCount")||0,s=dt(Ce.queueDetails,"lastFailureReason","LastFailureReason");if("PENDING"===e&&t>0&&s)return t>=2?{status:"Failed (Max Retries)",color:"error",icon:v.jsx(L,{})}:{status:"Retrying",color:"warning",icon:v.jsx(Ve,{spin:!0})};switch(e){case"COMPLETED":return{status:"Completed",color:"success",icon:v.jsx(j,{})};case"FAILED":return{status:"Failed",color:"error",icon:v.jsx(L,{})};case"CANCELLED":return{status:"Cancelled",color:"error",icon:v.jsx(L,{})};case"CANCELLING":return{status:"Cancelling",color:"warning",icon:v.jsx(C,{spin:!0})};case"PROCESSING":return{status:"Processing",color:"processing",icon:v.jsx(C,{spin:!0})};case"ASSIGNED":return{status:"Assigned",color:"blue",icon:v.jsx(m,{})};default:return{status:e||"Pending",color:"default",icon:v.jsx(m,{})}}},Ge=()=>{if(!Ce?.queueDetails)return"none";const e=dt(Ce.queueDetails,"lastAssigned","LastAssigned")||dt(Ce.queueDetails,"assignedTime","AssignedTime"),t=dt(Ce.queueDetails,"lastRetryAt","LastRetryAt"),s=dt(Ce.queueDetails,"lastResponseAt","LastResponseAt"),a=dt(Ce.queueDetails,"status","Status");if(!e||"COMPLETED"===a||"CANCELLED"===a||"CANCELLING"===a||"FAILED"===a||"PENDING"===a)return"none";const i=[e,t,s].filter(Boolean);if(0===i.length)return"none";const n=i.reduce((e,t)=>w(t).isAfter(w(e))?t:e),r=w().diff(w(n),"second");return r>=120?"critical":r>=90?"stale":r>=60?"early":"none"},Fe=()=>{const e=Ge();return"stale"===e||"critical"===e},Be=e=>{if(!e)return{color:"default",icon:null,label:"Normal"};switch(e){case 1:return{color:"red",icon:v.jsx(T,{}),label:"Highest"};case 2:return{color:"orange",icon:v.jsx(A,{}),label:"High"};case 3:default:return{color:"default",icon:null,label:"Normal"};case 4:return{color:"blue",icon:null,label:"Low"};case 5:return{color:"cyan",icon:null,label:"Lowest"}}},Ue=()=>{if(!Ce?.queueDetails)return 0;switch(dt(Ce.queueDetails,"status","Status")){case"COMPLETED":return 2;case"FAILED":case"CANCELLED":return-1;case"CANCELLING":case"PROCESSING":return 1;default:return 0}};return v.jsx(O,{"data-testid":"queue-trace-modal",title:v.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[v.jsxs(H,{children:[v.jsx(I,{}),`Queue Item Trace - ${e||""}`]}),v.jsxs(H,{direction:"vertical",size:8,align:"end",children:[v.jsx(ne,{"data-testid":"queue-trace-mode-switch",value:de?"simple":"detailed",onChange:e=>he("simple"===e),options:[{label:"Simple",value:"simple"},{label:"Detailed",value:"detailed"}],style:{minHeight:32}}),u&&v.jsxs(ot,{type:"secondary",style:{fontSize:"12px"},children:["Last fetched: ",u.format("HH:mm:ss")]})]})]}),open:t,onCancel:Me,style:h(1200),destroyOnHidden:!0,footer:[Ce?.queueDetails&&Ce.queueDetails.canBeCancelled&&("PENDING"===dt(Ce.queueDetails,"status","Status")||"ASSIGNED"===dt(Ce.queueDetails,"status","Status")||"PROCESSING"===dt(Ce.queueDetails,"status","Status"))?v.jsx(B,{"data-testid":"queue-trace-cancel-button",danger:!0,type:"critical"===Ge()?"primary":"default",icon:v.jsx(L,{}),onClick:Le,loading:_e,style:{...l.buttonPrimary,fontWeight:"critical"===Ge()?"bold":"normal",fontSize:"critical"===Ge()?"14px":"13px"},children:"critical"===Ge()?"Cancel Stuck Task":"stale"===Ge()?"Cancel Task":"Cancel"},"cancel"):null,Ce?.queueDetails&&"FAILED"===dt(Ce.queueDetails,"status","Status")&&(dt(Ce.queueDetails,"retryCount","RetryCount")||0)<2&&!dt(Ce.queueDetails,"permanentlyFailed","PermanentlyFailed")?v.jsx(B,{"data-testid":"queue-trace-retry-button",type:"primary",danger:!0,icon:v.jsx(Ve,{}),onClick:()=>{e&&qe(e,{onSuccess:()=>{Ne()}})},loading:Re,style:l.buttonPrimary,children:"Retry Again"},"retry"):null,v.jsx(B,{"data-testid":"queue-trace-refresh-button",icon:v.jsx(D,{}),onClick:async()=>{await Ne()},loading:De,style:l.buttonSecondary,children:"Refresh"},"refresh"),v.jsx(B,{"data-testid":"queue-trace-close-button",onClick:Me,style:l.buttonSecondary,children:"Close"},"close")].filter(Boolean),children:De?v.jsx("div",{className:"queue-trace-loading",children:v.jsx(G,{size:"large"})}):Ce?v.jsxs("div",{children:["early"===Ge()&&v.jsx(F,{"data-testid":"queue-trace-alert-early",message:"Task May Be Inactive",description:"Task hasn't provided updates for over 1 minute. This may be normal for long-running operations.",type:"info",showIcon:!0,icon:v.jsx(m,{}),style:{marginBottom:16}}),"stale"===Ge()&&v.jsx(F,{"data-testid":"queue-trace-alert-stale",message:"Task May Be Stale",description:"Task appears inactive for over 1.5 minutes. Consider canceling if no progress is expected.",type:"warning",showIcon:!0,icon:v.jsx(f,{}),style:{marginBottom:16},action:!Ce?.queueDetails?.canBeCancelled||"PENDING"!==dt(Ce.queueDetails,"status","Status")&&"ASSIGNED"!==dt(Ce.queueDetails,"status","Status")&&"PROCESSING"!==dt(Ce.queueDetails,"status","Status")?null:v.jsx(B,{danger:!0,size:"small",icon:v.jsx(L,{}),onClick:Le,loading:_e,children:"Cancel Task"})}),"critical"===Ge()&&v.jsx(F,{"data-testid":"queue-trace-alert-critical",message:"Task Likely Stuck - Cancellation Recommended",description:"Task has been inactive for over 2 minutes. The queue processor will automatically timeout this task at 3 minutes if no activity is detected.",type:"error",showIcon:!0,icon:v.jsx(p,{}),style:{marginBottom:16},action:!Ce?.queueDetails?.canBeCancelled||"PENDING"!==dt(Ce.queueDetails,"status","Status")&&"ASSIGNED"!==dt(Ce.queueDetails,"status","Status")&&"PROCESSING"!==dt(Ce.queueDetails,"status","Status")?null:v.jsx(B,{danger:!0,type:"primary",icon:v.jsx(L,{}),onClick:Le,loading:_e,style:{fontWeight:"bold"},children:"Cancel Stuck Task"})}),(()=>{if(!Ce?.queueDetails)return!1;const e=dt(Ce.queueDetails,"status","Status"),t=dt(Ce.queueDetails,"healthStatus","HealthStatus"),s=dt(Ce.queueDetails,"createdTime","CreatedTime");if("STALE_PENDING"===t)return!0;if("PENDING"!==e||!s)return!1;return w().diff(w(s),"hour")>=6})()&&v.jsx(F,{"data-testid":"queue-trace-alert-old-pending",message:"Old Pending Task",description:"This task has been pending for over 6 hours. It may expire soon if not processed.",type:"warning",showIcon:!0,icon:v.jsx(f,{}),style:{marginBottom:16}}),Ce.queueDetails&&"CANCELLING"===dt(Ce.queueDetails,"status","Status")&&v.jsx(F,{"data-testid":"queue-trace-alert-cancelling",message:"Task Being Cancelled",description:"The task is being cancelled. The bridge will stop execution gracefully.",type:"warning",showIcon:!0,icon:v.jsx(C,{spin:!0}),style:{marginBottom:16}}),Ce.queueDetails&&dt(Ce.queueDetails,"lastFailureReason","LastFailureReason")&&"CANCELLING"!==dt(Ce.queueDetails,"status","Status")&&v.jsx(F,{"data-testid":"queue-trace-alert-failure",message:"PENDING"===dt(Ce.queueDetails,"status","Status")&&dt(Ce.queueDetails,"retryCount","RetryCount")>0?dt(Ce.queueDetails,"retryCount","RetryCount")>=2?"Task Failed - Max Retries Reached":"Task Failed - Retrying":"Task Failed",description:dt(Ce.queueDetails,"lastFailureReason","LastFailureReason"),type:"PENDING"===dt(Ce.queueDetails,"status","Status")&&dt(Ce.queueDetails,"retryCount","RetryCount")>0?dt(Ce.queueDetails,"retryCount","RetryCount")>=2?"error":"warning":"error",showIcon:!0,icon:"PENDING"===dt(Ce.queueDetails,"status","Status")&&dt(Ce.queueDetails,"retryCount","RetryCount")>0?dt(Ce.queueDetails,"retryCount","RetryCount")>=2?v.jsx(L,{}):v.jsx(Ve,{}):void 0,style:{marginBottom:16}}),de&&Ce.queueDetails&&v.jsx(U,{"data-testid":"queue-trace-simple-overview",style:{...l.card,marginBottom:g("MD"),background:"dark"===Pe?"#1f1f1f":"#f0f2f5",border:"1px solid "+("dark"===Pe?"#303030":"#e8e8e8")},children:v.jsxs(H,{direction:"vertical",size:"large",style:{width:"100%"},children:[v.jsx("div",{style:{textAlign:"center"},children:v.jsxs(H,{size:"large",children:[v.jsx("span",{className:"queue-trace-status-icon "+("Processing"===Oe().status?"processing":""),children:Oe().icon}),v.jsxs(lt,{level:3,style:{margin:0},children:["Task ",Oe().status]})]})}),v.jsxs(Q,{"data-testid":"queue-trace-steps",className:"queue-trace-steps",current:Ue(),status:-1===Ue()?"error":void 0,size:"small",children:[v.jsx(ct,{title:"Assigned",description:Ce.queueDetails.assignedTime?re(Ce.queueDetails.assignedTime,"time"):"Waiting"}),v.jsx(ct,{title:"Processing",description:(()=>{const e=Ue(),t=dt(Ce.queueDetails,"status","Status"),s=mt(Ce.traceLogs,"QUEUE_ITEM_PROCESSING","QUEUE_ITEM_RESPONSE_UPDATED");return"PROCESSING"===t?s||"In Progress":"CANCELLING"===t?"Cancelling...":e>=1?s||"Processed":""})()}),v.jsx(ct,{title:"Completed",description:"COMPLETED"===dt(Ce.queueDetails,"status","Status")?"Done"+(mt(Ce.traceLogs,"QUEUE_ITEM_COMPLETED")?" - "+mt(Ce.traceLogs,"QUEUE_ITEM_COMPLETED"):""):"FAILED"===dt(Ce.queueDetails,"status","Status")?"Failed"+(mt(Ce.traceLogs,"QUEUE_ITEM_FAILED")?" - "+mt(Ce.traceLogs,"QUEUE_ITEM_FAILED"):""):"CANCELLED"===dt(Ce.queueDetails,"status","Status")?"Cancelled"+(mt(Ce.traceLogs,"QUEUE_ITEM_CANCELLED")?" - "+mt(Ce.traceLogs,"QUEUE_ITEM_CANCELLED"):""):"CANCELLING"===dt(Ce.queueDetails,"status","Status")?"Cancelling":""})]}),je&&v.jsx("div",{style:{marginTop:g("SM"),marginBottom:g("XS")},children:v.jsx(ot,{type:"secondary",style:{fontSize:"12px",fontStyle:"italic",display:"block",textAlign:"center"},children:je})}),null!==ye&&v.jsx(Y,{"data-testid":"queue-trace-progress",className:"queue-trace-progress",percent:ye,status:"Failed"===Oe().status||"Cancelled"===Oe().status?"exception":"Completed"===Oe().status?"success":"active",strokeColor:{"0%":"#108ee9","100%":"Failed"===Oe().status||"Cancelled"===Oe().status?"#ff4d4f":"#87d068"}}),!de&&v.jsxs(V,{gutter:[g("MD"),g("MD")],style:{textAlign:"center"},children:[v.jsx($,{span:8,children:v.jsxs("div",{"data-testid":"queue-trace-info-duration",className:"queue-trace-key-info",style:{padding:g("SM"),borderRadius:x.BORDER_RADIUS.LG,background:"dark"===Pe?"#262626":"#fafafa"},children:[v.jsx(ot,{type:"secondary",children:"Duration"}),v.jsx("div",{children:v.jsx(ot,{strong:!0,style:{fontSize:x.FONT_SIZE.LG},children:(He=Ce.queueDetails.totalDurationSeconds,He<60?`${He}s`:`${Math.floor(He/60)}m`)})})]})}),v.jsx($,{span:8,children:v.jsxs("div",{"data-testid":"queue-trace-info-machine",className:"queue-trace-key-info",style:{padding:g("SM"),borderRadius:x.BORDER_RADIUS.LG,background:"dark"===Pe?"#262626":"#fafafa"},children:[v.jsx(ot,{type:"secondary",children:"Machine"}),v.jsx("div",{children:v.jsx(ot,{strong:!0,children:Ce.queueDetails.machineName})})]})}),v.jsx($,{span:8,children:v.jsxs("div",{"data-testid":"queue-trace-info-priority",className:"queue-trace-key-info",style:{padding:g("SM"),borderRadius:x.BORDER_RADIUS.LG,background:"dark"===Pe?"#262626":"#fafafa"},children:[v.jsx(ot,{type:"secondary",children:"Priority"}),v.jsx("div",{children:v.jsxs(K,{color:Be(dt(Ce.queueDetails,"priority","Priority")).color,children:[Be(dt(Ce.queueDetails,"priority","Priority")).icon,Be(dt(Ce.queueDetails,"priority","Priority")).label]})})]})})]})]})}),de&&v.jsx(X,{"data-testid":"queue-trace-simple-console-collapse",activeKey:ke?["console"]:[],onChange:e=>Se(e.includes("console")),style:{marginTop:g("MD")},expandIcon:({isActive:e})=>v.jsx(at,{rotate:e?90:0}),children:v.jsx(ut,{header:v.jsxs(H,{children:[v.jsx(b,{}),v.jsx(ot,{children:"Response (Console)"}),"PROCESSING"===Ce?.queueDetails?.status&&v.jsx(K,{icon:v.jsx(C,{spin:!0}),color:"processing",children:"Live Output"})]}),children:v.jsx(ft,{content:me.replace(/\\r\\n/g,"\n").replace(/\\n/g,"\n").replace(/\\r/g,"\r"),theme:Pe,consoleOutputRef:Ae,isEmpty:!Ce?.responseVaultContent?.hasContent})},"console")}),!de&&v.jsx("div",{style:{marginTop:g("MD")},children:v.jsxs(X,{"data-testid":"queue-trace-collapse",className:"queue-trace-collapse",activeKey:ue,onChange:ce,expandIcon:({isActive:e})=>v.jsx(at,{rotate:e?90:0}),children:[Ce.queueDetails&&v.jsx(ut,{"data-testid":"queue-trace-panel-overview",header:v.jsxs(H,{children:[v.jsx(xe,{}),v.jsx("span",{children:"Task Overview"}),v.jsx(K,{color:Oe().color,children:Oe().status}),Fe()&&v.jsx(K,{color:"warning",icon:v.jsx(f,{}),children:"Stale"})]}),extra:Ce.queueDetails.canBeCancelled&&"COMPLETED"!==dt(Ce.queueDetails,"status","Status")&&"CANCELLED"!==dt(Ce.queueDetails,"status","Status")&&"CANCELLING"!==dt(Ce.queueDetails,"status","Status")&&"FAILED"!==dt(Ce.queueDetails,"status","Status")&&v.jsx(Z,{title:"This task can be cancelled",children:v.jsx(ee,{status:"processing",text:"Cancellable"})}),children:v.jsxs(V,{gutter:[24,16],children:[v.jsx($,{xs:24,lg:12,children:v.jsxs(H,{direction:"vertical",size:"middle",style:{width:"100%"},children:[v.jsx(U,{size:"small",title:"Task Information","data-testid":"queue-trace-task-info",children:v.jsxs(W,{column:1,size:"small",children:[v.jsx(W.Item,{label:"Task ID",children:v.jsx(ot,{code:!0,children:dt(Ce.queueDetails,"taskId","TaskId")})}),v.jsx(W.Item,{label:"Created By",children:v.jsxs(H,{children:[v.jsx(y,{}),v.jsx(ot,{children:dt(Ce.queueDetails,"createdBy","CreatedBy")||"System"})]})}),v.jsx(W.Item,{label:"Retry Status",children:v.jsxs(H,{children:[v.jsx(Ve,{}),v.jsxs(K,{color:0===dt(Ce.queueDetails,"retryCount","RetryCount")?"green":dt(Ce.queueDetails,"retryCount","RetryCount")<2?"orange":"red",children:[dt(Ce.queueDetails,"retryCount","RetryCount")||0," / 2 retries"]}),dt(Ce.queueDetails,"permanentlyFailed","PermanentlyFailed")&&v.jsx(K,{color:"error",children:"Permanently Failed"})]})}),v.jsx(W.Item,{label:"Priority",children:v.jsxs(H,{children:[Be(dt(Ce.queueDetails,"priority","Priority")).icon,v.jsx(K,{color:Be(dt(Ce.queueDetails,"priority","Priority")).color,children:Be(dt(Ce.queueDetails,"priority","Priority")).label})]})})]})}),v.jsx(U,{size:"small",title:"Processing Information","data-testid":"queue-trace-processing-info",children:v.jsxs(W,{column:1,size:"small",children:[v.jsx(W.Item,{label:"Machine",children:v.jsxs(H,{children:[v.jsx(E,{}),v.jsx(ot,{children:Ce.queueDetails.machineName})]})}),v.jsx(W.Item,{label:"Team",children:v.jsx(ot,{children:Ce.queueDetails.teamName})}),v.jsx(W.Item,{label:"Bridge",children:v.jsx(ot,{children:Ce.queueDetails.bridgeName})}),v.jsx(W.Item,{label:"Region",children:v.jsx(ot,{children:Ce.queueDetails.regionName})})]})}),v.jsxs(V,{gutter:[16,16],children:[v.jsx($,{span:8,children:v.jsx(J,{title:n("queue:statistics.totalDuration"),value:Ce.queueDetails.totalDurationSeconds<60?Ce.queueDetails.totalDurationSeconds:Math.floor(Ce.queueDetails.totalDurationSeconds/60),suffix:Ce.queueDetails.totalDurationSeconds<60?"sec":"min",prefix:v.jsx(m,{})})}),v.jsx($,{span:8,children:v.jsx(J,{title:n("queue:statistics.processing"),value:Ce.queueDetails.processingDurationSeconds?Ce.queueDetails.processingDurationSeconds<60?Ce.queueDetails.processingDurationSeconds:Math.floor(Ce.queueDetails.processingDurationSeconds/60):0,suffix:Ce.queueDetails.processingDurationSeconds&&Ce.queueDetails.processingDurationSeconds<60?"sec":"min",prefix:v.jsx(C,{})})}),v.jsx($,{span:8,children:v.jsx(J,{title:n("queue:statistics.timeSinceAssigned"),value:Ce.queueDetails.assignedTime?w().diff(w(Ce.queueDetails.assignedTime),"minute"):"N/A",suffix:Ce.queueDetails.assignedTime?"min":"",prefix:v.jsx(we,{}),valueStyle:{color:Fe()?"#ff4d4f":void 0}})})]})]})}),v.jsx($,{xs:24,lg:12,children:v.jsx(X,{"data-testid":"queue-trace-detailed-console-collapse",activeKey:ve?["console"]:[],onChange:e=>Ee(e.includes("console")),expandIcon:({isActive:e})=>v.jsx(at,{rotate:e?90:0}),children:v.jsx(ut,{header:v.jsxs(H,{children:[v.jsx(b,{}),v.jsx(ot,{children:"Response (Console)"}),"PROCESSING"===Ce.queueDetails?.status&&v.jsx(K,{icon:v.jsx(C,{spin:!0}),color:"processing",children:"Live Output"})]}),children:v.jsx(ft,{content:me.replace(/\\r\\n/g,"\n").replace(/\\n/g,"\n").replace(/\\r/g,"\r"),theme:Pe,consoleOutputRef:Ae,isEmpty:!Ce.responseVaultContent?.hasContent})},"console")})})]})},"overview"),Ce.queueDetails&&v.jsx(ut,{"data-testid":"queue-trace-panel-details",header:v.jsxs(H,{children:[v.jsx(M,{}),v.jsx("span",{children:"Queue Item Details"}),v.jsx(ot,{type:"secondary",style:{fontSize:"12px"},children:"(Result Set 1)"})]}),children:v.jsxs(W,{column:2,size:"small",children:[v.jsx(W.Item,{label:"Task ID",children:v.jsx(ot,{code:!0,children:dt(Ce.queueDetails,"taskId","TaskId")})}),v.jsx(W.Item,{label:"Status",children:v.jsx(K,{color:"COMPLETED"===dt(Ce.queueDetails,"status","Status")?"success":"CANCELLED"===dt(Ce.queueDetails,"status","Status")?"error":"CANCELLING"===dt(Ce.queueDetails,"status","Status")?"warning":"FAILED"===dt(Ce.queueDetails,"status","Status")?"error":"PROCESSING"===dt(Ce.queueDetails,"status","Status")?"processing":"ASSIGNED"===dt(Ce.queueDetails,"status","Status")?"blue":"default",children:dt(Ce.queueDetails,"status","Status")})}),v.jsx(W.Item,{label:"Priority",children:Ce.queueDetails.priorityLabel||"-"}),v.jsx(W.Item,{label:"Machine",children:Ce.queueDetails.machineName}),v.jsx(W.Item,{label:"Team",children:Ce.queueDetails.teamName}),v.jsx(W.Item,{label:"Bridge",children:Ce.queueDetails.bridgeName}),v.jsx(W.Item,{label:"Region",children:Ce.queueDetails.regionName}),v.jsx(W.Item,{label:"Created",children:re(Ce.queueDetails.createdTime,"datetime")}),Ce.queueDetails.assignedTime&&v.jsx(W.Item,{label:"Assigned",children:re(Ce.queueDetails.assignedTime,"datetime")}),Ce.queueDetails.lastRetryAt&&v.jsx(W.Item,{label:"Last Retry",children:re(Ce.queueDetails.lastRetryAt,"datetime")}),v.jsx(W.Item,{label:"Total Duration",children:ht(Ce.queueDetails.totalDurationSeconds)}),Ce.queueDetails.processingDurationSeconds&&v.jsx(W.Item,{label:"Processing Duration",children:ht(Ce.queueDetails.processingDurationSeconds)}),v.jsx(W.Item,{label:"Created By",children:dt(Ce.queueDetails,"createdBy","CreatedBy")||"-"}),v.jsx(W.Item,{label:"Retry Count",children:v.jsxs(K,{color:0===dt(Ce.queueDetails,"retryCount","RetryCount")?"green":dt(Ce.queueDetails,"retryCount","RetryCount")<3?"orange":"red",children:[dt(Ce.queueDetails,"retryCount","RetryCount")||0,"/2"]})}),dt(Ce.queueDetails,"lastFailureReason","LastFailureReason")&&v.jsx(W.Item,{label:"Last Failure Reason",span:2,children:v.jsx(ot,{type:"warning",children:dt(Ce.queueDetails,"lastFailureReason","LastFailureReason")})})]})},"details"),Ce.traceLogs&&Ce.traceLogs.length>0&&v.jsx(ut,{"data-testid":"queue-trace-panel-timeline",header:v.jsxs(H,{children:[v.jsx(I,{}),v.jsx("span",{children:"Processing Timeline"}),v.jsx(ot,{type:"secondary",style:{fontSize:"12px"},children:"(Result Set 4 - Audit Log)"})]}),children:v.jsx(te,{mode:"left",className:"queue-trace-timeline","data-testid":"queue-trace-timeline",children:Ce.traceLogs.map((e,t)=>{const s=dt(e,"action","Action"),a=dt(e,"timestamp","Timestamp"),i=dt(e,"details","Details")||"",n=dt(e,"actionByUser","ActionByUser")||"";let r="gray";return"QUEUE_ITEM_CREATED"===s?r="green":"QUEUE_ITEM_ASSIGNED"===s?r="blue":"QUEUE_ITEM_PROCESSING"===s||"QUEUE_ITEM_RESPONSE_UPDATED"===s?r="orange":"QUEUE_ITEM_COMPLETED"===s?r="green":"QUEUE_ITEM_CANCELLED"===s?r="red":"QUEUE_ITEM_CANCELLING"===s?r="warning":"QUEUE_ITEM_FAILED"===s?r="red":"QUEUE_ITEM_RETRY"===s?r="orange":(s.includes("ERROR")||s.includes("FAILED"))&&(r="red"),v.jsx(te.Item,{color:r,children:v.jsxs(H,{direction:"vertical",size:0,children:[v.jsx(ot,{strong:!0,children:s.replace("QUEUE_ITEM_","").replace(/_/g," ")}),v.jsx(ot,{type:"secondary",children:re(a,"datetime")}),i&&v.jsx(ot,{children:i}),n&&v.jsxs(ot,{type:"secondary",children:["By: ",n]})]})},t)})})},"timeline"),(Ce.vaultContent||Ce.responseVaultContent)&&v.jsx(ut,{"data-testid":"queue-trace-panel-vault",header:v.jsxs(H,{children:[v.jsx(M,{}),v.jsx("span",{children:"Vault Content"}),v.jsx(ot,{type:"secondary",style:{fontSize:"12px"},children:"(Result Sets 2 & 3)"})]}),children:v.jsx(se,{"data-testid":"queue-trace-vault-tabs",items:[{key:"request",label:v.jsxs(H,{children:[v.jsx(M,{}),"Request Vault"]}),children:Ce.vaultContent&&Ce.vaultContent.hasContent?(()=>{try{const e="string"==typeof Ce.vaultContent.vaultContent?JSON.parse(Ce.vaultContent.vaultContent):Ce.vaultContent.vaultContent||{};return v.jsx(_,{value:JSON.stringify(e,null,2),readOnly:!0,height:"300px"})}catch(e){return v.jsx(ae,{description:"Invalid request vault content format"})}})():v.jsx(ae,{description:"No request vault content"})},...Ce.responseVaultContent&&Ce.responseVaultContent.hasContent?[{key:"response",label:v.jsxs(H,{children:[v.jsx(M,{}),"Response Vault"]}),children:(()=>{try{const t="string"==typeof Ce.responseVaultContent.vaultContent?JSON.parse(Ce.responseVaultContent.vaultContent):Ce.responseVaultContent.vaultContent||{};if(t.result&&"string"==typeof t.result)try{const e=JSON.parse(t.result);if("success"===e.status&&e.kernel_compatibility){const t=e.kernel_compatibility,s=t.os_info||{},a=t.compatibility_status||"unknown",i={compatible:{type:"success",icon:v.jsx(j,{}),color:"#52c41a"},warning:{type:"warning",icon:v.jsx(f,{}),color:"#faad14"},incompatible:{type:"error",icon:v.jsx(p,{}),color:"#ff4d4f"},unknown:{type:"info",icon:v.jsx(P,{}),color:"#1890ff"}},n=i[a]||i.unknown;return v.jsxs(H,{direction:"vertical",style:{width:"100%"},children:[v.jsx(U,{size:"small",title:"SSH Test Result",style:{marginBottom:16},children:v.jsxs(W,{column:2,size:"small",children:[v.jsx(W.Item,{label:"Status",children:v.jsx(K,{color:"success",children:e.status})}),v.jsx(W.Item,{label:"Machine",children:e.machine||"N/A"}),v.jsx(W.Item,{label:"IP Address",children:e.ip}),v.jsx(W.Item,{label:"User",children:e.user}),v.jsx(W.Item,{label:"Auth Method",children:v.jsx(K,{children:e.auth_method})}),v.jsx(W.Item,{label:"SSH Key",children:e.ssh_key_configured?v.jsx(K,{color:"success",children:"Configured"}):v.jsx(K,{color:"warning",children:"Not Configured"})})]})}),v.jsx(U,{size:"small",title:"System Information",style:{marginBottom:16},children:v.jsxs(W,{column:1,size:"small",children:[v.jsx(W.Item,{label:"Operating System",children:s.pretty_name||"Unknown"}),v.jsx(W.Item,{label:"Kernel Version",children:v.jsx(ot,{code:!0,children:t.kernel_version||"Unknown"})}),v.jsx(W.Item,{label:"OS ID",children:s.id||"Unknown"}),v.jsx(W.Item,{label:"Version",children:s.version_id||"Unknown"}),v.jsx(W.Item,{label:"BTRFS Support",children:t.btrfs_available?v.jsx(K,{color:"success",children:"Available"}):v.jsx(K,{color:"warning",children:"Not Available"})}),v.jsx(W.Item,{label:"Sudo Support",children:(()=>{const e=t.sudo_available||"unknown";return"available"===e?v.jsx(K,{color:"success",children:"Available"}):"password_required"===e?v.jsx(K,{color:"warning",children:"Password Required"}):"not_installed"===e?v.jsx(K,{color:"error",children:"Not Installed"}):v.jsx(K,{color:"default",children:"Unknown"})})()})]})}),v.jsx(F,{"data-testid":"queue-trace-ssh-compatibility-alert",type:n.type,icon:n.icon,message:v.jsxs(H,{children:[v.jsx(ot,{strong:!0,children:"Compatibility Status:"}),v.jsx(ot,{style:{color:n.color,textTransform:"capitalize"},children:a})]}),description:v.jsxs(v.Fragment,{children:[t.compatibility_issues&&t.compatibility_issues.length>0&&v.jsxs("div",{style:{marginTop:8},children:[v.jsx(ot,{strong:!0,children:"Known Issues:"}),v.jsx("ul",{style:{marginTop:4,marginBottom:8},children:t.compatibility_issues.map((e,t)=>v.jsx("li",{children:e},t))})]}),t.recommendations&&t.recommendations.length>0&&v.jsxs("div",{children:[v.jsx(ot,{strong:!0,children:"Recommendations:"}),v.jsx("ul",{style:{marginTop:4,marginBottom:0},children:t.recommendations.map((e,t)=>v.jsx("li",{children:e},t))})]})]}),showIcon:!0}),v.jsx(X,{style:{marginTop:16},children:v.jsx(X.Panel,{header:"Raw Response Data",children:v.jsx(_,{value:JSON.stringify(e,null,2),readOnly:!0,height:"200px"})},"raw")})]})}}catch(e){}return v.jsx(_,{value:JSON.stringify(t,null,2),readOnly:!0,height:"300px"})}catch(t){return v.jsx(ae,{description:"Invalid response vault content format"})}})()}]:[]]})},"vault"),Ce.queuePosition&&Ce.queuePosition.length>0&&v.jsxs(ut,{"data-testid":"queue-trace-panel-related",header:v.jsxs(H,{children:[v.jsx(E,{}),v.jsx("span",{children:"Related Queue Items"}),v.jsx(ot,{type:"secondary",style:{fontSize:"12px"},children:"(Result Set 5 - Nearby Tasks)"})]}),children:[v.jsxs(V,{gutter:[16,16],children:[v.jsx($,{span:12,children:v.jsx(U,{size:"small",title:"Tasks Before This One",children:v.jsxs("div",{style:{maxHeight:200,overflow:"auto"},children:[Ce.queuePosition.filter(e=>"Before"===e.relativePosition).map((e,t)=>v.jsx("div",{style:{marginBottom:8},children:v.jsxs(H,{children:[v.jsx(ot,{code:!0,style:{fontSize:"11px"},children:e.taskId}),v.jsx(K,{color:"PROCESSING"===e.status?"processing":"default",style:{fontSize:"11px"},children:e.status}),v.jsx(ot,{type:"secondary",style:{fontSize:"11px"},children:w(e.createdTime).fromNow()})]})},t)),0===Ce.queuePosition.filter(e=>"Before"===e.relativePosition).length&&v.jsx(ae,{description:"No tasks ahead",image:ae.PRESENTED_IMAGE_SIMPLE})]})})}),v.jsx($,{span:12,children:v.jsx(U,{size:"small",title:"Tasks After This One",children:v.jsxs("div",{style:{maxHeight:200,overflow:"auto"},children:[Ce.queuePosition.filter(e=>"After"===e.relativePosition).map((e,t)=>v.jsx("div",{style:{marginBottom:8},children:v.jsxs(H,{children:[v.jsx(ot,{code:!0,style:{fontSize:"11px"},children:e.taskId}),v.jsx(K,{color:"PROCESSING"===e.status?"processing":"default",style:{fontSize:"11px"},children:e.status}),v.jsx(ot,{type:"secondary",style:{fontSize:"11px"},children:w(e.createdTime).fromNow()})]})},t)),0===Ce.queuePosition.filter(e=>"After"===e.relativePosition).length&&v.jsx(ae,{description:"No tasks behind",image:ae.PRESENTED_IMAGE_SIMPLE})]})})})]}),v.jsx("div",{style:{marginTop:16,textAlign:"center"},children:v.jsxs(ot,{type:"secondary",children:["Total: ",Ce.queuePosition.filter(e=>"Before"===e.relativePosition).length," tasks ahead,",Ce.queuePosition.filter(e=>"After"===e.relativePosition).length," tasks behind"]})})]},"related"),Ce.machineStats&&v.jsxs(ut,{"data-testid":"queue-trace-panel-performance",header:v.jsxs(H,{children:[v.jsx(xe,{}),v.jsx("span",{children:"Performance Metrics"}),v.jsx(ot,{type:"secondary",style:{fontSize:"12px"},children:"(Result Set 6 - Machine Stats)"})]}),children:[v.jsxs(V,{gutter:16,children:[v.jsx($,{span:8,children:v.jsxs(U,{children:[v.jsx(J,{title:"Current Queue Depth",value:Ce.machineStats.currentQueueDepth,prefix:v.jsx(we,{}),suffix:"tasks",valueStyle:{color:Ce.machineStats.currentQueueDepth>50?"#ff4d4f":Ce.machineStats.currentQueueDepth>20?"#faad14":"#52c41a"}}),v.jsx(Y,{percent:Math.min(100,Ce.machineStats.currentQueueDepth/100*100),showInfo:!1,strokeColor:Ce.machineStats.currentQueueDepth>50?"#ff4d4f":Ce.machineStats.currentQueueDepth>20?"#faad14":"#52c41a"})]})}),v.jsx($,{span:8,children:v.jsxs(U,{children:[v.jsx(J,{title:"Active Processing Count",value:Ce.machineStats.activeProcessingCount,prefix:v.jsx(C,{spin:!0}),suffix:"tasks"}),v.jsx(ot,{type:"secondary",children:"Currently being processed on this machine"})]})}),v.jsx($,{span:8,children:v.jsxs(U,{children:[v.jsx(J,{title:"Processing Capacity",value:`${Ce.machineStats.activeProcessingCount}/${Ce.machineStats.maxConcurrentTasks||"N/A"}`,prefix:v.jsx(xe,{}),valueStyle:{color:Ce.machineStats.activeProcessingCount>=(Ce.machineStats.maxConcurrentTasks||0)?"#ff4d4f":"#52c41a"}}),v.jsx(Y,{percent:Ce.machineStats.maxConcurrentTasks?Math.min(100,Ce.machineStats.activeProcessingCount/Ce.machineStats.maxConcurrentTasks*100):0,showInfo:!1,strokeColor:Ce.machineStats.activeProcessingCount>=(Ce.machineStats.maxConcurrentTasks||0)?"#ff4d4f":"#52c41a"})]})})]}),v.jsx(ie,{}),v.jsx(F,{"data-testid":"queue-trace-performance-alert",message:"Performance Analysis",description:v.jsxs(H,{direction:"vertical",children:[Ce.machineStats.currentQueueDepth>50&&v.jsx(ot,{children:"⚠️ High queue depth detected. Tasks may experience delays."}),Ce.machineStats.activeProcessingCount>=(Ce.machineStats.maxConcurrentTasks||0)&&v.jsx(ot,{children:"⚠️ Machine at full capacity. New tasks will wait in queue."}),0===Ce.machineStats.currentQueueDepth&&0===Ce.machineStats.activeProcessingCount&&v.jsx(ot,{children:"✅ Machine is idle and ready to process tasks immediately."})]}),type:Ce.machineStats.currentQueueDepth>50?"warning":"info"})]},"performance")]})})]}):v.jsx(ae,{description:"No trace data available"})});var He};export{xe as D,De as P,pt as Q,at as R,it as q};

appId: com.rediacc.desktop
productName: Rediacc Desktop
copyright: Copyright Â© 2024 Rediacc

# Skip native module rebuild on Windows (uses prebuilds instead)
# See scripts/before-build.js for details
beforeBuild: scripts/before-build.js

directories:
  buildResources: resources
  output: ../../dist/desktop

files:
  # Include built output and config files
  - out/**
  - package.json
  - externals.json
  # Include external modules copied by resolve-desktop-externals.sh
  # (not in package.json dependencies - they're externalized for build)
  # Use from/to mapping to preserve directory structure
  - from: node_modules
    to: node_modules
    filter:
      - "**/*"

asarUnpack:
  - resources/**
  # Native modules must be unpacked for their bindings to work
  - node_modules/ssh2/**
  - node_modules/cpu-features/**
  - node_modules/node-pty/**

# Windows Configuration
# Note: arch is controlled by CI via --arch flag, not hardcoded here
win:
  target: nsis
  artifactName: rediacc-desktop-${version}-win-${arch}.${ext}
  icon: resources/icon.ico
  # Bundle MSYS2 binaries for rsync/SSH functionality
  extraResources:
    - from: msys2-bundle
      to: msys2-bundle
      filter:
        - '**/*'

nsis:
  oneClick: false
  perMachine: true
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: false
  createDesktopShortcut: always
  createStartMenuShortcut: true
  shortcutName: Rediacc Desktop
  installerIcon: resources/icon.ico
  uninstallerIcon: resources/icon.ico

# macOS Configuration
# Note: arch is controlled by CI via --arch flag, not hardcoded here
mac:
  target:
    - dmg
    - zip
  artifactName: rediacc-desktop-${version}-mac-${arch}.${ext}
  icon: resources/icon.png
  category: public.app-category.developer-tools
  entitlementsInherit: resources/entitlements.mac.plist
  hardenedRuntime: true
  # gatekeeperAssess defaults to true, enabling macOS security verification

dmg:
  writeUpdateInfo: false
  sign: false
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications
  window:
    width: 540
    height: 380

# Linux Configuration
# Note: arch is controlled by CI via --arch flag, not hardcoded here
linux:
  target:
    - AppImage
    - deb
  artifactName: rediacc-desktop-${version}-linux-${arch}.${ext}
  icon: resources/icon.png
  category: Development
  maintainer: Rediacc <support@rediacc.com>
  synopsis: Rediacc Desktop Application
  description: Desktop application for managing Rediacc infrastructure

deb:
  depends:
    - libgtk-3-0
    - libnotify4
    - libnss3
    - libxss1
    - libxtst6
    - xdg-utils
    - libatspi2.0-0
    - libsecret-1-0
  afterInstall: scripts/postinst.sh
  afterRemove: scripts/postrm.sh

appImage:
  artifactName: rediacc-desktop-${version}-linux.${ext}

# Publish Configuration
publish:
  - provider: generic
    url: https://releases.rediacc.com/desktop/
    channel: latest

# Protocol Handler (rediacc://)
protocols:
  - name: Rediacc Desktop
    schemes:
      - rediacc
    role: Viewer

# Extra Resources
extraResources:
  - from: resources/
    to: resources/
    filter:
      - '**/*'
      - '!*.psd'

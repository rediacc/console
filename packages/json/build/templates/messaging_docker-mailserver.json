{"id":"messaging_docker-mailserver","name":"Docker Mailserver","description":"Production-ready fullstack mail server with SMTP, IMAP, anti-spam, and anti-virus protection using configuration files.","category":"messaging","tags":["messaging","docker-mailserver"],"files":[{"name":".env","path":"docker-mailserver/.env","type":"environment","content":"# Docker Mailserver Configuration\n\n# REQUIRED: Set your mail server hostname (e.g., mail.example.com)\n# This must match your DNS A record\nHOSTNAME=mail.example.com\n\n# Network mode for Docker (default: bridge)\nNETWORK_MODE=bridge\n\n# Security Features (enabled by default)\n# Anti-spam protection with Rspamd\nENABLE_RSPAMD=1\n\n# Anti-virus scanning with ClamAV\nENABLE_CLAMAV=1\n\n# Brute-force protection with Fail2Ban\nENABLE_FAIL2BAN=1"},{"name":"README.md","path":"docker-mailserver/README.md","type":"markdown","content":"# Docker Mailserver\n\nProduction-ready fullstack mail server with SMTP, IMAP, anti-spam, and anti-virus protection using configuration files.\n\n## Features\n- Complete mail stack: Postfix (SMTP), Dovecot (IMAP), Rspamd (anti-spam), ClamAV (anti-virus)\n- File-based configuration with no database required\n- Built-in Fail2Ban for brute-force protection\n- SSL/TLS encryption support\n- LDAP authentication support (optional)\n\n## Usage\n```bash\nsource Rediaccfile\nprep  # Pull image and create directories\nup    # Start mail server (auto-creates admin account on first run)\ndown  # Stop and cleanup\n```\n\n### First Run - Automatic Admin Account\nOn first run, an admin mail account is automatically created:\n- **Email**: `admin@your-domain.com` (based on HOSTNAME in .env)\n- **Password**: Random 16-character password\n- **Credentials**: Saved to `./docker-data/dms/admin-credentials.txt`\n\n**Important**: Change this password after first login for security!\n\n## Configuration\nEdit `.env` to customize:\n- `HOSTNAME`: Your mail server hostname (required - e.g., mail.example.com)\n- Security features enabled by default (Rspamd, ClamAV, Fail2Ban)\n\n## Access\n- **SMTP Ports**: 25, 465, 587 (standard mail ports - fixed)\n- **IMAP Port**: 993 (IMAPS)\n- **Note**: Standard mail protocol ports are fixed and cannot be changed\n\n## Important Setup Requirements\nBefore using in production:\n1. **Configure hostname** in `.env` to match your domain (e.g., mail.example.com)\n2. **Start the server** - Admin account is auto-created on first run\n3. **Change default password** - Find credentials in `./docker-data/dms/admin-credentials.txt`\n4. **Setup DNS records**: SPF, DKIM, DMARC for your domain\n5. **Configure SSL/TLS certificates** for secure mail delivery\n6. **Generate DKIM keys** for email authentication\n\n### Managing Mail Accounts\n\n**Quick Management with tool.sh:**\n```bash\n# View auto-generated admin credentials\ncat ./docker-data/dms/admin-credentials.txt\n\n# Add additional mail accounts\n./tool.sh email add user@example.com password123\n\n# Change a password\n./tool.sh email update admin@example.com newpassword\n\n# List all accounts\n./tool.sh email list\n\n# Delete an account\n./tool.sh email del user@example.com\n\n# Add email alias\n./tool.sh alias add info@example.com admin@example.com\n\n# Set mailbox quota\n./tool.sh quota set user@example.com 2G\n\n# Generate DKIM keys (required for production)\n./tool.sh config dkim\n\n# Show all available commands\n./tool.sh help\n```\n\n**Alternative - Direct docker exec:**\n```bash\ndocker exec -it mailserver setup email add user@example.com\ndocker exec -it mailserver setup email list\ndocker exec -it mailserver setup config dkim\n```\n\n## Important Notes\n- **Auto-Generated Admin**: First run creates `admin@your-domain.com` with random password\n- **Credentials File**: `./docker-data/dms/admin-credentials.txt` (change password after first login!)\n- **Fixed Ports**: Mail protocols require standard ports (25, 465, 587, 993)\n- **One Instance Per Machine**: Due to port requirements, only one mail server can run per machine\n- **NET_ADMIN Capability**: Required for Fail2Ban functionality\n- **Data Persistence**: All mail data, state, logs, and config stored in `./docker-data/dms/`\n- **Production Deployment**: Requires proper DNS, SSL/TLS, and configuration - see official docs\n\n## Resources\n- [Official Documentation](https://docker-mailserver.github.io/docker-mailserver/latest/)\n- [Basic Installation Guide](https://docker-mailserver.github.io/docker-mailserver/latest/examples/tutorials/basic-installation/)\n- [Docker Hub](https://hub.docker.com/r/mailserver/docker-mailserver)"},{"name":"Rediaccfile","path":"docker-mailserver/Rediaccfile","type":"text","content":"#!/bin/bash\n\n# === Renet Compose Support ===\n_use_renet() {\n  [[ -n \"$REPOSITORY_NETWORK_ID\" ]] && command -v renet &>/dev/null\n}\n_compose() {\n  if _use_renet; then\n    renet compose --network-id \"$REPOSITORY_NETWORK_ID\" -- \"$@\"\n  else\n    docker compose \"$@\"\n  fi\n}\n\n# Docker Mailserver Lifecycle Functions\n\nprep() {\n  echo \"Pulling Docker Mailserver image...\"\n  docker pull ghcr.io/docker-mailserver/docker-mailserver:latest\n  local exit_code=$?\n  if [ $exit_code -ne 0 ]; then\n    echo \"Failed to pull image\"\n    return $exit_code\n  fi\n\n  echo \"Creating data directories...\"\n  mkdir -p docker-data/dms/mail-data\n  mkdir -p docker-data/dms/mail-state\n  mkdir -p docker-data/dms/mail-logs\n  mkdir -p docker-data/dms/config\n\n  return $?\n}\n\nup() {\n  echo \"Starting Docker Mailserver...\"\n  _compose up -d\n  local exit_code=$?\n  if [ $exit_code -ne 0 ]; then\n    echo \"Failed to start Docker Mailserver\"\n    return $exit_code\n  fi\n\n  echo \"\"\n  echo \"Docker Mailserver started successfully!\"\n  echo \"\"\n\n  # Auto-create admin account on first run\n  local credentials_file=\"./docker-data/dms/admin-credentials.txt\"\n\n  if [ ! -f \"$credentials_file\" ]; then\n    echo \"First run detected - creating admin mail account...\"\n    echo \"\"\n\n    # Extract domain from HOSTNAME in .env (default: mail.example.com)\n    source .env 2>/dev/null || true\n    local hostname=\"${HOSTNAME:-mail.example.com}\"\n    local domain=\"${hostname#*.}\"  # Remove first part (mail.) to get domain\n    local email=\"admin@${domain}\"\n\n    # Generate random password (16 characters)\n    local password=$(openssl rand -base64 16 | tr -d \"=+/\" | cut -c1-16)\n\n    echo \"Waiting for mailserver to be ready (30 seconds)...\"\n    sleep 30\n\n    # Create the admin account\n    echo \"Creating admin account: ${email}\"\n    docker exec mailserver setup email add \"${email}\" \"${password}\" 2>/dev/null\n\n    if [ $? -eq 0 ]; then\n      # Store credentials\n      echo \"Email: ${email}\" > \"$credentials_file\"\n      echo \"Password: ${password}\" >> \"$credentials_file\"\n      chmod 600 \"$credentials_file\"\n\n      echo \"\"\n      echo \"‚úÖ Admin account created successfully!\"\n      echo \"\"\n      echo \"üìß Credentials saved to: ${credentials_file}\"\n      echo \"   Email: ${email}\"\n      echo \"   Password: ${password}\"\n      echo \"\"\n      echo \"‚ö†Ô∏è  IMPORTANT: Change this password after first login!\"\n      echo \"\"\n    else\n      echo \"‚ö†Ô∏è  Failed to create admin account. You can create it manually with:\"\n      echo \"   docker exec -it mailserver setup email add ${email}\"\n    fi\n  else\n    echo \"Admin account already exists. Credentials in: ${credentials_file}\"\n    echo \"\"\n  fi\n\n  echo \"IMPORTANT: Before using in production, you must:\"\n  echo \"  1. Setup DNS records (SPF, DKIM, DMARC) for your domain\"\n  echo \"  2. Configure SSL/TLS certificates\"\n  echo \"  3. Generate DKIM keys using: ./tool.sh config dkim\"\n  echo \"  4. Change the default admin password\"\n  echo \"\"\n  echo \"Mail server ports:\"\n  echo \"  - SMTP: 25, 465, 587\"\n  echo \"  - IMAP: 993\"\n  echo \"\"\n  echo \"Quick management:\"\n  echo \"  - Run: ./tool.sh help  (for all available commands)\"\n  echo \"  - Examples: ./tool.sh email list, ./tool.sh email add user@domain.com\"\n  echo \"\"\n  echo \"Check logs with: docker compose logs -f\"\n  echo \"Official docs: https://docker-mailserver.github.io/docker-mailserver/latest/\"\n  echo \"\"\n\n  return 0\n}\n\ndown() {\n  echo \"Stopping Docker Mailserver and cleaning up...\"\n  _compose down -v\n  return $?\n}"},{"name":"docker-compose.yaml","path":"docker-mailserver/docker-compose.yaml","type":"yaml","content":"services:\n  mailserver:\n    image: ghcr.io/docker-mailserver/docker-mailserver:latest\n    container_name: mailserver\n    hostname: ${HOSTNAME:-mail.example.com}\n    restart: always\n    network_mode: \"${NETWORK_MODE:-bridge}\"\n    ports:\n      - \"25:25\"    # SMTP\n      - \"465:465\"  # SMTPS (SMTP over TLS)\n      - \"587:587\"  # Submission\n      - \"993:993\"  # IMAPS (IMAP over TLS)\n    volumes:\n      - ./docker-data/dms/mail-data:/var/mail\n      - ./docker-data/dms/mail-state:/var/mail-state\n      - ./docker-data/dms/mail-logs:/var/log/mail\n      - ./docker-data/dms/config:/tmp/docker-mailserver\n      - /etc/localtime:/etc/localtime:ro\n    environment:\n      - ENABLE_RSPAMD=${ENABLE_RSPAMD:-1}\n      - ENABLE_CLAMAV=${ENABLE_CLAMAV:-1}\n      - ENABLE_FAIL2BAN=${ENABLE_FAIL2BAN:-1}\n    cap_add:\n      - NET_ADMIN\n    healthcheck:\n      test: [\"CMD-SHELL\", \"nc -z localhost 25 || exit 1\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 120s"},{"name":"tool.sh","path":"docker-mailserver/tool.sh","type":"script","content":"#!/bin/bash\n\n# Docker Mailserver Management Tool\n# Simple wrapper for docker exec mailserver setup commands\n\nCONTAINER_NAME=\"mailserver\"\n\n# Check if container is running\nif ! docker ps --format '{{.Names}}' | grep -q \"^${CONTAINER_NAME}$\"; then\n  echo \"Error: Container '${CONTAINER_NAME}' is not running.\"\n  echo \"Start the mail server with: source Rediaccfile && up\"\n  exit 1\nfi\n\n# Show help if no arguments provided\nif [ $# -eq 0 ]; then\n  echo \"Docker Mailserver Management Tool\"\n  echo \"\"\n  echo \"Usage: ./tool.sh <command> [arguments...]\"\n  echo \"\"\n  echo \"Common commands:\"\n  echo \"  email add <email> [password]       - Create new mail account\"\n  echo \"  email update <email> [password]    - Update account password\"\n  echo \"  email del <email>                  - Delete mail account\"\n  echo \"  email list                         - List all mail accounts\"\n  echo \"\"\n  echo \"  alias add <alias> <target>         - Create email alias\"\n  echo \"  alias del <alias> <target>         - Delete email alias\"\n  echo \"  alias list                         - List all aliases\"\n  echo \"\"\n  echo \"  quota set <email> <quota>          - Set mailbox quota (e.g., 1G, 500M)\"\n  echo \"  quota del <email>                  - Remove quota limit\"\n  echo \"\"\n  echo \"  config dkim [keysize N]            - Generate DKIM keys\"\n  echo \"\"\n  echo \"  help                               - Show all available commands\"\n  echo \"\"\n  echo \"Examples:\"\n  echo \"  ./tool.sh email add user@example.com secretpass123\"\n  echo \"  ./tool.sh email list\"\n  echo \"  ./tool.sh alias add info@example.com admin@example.com\"\n  echo \"  ./tool.sh quota set user@example.com 2G\"\n  echo \"  ./tool.sh config dkim\"\n  echo \"\"\n  exit 0\nfi\n\n# Execute setup command with all arguments\ndocker exec \"${CONTAINER_NAME}\" setup \"$@\""}],"readme":"# Docker Mailserver\n\nProduction-ready fullstack mail server with SMTP, IMAP, anti-spam, and anti-virus protection using configuration files.\n\n## Features\n- Complete mail stack: Postfix (SMTP), Dovecot (IMAP), Rspamd (anti-spam), ClamAV (anti-virus)\n- File-based configuration with no database required\n- Built-in Fail2Ban for brute-force protection\n- SSL/TLS encryption support\n- LDAP authentication support (optional)\n\n## Usage\n```bash\nsource Rediaccfile\nprep  # Pull image and create directories\nup    # Start mail server (auto-creates admin account on first run)\ndown  # Stop and cleanup\n```\n\n### First Run - Automatic Admin Account\nOn first run, an admin mail account is automatically created:\n- **Email**: `admin@your-domain.com` (based on HOSTNAME in .env)\n- **Password**: Random 16-character password\n- **Credentials**: Saved to `./docker-data/dms/admin-credentials.txt`\n\n**Important**: Change this password after first login for security!\n\n## Configuration\nEdit `.env` to customize:\n- `HOSTNAME`: Your mail server hostname (required - e.g., mail.example.com)\n- Security features enabled by default (Rspamd, ClamAV, Fail2Ban)\n\n## Access\n- **SMTP Ports**: 25, 465, 587 (standard mail ports - fixed)\n- **IMAP Port**: 993 (IMAPS)\n- **Note**: Standard mail protocol ports are fixed and cannot be changed\n\n## Important Setup Requirements\nBefore using in production:\n1. **Configure hostname** in `.env` to match your domain (e.g., mail.example.com)\n2. **Start the server** - Admin account is auto-created on first run\n3. **Change default password** - Find credentials in `./docker-data/dms/admin-credentials.txt`\n4. **Setup DNS records**: SPF, DKIM, DMARC for your domain\n5. **Configure SSL/TLS certificates** for secure mail delivery\n6. **Generate DKIM keys** for email authentication\n\n### Managing Mail Accounts\n\n**Quick Management with tool.sh:**\n```bash\n# View auto-generated admin credentials\ncat ./docker-data/dms/admin-credentials.txt\n\n# Add additional mail accounts\n./tool.sh email add user@example.com password123\n\n# Change a password\n./tool.sh email update admin@example.com newpassword\n\n# List all accounts\n./tool.sh email list\n\n# Delete an account\n./tool.sh email del user@example.com\n\n# Add email alias\n./tool.sh alias add info@example.com admin@example.com\n\n# Set mailbox quota\n./tool.sh quota set user@example.com 2G\n\n# Generate DKIM keys (required for production)\n./tool.sh config dkim\n\n# Show all available commands\n./tool.sh help\n```\n\n**Alternative - Direct docker exec:**\n```bash\ndocker exec -it mailserver setup email add user@example.com\ndocker exec -it mailserver setup email list\ndocker exec -it mailserver setup config dkim\n```\n\n## Important Notes\n- **Auto-Generated Admin**: First run creates `admin@your-domain.com` with random password\n- **Credentials File**: `./docker-data/dms/admin-credentials.txt` (change password after first login!)\n- **Fixed Ports**: Mail protocols require standard ports (25, 465, 587, 993)\n- **One Instance Per Machine**: Due to port requirements, only one mail server can run per machine\n- **NET_ADMIN Capability**: Required for Fail2Ban functionality\n- **Data Persistence**: All mail data, state, logs, and config stored in `./docker-data/dms/`\n- **Production Deployment**: Requires proper DNS, SSL/TLS, and configuration - see official docs\n\n## Resources\n- [Official Documentation](https://docker-mailserver.github.io/docker-mailserver/latest/)\n- [Basic Installation Guide](https://docker-mailserver.github.io/docker-mailserver/latest/examples/tutorials/basic-installation/)\n- [Docker Hub](https://hub.docker.com/r/mailserver/docker-mailserver)","generated":"2026-01-16T09:43:38Z"}

---
title: "ما بعد التثبيت"
description: "إعداد التشغيل التلقائي، وهيكل السياق، واستكشاف الأخطاء وإصلاحها في Rediacc."
category: "Guides"
order: 3
language: ar
---

# ما بعد التثبيت

بعد إكمال [الدليل خطوة بخطوة](/ar/docs/guide)، تغطي هذه الصفحة إعداد التشغيل التلقائي، وفهم ملف إعدادات السياق، واستكشاف المشكلات الشائعة وإصلاحها.

## التشغيل التلقائي عند الإقلاع

افتراضياً، يجب تحميل المستودعات وتشغيلها يدوياً بعد إعادة تشغيل الخادم. يقوم **التشغيل التلقائي** بتهيئة المستودعات للتحميل تلقائياً، وتشغيل Docker، وتنفيذ `up()` في Rediaccfile عند إقلاع الخادم.

### كيف يعمل

عند تفعيل التشغيل التلقائي لمستودع:

1. يتم إنشاء ملف مفتاح LUKS عشوائي بحجم 256 بايت وإضافته إلى فتحة LUKS رقم 1 للمستودع (تبقى الفتحة 0 لعبارة مرور المستخدم).
2. يُخزّن ملف المفتاح في `{datastore}/.credentials/keys/{guid}.key` بصلاحيات `0600` (الجذر فقط).
3. يتم تثبيت خدمة systemd (`rediacc-autostart`) تعمل عند الإقلاع لتحميل جميع المستودعات المفعّلة وتشغيل خدماتها.

عند إيقاف النظام أو إعادة تشغيله، تقوم الخدمة بإيقاف جميع الخدمات بسلاسة (Rediaccfile `down()`)، وإيقاف عمليات Docker، وإغلاق وحدات LUKS.

> **ملاحظة أمنية:** تفعيل التشغيل التلقائي يخزّن ملف مفتاح LUKS على قرص الخادم. يمكن لأي شخص لديه صلاحيات الجذر على الخادم تحميل المستودع بدون عبارة المرور. هذا تنازل بين الراحة (التشغيل التلقائي عند الإقلاع) والأمان (طلب إدخال عبارة المرور يدوياً). قيّم هذا بناءً على نموذج التهديد الخاص بك.

### تفعيل التشغيل التلقائي

```bash
rdc repo autostart enable my-app -m server-1
```

سيُطلب منك إدخال عبارة مرور المستودع. هذا ضروري للسماح بإضافة ملف المفتاح إلى وحدة LUKS.

### تفعيل التشغيل التلقائي لجميع المستودعات

```bash
rdc repo autostart enable-all -m server-1
```

### تعطيل التشغيل التلقائي

```bash
rdc repo autostart disable my-app -m server-1
```

يزيل هذا ملف المفتاح ويحذف فتحة LUKS رقم 1. لن يتم تحميل المستودع تلقائياً عند الإقلاع بعد ذلك.

### عرض حالة التشغيل التلقائي

```bash
rdc repo autostart list -m server-1
```

يعرض المستودعات التي تم تفعيل التشغيل التلقائي لها وما إذا كانت خدمة systemd مثبّتة.

## فهم إعدادات السياق

يتم تخزين جميع إعدادات السياق في `~/.rediacc/config.json`. فيما يلي مثال مشروح لما يبدو عليه هذا الملف بعد إكمال الدليل:

```json
{
  "contexts": {
    "production": {
      "name": "production",
      "mode": "local",
      "apiUrl": "local://",
      "ssh": {
        "privateKeyPath": "/home/you/.ssh/id_ed25519"
      },
      "machines": {
        "prod-1": {
          "ip": "203.0.113.50",
          "user": "deploy",
          "port": 22,
          "datastore": "/mnt/rediacc",
          "knownHosts": "203.0.113.50 ssh-ed25519 AAAA..."
        }
      },
      "repositories": {
        "webapp": {
          "repositoryGuid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
          "credential": "base64-encoded-random-passphrase",
          "networkId": 2816
        }
      }
    }
  }
}
```

**الحقول الرئيسية:**

| الحقل | الوصف |
|-------|-------|
| `mode` | `"local"` للوضع المحلي، `"s3"` للسياقات المدعومة بـ S3. |
| `apiUrl` | `"local://"` يشير إلى الوضع المحلي (بدون API بعيد). |
| `ssh.privateKeyPath` | مسار مفتاح SSH الخاص المستخدم لجميع اتصالات الأجهزة. |
| `machines.<name>.knownHosts` | مفاتيح مضيف SSH من `ssh-keyscan`، تُستخدم للتحقق من هوية الخادم. |
| `repositories.<name>.repositoryGuid` | معرّف UUID يحدد صورة القرص المشفرة على الخادم. |
| `repositories.<name>.credential` | عبارة مرور تشفير LUKS. **لا تُخزّن على الخادم.** |
| `repositories.<name>.networkId` | معرّف الشبكة الذي يحدد الشبكة الفرعية لعناوين IP (2816 + n*64). يُعيَّن تلقائياً. |

> يحتوي هذا الملف على بيانات حساسة (مسارات مفاتيح SSH، بيانات اعتماد LUKS). يُخزّن بصلاحيات `0600` (قراءة/كتابة للمالك فقط). لا تشاركه أو تضعه في نظام التحكم بالإصدارات.

## استكشاف الأخطاء وإصلاحها

### فشل اتصال SSH

- تحقق من إمكانية الاتصال يدوياً: `ssh -i ~/.ssh/id_ed25519 deploy@203.0.113.50`
- شغّل `rdc context scan-keys server-1` لتحديث مفاتيح المضيف
- تأكد من تطابق منفذ SSH: `--port 22`

### فشل إعداد الجهاز

- تأكد من أن المستخدم لديه صلاحيات sudo بدون كلمة مرور، أو قم بتهيئة `NOPASSWD` للأوامر المطلوبة
- تحقق من المساحة المتاحة على القرص في الخادم
- شغّل مع `--debug` للمخرجات التفصيلية: `rdc context setup-machine server-1 --debug`

### فشل إنشاء المستودع

- تحقق من اكتمال الإعداد: يجب أن يكون مجلد مخزن البيانات موجوداً
- تحقق من مساحة القرص على الخادم
- تأكد من تثبيت ملف renet التنفيذي (أعد تشغيل الإعداد إذا لزم الأمر)

### فشل تشغيل الخدمات

- تحقق من صيغة Rediaccfile: يجب أن يكون Bash صالحاً
- تأكد من أن ملفات `docker compose` تستخدم `network_mode: host`
- تحقق من إمكانية الوصول إلى صور Docker (ضع في اعتبارك `docker compose pull` في `prep()`)
- تحقق من سجلات الحاويات: اتصل بالخادم عبر SSH واستخدم `docker -H unix:///var/run/rediacc/docker-{networkId}.sock logs {container}`

### أخطاء رفض الصلاحيات

- عمليات المستودع تتطلب صلاحيات الجذر على الخادم (renet يعمل عبر `sudo`)
- تحقق من أن المستخدم في مجموعة `sudo`
- تأكد من صحة صلاحيات مجلد مخزن البيانات

### تشغيل التشخيصات

استخدم أمر الطبيب المدمج لتشخيص المشكلات:

```bash
rdc doctor
```

يتحقق هذا من بيئتك، وتثبيت renet، وإعدادات السياق، وحالة المصادقة.

---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { createTranslator } from '../../i18n/utils';
import { getLanguagePaths } from '../../i18n/language-utils';
import type { Language } from '../../i18n/types';
import InstallMethods from '../../components/InstallMethods';
import '../../styles/install-page.css';

export const getStaticPaths = getLanguagePaths;

const { lang } = Astro.params as { lang: Language };
const { t } = createTranslator(lang);
---

<BaseLayout
  lang={lang}
  title={t('pages.install.meta.title')}
  description={t('pages.install.meta.description')}
  keywords={t('pages.install.meta.keywords')}
  ogType="website"
  structuredDataType="organization"
>
  <article class="install-page" data-copied={t('pages.install.copied')}>
    <!-- Hero Section -->
    <section class="install-hero section-dark">
      <div class="install-hero-content">
        <h1>{t('pages.install.hero.title')}</h1>
        <p class="hero-subtitle">{t('pages.install.hero.subtitle')}</p>
        <p class="hero-downloads-note">
          {t('pages.install.hero.downloadsNote')}{' '}
          <a href={`/${lang}/downloads`} class="hero-downloads-link">
            {t('pages.install.hero.downloadsLink')} &rarr;
          </a>
        </p>
      </div>
    </section>

    <!-- Installation Methods (React island) -->
    <InstallMethods client:visible lang={lang} />

    <!-- Verify Installation -->
    <section class="verify-section section-dark">
      <div class="container">
        <h2>{t('pages.install.verify.title')}</h2>
        <div class="code-block code-block-dark">
          <div class="code-header">
            <span>bash</span>
            <button class="copy-btn" data-copy="verify">{t('pages.install.copy')}</button>
          </div>
          <pre><code id="code-verify">rdc --version</code></pre>
        </div>
      </div>
    </section>

    <!-- Architecture Support -->
    <section class="arch-section section-light">
      <div class="container">
        <h2>{t('pages.install.architectures.title')}</h2>
        <div class="arch-table-wrapper">
          <table class="arch-table">
            <thead>
              <tr>
                <th>{t('pages.install.architectures.method')}</th>
                <th>{t('pages.install.architectures.platform')}</th>
                <th>x86_64 / amd64</th>
                <th>ARM64 / aarch64</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="3">{t('pages.install.methods.quick.title')}</td>
                <td>Linux</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>macOS</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>Windows</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td rowspan="3">{t('pages.install.methods.binary.title')}</td>
                <td>Linux</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>macOS</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>Windows</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>APT (.deb)</td>
                <td>Linux</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>DNF (.rpm)</td>
                <td>Linux</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>APK (.apk)</td>
                <td>Linux (Alpine)</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>Pacman (.pkg.tar.zst)</td>
                <td>Linux (Arch)</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>Homebrew</td>
                <td>macOS / Linux</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
              <tr>
                <td>Docker</td>
                <td>Linux / macOS / Windows</td>
                <td class="supported">&#10003;</td>
                <td class="supported">&#10003;</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </article>

  <!-- Copy-to-clipboard script for static sections (verify) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const buttons = document.querySelectorAll<HTMLButtonElement>('.verify-section .copy-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', async () => {
          const target = btn.getAttribute('data-copy');
          if (!target) return;
          const codeEl = document.getElementById(`code-${target}`);
          if (!codeEl) return;

          try {
            await navigator.clipboard.writeText(codeEl.textContent || '');
            const original = btn.textContent;
            btn.textContent = btn.closest('.install-page')?.getAttribute('data-copied') || 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => {
              btn.textContent = original;
              btn.classList.remove('copied');
            }, 2000);
          } catch {
            const range = document.createRange();
            range.selectNodeContents(codeEl);
            const sel = window.getSelection();
            sel?.removeAllRanges();
            sel?.addRange(range);
          }
        });
      });
    });
  </script>
</BaseLayout>

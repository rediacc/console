---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

export interface Props {
  title: string;
  subtitle: string;
  videoSrc?: string;
  captionsSrc?: string;
  heroImage?: ImageMetadata | string;
  heroImageAlt?: string;
  ctaText?: string;
  ctaHref?: string;
  secondaryCtaText?: string;
  secondaryCtaHref?: string;
}

const { title, subtitle, videoSrc = '/videos/demo.mp4', captionsSrc, heroImage, heroImageAlt = '', ctaText, ctaHref, secondaryCtaText, secondaryCtaHref } = Astro.props;
const isOptimizedImage = heroImage && typeof heroImage !== 'string';
---

<section id="overview" class="hero-video-section">
  <div class="container">
    <div class="hero-video-content">
      <slot name="breadcrumb" />
      <div class="hero-text">
        <h1 class="hero-title">{title}</h1>
        <p class="hero-subtitle" set:html={subtitle} />
        {ctaText && ctaHref && (
          <div class="hero-cta-wrapper">
            <a href={ctaHref} class="btn btn-primary btn-large">
              {ctaText}
            </a>
            {secondaryCtaText && secondaryCtaHref && (
              <a href={secondaryCtaHref} class="hero-secondary-cta">
                {secondaryCtaText}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </a>
            )}
          </div>
        )}
      </div>

      {heroImage ? (
        <div class="hero-image-container">
          {isOptimizedImage ? (
            <Image
              src={heroImage as ImageMetadata}
              alt={heroImageAlt}
              class="hero-image"
              width={1200}
              loading="eager"
              decoding="async"
              quality={85}
            />
          ) : (
            <img
              src={heroImage as string}
              alt={heroImageAlt}
              class="hero-image"
              width="1200"
              height="675"
              loading="eager"
              decoding="async"
              fetchpriority="high"
            />
          )}
        </div>
      ) : (
        <div class="video-container-inline">
          <div class="video-wrapper-inline">
            <video
              class="video-element"
              controls
              preload="metadata"
              aria-label={`${title}: ${subtitle}`}
            >
              <source src={videoSrc} type="video/mp4" />
              {captionsSrc && (
                <track kind="captions" src={captionsSrc} srcLang="en" label="English captions" />
              )}
              Your browser does not support the video tag.
            </video>
          </div>
        </div>
      )}
    </div>
  </div>
</section>

<style>
  .hero-image-container {
    margin: var(--space-8) auto;
    max-width: 900px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, var(--opacity-10));
  }

  .hero-image {
    width: 100%;
    height: auto;
    display: block;
  }

  .hero-cta-wrapper {
    margin-top: var(--space-8);
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-4);
  }

  .hero-secondary-cta {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    color: rgba(255, 255, 255, var(--opacity-80));
    text-decoration: none;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-sm);
    transition: color var(--transition-duration-base) ease;
  }

  .hero-secondary-cta:hover {
    color: white;
  }

  .hero-secondary-cta:focus-visible {
    outline: 2px solid white;
    outline-offset: 2px;
  }

  .hero-secondary-cta svg {
    flex-shrink: 0;
  }
</style>

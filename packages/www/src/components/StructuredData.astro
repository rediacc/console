---
import {
  COMPANY_LEGAL_NAME,
  COMPANY_REGISTERED_ADDRESS,
  COMPANY_REGISTRY_CODE,
  COMPANY_REGISTER_NAME,
  COMPANY_VAT_NUMBER,
  CONTACT_EMAIL,
  SITE_URL
} from '../config/constants';

export interface Props {
  type?: 'organization' | 'website' | 'service' | 'software' | 'breadcrumb' | 'sitenavigation' | 'blogposting' | 'faq';
  data?: any;
}

const { type = 'organization', data = {} } = Astro.props;

const baseUrl = SITE_URL;

const getStructuredData = (type: string, customData: any = {}) => {
  const commonData = {
    '@context': 'https://schema.org',
  };

  switch (type) {
    case 'organization':
      return {
        ...commonData,
        '@type': 'Organization',
        name: 'Rediacc',
        legalName: COMPANY_LEGAL_NAME,
        url: baseUrl,
        description: 'Infrastructure Automation Platform designed for accelerated development operations',
        logo: `${baseUrl}/favicon.svg`,
        sameAs: [
          'https://github.com/orgs/rediacc/',
          'https://www.linkedin.com/company/rediacc/'
        ],
        contactPoint: {
          '@type': 'ContactPoint',
          contactType: 'Customer Service',
          email: CONTACT_EMAIL,
          url: `${baseUrl}/contact`
        },
        address: {
          '@type': 'PostalAddress',
          streetAddress: COMPANY_REGISTERED_ADDRESS,
          addressCountry: 'EE'
        },
        vatID: COMPANY_VAT_NUMBER,
        identifier: {
          '@type': 'PropertyValue',
          propertyID: COMPANY_REGISTER_NAME,
          value: COMPANY_REGISTRY_CODE
        },
        foundingDate: '2024',
        ...customData
      };

    case 'website':
      return {
        ...commonData,
        '@type': 'WebSite',
        name: 'Rediacc',
        url: baseUrl,
        description: 'Infrastructure Automation Platform designed for accelerated development operations',
        publisher: {
          '@type': 'Organization',
          name: 'Rediacc',
          url: baseUrl
        },
        potentialAction: {
          '@type': 'SearchAction',
          target: {
            '@type': 'EntryPoint',
            urlTemplate: `${baseUrl}/search?q={search_term_string}`
          },
          'query-input': 'required name=search_term_string'
        },
        ...customData
      };

    case 'service':
      return {
        ...commonData,
        '@type': 'Service',
        name: 'Infrastructure Automation Platform',
        description: 'Accelerate development workflows with instant environment provisioning and production-like testing',
        provider: {
          '@type': 'Organization',
          name: 'Rediacc',
          url: baseUrl
        },
        serviceType: 'Infrastructure Automation',
        category: 'Software Development Tools',
        offers: {
          '@type': 'Offer',
          availability: 'https://schema.org/PreOrder',
          priceValidUntil: '2026-12-31',
          description: 'Early access program available'
        },
        ...customData
      };

    case 'breadcrumb':
      return {
        ...commonData,
        '@type': 'BreadcrumbList',
        itemListElement: customData.items || []
      };

    case 'sitenavigation':
      return {
        ...commonData,
        '@type': 'SiteNavigationElement',
        name: customData.name || 'Main Navigation',
        url: customData.url || baseUrl,
        about: customData.about || 'Infrastructure Automation Platform',
        hasPart: customData.navigationItems || [
          {
            '@type': 'WebPage',
            name: 'Home',
            url: baseUrl
          },
          {
            '@type': 'WebPage',
            name: 'Contact',
            url: `${baseUrl}/contact`
          }
        ]
      };

    case 'blogposting':
      return {
        ...commonData,
        '@type': 'BlogPosting',
        headline: customData.title,
        description: customData.description,
        author: {
          '@type': 'Person',
          name: customData.author
        },
        publisher: {
          '@type': 'Organization',
          name: 'Rediacc',
          url: baseUrl,
          logo: {
            '@type': 'ImageObject',
            url: `${baseUrl}/favicon.svg`
          }
        },
        datePublished: customData.publishedDate,
        dateModified: customData.updatedDate || customData.publishedDate,
        image: customData.image ? {
          '@type': 'ImageObject',
          url: customData.image,
          width: 1200,
          height: 630
        } : {
          '@type': 'ImageObject',
          url: `${baseUrl}/favicon.svg`,
          width: 512,
          height: 512
        },
        url: customData.url || baseUrl,
        mainEntityOfPage: {
          '@type': 'WebPage',
          '@id': customData.url || baseUrl
        },
        inLanguage: customData.language || 'en',
        keywords: customData.tags ? customData.tags.join(', ') : '',
        articleSection: customData.category,
        ...customData.additionalData
      };

    case 'faq':
      return {
        ...commonData,
        '@type': 'FAQPage',
        mainEntity: (customData.items || []).map((item: { question: string; answer: string }) => ({
          '@type': 'Question',
          name: item.question,
          acceptedAnswer: {
            '@type': 'Answer',
            text: item.answer
          }
        })),
        ...customData.additionalData
      };

    case 'software':
      return {
        ...commonData,
        '@type': 'SoftwareApplication',
        name: 'Rediacc',
        description: 'Infrastructure Automation Platform designed for accelerated development operations',
        url: baseUrl,
        applicationCategory: 'DeveloperApplication',
        operatingSystem: 'Linux',
        offers: {
          '@type': 'AggregateOffer',
          lowPrice: '0',
          priceCurrency: 'USD',
          availability: 'https://schema.org/InStock',
          offerCount: customData.offerCount || '4'
        },
        publisher: {
          '@type': 'Organization',
          name: 'Rediacc',
          url: baseUrl
        },
        ...customData
      };

    default:
      return { ...commonData, ...customData };
  }
};

const structuredData = getStructuredData(type, data);
---

<script is:inline type="application/ld+json" set:html={JSON.stringify(structuredData)} />

<svg viewBox="0 0 800 620" width="800" height="620" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="serverGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#2d2d2d"/>
      <stop offset="100%" stop-color="#1a1a1a"/>
    </linearGradient>
    <filter id="ds" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.25"/>
    </filter>
    <marker id="arrowDown" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#556b2f"/>
    </marker>
    <marker id="arrowDownSmall" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#556b2f"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect x="0" y="0" width="800" height="620" fill="#f5f5f5"/>

  <!-- Decorative corner circles -->
  <circle cx="40" cy="600" r="16" fill="#e0e0e0" opacity="0.35"/>
  <circle cx="72" cy="608" r="10" fill="#556b2f" opacity="0.12"/>
  <circle cx="760" cy="600" r="16" fill="#e0e0e0" opacity="0.35"/>
  <circle cx="728" cy="608" r="10" fill="#556b2f" opacity="0.12"/>

  <!-- ============================================ -->
  <!-- ROW 1: Internet -->
  <!-- ============================================ -->
  <g font-family="Arial, sans-serif">
    <!-- Globe icon -->
    <circle cx="400" cy="28" r="16" fill="none" stroke="#3d3d3d" stroke-width="1.5"/>
    <ellipse cx="400" cy="28" rx="8" ry="16" fill="none" stroke="#3d3d3d" stroke-width="1"/>
    <line x1="384" y1="28" x2="416" y2="28" stroke="#3d3d3d" stroke-width="1"/>
    <line x1="387" y1="19" x2="413" y2="19" stroke="#3d3d3d" stroke-width="0.8"/>
    <line x1="387" y1="37" x2="413" y2="37" stroke="#3d3d3d" stroke-width="0.8"/>
    <text x="400" y="58" text-anchor="middle" font-size="15" font-weight="700" fill="#1a1a1a">Internet</text>
    <text x="400" y="72" text-anchor="middle" font-size="10" fill="#999999">HTTP/HTTPS, TCP, UDP</text>
  </g>

  <!-- Arrow: Internet -> Traefik -->
  <line x1="400" y1="76" x2="400" y2="94" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDown)"/>

  <!-- ============================================ -->
  <!-- ROW 2: Traefik Reverse Proxy -->
  <!-- ============================================ -->
  <g filter="url(#ds)">
    <rect x="260" y="100" width="280" height="54" rx="8" fill="url(#serverGrad)" stroke="#3d3d3d" stroke-width="2"/>
    <!-- Drive bay lines -->
    <rect x="276" y="110" width="200" height="8" rx="2" fill="#3d3d3d"/>
    <rect x="276" y="124" width="200" height="8" rx="2" fill="#3d3d3d"/>
    <rect x="276" y="138" width="200" height="8" rx="2" fill="#3d3d3d"/>
    <circle cx="488" cy="114" r="3" fill="#556b2f"/>
    <circle cx="488" cy="128" r="3" fill="#556b2f"/>
    <circle cx="488" cy="142" r="3" fill="#556b2f"/>
  </g>
  <g font-family="Arial, sans-serif">
    <text x="400" y="172" text-anchor="middle" font-size="15" font-weight="700" fill="#1a1a1a">Traefik Reverse Proxy</text>
    <!-- Left annotation: path -->
    <text x="248" y="122" text-anchor="end" font-size="10" fill="#999999">/opt/rediacc/proxy/</text>
    <!-- Right annotation: ports -->
    <text x="552" y="122" text-anchor="start" font-size="10" fill="#999999">Ports: 80, 443, TCP, UDP</text>
  </g>

  <!-- Arrow: Traefik -> Route Server -->
  <line x1="400" y1="182" x2="400" y2="200" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDown)"/>

  <!-- ============================================ -->
  <!-- ROW 3: Route Server -->
  <!-- ============================================ -->
  <g filter="url(#ds)">
    <rect x="270" y="208" width="260" height="52" rx="10" fill="#ffffff" stroke="#556b2f" stroke-width="2"/>
  </g>
  <g font-family="Arial, sans-serif">
    <text x="400" y="238" text-anchor="middle" font-size="15" font-weight="700" fill="#1a1a1a">Route Server</text>
    <!-- Left annotation -->
    <text x="258" y="230" text-anchor="end" font-size="10" fill="#999999">Port 7111</text>
    <!-- Right annotation -->
    <text x="542" y="230" text-anchor="start" font-size="10" fill="#999999">systemd: rediacc-router</text>
    <!-- Description below -->
    <text x="400" y="274" text-anchor="middle" font-size="10" fill="#999999">polls every 5s  |  discovers containers across all daemons</text>
  </g>

  <!-- Arrows: Route Server -> Three Daemons (fan out) -->
  <line x1="340" y1="260" x2="162" y2="298" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDownSmall)"/>
  <line x1="400" y1="260" x2="400" y2="298" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDownSmall)"/>
  <line x1="460" y1="260" x2="638" y2="298" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDownSmall)"/>

  <!-- ============================================ -->
  <!-- ROW 4: Three Docker Daemons -->
  <!-- ============================================ -->

  <!-- Daemon A -->
  <g font-family="Arial, sans-serif">
    <rect x="48" y="304" width="210" height="120" rx="10" fill="#fafafa" stroke="#556b2f" stroke-width="2" stroke-dasharray="4,3"/>
    <text x="153" y="324" text-anchor="middle" font-size="13" font-weight="700" fill="#1a1a1a">Docker Daemon A</text>
    <text x="153" y="339" text-anchor="middle" font-size="8" fill="#999999">/run/rediacc/docker-2816.sock</text>
    <text x="153" y="353" text-anchor="middle" font-size="9" fill="#1a1a1a">net: 2816</text>
    <rect x="78" y="360" width="150" height="20" rx="10" fill="rgba(85,107,47,0.15)" stroke="#556b2f" stroke-width="1"/>
    <text x="153" y="374" text-anchor="middle" font-size="10" font-weight="700" fill="#556b2f">127.0.11.0/26</text>
    <!-- Container boxes -->
    <rect x="72" y="388" width="44" height="22" rx="5" fill="#556b2f"/>
    <rect x="122" y="388" width="44" height="22" rx="5" fill="#6f8243"/>
    <rect x="172" y="388" width="44" height="22" rx="5" fill="#556b2f"/>
    <text x="94" y="403" text-anchor="middle" font-size="9" fill="#ffffff">nginx</text>
    <text x="144" y="403" text-anchor="middle" font-size="9" fill="#ffffff">app</text>
    <text x="194" y="403" text-anchor="middle" font-size="9" fill="#ffffff">db</text>
  </g>

  <!-- Isolation barrier A-B -->
  <g>
    <line x1="276" y1="312" x2="276" y2="416" stroke="#999999" stroke-width="1.5"/>
    <line x1="263" y1="358" x2="289" y2="374" stroke="#999999" stroke-width="2"/>
    <line x1="289" y1="358" x2="263" y2="374" stroke="#999999" stroke-width="2"/>
  </g>

  <!-- Daemon B -->
  <g font-family="Arial, sans-serif">
    <rect x="295" y="304" width="210" height="120" rx="10" fill="#fafafa" stroke="#556b2f" stroke-width="2" stroke-dasharray="4,3"/>
    <text x="400" y="324" text-anchor="middle" font-size="13" font-weight="700" fill="#1a1a1a">Docker Daemon B</text>
    <text x="400" y="339" text-anchor="middle" font-size="8" fill="#999999">/run/rediacc/docker-2880.sock</text>
    <text x="400" y="353" text-anchor="middle" font-size="9" fill="#1a1a1a">net: 2880</text>
    <rect x="325" y="360" width="150" height="20" rx="10" fill="rgba(85,107,47,0.15)" stroke="#556b2f" stroke-width="1"/>
    <text x="400" y="374" text-anchor="middle" font-size="10" font-weight="700" fill="#556b2f">127.0.11.64/26</text>
    <!-- Container boxes -->
    <rect x="313" y="388" width="44" height="22" rx="5" fill="#6f8243"/>
    <rect x="363" y="388" width="44" height="22" rx="5" fill="#556b2f"/>
    <rect x="413" y="388" width="44" height="22" rx="5" fill="#6f8243"/>
    <text x="335" y="403" text-anchor="middle" font-size="9" fill="#ffffff">api</text>
    <text x="385" y="403" text-anchor="middle" font-size="9" fill="#ffffff">worker</text>
    <text x="435" y="403" text-anchor="middle" font-size="9" fill="#ffffff">redis</text>
  </g>

  <!-- Isolation barrier B-C -->
  <g>
    <line x1="524" y1="312" x2="524" y2="416" stroke="#999999" stroke-width="1.5"/>
    <line x1="511" y1="358" x2="537" y2="374" stroke="#999999" stroke-width="2"/>
    <line x1="537" y1="358" x2="511" y2="374" stroke="#999999" stroke-width="2"/>
  </g>

  <!-- Daemon C -->
  <g font-family="Arial, sans-serif">
    <rect x="542" y="304" width="210" height="120" rx="10" fill="#fafafa" stroke="#556b2f" stroke-width="2" stroke-dasharray="4,3"/>
    <text x="647" y="324" text-anchor="middle" font-size="13" font-weight="700" fill="#1a1a1a">Docker Daemon C</text>
    <text x="647" y="339" text-anchor="middle" font-size="8" fill="#999999">/run/rediacc/docker-2944.sock</text>
    <text x="647" y="353" text-anchor="middle" font-size="9" fill="#1a1a1a">net: 2944</text>
    <rect x="572" y="360" width="150" height="20" rx="10" fill="rgba(85,107,47,0.15)" stroke="#556b2f" stroke-width="1"/>
    <text x="647" y="374" text-anchor="middle" font-size="10" font-weight="700" fill="#556b2f">127.0.11.128/26</text>
    <!-- Container boxes -->
    <rect x="560" y="388" width="44" height="22" rx="5" fill="#556b2f"/>
    <rect x="610" y="388" width="44" height="22" rx="5" fill="#6f8243"/>
    <rect x="660" y="388" width="44" height="22" rx="5" fill="#556b2f"/>
    <text x="582" y="403" text-anchor="middle" font-size="9" fill="#ffffff">gitlab</text>
    <text x="632" y="403" text-anchor="middle" font-size="9" fill="#ffffff">runner</text>
    <text x="682" y="403" text-anchor="middle" font-size="9" fill="#ffffff">pg</text>
  </g>

  <!-- Arrows: Daemons -> LUKS Repos -->
  <line x1="153" y1="424" x2="153" y2="452" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDown)"/>
  <line x1="400" y1="424" x2="400" y2="452" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDown)"/>
  <line x1="647" y1="424" x2="647" y2="452" stroke="#556b2f" stroke-width="2" marker-end="url(#arrowDown)"/>

  <!-- ============================================ -->
  <!-- ROW 5: LUKS Encrypted Repos -->
  <!-- ============================================ -->

  <!-- LUKS Repo A -->
  <g font-family="Arial, sans-serif">
    <rect x="68" y="460" width="170" height="58" rx="8" fill="#e0e0e0" stroke="#3d3d3d" stroke-width="1.5"/>
    <!-- Lock icon -->
    <rect x="80" y="476" width="14" height="12" rx="2" fill="#556b2f"/>
    <path d="M83 476 v-5 a4 4 0 0 1 8 0 v5" fill="none" stroke="#556b2f" stroke-width="2"/>
    <text x="160" y="484" text-anchor="middle" font-size="12" font-weight="700" fill="#1a1a1a">LUKS Encrypted</text>
    <text x="153" y="504" text-anchor="middle" font-size="9" fill="#999999">/mnt/rediacc/mounts/{uuid}/</text>
  </g>

  <!-- LUKS Repo B -->
  <g font-family="Arial, sans-serif">
    <rect x="315" y="460" width="170" height="58" rx="8" fill="#e0e0e0" stroke="#3d3d3d" stroke-width="1.5"/>
    <!-- Lock icon -->
    <rect x="327" y="476" width="14" height="12" rx="2" fill="#556b2f"/>
    <path d="M330 476 v-5 a4 4 0 0 1 8 0 v5" fill="none" stroke="#556b2f" stroke-width="2"/>
    <text x="407" y="484" text-anchor="middle" font-size="12" font-weight="700" fill="#1a1a1a">LUKS Encrypted</text>
    <text x="400" y="504" text-anchor="middle" font-size="9" fill="#999999">/mnt/rediacc/mounts/{uuid}/</text>
  </g>

  <!-- LUKS Repo C -->
  <g font-family="Arial, sans-serif">
    <rect x="562" y="460" width="170" height="58" rx="8" fill="#e0e0e0" stroke="#3d3d3d" stroke-width="1.5"/>
    <!-- Lock icon -->
    <rect x="574" y="476" width="14" height="12" rx="2" fill="#556b2f"/>
    <path d="M577 476 v-5 a4 4 0 0 1 8 0 v5" fill="none" stroke="#556b2f" stroke-width="2"/>
    <text x="654" y="484" text-anchor="middle" font-size="12" font-weight="700" fill="#1a1a1a">LUKS Encrypted</text>
    <text x="647" y="504" text-anchor="middle" font-size="9" fill="#999999">/mnt/rediacc/mounts/{uuid}/</text>
  </g>

  <!-- ============================================ -->
  <!-- ROW 6: Bottom summary badge -->
  <!-- ============================================ -->
  <g filter="url(#ds)">
    <rect x="40" y="545" width="720" height="46" rx="23" fill="#556b2f"/>
    <text x="400" y="573" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="700" fill="#ffffff">Internet → Proxy → Route Discovery → Isolated Daemons → Encrypted Storage</text>
  </g>
</svg>

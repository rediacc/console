import{j as e,f as t,u as s,g as r,h as a,e as n}from"./chunk-DXw4Pgvm.js";import{f as i,g as o,r as l,j as d,R as c}from"./chunk-DZuWtVpy.js";import{r as u,a as m,b as p,c as g,s as h,F as y,j as x,J as f,u as j,n as b,t as w,z as v,L as C,N as k,O as N,M as P,S as A,K as S,D as T,g as M,W as E,x as I,Q as D,l as F,R as B,A as L,i as R,q as z,P as Z,V as O,w as U,U as G,X as q,Y as _,Z as V,_ as $}from"../index-yUn99L-Z.js";import{C as K,v as H,w as X,x as Q,a as W,y as Y,z as J,A as ee,B as te,D as se,E as re,G as ae,H as ne,I as ie,V as oe,s as le,U as de,S as ce,J as ue}from"./chunk-KEZpi22j.js";import{A as me,S as pe}from"./chunk-BW8iAa_s.js";import{E as ge}from"./chunk-B_oFtdWH.js";import{E as he}from"./chunk-DwuMAJS_.js";import{D as ye,S as xe}from"./chunk-CnIoJHkD.js";import{T as fe}from"./chunk-Bqa2DPg6.js";import{C as je,D as be}from"./chunk-O19uuq1F.js";import{C as we}from"./chunk-CnEprTnD.js";import{D as ve}from"./chunk-BWxJqMfW.js";import{E as Ce}from"./chunk-D_yeOTF2.js";import{I as ke}from"./chunk-D7vHbxrW.js";import{R as Ne}from"./chunk-C0whZ1Sz.js";import{F as Pe,a as Ae,B as Se,I as Te,S as Me,d as Ee,g as Ie,ah as De,k as Fe,q as Be,s as Le,o as Re,u as ze,w as Ze,W as Oe,M as Ue,i as Ge,p as qe,T as _e,V as Ve,R as $e,f as Ke,E as He,ae as Xe,x as Qe,U as We,h as Ye}from"./chunk-CSjZqX98.js";import{S as Je}from"./chunk-DWt9Pw8W.js";import{R as et}from"./chunk-CPGn7gBY.js";import{C as tt}from"./chunk-BQ4C3Wa9.js";import{u as st,i as rt}from"./chunk-CM3g5OHp.js";import{m as at,a as nt}from"./chunk-BYix58BC.js";import{e as it}from"./chunk-nn1hMP-Z.js";import"./chunk-BNqsZZGB.js";import"./chunk-C0XEpv6B.js";import"./chunk-CGbGzfZT.js";import"./chunk-gWmBjRHJ.js";import"./chunk-xSw6NTs2.js";import"./chunk-BP6R0kRn.js";var ot,lt,dt,ct={exports:{}},ut={},mt={};function pt(){if(ot)return mt;ot=1,Object.defineProperty(mt,"__esModule",{value:!0});return mt.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"},mt}function gt(){if(lt)return ut;lt=1;var e=u().default,t=m().default;Object.defineProperty(ut,"__esModule",{value:!0}),ut.default=void 0;var s=t(p()),r=e(i()),a=t(pt()),n=t(g()),o=function(e,t){return r.createElement(n.default,(0,s.default)({},e,{ref:t,icon:a.default}))},l=r.forwardRef(o);return ut.default=l,ut}function ht(){return dt||(dt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const r=(s=gt())&&s.__esModule?s:{default:s};t.default=r,e.exports=r}(ct,ct.exports)),ct.exports}const yt=o(ht());function xt({form:t,fields:s,onSubmit:r,submitText:a="Submit",cancelText:n="Cancel",onCancel:i,loading:o=!1,layout:l="vertical"}){const{control:d,handleSubmit:c,formState:{errors:u}}=t,m=t=>{switch(t.type){case"select":return e.jsx(K,{name:t.name,control:d,render:({field:s})=>e.jsx(Me,{...s,placeholder:t.placeholder,options:t.options,disabled:t.disabled,allowClear:!0,showSearch:!0,filterOption:(e,t)=>(t?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"},"data-testid":`resource-form-field-${t.name}`})});case"password":return e.jsx(K,{name:t.name,control:d,render:({field:s})=>e.jsx(Te.Password,{...s,placeholder:t.placeholder,disabled:t.disabled,autoComplete:"off","data-testid":`resource-form-field-${t.name}`})});default:return e.jsx(K,{name:t.name,control:d,render:({field:s})=>e.jsx(Te,{...s,type:t.type||"text",placeholder:t.placeholder,disabled:t.disabled,autoComplete:"off","data-testid":`resource-form-field-${t.name}`})})}},p="vertical"===l?"horizontal":l,g={span:6},y={span:18};return e.jsxs(Pe,{layout:p,onFinish:c(r),labelCol:g,wrapperCol:y,labelAlign:"right",colon:!0,"data-testid":"resource-form",children:[s.map(t=>{if(t.hidden)return null;const s=u[t.name];return e.jsx(Pe.Item,{label:t.label,required:t.required,validateStatus:s?"error":void 0,help:s?.message,children:m(t)},t.name)}),e.jsx(Pe.Item,{style:{marginBottom:0,marginTop:h("CONTAINER")},wrapperCol:{offset:g.span,span:y.span},children:e.jsxs(Ae,{style:{width:"100%",justifyContent:"flex-end"},children:[i&&e.jsx(Se,{onClick:i,disabled:o,"data-testid":"resource-form-cancel-button",children:n}),e.jsx(Se,{type:"primary",htmlType:"submit",loading:o,"data-testid":"resource-form-submit-button",children:a})]})})]})}const ft=H({endpoint:"/CreateNewUser",method:"post",invalidateKeys:["users","dropdown-data"],successMessage:e=>`User "${e.email}" created successfully`,errorMessage:"Failed to create user",transformData:async e=>{const t=await y(e.password);return{newUserEmail:e.email,newUserHash:t}}}),jt=H({endpoint:"/UpdateUserToDeactivated",method:"put",invalidateKeys:["users"],successMessage:e=>`User "${e}" deactivated`,errorMessage:"Failed to deactivate user",transformData:e=>({userEmail:e})}),bt=H({endpoint:"/UpdateUserAssignedPermissions",method:"put",invalidateKeys:["users"],successMessage:e=>`User "${e.userEmail}" assigned to group "${e.permissionGroupName}"`,errorMessage:"Failed to assign permissions"}),wt=H({endpoint:"/UpdateUserPassword",method:"put",invalidateKeys:[],successMessage:()=>"Password updated successfully. Please login with your new password.",errorMessage:"Failed to update password",transformData:async e=>({userNewPass:await y(e.newPassword)})}),vt=H({endpoint:"/DeleteUserRequest",method:"delete",invalidateKeys:["user-requests"],successMessage:()=>"User session terminated successfully",errorMessage:"Failed to terminate user session",transformData:e=>({requestId:e.requestId})});Ee.extend(v);const Ct=()=>{const{t:r}=st("system"),a=s(f),[n,i]=l.useState(""),o=j(),d=b(),c=w(),{data:u=[],isLoading:m,refetch:p}=t({queryKey:["user-requests"],queryFn:async()=>{const e=await x.get("/GetUserRequests");return e.resultSets[1]?.data||[]},staleTime:1e4,refetchInterval:3e4}),g=vt(),h=u.filter(e=>e.userEmail.toLowerCase().includes(n.toLowerCase())||e.ipAddress.toLowerCase().includes(n.toLowerCase())||e.sessionName.toLowerCase().includes(n.toLowerCase())),y=u.filter(e=>e.isActive),v=[{title:r("userSessions.columns.user"),dataIndex:"userEmail",key:"userEmail",width:200,render:t=>e.jsxs(Ae,{children:[e.jsx("span",{style:o.body,children:t}),t===a?.email&&e.jsx(Ie,{color:"blue",style:{borderRadius:"var(--border-radius-sm)",...o.caption},children:r("userSessions.currentSession")})]})},{title:r("userSessions.columns.sessionName"),dataIndex:"sessionName",key:"sessionName",width:150},{title:r("userSessions.columns.ipAddress"),dataIndex:"ipAddress",key:"ipAddress",width:120},{title:r("userSessions.columns.userAgent"),dataIndex:"userAgent",key:"userAgent",width:300,ellipsis:!0},{title:r("userSessions.columns.status"),dataIndex:"isActive",key:"isActive",width:100,render:t=>e.jsx(Ie,{color:t?"green":"red",style:{borderRadius:"var(--border-radius-sm)",...o.caption},children:r(t?"userSessions.active":"userSessions.inactive")})},{title:r("userSessions.columns.createdAt"),dataIndex:"createdAt",key:"createdAt",width:180,render:e=>Ee(e).format("YYYY-MM-DD HH:mm:ss"),sorter:(e,t)=>Ee(e.createdAt).unix()-Ee(t.createdAt).unix(),defaultSortOrder:"descend"},{title:r("userSessions.columns.lastActivity"),dataIndex:"lastActivity",key:"lastActivity",width:150,render:e=>Ee(e).fromNow()},{title:r("userSessions.columns.duration"),key:"duration",width:120,render:(e,t)=>`${Ee(t.lastActivity).diff(Ee(t.createdAt),"minute")} ${r("userSessions.minutes")}`},{title:r("userSessions.columns.actions"),key:"actions",width:120,fixed:"right",render:(t,s)=>e.jsx(De,{title:e.jsx("span",{style:o.label,children:r("userSessions.confirmTerminate")}),description:e.jsx("span",{style:o.body,children:s.userEmail===a?.email?r("userSessions.confirmTerminateSelf"):r("userSessions.confirmTerminateOther",{email:s.userEmail})}),onConfirm:()=>(async e=>{try{await g.mutateAsync({requestId:e.requestId}),e.userEmail===a?.email&&Oe.warning(r("userSessions.selfTerminateWarning"))}catch(t){}})(s),okText:r("common:yes"),cancelText:r("common:no"),disabled:!s.isActive,children:e.jsx(Fe,{title:r("userSessions.terminate"),children:e.jsx(Se,{"data-testid":`sessions-terminate-${s.requestId}`,type:"link",danger:!0,icon:e.jsx(tt,{style:o.icon.small}),disabled:!s.isActive,loading:g.isPending,style:{...d.tableActionButton,...o.touchTargetSmall},"aria-label":r("userSessions.terminate")})})})}];return e.jsxs("div",{className:"user-sessions-tab",style:o.container,children:[e.jsxs(Be,{gutter:16,style:o.marginBottom.lg,children:[e.jsx(Le,{span:6,children:e.jsx(Re,{"data-testid":"sessions-stat-total",style:{...o.card,boxShadow:"var(--shadow-sm)",border:"1px solid var(--color-border-secondary)"},children:e.jsx(ze,{title:e.jsx("span",{style:o.label,children:r("userSessions.totalSessions")}),value:u.length,valueStyle:o.heading3})})}),e.jsx(Le,{span:6,children:e.jsx(Re,{"data-testid":"sessions-stat-active",style:{...o.card,boxShadow:"var(--shadow-sm)",border:"1px solid var(--color-border-secondary)"},children:e.jsx(ze,{title:e.jsx("span",{style:o.label,children:r("userSessions.activeSessions")}),value:y.length,valueStyle:{...o.heading3,color:"var(--color-success)"}})})}),e.jsx(Le,{span:6,children:e.jsx(Re,{"data-testid":"sessions-stat-unique-users",style:{...o.card,boxShadow:"var(--shadow-sm)",border:"1px solid var(--color-border-secondary)"},children:e.jsx(ze,{title:e.jsx("span",{style:o.label,children:r("userSessions.uniqueUsers")}),value:new Set(u.map(e=>e.userEmail)).size,valueStyle:o.heading3})})}),e.jsx(Le,{span:6,children:e.jsx(Re,{"data-testid":"sessions-stat-average-duration",style:{...o.card,boxShadow:"var(--shadow-sm)",border:"1px solid var(--color-border-secondary)"},children:e.jsx(ze,{title:e.jsx("span",{style:o.label,children:r("userSessions.averageDuration")}),value:u.length>0?Math.round(u.reduce((e,t)=>e+Ee(t.lastActivity).diff(Ee(t.createdAt),"minute"),0)/u.length):0,suffix:e.jsx("span",{style:o.caption,children:r("userSessions.minutes")}),valueStyle:o.heading3})})})]}),e.jsx(Re,{title:e.jsxs(Ae,{style:o.flexStart,children:[e.jsx("span",{style:o.heading4,children:r("userSessions.title")}),e.jsx(Fe,{title:r("common:actions.refresh"),children:e.jsx(Se,{"data-testid":"sessions-refresh-button",icon:e.jsx(et,{style:o.icon.small}),onClick:()=>p(),loading:m,style:{...o.buttonSecondary,...o.touchTargetSmall},"aria-label":r("common:actions.refresh")})})]}),extra:e.jsx(Te,{"data-testid":"sessions-search-input",placeholder:r("userSessions.searchPlaceholder"),prefix:e.jsx(Je,{style:o.icon.small}),value:n,onChange:e=>i(e.target.value),style:{width:300,...c.formInput},autoComplete:"off"}),style:{...o.card,border:"1px solid var(--color-border-secondary)"},children:e.jsx("div",{style:d.tableContainer,children:e.jsx(Ze,{"data-testid":"sessions-table",columns:v,dataSource:h,rowKey:"requestId",loading:m,pagination:{pageSize:10,showSizeChanger:!0,showTotal:t=>e.jsx("span",{style:o.caption,children:r("userSessions.totalCount",{count:t})})},scroll:{x:1500},onRow:e=>({"data-testid":`sessions-row-${e.requestId}`})})})})]})};var kt,Nt,Pt,At,St,Tt,Mt,Et,It,Dt,Ft,Bt,Lt,Rt,zt,Zt,Ot,Ut,Gt,qt,_t,Vt,$t,Kt={},Ht={exports:{}};function Xt(){if(Nt)return kt;Nt=1;return kt="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function Qt(){if(At)return Pt;At=1;var e=Xt();function t(){}function s(){}return s.resetWarningCache=t,Pt=function(){function r(t,s,r,a,n,i){if(i!==e){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function a(){return r}r.isRequired=r;var n={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:a,element:r,elementType:r,instanceOf:a,node:r,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:s,resetWarningCache:t};return n.PropTypes=n,n}}function Wt(){return St||(St=1,Ht.exports=Qt()()),Ht.exports}function Yt(){return Mt?Tt:(Mt=1,Tt={L:1,M:0,Q:3,H:2})}function Jt(){return It?Et:(It=1,Et={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8})}function es(){if(Ot)return Zt;Ot=1;for(var e={glog:function(t){if(t<1)throw new Error("glog("+t+")");return e.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return e.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)e.EXP_TABLE[t]=1<<t;for(t=8;t<256;t++)e.EXP_TABLE[t]=e.EXP_TABLE[t-4]^e.EXP_TABLE[t-5]^e.EXP_TABLE[t-6]^e.EXP_TABLE[t-8];for(t=0;t<255;t++)e.LOG_TABLE[e.EXP_TABLE[t]]=t;return Zt=e}function ts(){if(Gt)return Ut;Gt=1;var e=es();function t(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var s=0;s<e.length&&0==e[s];)s++;this.num=new Array(e.length-s+t);for(var r=0;r<e.length-s;r++)this.num[r]=e[r+s]}return t.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(s){for(var r=new Array(this.getLength()+s.getLength()-1),a=0;a<this.getLength();a++)for(var n=0;n<s.getLength();n++)r[a+n]^=e.gexp(e.glog(this.get(a))+e.glog(s.get(n)));return new t(r,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var r=e.glog(this.get(0))-e.glog(s.get(0)),a=new Array(this.getLength()),n=0;n<this.getLength();n++)a[n]=this.get(n);for(n=0;n<s.getLength();n++)a[n]^=e.gexp(e.glog(s.get(n))+r);return new t(a,0).mod(s)}},Ut=t}function ss(){if($t)return Vt;$t=1;var e=function(){if(Ft)return Dt;Ft=1;var e=Jt();function t(t){this.mode=e.MODE_8BIT_BYTE,this.data=t}return t.prototype={getLength:function(e){return this.data.length},write:function(e){for(var t=0;t<this.data.length;t++)e.put(this.data.charCodeAt(t),8)}},Dt=t}(),t=function(){if(Lt)return Bt;Lt=1;var e=Yt();function t(e,t){this.totalCount=e,this.dataCount=t}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(e,s){var r=t.getRsBlockTable(e,s);if(null==r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+s);for(var a=r.length/3,n=new Array,i=0;i<a;i++)for(var o=r[3*i+0],l=r[3*i+1],d=r[3*i+2],c=0;c<o;c++)n.push(new t(l,d));return n},t.getRsBlockTable=function(s,r){switch(r){case e.L:return t.RS_BLOCK_TABLE[4*(s-1)+0];case e.M:return t.RS_BLOCK_TABLE[4*(s-1)+1];case e.Q:return t.RS_BLOCK_TABLE[4*(s-1)+2];case e.H:return t.RS_BLOCK_TABLE[4*(s-1)+3];default:return}},Bt=t}(),s=function(){if(zt)return Rt;function e(){this.buffer=new Array,this.length=0}return zt=1,e.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var s=0;s<t;s++)this.putBit(1==(e>>>t-s-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},Rt=e}(),r=function(){if(_t)return qt;_t=1;var e=Jt(),t=ts(),s=es(),r=0,a=1,n=2,i=3,o=4,l=5,d=6,c=7,u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;u.getBCHDigit(t)-u.getBCHDigit(u.G15)>=0;)t^=u.G15<<u.getBCHDigit(t)-u.getBCHDigit(u.G15);return(e<<10|t)^u.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;u.getBCHDigit(t)-u.getBCHDigit(u.G18)>=0;)t^=u.G18<<u.getBCHDigit(t)-u.getBCHDigit(u.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return u.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,s){switch(e){case r:return(t+s)%2==0;case a:return t%2==0;case n:return s%3==0;case i:return(t+s)%3==0;case o:return(Math.floor(t/2)+Math.floor(s/3))%2==0;case l:return t*s%2+t*s%3==0;case d:return(t*s%2+t*s%3)%2==0;case c:return(t*s%3+(t+s)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var r=new t([1],0),a=0;a<e;a++)r=r.multiply(new t([1,s.gexp(a)],0));return r},getLengthInBits:function(t,s){if(1<=s&&s<10)switch(t){case e.MODE_NUMBER:return 10;case e.MODE_ALPHA_NUM:return 9;case e.MODE_8BIT_BYTE:case e.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(s<27)switch(t){case e.MODE_NUMBER:return 12;case e.MODE_ALPHA_NUM:return 11;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(s<41))throw new Error("type:"+s);switch(t){case e.MODE_NUMBER:return 14;case e.MODE_ALPHA_NUM:return 13;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),s=0,r=0;r<t;r++)for(var a=0;a<t;a++){for(var n=0,i=e.isDark(r,a),o=-1;o<=1;o++)if(!(r+o<0||t<=r+o))for(var l=-1;l<=1;l++)a+l<0||t<=a+l||0==o&&0==l||i==e.isDark(r+o,a+l)&&n++;n>5&&(s+=3+n-5)}for(r=0;r<t-1;r++)for(a=0;a<t-1;a++){var d=0;e.isDark(r,a)&&d++,e.isDark(r+1,a)&&d++,e.isDark(r,a+1)&&d++,e.isDark(r+1,a+1)&&d++,0!=d&&4!=d||(s+=3)}for(r=0;r<t;r++)for(a=0;a<t-6;a++)e.isDark(r,a)&&!e.isDark(r,a+1)&&e.isDark(r,a+2)&&e.isDark(r,a+3)&&e.isDark(r,a+4)&&!e.isDark(r,a+5)&&e.isDark(r,a+6)&&(s+=40);for(a=0;a<t;a++)for(r=0;r<t-6;r++)e.isDark(r,a)&&!e.isDark(r+1,a)&&e.isDark(r+2,a)&&e.isDark(r+3,a)&&e.isDark(r+4,a)&&!e.isDark(r+5,a)&&e.isDark(r+6,a)&&(s+=40);var c=0;for(a=0;a<t;a++)for(r=0;r<t;r++)e.isDark(r,a)&&c++;return s+Math.abs(100*c/t/t-50)/5*10}};return qt=u}(),a=ts();function n(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var i=n.prototype;return i.addData=function(t){var s=new e(t);this.dataList.push(s),this.dataCache=null},i.isDark=function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},i.getModuleCount=function(){return this.moduleCount},i.make=function(){if(this.typeNumber<1){var e=1;for(e=1;e<40;e++){for(var a=t.getRSBlocks(e,this.errorCorrectLevel),n=new s,i=0,o=0;o<a.length;o++)i+=a[o].dataCount;for(o=0;o<this.dataList.length;o++){var l=this.dataList[o];n.put(l.mode,4),n.put(l.getLength(),r.getLengthInBits(l.mode,e)),l.write(n)}if(n.getLengthInBits()<=8*i)break}this.typeNumber=e}this.makeImpl(!1,this.getBestMaskPattern())},i.makeImpl=function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var s=0;s<this.moduleCount;s++){this.modules[s]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[s][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=n.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},i.setupPositionProbePattern=function(e,t){for(var s=-1;s<=7;s++)if(!(e+s<=-1||this.moduleCount<=e+s))for(var r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[e+s][t+r]=0<=s&&s<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==s||6==s)||2<=s&&s<=4&&2<=r&&r<=4)},i.getBestMaskPattern=function(){for(var e=0,t=0,s=0;s<8;s++){this.makeImpl(!0,s);var a=r.getLostPoint(this);(0==s||e>a)&&(e=a,t=s)}return t},i.createMovieClip=function(e,t,s){var r=e.createEmptyMovieClip(t,s);this.make();for(var a=0;a<this.modules.length;a++)for(var n=1*a,i=0;i<this.modules[a].length;i++){var o=1*i;this.modules[a][i]&&(r.beginFill(0,100),r.moveTo(o,n),r.lineTo(o+1,n),r.lineTo(o+1,n+1),r.lineTo(o,n+1),r.endFill())}return r},i.setupTimingPattern=function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},i.setupPositionAdjustPattern=function(){for(var e=r.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var s=0;s<e.length;s++){var a=e[t],n=e[s];if(null==this.modules[a][n])for(var i=-2;i<=2;i++)for(var o=-2;o<=2;o++)this.modules[a+i][n+o]=-2==i||2==i||-2==o||2==o||0==i&&0==o}},i.setupTypeNumber=function(e){for(var t=r.getBCHTypeNumber(this.typeNumber),s=0;s<18;s++){var a=!e&&1==(t>>s&1);this.modules[Math.floor(s/3)][s%3+this.moduleCount-8-3]=a}for(s=0;s<18;s++){a=!e&&1==(t>>s&1);this.modules[s%3+this.moduleCount-8-3][Math.floor(s/3)]=a}},i.setupTypeInfo=function(e,t){for(var s=this.errorCorrectLevel<<3|t,a=r.getBCHTypeInfo(s),n=0;n<15;n++){var i=!e&&1==(a>>n&1);n<6?this.modules[n][8]=i:n<8?this.modules[n+1][8]=i:this.modules[this.moduleCount-15+n][8]=i}for(n=0;n<15;n++){i=!e&&1==(a>>n&1);n<8?this.modules[8][this.moduleCount-n-1]=i:n<9?this.modules[8][15-n-1+1]=i:this.modules[8][15-n-1]=i}this.modules[this.moduleCount-8][8]=!e},i.mapData=function(e,t){for(var s=-1,a=this.moduleCount-1,n=7,i=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var l=0;l<2;l++)if(null==this.modules[a][o-l]){var d=!1;i<e.length&&(d=1==(e[i]>>>n&1)),r.getMask(t,a,o-l)&&(d=!d),this.modules[a][o-l]=d,-1==--n&&(i++,n=7)}if((a+=s)<0||this.moduleCount<=a){a-=s,s=-s;break}}},n.PAD0=236,n.PAD1=17,n.createData=function(e,a,i){for(var o=t.getRSBlocks(e,a),l=new s,d=0;d<i.length;d++){var c=i[d];l.put(c.mode,4),l.put(c.getLength(),r.getLengthInBits(c.mode,e)),c.write(l)}var u=0;for(d=0;d<o.length;d++)u+=o[d].dataCount;if(l.getLengthInBits()>8*u)throw new Error("code length overflow. ("+l.getLengthInBits()+">"+8*u+")");for(l.getLengthInBits()+4<=8*u&&l.put(0,4);l.getLengthInBits()%8!=0;)l.putBit(!1);for(;!(l.getLengthInBits()>=8*u||(l.put(n.PAD0,8),l.getLengthInBits()>=8*u));)l.put(n.PAD1,8);return n.createBytes(l,o)},n.createBytes=function(e,t){for(var s=0,n=0,i=0,o=new Array(t.length),l=new Array(t.length),d=0;d<t.length;d++){var c=t[d].dataCount,u=t[d].totalCount-c;n=Math.max(n,c),i=Math.max(i,u),o[d]=new Array(c);for(var m=0;m<o[d].length;m++)o[d][m]=255&e.buffer[m+s];s+=c;var p=r.getErrorCorrectPolynomial(u),g=new a(o[d],p.getLength()-1).mod(p);l[d]=new Array(p.getLength()-1);for(m=0;m<l[d].length;m++){var h=m+g.getLength()-l[d].length;l[d][m]=h>=0?g.get(h):0}}var y=0;for(m=0;m<t.length;m++)y+=t[m].totalCount;var x=new Array(y),f=0;for(m=0;m<n;m++)for(d=0;d<t.length;d++)m<o[d].length&&(x[f++]=o[d][m]);for(m=0;m<i;m++)for(d=0;d<t.length;d++)m<l[d].length&&(x[f++]=l[d][m]);return x},Vt=n}var rs,as,ns={};function is(){if(rs)return ns;rs=1,Object.defineProperty(ns,"__esModule",{value:!0});var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},t=a(Wt()),s=i(),r=a(s);function a(e){return e&&e.__esModule?e:{default:e}}var n={bgColor:t.default.oneOfType([t.default.object,t.default.string]).isRequired,bgD:t.default.string.isRequired,fgColor:t.default.oneOfType([t.default.object,t.default.string]).isRequired,fgD:t.default.string.isRequired,size:t.default.number.isRequired,title:t.default.string,viewBoxSize:t.default.number.isRequired,xmlns:t.default.string},o=(0,s.forwardRef)(function(t,s){var a=t.bgColor,n=t.bgD,i=t.fgD,o=t.fgColor,l=t.size,d=t.title,c=t.viewBoxSize,u=t.xmlns,m=void 0===u?"http://www.w3.org/2000/svg":u,p=function(e,t){var s={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r]);return s}(t,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return r.default.createElement("svg",e({},p,{height:l,ref:s,viewBox:"0 0 "+c+" "+c,width:l,xmlns:m}),d?r.default.createElement("title",null,d):null,r.default.createElement("path",{d:n,fill:a}),r.default.createElement("path",{d:i,fill:o}))});return o.displayName="QRCodeSvg",o.propTypes=n,ns.default=o,ns}const os=o(function(){if(as)return Kt;as=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.QRCode=void 0;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},t=l(Wt()),s=l(Yt()),r=l(ss()),a=i(),n=l(a),o=l(is());function l(e){return e&&e.__esModule?e:{default:e}}var d={bgColor:t.default.oneOfType([t.default.object,t.default.string]),fgColor:t.default.oneOfType([t.default.object,t.default.string]),level:t.default.string,size:t.default.number,value:t.default.string.isRequired},c=(0,a.forwardRef)(function(t,a){var i=t.bgColor,l=void 0===i?"#FFFFFF":i,d=t.fgColor,c=void 0===d?"#000000":d,u=t.level,m=void 0===u?"L":u,p=t.size,g=void 0===p?256:p,h=t.value,y=function(e,t){var s={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r]);return s}(t,["bgColor","fgColor","level","size","value"]),x=new r.default(-1,s.default[m]);x.addData(h),x.make();var f=x.modules;return n.default.createElement(o.default,e({},y,{bgColor:l,bgD:f.map(function(e,t){return e.map(function(e,s){return e?"":"M "+s+" "+t+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:c,fgD:f.map(function(e,t){return e.map(function(e,s){return e?"M "+s+" "+t+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:a,size:g,viewBoxSize:f.length}))});return Kt.QRCode=c,c.displayName="QRCode",c.propTypes=d,Kt.default=c,Kt}()),{Title:ls,Text:ds,Paragraph:cs}=_e,us=({open:t,onCancel:r})=>{const{t:a}=st("settings"),[n]=Pe.useForm(),[i]=Pe.useForm(),o=s(e=>e.auth.user?.email),{data:d,isLoading:c,refetch:u}=C(),m=k(),p=N(),[g,y]=l.useState(!1),[x,f]=l.useState(!1),[j,b]=l.useState(""),[w,v]=l.useState(!1),[I,D]=l.useState(!1),[F]=Pe.useForm(),[B,L]=l.useState(t);t!==B&&(L(t),t&&(v(!1),D(!1),b(""),F.resetFields())),l.useEffect(()=>{t&&u()},[t,u]);const R=async e=>{try{await m.mutateAsync({password:"",verificationCode:e.code,secret:j,confirmEnable:!0}),D(!1),v(!0),F.resetFields()}catch(t){}},z=(e,t)=>{const s=encodeURIComponent("Rediacc");return`otpauth://totp/${s}:${encodeURIComponent(t)}?secret=${e}&issuer=${s}`};return e.jsxs(e.Fragment,{children:[e.jsx(Ue,{title:e.jsxs(Ae,{children:[e.jsx(A,{style:{color:"var(--color-primary)"}}),e.jsx("span",{children:a("twoFactorAuth.title")})]}),open:t,onCancel:r,footer:null,className:P.Medium,"data-testid":"tfa-settings-main-modal",children:(()=>{if(c)return e.jsx("div",{style:{textAlign:"center",padding:`${h("XXXL")}px 0`},"data-testid":"tfa-settings-loading",children:e.jsx(qe,{size:"large"})});if(I&&j)return e.jsxs(Ae,{direction:"vertical",size:h("LG"),style:{width:"100%"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(A,{style:{fontSize:T.FONT_SIZE.XXXXL,color:"var(--color-primary)"}}),e.jsx(ls,{level:4,style:{marginTop:h("MD")},children:a("twoFactorAuth.verification.title")}),e.jsx(cs,{type:"secondary",children:a("twoFactorAuth.verification.subtitle")})]}),e.jsx(Ve,{"data-testid":"tfa-settings-setup-tabs",items:[{key:"qrcode",label:a("twoFactorAuth.setupMethods.qrCode"),children:e.jsxs(Ae,{direction:"vertical",align:"center",style:{width:"100%"},children:[e.jsx("div",{style:{background:"white",padding:h("MD"),borderRadius:T.BORDER_RADIUS.LG},children:e.jsx(os,{value:z(j,o||""),size:200,"data-testid":"tfa-settings-qr-code"})}),e.jsx(ds,{type:"secondary",children:a("twoFactorAuth.scanQRCode")})]})},{key:"manual",label:a("twoFactorAuth.setupMethods.manual"),children:e.jsx(Ae,{direction:"vertical",style:{width:"100%"},children:e.jsx(Ge,{message:a("twoFactorAuth.manualSetup.title"),description:e.jsxs(Ae,{direction:"vertical",style:{width:"100%"},children:[e.jsx(ds,{children:a("twoFactorAuth.manualSetup.instructions")}),e.jsxs(Ae.Compact,{style:{width:"100%",marginTop:h("SM")},children:[e.jsx(Te,{value:j,readOnly:!0,style:{fontFamily:"monospace"},"data-testid":"tfa-settings-secret-key-input"}),e.jsx(Se,{icon:e.jsx(je,{}),onClick:()=>{return e=j,navigator.clipboard.writeText(e),void Oe.success(a("twoFactorAuth.secretCopied"));var e},"data-testid":"tfa-settings-copy-secret-button"})]})]}),type:"info","data-testid":"tfa-settings-manual-setup-alert"})})}]}),e.jsxs(Pe,{form:F,layout:"vertical",onFinish:R,children:[e.jsx(Pe.Item,{name:"code",label:a("twoFactorAuth.verification.codeLabel"),rules:[{required:!0,message:a("twoFactorAuth.verification.codeRequired")},{len:6,message:a("twoFactorAuth.verification.codeLength")},{pattern:/^\d{6}$/,message:a("twoFactorAuth.verification.codeFormat")}],children:e.jsx(Te,{size:"large",placeholder:a("twoFactorAuth.verification.codePlaceholder"),maxLength:6,style:{textAlign:"center",fontSize:T.FONT_SIZE.XL,letterSpacing:T.LETTER_SPACING.WIDER},autoComplete:"off","data-testid":"tfa-settings-verification-input"})}),e.jsx(Pe.Item,{style:{marginBottom:0},children:e.jsxs(Ae,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(Se,{onClick:()=>{D(!1),b(""),F.resetFields()},"data-testid":"tfa-settings-verification-cancel-button",children:a("common:general.cancel")}),e.jsx(Se,{type:"primary",htmlType:"submit",loading:m.isPending,style:{background:"var(--color-primary)",borderColor:"var(--color-primary)"},"data-testid":"tfa-settings-verification-submit-button",children:a("twoFactorAuth.verification.submit")})]})})]})]});if(w)return e.jsx($e,{status:"success",title:a("twoFactorAuth.enableSuccess.title"),subTitle:a("twoFactorAuth.enableSuccess.subtitle"),"data-testid":"tfa-settings-success-result",extra:e.jsxs(Ae,{direction:"vertical",size:h("LG"),style:{width:"100%"},children:[e.jsx(Ge,{message:a("twoFactorAuth.enableSuccess.verified"),description:a("twoFactorAuth.enableSuccess.verifiedDescription"),type:"success",showIcon:!0,icon:e.jsx(M,{}),"data-testid":"tfa-settings-success-alert"}),e.jsx(Se,{type:"primary",size:"large",block:!0,onClick:()=>{v(!1),b(""),u()},style:{background:"var(--color-primary)",borderColor:"var(--color-primary)"},"data-testid":"tfa-settings-success-done-button",children:a("twoFactorAuth.done")})]})});const t=Boolean(d?.isTFAEnabled);return e.jsxs(Ae,{direction:"vertical",size:h("LG"),style:{width:"100%"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(A,{style:{fontSize:T.FONT_SIZE.XXXXXXL,color:t?"var(--color-success)":"var(--color-text-quaternary)"}}),e.jsx(ls,{level:4,style:{marginTop:h("MD")},children:a(t?"twoFactorAuth.status.enabled":"twoFactorAuth.status.disabled")}),e.jsx(cs,{type:"secondary",children:a(t?"twoFactorAuth.status.enabledDescription":"twoFactorAuth.status.disabledDescription")})]}),e.jsx(Re,{children:e.jsxs(Ae,{direction:"vertical",size:h("MD"),style:{width:"100%"},children:[e.jsx(ls,{level:5,children:a("twoFactorAuth.whatIs.title")}),e.jsx(cs,{children:a("twoFactorAuth.whatIs.description")}),e.jsxs("ul",{children:[e.jsx("li",{children:a("twoFactorAuth.whatIs.benefit1")}),e.jsx("li",{children:a("twoFactorAuth.whatIs.benefit2")}),e.jsx("li",{children:a("twoFactorAuth.whatIs.benefit3")})]})]})}),t?e.jsx(Se,{type:"primary",danger:!0,size:"large",block:!0,icon:e.jsx(E,{}),onClick:()=>f(!0),"data-testid":"tfa-settings-disable-button",children:a("twoFactorAuth.disable")}):e.jsx(Se,{type:"primary",size:"large",block:!0,icon:e.jsx(M,{}),onClick:()=>y(!0),style:{background:"var(--color-primary)",borderColor:"var(--color-primary)"},"data-testid":"tfa-settings-enable-button",children:a("twoFactorAuth.enable")})]})})()}),e.jsx(Ue,{title:a("twoFactorAuth.enableModal.title"),open:g,onCancel:()=>{y(!1),n.resetFields()},footer:null,className:P.Medium,"data-testid":"tfa-settings-enable-modal",children:e.jsxs(Pe,{form:n,layout:"vertical",onFinish:async e=>{try{const t=await m.mutateAsync({password:e.password,generateOnly:!0});b(t.secret),y(!1),D(!0),n.resetFields()}catch(t){t.message?.includes("already enabled")&&(y(!1),n.resetFields())}},children:[e.jsx(Ge,{message:a("twoFactorAuth.enableModal.warning"),description:a("twoFactorAuth.enableModal.warningDescription"),type:"warning",showIcon:!0,style:{marginBottom:h("LG")},"data-testid":"tfa-settings-enable-warning-alert"}),e.jsx(Pe.Item,{name:"password",label:a("twoFactorAuth.enableModal.passwordLabel"),rules:[{required:!0,message:a("twoFactorAuth.enableModal.passwordRequired")}],children:e.jsx(Te.Password,{prefix:e.jsx(S,{}),placeholder:a("twoFactorAuth.enableModal.passwordPlaceholder"),size:"large",autoComplete:"off","data-testid":"tfa-settings-enable-password-input"})}),e.jsx(Pe.Item,{style:{marginBottom:0},children:e.jsxs(Ae,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(Se,{onClick:()=>{y(!1),n.resetFields()},"data-testid":"tfa-settings-enable-cancel-button",children:a("common:general.cancel")}),e.jsx(Se,{type:"primary",htmlType:"submit",loading:m.isPending,style:{background:"var(--color-primary)",borderColor:"var(--color-primary)"},"data-testid":"tfa-settings-enable-submit-button",children:a("twoFactorAuth.enableModal.submit")})]})})]})}),e.jsx(Ue,{title:a("twoFactorAuth.disableModal.title"),open:x,onCancel:()=>{f(!1),i.resetFields()},footer:null,className:P.Medium,"data-testid":"tfa-settings-disable-modal",children:e.jsxs(Pe,{form:i,layout:"vertical",onFinish:async e=>{try{await p.mutateAsync({password:e.password,currentCode:e.code}),f(!1),i.resetFields()}catch(t){}},children:[e.jsx(Ge,{message:a("twoFactorAuth.disableModal.warning"),description:a("twoFactorAuth.disableModal.warningDescription"),type:"error",showIcon:!0,style:{marginBottom:h("LG")},"data-testid":"tfa-settings-disable-warning-alert"}),e.jsx(Pe.Item,{name:"password",label:a("twoFactorAuth.disableModal.passwordLabel"),rules:[{required:!0,message:a("twoFactorAuth.disableModal.passwordRequired")}],children:e.jsx(Te.Password,{prefix:e.jsx(S,{}),placeholder:a("twoFactorAuth.disableModal.passwordPlaceholder"),size:"large",autoComplete:"off","data-testid":"tfa-settings-disable-password-input"})}),e.jsx(Pe.Item,{name:"code",label:a("twoFactorAuth.disableModal.codeLabel"),rules:[{required:!0,message:a("twoFactorAuth.disableModal.codeRequired")},{len:6,message:a("twoFactorAuth.disableModal.codeLength")},{pattern:/^\d{6}$/,message:a("twoFactorAuth.disableModal.codeFormat")}],children:e.jsx(Te,{size:"large",placeholder:a("twoFactorAuth.disableModal.codePlaceholder"),maxLength:6,style:{textAlign:"center",fontSize:T.FONT_SIZE.XL,letterSpacing:T.LETTER_SPACING.WIDER},autoComplete:"off","data-testid":"tfa-settings-disable-code-input"})}),e.jsx(Pe.Item,{style:{marginBottom:0},children:e.jsxs(Ae,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(Se,{onClick:()=>{f(!1),i.resetFields()},"data-testid":"tfa-settings-disable-cancel-button",children:a("common:general.cancel")}),e.jsx(Se,{type:"primary",danger:!0,htmlType:"submit",loading:p.isPending,"data-testid":"tfa-settings-disable-submit-button",children:a("twoFactorAuth.disableModal.submit")})]})})]})})]})},ms=H({endpoint:"/UpdateCompanyVault",method:"post",invalidateKeys:["company-vault"],successMessage:()=>"Vault configuration updated successfully",errorMessage:"Failed to update vault configuration",transformData:e=>({...e,companyVault:at(e.companyVault)})}),ps=X("Region","create","/CreateRegion","regionName"),gs=H({endpoint:"/UpdateRegionName",method:"put",invalidateKeys:["regions","dropdown-data"],successMessage:e=>`Region renamed to "${e.newRegionName}"`,errorMessage:"Failed to update region name"}),hs=Q("Region","/UpdateRegionVault","regionName","regionVault"),ys=H({endpoint:"/DeleteRegion",method:"delete",invalidateKeys:["regions","dropdown-data"],successMessage:e=>`Region "${e}" deleted successfully`,errorMessage:"Failed to delete region",transformData:e=>({regionName:e})}),xs=H({endpoint:"/CreateBridge",method:"post",invalidateKeys:["bridges","regions","dropdown-data"],successMessage:e=>`Bridge "${e.bridgeName}" created successfully`,errorMessage:"Failed to create bridge",transformData:e=>({...e,bridgeVault:e.bridgeVault||"{}"})}),fs=H({endpoint:"/UpdateBridgeName",method:"put",invalidateKeys:["bridges","dropdown-data"],successMessage:e=>`Bridge renamed to "${e.newBridgeName}"`,errorMessage:"Failed to update bridge name"}),js=Q("Bridge","/UpdateBridgeVault","bridgeName","bridgeVault"),bs=X("Bridge","delete","/DeleteBridge","bridgeName",["regions"]),ws=H({endpoint:"/ResetBridgeAuthorization",method:"post",invalidateKeys:["bridges"],successMessage:e=>`Bridge authorization reset for "${e.bridgeName}"`,errorMessage:"Failed to reset bridge authorization"}),{Title:vs,Text:Cs}=_e,ks=()=>{const{t:i}=st("settings"),{t:o}=st("system"),{t:u}=st("resources"),{t:m}=st("common"),p=s(e=>e.ui.uiMode),[g,h]=l.useState(null),y=s(e=>e.auth.user),f=n(),j=d(),[b,w]=l.useState("users");l.useEffect(()=>{(async()=>{const e=await _.getMasterPassword();h(e)})()},[]),c.useEffect(()=>{w("users")},[p]);const[v,C]=l.useState(!1),[k,N]=l.useState(!1),[K,H]=l.useState(!1),[X,Q]=l.useState(!1),[Ee]=Pe.useForm(),[ze,Je]=l.useState(!1),[et,tt]=l.useState({open:!1}),[at,ot]=l.useState(""),[lt,dt]=l.useState(!1),[ct,ut]=l.useState(!1),[mt,pt]=l.useState(!1),[gt,ht]=l.useState(null),[vt,kt]=l.useState(""),[Nt,Pt]=l.useState(""),[At,St]=l.useState(""),[Tt,Mt]=l.useState(!1),[Et,It]=l.useState(null),[Dt,Ft]=l.useState(""),[Bt,Lt]=l.useState(null),[Rt,zt]=l.useState({open:!1}),[Zt,Ot]=l.useState({open:!1,bridgeName:"",isCloudManaged:!1}),[Ut,Gt]=l.useState({open:!1,entityType:null,entityIdentifier:null}),[qt,_t]=l.useState({open:!1,resourceType:"team",mode:"create"}),[Vt,$t]=l.useState(null),[Kt,Ht]=l.useState(!1),[Xt]=Pe.useForm(),Qt=g?"update":"create",[Wt,Yt]=l.useState(Qt),[Jt,es]=l.useState("update"),[ts,ss]=l.useState(!1),[rs,as]=l.useState(60),ns=l.useRef(null),[is,os]=l.useState(!1),[ls,ds]=l.useState(null),[cs,ks]=l.useState("skip"),[Ns]=Pe.useForm(),{data:Ps}=nt(),{data:As}=(()=>{const e=I(D);return t({queryKey:["company-vault",e],queryFn:async()=>{const e=await x.get("/GetCompanyVault"),t=e.resultSets[1]?.data[0];return t?{vault:t.vaultContent||t.VaultContent||"{}",vaultVersion:t.vaultVersion||t.VaultVersion||1}:{vault:"{}",vaultVersion:1}},enabled:!!e})})(),Ss=ms(),Ts=(()=>{const e=r();return a({mutationFn:async e=>{const t=await x.post("/UpdateCompanyBlockUserRequests",{blockUserRequests:e});return t.resultSets[0]?.data[0]},onSuccess:(t,s)=>{const r=s?"blocked":"unblocked",a=t?.DeactivatedCount||0;F("success",s&&a>0?`User requests ${r}. ${a} active sessions were terminated.`:`User requests ${r} successfully`),e.invalidateQueries({queryKey:["company"]}),e.invalidateQueries({queryKey:["users"]})},onError:()=>{F("error","Failed to update user request blocking status")}})})(),Ms=t({queryKey:["company-all-vaults"],queryFn:async()=>{const e=await x.get("/GetCompanyVaults"),t=e.resultSets[1]?.data||[],s=e.resultSets[2]?.data||[],r={};return t.forEach(e=>{const t=e.entityType;if(t){const s=t.charAt(0).toLowerCase()+t.slice(1)+("Company"===t?"":"s");r[s]||(r[s]=[]),r[s].push(e)}}),{...r,bridgesWithRequestToken:s,allVaults:t}},enabled:!1}),Es=(()=>{const e=r();return a({mutationFn:async e=>{const t=await x.post("/UpdateCompanyVaults",{updates:JSON.stringify(e)});return t.resultSets[0]?.data[0]},onSuccess:t=>{const s=t?.Result||{},r=s.TotalUpdated||0,a=s.FailedCount||0;if(a>0){const e=rt.t("system:dangerZone.updateMasterPassword.error.partialSuccess",{updated:r,failed:a});F("error",e)}e.invalidateQueries()},onError:e=>{const t=e?.message||rt.t("system:dangerZone.updateMasterPassword.error.updateFailed");F("error",t)}})})(),Is=t({queryKey:["company-export-data"],queryFn:async()=>{const e=await x.get("/ExportCompanyData"),t=e.resultSets[1]?.data[0];if(!t)throw new Error("No export data returned");return t},enabled:!1}),Ds=(()=>{const e=r();return a({mutationFn:async e=>{const t=await x.post("/ImportCompanyData",{companyDataJson:e.companyDataJson,importMode:e.importMode||"skip"});return t.resultSets[0]?.data[0]},onSuccess:t=>{const s=t?.ImportedCount||0,r=t?.SkippedCount||0,a=t?.ErrorCount||0;let n=`Import completed: ${s} items imported`;r>0&&(n+=`, ${r} items skipped`),a>0&&(n+=`, ${a} errors`),F("success",n),e.invalidateQueries()},onError:e=>{F("error",e?.message||"Failed to import company data")}})})(),{data:Fs=[],isLoading:Bs}=t({queryKey:["users"],queryFn:async()=>{const e=await x.get("/GetCompanyUsers");return(e.resultSets[1]?.data||[]).map(e=>({...e,userEmail:e.UserEmail||e.userEmail,companyName:e.CompanyName||e.companyName,activated:void 0!==e.Activated?e.Activated:e.activated,permissionGroupName:e.PermissionsName||e.permissionsName||e.permissionGroupName,lastActive:e.lastActive}))}}),Ls=ft(),Rs=jt(),zs=bt(),Zs=wt(),{data:Os=[],isLoading:Us}=t({queryKey:["permissionGroups"],queryFn:async()=>{const e=await x.get("/GetCompanyPermissionGroups");return(e.resultSets[1]?.data||[]).map(e=>({permissionGroupName:e.PermissionGroupName||e.permissionGroupName,userCount:e.UserCount||e.userCount||0,permissionCount:e.PermissionCount||e.permissionCount||0,permissions:e.Permissions?e.Permissions.split(",").map(e=>e.trim()).filter(e=>e):[]}))}}),{data:Gs}=t({queryKey:["permissionGroup",qs=gt?.permissionGroupName||""],queryFn:async()=>{const e=await x.get("/GetPermissionGroupDetails",{permissionGroupName:qs}),t=(e.resultSets[1]?.data||[]).map(e=>e.PermissionName||e.permissionName);return{permissionGroupName:qs,permissions:t}},enabled:!!qs});var qs;const _s=(()=>{const e=r();return a({mutationFn:async e=>await x.post("/CreatePermissionGroup",e),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["permissionGroups"]}),e.invalidateQueries({queryKey:["dropdown-data"]}),F("success",`Permission group "${s.permissionGroupName}" created successfully`)},onError:e=>{F("error",e.message||"Failed to create permission group")}})})(),Vs=(()=>{const e=r();return a({mutationFn:async e=>await x.delete("/DeletePermissionGroup",{permissionGroupName:e}),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["permissionGroups"]}),e.invalidateQueries({queryKey:["dropdown-data"]}),F("success",`Permission group "${s}" deleted successfully`)},onError:e=>{F("error",e.message||"Failed to delete permission group")}})})(),$s=(()=>{const e=r();return a({mutationFn:async e=>await x.post("/CreatePermissionInGroup",e),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["permissionGroup",s.permissionGroupName]}),e.invalidateQueries({queryKey:["permissionGroups"]}),F("success",`Permission "${s.permissionName}" added to group`)},onError:e=>{F("error",e.message||"Failed to add permission to group")}})})(),Ks=(()=>{const e=r();return a({mutationFn:async e=>await x.delete("/DeletePermissionFromGroup",e),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["permissionGroup",s.permissionGroupName]}),e.invalidateQueries({queryKey:["permissionGroups"]}),F("success",`Permission "${s.permissionName}" removed from group`)},onError:e=>{F("error",e.message||"Failed to remove permission from group")}})})(),Hs=(()=>{const e=r();return a({mutationFn:async e=>await x.put("/UpdateUserAssignedPermissions",e),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["users"]}),e.invalidateQueries({queryKey:["permissionGroup",s.permissionGroupName]}),F("success",`User assigned to permission group "${s.permissionGroupName}"`)},onError:e=>{F("error",e.message||"Failed to assign user to permission group")}})})(),{data:Xs=[],isLoading:Qs}=W(),{data:Ws=[]}=Y(Et?.teamName||""),Ys=J(),Js=ee(),er=te(),tr=se(),sr=re(),rr=ae(),{data:ar,isLoading:nr}=((e=!0)=>t({queryKey:["regions"],queryFn:async()=>{const e=await x.get("/GetCompanyRegions");return it(e,"regionName")},enabled:e,staleTime:3e4}))(!0),ir=ar||[],or=ps(),lr=gs(),dr=ys(),cr=hs(),{data:ur,isLoading:mr}=t({queryKey:["bridges",pr=Bt||void 0],queryFn:async()=>{if(!pr)return[];const e=await x.get("/GetRegionBridges",{regionName:pr}),t=e.resultSets?.[1]?.data||[];return Array.isArray(t)?t.filter(e=>e&&e.bridgeName):[]},enabled:!!pr,staleTime:3e4});var pr;const gr=ur||[],hr=xs(),yr=fs(),xr=bs(),fr=js(),jr=ws();l.useEffect(()=>{ir.length>0&&!Bt&&Lt(ir[0].regionName)},[ir,Bt]),l.useEffect(()=>{if(Kt){Yt(g?"update":"create")}},[Kt,g]),l.useEffect(()=>(ts&&rs>0?ns.current=setInterval(()=>{as(e=>e-1)},1e3):0===rs&&(f(B()),j("/login")),()=>{ns.current&&clearInterval(ns.current)}),[ts,rs,f,j]);const br=ne({resolver:ie(ue),defaultValues:{newUserEmail:"",newUserPassword:""}}),wr=async()=>{if(vt.trim())try{await _s.mutateAsync({permissionGroupName:vt}),dt(!1),kt("")}catch(e){}else F("error","Please enter a group name")},vr=(e,t,s)=>{_t({open:!0,resourceType:e,mode:t,data:s}),$t(s)},Cr=()=>{_t({open:!1,resourceType:"team",mode:"create"}),$t(null)},kr=[{title:"Group Name",dataIndex:"permissionGroupName",key:"permissionGroupName",render:t=>e.jsxs(Ae,{children:[e.jsx(ce,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:"Users",dataIndex:"userCount",key:"userCount",width:100,render:t=>e.jsx(Ye,{count:t,showZero:!0,children:e.jsx(G,{style:{fontSize:T.DIMENSIONS.ICON_MD}})})},{title:"Permissions",dataIndex:"permissionCount",key:"permissionCount",width:120,render:t=>e.jsx(Ye,{count:t,showZero:!0,style:{backgroundColor:"#556b2f"},children:e.jsx(S,{style:{fontSize:T.DIMENSIONS.ICON_MD}})})},{title:"Actions",key:"actions",width:350,render:(t,s)=>e.jsxs(Ae,{children:[e.jsx(Fe,{title:"Permissions",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(S,{}),onClick:()=>{ht(s),ut(!0)},"data-testid":`system-permission-group-manage-button-${s.permissionGroupName}`,"aria-label":"Permissions"})}),e.jsx(Fe,{title:"Assign User",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(G,{}),onClick:()=>{ht(s),pt(!0)},"data-testid":`system-permission-group-assign-user-button-${s.permissionGroupName}`,"aria-label":"Assign User"})}),e.jsx(Fe,{title:"Trace",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(R,{}),onClick:()=>{Gt({open:!0,entityType:"Permissions",entityIdentifier:s.permissionGroupName,entityName:s.permissionGroupName})},"data-testid":`system-permission-group-trace-button-${s.permissionGroupName}`,"aria-label":"Trace"})}),e.jsx(De,{title:"Delete Permission Group",description:`Are you sure you want to delete group "${s.permissionGroupName}"?`,onConfirm:()=>(async e=>{try{await Vs.mutateAsync(e)}catch(t){}})(s.permissionGroupName),okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},children:e.jsx(Fe,{title:"Delete",children:e.jsx(Se,{type:"primary",danger:!0,size:"small",icon:e.jsx(z,{}),loading:Vs.isPending,"data-testid":`system-permission-group-delete-button-${s.permissionGroupName}`,"aria-label":"Delete"})})})]})}],Nr=[{title:"Email",dataIndex:"userEmail",key:"userEmail",render:t=>e.jsxs(Ae,{children:[e.jsx(G,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:"Status",dataIndex:"activated",key:"activated",width:120,render:t=>t?e.jsx(Ie,{icon:e.jsx(M,{}),color:"success",children:"Active"}):e.jsx(Ie,{icon:e.jsx(pe,{}),color:"default",children:"Inactive"})},{title:"Permission Group",dataIndex:"permissionGroupName",key:"permissionGroupName",render:t=>t?e.jsx(Ie,{icon:e.jsx(ce,{}),color:"blue",children:t}):e.jsx(Ie,{color:"default",children:"No Group"})},{title:"Last Active",dataIndex:"lastActive",key:"lastActive",render:e=>e?new Date(e).toLocaleDateString():"Never"},{title:"Actions",key:"actions",width:300,render:(t,s)=>e.jsxs(Ae,{children:[e.jsx(Fe,{title:"Permissions",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(ce,{}),onClick:()=>{tt({open:!0,user:s}),ot(s.permissionGroupName||"")},"data-testid":`system-user-permissions-button-${s.userEmail}`,"aria-label":"Permissions"})}),e.jsx(Fe,{title:"Trace",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(R,{}),onClick:()=>{Gt({open:!0,entityType:"User",entityIdentifier:s.userEmail,entityName:s.userEmail})},"data-testid":`system-user-trace-button-${s.userEmail}`,"aria-label":"Trace"})}),s.activated&&e.jsx(De,{title:"Deactivate User",description:`Are you sure you want to deactivate "${s.userEmail}"?`,onConfirm:()=>(async e=>{try{await Rs.mutateAsync(e)}catch(t){}})(s.userEmail),okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},children:e.jsx(Fe,{title:"Deactivate",children:e.jsx(Se,{type:"primary",danger:!0,size:"small",icon:e.jsx(pe,{}),loading:Rs.isPending,"data-testid":`system-user-deactivate-button-${s.userEmail}`,"aria-label":"Deactivate"})})})]})}],Pr=Ps?.permissions||[],Ar=[{title:"Team Name",dataIndex:"teamName",key:"teamName",render:t=>e.jsxs(Ae,{children:[e.jsx(fe,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:"Members",dataIndex:"memberCount",key:"memberCount",width:100,render:t=>e.jsx(Ye,{count:t,showZero:!0,children:e.jsx(G,{style:{fontSize:T.DIMENSIONS.ICON_MD}})})},{title:"Machines",dataIndex:"machineCount",key:"machineCount",width:100,render:t=>e.jsxs(Ae,{children:[e.jsx(ye,{}),e.jsx("span",{children:t})]})},{title:"Repositories",dataIndex:"repoCount",key:"repoCount",width:120,render:t=>e.jsxs(Ae,{children:[e.jsx(be,{}),e.jsx("span",{children:t||0})]})},{title:"Storage",dataIndex:"storageCount",key:"storageCount",width:100,render:t=>e.jsxs(Ae,{children:[e.jsx(we,{}),e.jsx("span",{children:t||0})]})},..."expert"===p?[{title:"Vault Version",dataIndex:"vaultVersion",key:"vaultVersion",width:120,render:t=>e.jsx(Ie,{children:i("common:general.versionFormat",{version:t})})}]:[],{title:"Actions",key:"actions",width:350,render:(t,s)=>e.jsxs(Ae,{children:[e.jsx(Fe,{title:"Edit",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(he,{}),onClick:()=>vr("team","edit",s),"data-testid":`system-team-edit-button-${s.teamName}`,"aria-label":"Edit"})}),e.jsx(Fe,{title:"Members",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(G,{}),onClick:()=>{It(s),Mt(!0)},"data-testid":`system-team-members-button-${s.teamName}`,"aria-label":"Members"})}),e.jsx(Fe,{title:"Trace",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(R,{}),onClick:()=>{Gt({open:!0,entityType:"Team",entityIdentifier:s.teamName,entityName:s.teamName})},"data-testid":`system-team-trace-button-${s.teamName}`,"aria-label":"Trace"})}),e.jsx(De,{title:"Delete Team",description:`Are you sure you want to delete team "${s.teamName}"?`,onConfirm:()=>(async e=>{try{await er.mutateAsync(e)}catch(t){}})(s.teamName),okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},children:e.jsx(Fe,{title:"Delete",children:e.jsx(Se,{type:"primary",danger:!0,size:"small",icon:e.jsx(z,{}),loading:er.isPending,"data-testid":`system-team-delete-button-${s.teamName}`,"aria-label":"Delete"})})})]})}],Sr=[{title:u("regions.regionName"),dataIndex:"regionName",key:"regionName",render:t=>e.jsxs(Ae,{children:[e.jsx(ge,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:u("regions.bridges"),dataIndex:"bridgeCount",key:"bridgeCount",width:120,render:t=>e.jsxs(Ae,{children:[e.jsx(L,{}),e.jsx("span",{children:t})]})},..."expert"===p?[{title:u("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:120,render:t=>e.jsx(Ie,{children:i("common:general.versionFormat",{version:t})})}]:[],{title:u("general.actions"),key:"actions",width:300,render:(t,s)=>e.jsxs(Ae,{children:[e.jsx(Fe,{title:u("general.edit"),children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(he,{}),onClick:()=>vr("region","edit",s),"data-testid":`system-region-edit-button-${s.regionName}`,"aria-label":u("general.edit")})}),e.jsx(Fe,{title:"Trace",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(R,{}),onClick:()=>{Gt({open:!0,entityType:"Region",entityIdentifier:s.regionName,entityName:s.regionName})},"data-testid":`system-region-trace-button-${s.regionName}`,"aria-label":"Trace"})}),e.jsx(De,{title:u("regions.deleteRegion"),description:u("regions.confirmDelete",{regionName:s.regionName}),onConfirm:()=>(async e=>{try{await dr.mutateAsync(e),Bt===e&&Lt(null)}catch(t){}})(s.regionName),okText:u("general.yes"),cancelText:u("general.no"),okButtonProps:{danger:!0},children:e.jsx(Fe,{title:u("general.delete"),children:e.jsx(Se,{type:"primary",danger:!0,size:"small",icon:e.jsx(z,{}),loading:dr.isPending,"data-testid":`system-region-delete-button-${s.regionName}`,"aria-label":u("general.delete")})})})]})}],Tr=[{title:u("bridges.bridgeName"),dataIndex:"bridgeName",key:"bridgeName",render:(t,s)=>e.jsxs(Ae,{children:[e.jsx(L,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t}),1===s.hasAccess&&e.jsx(Ie,{color:"green",icon:e.jsx(M,{}),children:"Access"})]})},{title:u("teams.machines"),dataIndex:"machineCount",key:"machineCount",width:120,render:t=>e.jsxs(Ae,{children:[e.jsx(ye,{}),e.jsx("span",{children:t})]})},{title:"Type",dataIndex:"isGlobalBridge",key:"isGlobalBridge",width:100,render:t=>t?e.jsx(Ie,{color:"purple",icon:e.jsx(we,{}),children:"Global"}):e.jsx(Ie,{color:"blue",icon:e.jsx(L,{}),children:"Regular"})},{title:"Management",dataIndex:"managementMode",key:"managementMode",width:120,render:t=>{if(!t)return e.jsx(Ie,{children:"Local"});const s="Cloud"===t?"green":"default",r="Cloud"===t?e.jsx(we,{}):e.jsx(ye,{});return e.jsx(Ie,{color:s,icon:r,children:t})}},..."expert"===p?[{title:u("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:120,render:t=>e.jsx(Ie,{children:i("common:general.versionFormat",{version:t})})}]:[],{title:u("general.actions"),key:"actions",width:T.DIMENSIONS.MODAL_WIDTH,render:(t,s)=>e.jsxs(Ae,{children:[e.jsx(Fe,{title:u("general.edit"),children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(he,{}),onClick:()=>vr("bridge","edit",s),"data-testid":`system-bridge-edit-button-${s.bridgeName}`,"aria-label":u("general.edit")})}),e.jsx(Fe,{title:"Token",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(S,{}),onClick:()=>zt({open:!0,bridge:s}),"data-testid":`system-bridge-token-button-${s.bridgeName}`,"aria-label":"Token"})}),e.jsx(Fe,{title:"Reset Auth",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(xe,{}),onClick:()=>Ot({open:!0,bridgeName:s.bridgeName,isCloudManaged:!1}),"data-testid":`system-bridge-reset-auth-button-${s.bridgeName}`,"aria-label":"Reset Auth"})}),e.jsx(Fe,{title:"Trace",children:e.jsx(Se,{type:"primary",size:"small",icon:e.jsx(R,{}),onClick:()=>{Gt({open:!0,entityType:"Bridge",entityIdentifier:s.bridgeName,entityName:s.bridgeName})},"data-testid":`system-bridge-trace-button-${s.bridgeName}`,"aria-label":"Trace"})}),e.jsx(De,{title:u("bridges.deleteBridge"),description:u("bridges.confirmDelete",{bridgeName:s.bridgeName}),onConfirm:()=>(async e=>{try{await xr.mutateAsync({regionName:e.regionName,bridgeName:e.bridgeName})}catch(t){}})(s),okText:u("general.yes"),cancelText:u("general.no"),okButtonProps:{danger:!0},children:e.jsx(Fe,{title:u("general.delete"),children:e.jsx(Se,{type:"primary",danger:!0,size:"small",icon:e.jsx(z,{}),loading:xr.isPending,"data-testid":`system-bridge-delete-button-${s.bridgeName}`,"aria-label":u("general.delete")})})})]})}],Mr={key:"users",label:e.jsxs("span",{"data-testid":"system-tab-users",children:[e.jsx(G,{}),"Users"]}),children:e.jsx(Ne,{title:e.jsxs(Ae,{children:[e.jsx("span",{style:{fontSize:T.FONT_SIZE.BASE,fontWeight:T.FONT_WEIGHT.MEDIUM},children:"Users"}),e.jsx("span",{style:{fontSize:14,color:"#666"},children:"Manage users and their permissions"})]}),loading:Bs,data:Fs,columns:Nr,rowKey:"userEmail",searchPlaceholder:"Search users...","data-testid":"system-user-table",actions:e.jsx(Fe,{title:i("system:actions.createUser"),children:e.jsx(Se,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>Je(!0),"data-testid":"system-create-user-button","aria-label":i("system:actions.createUser")})})})},Er={key:"permissions",label:e.jsxs("span",{"data-testid":"system-tab-permissions",children:[e.jsx(ce,{}),"Permissions"]}),children:e.jsx(Ne,{title:e.jsxs(Ae,{children:[e.jsx("span",{style:{fontSize:T.FONT_SIZE.BASE,fontWeight:T.FONT_WEIGHT.MEDIUM},children:"Permission Groups"}),e.jsx("span",{style:{fontSize:14,color:"#666"},children:"Manage permission groups and their assignments"})]}),loading:Us,data:Os,columns:kr,rowKey:"permissionGroupName",searchPlaceholder:"Search permission groups...","data-testid":"system-permission-group-table",actions:e.jsx(Fe,{title:i("system:actions.createGroup"),children:e.jsx(Se,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>dt(!0),"data-testid":"system-create-permission-group-button","aria-label":i("system:actions.createGroup")})})})},Ir={key:"teams",label:e.jsxs("span",{"data-testid":"system-tab-teams",children:[e.jsx(fe,{}),"Teams"]}),children:e.jsx(Ne,{title:e.jsxs(Ae,{children:[e.jsx("span",{style:{fontSize:T.FONT_SIZE.BASE,fontWeight:T.FONT_WEIGHT.MEDIUM},children:"Teams"}),e.jsx("span",{style:{fontSize:14,color:"#666"},children:"Manage teams and their members"})]}),loading:Qs,data:Xs,columns:Ar,rowKey:"teamName",searchPlaceholder:"Search teams...","data-testid":"system-team-table",actions:e.jsx(Fe,{title:i("system:actions.createTeam"),children:e.jsx(Se,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>vr("team","create"),"data-testid":"system-create-team-button","aria-label":i("system:actions.createTeam")})})})},Dr="simple"===p?[Mr,Ir]:[Mr,Ir,Er,{key:"sessions",label:e.jsxs("span",{"data-testid":"system-tab-sessions",children:[e.jsx(ye,{}),"User Sessions"]}),children:e.jsx(Ct,{})}];return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{direction:"vertical",size:24,style:{width:"100%",marginBottom:24},children:[e.jsx(vs,{level:3,children:i("title")}),e.jsxs(Be,{gutter:[16,16],children:[e.jsx(Le,{xs:24,lg:12,children:e.jsx(Re,{style:{height:"100%"},children:e.jsxs(Ae,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsxs(Ae,{children:[e.jsx(O,{style:{fontSize:24,color:"#556b2f"}}),e.jsx(vs,{level:4,style:{margin:0},children:i("company.title")})]}),e.jsx(Cs,{type:"secondary",children:i("company.description")}),e.jsx(Fe,{title:i("company.configureVault"),children:e.jsx(Se,{type:"primary",icon:e.jsx(U,{}),onClick:()=>C(!0),size:"large",style:{marginTop:16},"data-testid":"system-company-vault-button","aria-label":i("company.configureVault")})})]})})}),e.jsx(Le,{xs:24,lg:12,children:e.jsx(Re,{style:{height:"100%"},children:e.jsxs(Ae,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsxs(Ae,{children:[e.jsx(G,{style:{fontSize:24,color:"#556b2f"}}),e.jsx(vs,{level:4,style:{margin:0},children:i("personal.title")})]}),e.jsx(Cs,{type:"secondary",children:i("personal.description")}),e.jsxs(Ae,{style:{marginTop:16},wrap:!0,children:[e.jsx(Fe,{title:i("personal.configureVault"),children:e.jsx(Se,{type:"primary",icon:e.jsx(U,{}),onClick:()=>N(!0),size:"large","data-testid":"system-user-vault-button","aria-label":i("personal.configureVault")})}),e.jsx(Fe,{title:i("system:actions.changePassword"),children:e.jsx(Se,{type:"primary",icon:e.jsx(S,{}),onClick:()=>H(!0),size:"large","data-testid":"system-change-password-button","aria-label":i("system:actions.changePassword")})}),e.jsx(Fe,{title:i("system:actions.twoFactorAuth"),children:e.jsx(Se,{type:"primary",icon:e.jsx(A,{}),onClick:()=>Q(!0),size:"large","data-testid":"system-two-factor-button","aria-label":i("system:actions.twoFactorAuth")})})]})]})})})]})]}),e.jsx(vs,{level:3,style:{marginBottom:24},children:"Users, Teams & Permissions"}),e.jsx(Re,{children:e.jsx(Ve,{activeKey:b,onChange:w,items:Dr})}),e.jsx(Ue,{title:"Create Permission Group",open:lt,onCancel:()=>{dt(!1),kt("")},onOk:wr,confirmLoading:_s.isPending,okButtonProps:{"data-testid":"modal-create-permission-group-ok"},cancelButtonProps:{"data-testid":"modal-create-permission-group-cancel"},children:e.jsx(Te,{placeholder:"Enter group name",value:vt,onChange:e=>kt(e.target.value),"data-testid":"system-permission-group-name-input",onPressEnter:wr,autoComplete:"off"})}),e.jsx(Ue,{title:`Manage Permissions - ${gt?.permissionGroupName}`,open:ct,onCancel:()=>{ut(!1),ht(null),Pt("")},footer:null,className:P.Large,children:e.jsx(Ve,{items:[{key:"current",label:"Current Permissions",children:e.jsx(Re,{children:e.jsx(Ke,{dataSource:Gs?.permissions||[],renderItem:t=>e.jsx(Ke.Item,{actions:[e.jsx(Fe,{title:i("common:actions.remove"),children:e.jsx(Se,{type:"primary",danger:!0,size:"small",onClick:()=>(async e=>{if(gt)try{await Ks.mutateAsync({permissionGroupName:gt.permissionGroupName,permissionName:e})}catch(t){}})(t),loading:Ks.isPending,"data-testid":`permission-remove-button-${t}`,"aria-label":i("common:actions.remove")})},"remove")],children:e.jsx(Ke.Item.Meta,{avatar:e.jsx(S,{}),title:t})}),locale:{emptyText:"No permissions assigned"}})})},{key:"add",label:"Add Permissions",children:e.jsx(Ae,{direction:"vertical",style:{width:"100%"},size:16,children:e.jsxs(Ae,{style:{width:"100%"},children:[e.jsx(Me,{placeholder:"Select permission to add",style:{width:"100%"},value:Nt,onChange:Pt,showSearch:!0,filterOption:(e,t)=>String(t?.label??"").toLowerCase().includes(e.toLowerCase()),"data-testid":"permission-select-add",children:Pr.map(t=>e.jsx(Me.Option,{value:t.name,label:t.name,disabled:Gs?.permissions?.includes(t.name),"data-testid":`permission-option-${t.name}`,children:t.name},t.name))}),e.jsx(Fe,{title:i("system:actions.addPermission"),children:e.jsx(Se,{type:"primary",onClick:async()=>{if(gt&&Nt)try{await $s.mutateAsync({permissionGroupName:gt.permissionGroupName,permissionName:Nt}),Pt("")}catch(e){}},loading:$s.isPending,disabled:!Nt,"data-testid":"permission-add-button","aria-label":i("system:actions.addPermission"),icon:e.jsx(Z,{})})})]})})}]})}),e.jsx(Ue,{title:`Assign User to ${gt?.permissionGroupName}`,open:mt,onCancel:()=>{pt(!1),ht(null),St("")},onOk:async()=>{if(gt&&At)try{await Hs.mutateAsync({userEmail:At,permissionGroupName:gt.permissionGroupName}),pt(!1),St("")}catch(e){}},confirmLoading:Hs.isPending,okButtonProps:{"data-testid":"modal-assign-user-ok"},cancelButtonProps:{"data-testid":"modal-assign-user-cancel"},children:e.jsx(Me,{placeholder:"Select user",style:{width:"100%"},value:At,onChange:St,showSearch:!0,filterOption:(e,t)=>(t?.label??"").toLowerCase().includes(e.toLowerCase()),options:Ps?.users?.map(e=>({value:e.value,label:e.label,disabled:"active"!==e.status}))||[],"data-testid":"assign-user-select"})}),e.jsx(Ue,{title:"Create User",open:ze,onCancel:()=>{Je(!1),br.reset()},footer:null,children:e.jsx(xt,{form:br,fields:[{name:"newUserEmail",label:"Email",type:"email",placeholder:"user@example.com",required:!0},{name:"newUserPassword",label:"Password",type:"password",placeholder:"Enter password",required:!0}],onSubmit:async e=>{try{await Ls.mutateAsync({email:e.newUserEmail,password:e.newUserPassword}),Je(!1),br.reset()}catch(t){}},submitText:"Create",cancelText:"Cancel",onCancel:()=>{Je(!1),br.reset()},loading:Ls.isPending})}),e.jsx(Ue,{title:`Assign Permissions - ${et.user?.userEmail}`,open:et.open,onCancel:()=>{tt({open:!1}),ot("")},onOk:async()=>{if(et.user&&at)try{await zs.mutateAsync({userEmail:et.user.userEmail,permissionGroupName:at}),tt({open:!1}),ot("")}catch(e){}},okText:"Assign",confirmLoading:zs.isPending,okButtonProps:{"data-testid":"modal-assign-permissions-ok"},cancelButtonProps:{"data-testid":"modal-assign-permissions-cancel"},children:e.jsx(Pe,{layout:"vertical",children:e.jsx(Pe.Item,{label:"Permission Group",children:e.jsx(Me,{value:at,onChange:ot,placeholder:"Select permission group",options:Os?.map(e=>({value:e.permissionGroupName,label:`${e.permissionGroupName} (${e.userCount} users, ${e.permissionCount} permissions)`})),allowClear:!0,"data-testid":"user-permission-group-select"})})})}),e.jsx(oe,{open:v,onCancel:()=>C(!1),onSave:async(e,t)=>{await Ss.mutateAsync({companyVault:e,vaultVersion:t}),C(!1)},entityType:"COMPANY",title:i("company.modalTitle"),initialVault:As?.vault||"{}",initialVersion:As?.vaultVersion||1,loading:Ss.isPending}),e.jsx(oe,{open:k,onCancel:()=>N(!1),onSave:async(e,t)=>{N(!1)},entityType:"USER",title:i("personal.modalTitle"),initialVault:"{}",initialVersion:1,loading:!1}),e.jsx(Ue,{title:`Manage Team Members - ${Et?.teamName}`,open:Tt,onCancel:()=>{Mt(!1),It(null),Ft("")},footer:null,className:P.Large,children:e.jsx(Ve,{items:[{key:"current",label:"Current Members",children:e.jsx(Re,{children:e.jsx(Ke,{dataSource:Ws,renderItem:t=>e.jsx(Ke.Item,{actions:[e.jsx(De,{title:"Remove Team Member",description:`Are you sure you want to remove "${t.userEmail}" from this team?`,onConfirm:()=>(async e=>{if(Et)try{await rr.mutateAsync({teamName:Et.teamName,removeUserEmail:e})}catch(t){}})(t.userEmail),okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},children:e.jsx(Fe,{title:i("common:actions.remove"),children:e.jsx(Se,{type:"primary",danger:!0,size:"small",loading:rr.isPending,icon:e.jsx(z,{}),"aria-label":i("common:actions.remove")})})},"remove")],children:e.jsx(Ke.Item.Meta,{avatar:e.jsx(G,{}),title:t.userEmail,description:e.jsxs(Ae,{size:"small",children:[t.isMember&&e.jsx(Ie,{color:"green",children:"Member"}),t.hasAccess&&e.jsx(Ie,{color:"blue",children:"Has Access"})]})})}),locale:{emptyText:"No members in this team"}})})},{key:"add",label:"Add Members",children:e.jsx(Ae,{direction:"vertical",style:{width:"100%"},size:16,children:e.jsxs(Ae,{style:{width:"100%"},children:[e.jsx(Me,{placeholder:"Select user to add",style:{width:"100%"},value:Dt,onChange:Ft,showSearch:!0,filterOption:(e,t)=>String(t?.label??"").toLowerCase().includes(e.toLowerCase()),options:Ps?.users?.filter(e=>"active"===e.status)?.map(e=>({value:e.value,label:e.label,disabled:Ws.some(t=>t.userEmail===e.value&&t.isMember)}))||[]}),e.jsx(Fe,{title:i("system:actions.addMember"),children:e.jsx(Se,{type:"primary",onClick:async()=>{if(Et&&Dt)try{await sr.mutateAsync({teamName:Et.teamName,newUserEmail:Dt}),Ft("")}catch(e){}},loading:sr.isPending,disabled:!Dt,icon:e.jsx(Z,{}),"aria-label":i("system:actions.addMember")})})]})})}]})}),"expert"===p&&e.jsxs(e.Fragment,{children:[e.jsx(vs,{level:3,style:{marginTop:48,marginBottom:24},children:o("regionsInfrastructure.title")}),e.jsx(Re,{children:e.jsxs(Be,{gutter:[24,24],children:[e.jsx(Le,{span:24,children:e.jsx(Ne,{title:e.jsxs(Ae,{children:[e.jsx("span",{style:{fontSize:T.FONT_SIZE.BASE,fontWeight:T.FONT_WEIGHT.MEDIUM},children:u("regions.title")}),e.jsx("span",{style:{fontSize:14,color:"#666"},children:u("regions.selectRegionPrompt")})]}),loading:nr,data:ir,columns:Sr,rowKey:"regionName",searchPlaceholder:u("regions.searchRegions"),"data-testid":"system-region-table",actions:e.jsx(Fe,{title:u("regions.createRegion"),children:e.jsx(Se,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>vr("region","create"),"data-testid":"system-create-region-button","aria-label":u("regions.createRegion")})}),rowSelection:{type:"radio",selectedRowKeys:Bt?[Bt]:[],onChange:e=>{Lt(e[0]||null)}},onRow:e=>({onClick:()=>Lt(e.regionName),className:Bt===e.regionName?"selected-row":"",style:{cursor:"pointer"}})})}),e.jsx(Le,{span:24,children:e.jsxs(Re,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(vs,{level:4,style:{margin:0},children:Bt?u("regions.bridgesInRegion",{region:Bt}):u("bridges.title")}),!Bt&&e.jsx(Cs,{type:"secondary",style:{fontSize:14},children:u("regions.selectRegionToView")})]}),Bt&&e.jsx(Fe,{title:u("bridges.createBridge"),children:e.jsx(Se,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>{vr("bridge","create",{regionName:Bt})},"data-testid":"system-create-bridge-button","aria-label":u("bridges.createBridge")})})]}),Bt?mr?e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(qe,{size:"large"}),e.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:i("common:general.loading")})]}):e.jsx(Ze,{columns:Tr,dataSource:gr,rowKey:"bridgeName",pagination:{total:gr.length||0,pageSize:10,showSizeChanger:!0,showTotal:e=>u("bridges.totalBridges",{total:e})},locale:{emptyText:u("bridges.noBridges")},"data-testid":"system-bridge-table"}):e.jsx(He,{image:He.PRESENTED_IMAGE_SIMPLE,description:u("regions.selectRegionPrompt"),style:{padding:"40px 0"}})]})})]})})]}),e.jsx(Ue,{title:`Bridge Token - ${Rt.bridge?.bridgeName||""}`,open:Rt.open,onCancel:()=>zt({open:!1}),footer:[e.jsx(Se,{onClick:()=>zt({open:!1}),children:"Close"},"close")],className:P.Medium,children:(()=>{const t=Rt.bridge;if(!t)return null;const s=t.bridgeCredentials;return 0===t.hasAccess?e.jsx(Ge,{message:"Access Denied",description:"You don't have the necessary permissions to view bridge credentials. Please contact an administrator.",type:"error",showIcon:!0}):s?e.jsxs(Ae,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(Ge,{message:"Bridge Authentication Token",description:"This token is used by the bridge to authenticate its first connection to the system. After the first successful use, the bridge will receive a new token for subsequent requests. If this token has already been used, you'll need to use 'Reset Auth' to generate new credentials.",type:"warning",showIcon:!0}),e.jsxs("div",{children:[e.jsx(Cs,{strong:!0,children:"Token:"}),e.jsxs(Ae.Compact,{style:{marginTop:8,width:"100%"},children:[e.jsx(Te,{value:s,readOnly:!0,style:{width:"100%"},autoComplete:"off"}),e.jsx(Se,{icon:e.jsx(je,{}),onClick:()=>{navigator.clipboard.writeText(s),Oe.success("Token copied to clipboard")}})]})]}),e.jsx(Ge,{message:"Important",description:"Keep this token secure. It provides access to process queue items on behalf of your organization. If you suspect the token has been compromised, use 'Reset Auth' immediately.",type:"info",showIcon:!0})]}):e.jsx(Ge,{message:"No Bridge Token Available",description:"Bridge credentials are not available. This could be because you don't have the necessary permissions, or the bridge credentials vault has not been created. Administrators can use 'Reset Auth' to generate new credentials.",type:"info",showIcon:!0})})()}),e.jsx(me,{open:Ut.open,onCancel:()=>Gt({open:!1,entityType:null,entityIdentifier:null}),entityType:Ut.entityType,entityIdentifier:Ut.entityIdentifier,entityName:Ut.entityName}),e.jsx(le,{open:qt.open,onCancel:Cr,resourceType:qt.resourceType,mode:qt.mode,existingData:qt.data||Vt,onSubmit:async e=>{try{switch(qt.resourceType){case"team":if("create"===qt.mode)await Ys.mutateAsync(e);else if("edit"===qt.mode){e.teamName!==Vt.teamName&&await Js.mutateAsync({currentTeamName:Vt.teamName,newTeamName:e.teamName});const t=e.teamVault;t&&t!==Vt.vaultContent&&await tr.mutateAsync({teamName:e.teamName||Vt.teamName,teamVault:t,vaultVersion:Vt.vaultVersion+1})}break;case"region":if("create"===qt.mode)await or.mutateAsync(e);else if("edit"===qt.mode){e.regionName!==Vt.regionName&&await lr.mutateAsync({currentRegionName:Vt.regionName,newRegionName:e.regionName});const t=e.regionVault;t&&t!==Vt.vaultContent&&await cr.mutateAsync({regionName:e.regionName||Vt.regionName,regionVault:t,vaultVersion:Vt.vaultVersion+1})}break;case"bridge":if("create"===qt.mode)await hr.mutateAsync(e);else if("edit"===qt.mode){e.bridgeName!==Vt.bridgeName&&await yr.mutateAsync({regionName:Vt.regionName,currentBridgeName:Vt.bridgeName,newBridgeName:e.bridgeName});const t=e.bridgeVault;t&&t!==Vt.vaultContent&&await fr.mutateAsync({regionName:e.regionName||Vt.regionName,bridgeName:e.bridgeName||Vt.bridgeName,bridgeVault:t,vaultVersion:Vt.vaultVersion+1})}}Cr()}catch(t){}},onUpdateVault:"edit"===qt.mode?async(e,t)=>{if(Vt)try{switch(qt.resourceType){case"team":await tr.mutateAsync({teamName:Vt.teamName,teamVault:e,vaultVersion:t});break;case"region":await cr.mutateAsync({regionName:Vt.regionName,regionVault:e,vaultVersion:t});break;case"bridge":await fr.mutateAsync({regionName:Vt.regionName,bridgeName:Vt.bridgeName,bridgeVault:e,vaultVersion:t})}}catch(s){}}:void 0,isSubmitting:Ys.isPending||Js.isPending||or.isPending||lr.isPending||hr.isPending||yr.isPending,isUpdatingVault:tr.isPending||cr.isPending||fr.isPending}),"expert"===p&&e.jsxs(e.Fragment,{children:[e.jsxs(vs,{level:3,style:{marginTop:48,marginBottom:24,color:"#ff4d4f"},children:[e.jsx(E,{})," ",o("dangerZone.title")]}),e.jsx(Re,{style:{borderColor:"#ff4d4f"},children:e.jsxs(Ae,{direction:"vertical",size:24,style:{width:"100%"},children:[e.jsxs(Be,{gutter:[16,16],align:"middle",children:[e.jsx(Le,{xs:24,lg:16,children:e.jsxs(Ae,{direction:"vertical",size:8,children:[e.jsx(vs,{level:5,style:{margin:0},children:o("dangerZone.blockUserRequests.title")}),e.jsx(Cs,{type:"secondary",children:o("dangerZone.blockUserRequests.description")})]})}),e.jsx(Le,{xs:24,lg:8,style:{textAlign:"right"},children:e.jsxs(Ae,{children:[e.jsx(De,{title:o("dangerZone.blockUserRequests.confirmBlock.title"),description:e.jsxs(Ae,{direction:"vertical",children:[e.jsx(Cs,{children:o("dangerZone.blockUserRequests.confirmBlock.description")}),e.jsxs("ul",{style:{margin:"8px 0",paddingLeft:20},children:[e.jsx("li",{children:o("dangerZone.blockUserRequests.confirmBlock.effect1")}),e.jsx("li",{children:o("dangerZone.blockUserRequests.confirmBlock.effect2")}),e.jsx("li",{children:o("dangerZone.blockUserRequests.confirmBlock.effect3")})]}),e.jsx(Cs,{strong:!0,children:o("dangerZone.blockUserRequests.confirmBlock.confirm")})]}),onConfirm:()=>Ts.mutate(!0),okText:o("dangerZone.blockUserRequests.confirmBlock.okText"),cancelText:m("general.cancel"),okButtonProps:{danger:!0},children:e.jsx(Fe,{title:o("dangerZone.blockUserRequests.blockButton"),children:e.jsx(Se,{type:"primary",danger:!0,icon:e.jsx(q,{}),loading:Ts.isPending,"aria-label":o("dangerZone.blockUserRequests.blockButton")})})}),e.jsx(De,{title:o("dangerZone.blockUserRequests.confirmUnblock.title"),description:o("dangerZone.blockUserRequests.confirmUnblock.description"),onConfirm:()=>Ts.mutate(!1),okText:o("dangerZone.blockUserRequests.confirmUnblock.okText"),cancelText:m("general.cancel"),children:e.jsx(Fe,{title:o("dangerZone.blockUserRequests.unblockButton"),children:e.jsx(Se,{type:"primary",icon:e.jsx(yt,{}),loading:Ts.isPending,"aria-label":o("dangerZone.blockUserRequests.unblockButton")})})})]})})]}),e.jsx("hr",{style:{margin:0,borderColor:"#f0f0f0"}}),e.jsxs(Be,{gutter:[16,16],align:"middle",children:[e.jsx(Le,{xs:24,lg:16,children:e.jsxs(Ae,{direction:"vertical",size:8,children:[e.jsx(vs,{level:5,style:{margin:0},children:o("dangerZone.exportVaults.title")}),e.jsx(Cs,{type:"secondary",children:o("dangerZone.exportVaults.description")})]})}),e.jsx(Le,{xs:24,lg:8,style:{textAlign:"right"},children:e.jsx(Fe,{title:o("dangerZone.exportVaults.button"),children:e.jsx(Se,{type:"primary",icon:e.jsx(ve,{}),onClick:async()=>{try{const e=await Ms.refetch();if(e.data){const t=(new Date).toISOString().replace(/[:.]/g,"-").split("T")[0],{allVaults:s,bridgesWithRequestToken:r,...a}=e.data,n={exportDate:(new Date).toISOString(),vaults:a,bridgesWithRequestToken:r,metadata:{totalVaults:s.length,vaultTypes:Object.keys(a).map(e=>({type:e,count:a[e]?.length||0}))}},i=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),l=URL.createObjectURL(i),d=document.createElement("a");d.href=l,d.download=`company-vaults-export-${t}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),F("success",o("dangerZone.exportVaults.success"))}}catch(e){F("error",o("dangerZone.exportVaults.error"))}},loading:Ms.isFetching,"data-testid":"system-export-vaults-button","aria-label":o("dangerZone.exportVaults.button")})})})]}),e.jsx("hr",{style:{margin:0,borderColor:"#f0f0f0"}}),e.jsxs(Be,{gutter:[16,16],align:"middle",children:[e.jsx(Le,{xs:24,lg:16,children:e.jsxs(Ae,{direction:"vertical",size:8,children:[e.jsx(vs,{level:5,style:{margin:0},children:o("dangerZone.exportData.title")}),e.jsx(Cs,{type:"secondary",children:o("dangerZone.exportData.description")})]})}),e.jsx(Le,{xs:24,lg:8,style:{textAlign:"right"},children:e.jsx(Fe,{title:o("dangerZone.exportData.button"),children:e.jsx(Se,{type:"primary",icon:e.jsx(Ce,{}),onClick:async()=>{try{const e=await Is.refetch();if(e.data){const t=(new Date).toISOString().replace(/[:.]/g,"-").split("T")[0],s=e.data,r=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download=`company-data-export-${t}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),F("success",o("dangerZone.exportData.success"))}}catch(e){F("error",o("dangerZone.exportData.error"))}},loading:Is.isFetching,"data-testid":"system-export-data-button","aria-label":o("dangerZone.exportData.button")})})})]}),e.jsx("hr",{style:{margin:0,borderColor:"#f0f0f0"}}),e.jsxs(Be,{gutter:[16,16],align:"middle",children:[e.jsx(Le,{xs:24,lg:16,children:e.jsxs(Ae,{direction:"vertical",size:8,children:[e.jsx(vs,{level:5,style:{margin:0},children:o("dangerZone.importData.title")}),e.jsx(Cs,{type:"secondary",children:o("dangerZone.importData.description")})]})}),e.jsx(Le,{xs:24,lg:8,style:{textAlign:"right"},children:e.jsx(Fe,{title:o("dangerZone.importData.button"),children:e.jsx(Se,{type:"primary",danger:!0,icon:e.jsx(ke,{}),onClick:()=>os(!0),"data-testid":"system-import-data-button","aria-label":o("dangerZone.importData.button")})})})]}),e.jsx("hr",{style:{margin:0,borderColor:"#f0f0f0"}}),e.jsxs(Be,{gutter:[16,16],align:"middle",children:[e.jsx(Le,{xs:24,lg:16,children:e.jsxs(Ae,{direction:"vertical",size:8,children:[e.jsx(vs,{level:5,style:{margin:0},children:o("dangerZone.updateMasterPassword.title")}),e.jsx(Cs,{type:"secondary",children:o("dangerZone.updateMasterPassword.description")}),e.jsxs("ul",{style:{margin:"8px 0 0 20px",fontSize:14,color:"rgba(0, 0, 0, 0.45)"},children:[e.jsx("li",{children:o("dangerZone.updateMasterPassword.effect1")}),e.jsx("li",{children:o("dangerZone.updateMasterPassword.effect2")}),e.jsx("li",{children:o("dangerZone.updateMasterPassword.effect3")})]}),e.jsx(Cs,{type:"secondary",strong:!0,style:{display:"block",marginTop:8},children:o("dangerZone.updateMasterPassword.warning")})]})}),e.jsx(Le,{xs:24,lg:8,style:{textAlign:"right"},children:e.jsx(Fe,{title:o("dangerZone.updateMasterPassword.button"),children:e.jsx(Se,{type:"primary",danger:!0,icon:e.jsx(S,{}),onClick:()=>Ht(!0),"data-testid":"system-update-master-password-button","aria-label":o("dangerZone.updateMasterPassword.button")})})})]})]})})]}),e.jsx(Ue,{title:o(g?"dangerZone.updateMasterPassword.modal.title":"dangerZone.updateMasterPassword.modal.operationCreate"),open:Kt,onCancel:()=>{Ht(!1),Xt.resetFields(),Yt(Qt)},footer:null,className:P.Medium,children:e.jsxs(Pe,{layout:"vertical",form:Xt,onFinish:async e=>{if(!Es.isPending)try{const r=await Ms.refetch();if(!r.data||!r.data.allVaults)return void F("error",o("dangerZone.updateMasterPassword.error.fetchVaults"));const a=[],n="remove"===Wt?"":e.password;for(const e of r.data.allVaults)if(e.decryptedVault&&e.credential&&e.vaultName)try{let s=e.decryptedVault;if(g&&"create"!==Wt)try{s.match(/^[A-Za-z0-9+/]+=*$/)&&(s=await V(s,g))}catch(t){}let r=s;r="remove"===Wt?s:await $(s,n),a.push({credential:e.credential,name:e.vaultName,content:r,version:e.version||1})}catch(s){F("error",`Failed to process vault ${e.vaultName}`)}if(0===a.length)return void F("error",o("dangerZone.updateMasterPassword.error.noVaults"));await Es.mutateAsync(a),await Ts.mutateAsync(!1),await _.setMasterPassword("remove"===Wt?null:n),h("remove"===Wt?null:n),Ht(!1),Xt.resetFields(),es(Wt),Yt(Qt),as(60),ss(!0)}catch(s){}},children:[g&&e.jsx(Pe.Item,{label:o("dangerZone.updateMasterPassword.modal.operationType"),style:{marginBottom:24},children:e.jsx(Xe.Group,{value:Wt,onChange:e=>{Yt(e.target.value),Xt.resetFields(["password","confirmPassword"])},children:e.jsxs(Ae,{direction:"vertical",children:[e.jsx(Xe,{value:"update",children:o("dangerZone.updateMasterPassword.modal.operationUpdate")}),e.jsx(Xe,{value:"remove",children:o("dangerZone.updateMasterPassword.modal.operationRemove")})]})})}),e.jsx(Ge,{message:e.jsxs(e.Fragment,{children:["⚠️"," ",o("dangerZone.updateMasterPassword.modal.warningTitle").replace("⚠️ ","")]}),description:e.jsxs(Ae,{direction:"vertical",size:8,children:[e.jsx(Cs,{children:o(`dangerZone.updateMasterPassword.modal.warningDescription${Wt.charAt(0).toUpperCase()+Wt.slice(1)}`)}),e.jsxs("ul",{style:{margin:"4px 0",paddingLeft:20},children:[e.jsx("li",{children:o("dangerZone.updateMasterPassword.modal.warningEffect1")}),e.jsx("li",{children:o("dangerZone.updateMasterPassword.modal.warningEffect2")}),e.jsx("li",{children:o(`dangerZone.updateMasterPassword.modal.warningEffect3${Wt.charAt(0).toUpperCase()+Wt.slice(1)}`)}),"remove"!==Wt&&e.jsx("li",{children:o("dangerZone.updateMasterPassword.modal.warningEffect4")})]}),e.jsx(Cs,{strong:!0,children:o("dangerZone.updateMasterPassword.modal.warningPermanent")}),e.jsx(Cs,{strong:!0,style:{color:"#ff4d4f"},children:o("remove"===Wt?"dangerZone.updateMasterPassword.modal.warningSecureRemove":"dangerZone.updateMasterPassword.modal.warningSecure")})]}),type:"warning",showIcon:!0,style:{marginBottom:24}}),"remove"!==Wt&&e.jsxs(e.Fragment,{children:[e.jsx(Pe.Item,{label:o("dangerZone.updateMasterPassword.modal.newPasswordLabel"),name:"password",rules:[{required:!0,message:o("dangerZone.updateMasterPassword.modal.newPasswordRequired")},{min:12,message:o("dangerZone.updateMasterPassword.modal.newPasswordMinLength")},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,message:o("dangerZone.updateMasterPassword.modal.newPasswordPattern")}],children:e.jsx(Te.Password,{placeholder:o("dangerZone.updateMasterPassword.modal.newPasswordPlaceholder"),size:"large",autoComplete:"new-password"})}),e.jsx(Pe.Item,{label:o("dangerZone.updateMasterPassword.modal.confirmPasswordLabel"),name:"confirmPassword",dependencies:["password"],rules:[{required:!0,message:o("dangerZone.updateMasterPassword.modal.confirmPasswordRequired")},({getFieldValue:e})=>({validator:(t,s)=>s&&e("password")!==s?Promise.reject(new Error(o("dangerZone.updateMasterPassword.modal.confirmPasswordMatch"))):Promise.resolve()})],children:e.jsx(Te.Password,{placeholder:o("dangerZone.updateMasterPassword.modal.confirmPasswordPlaceholder"),size:"large",autoComplete:"new-password"})})]}),e.jsx(Ge,{message:m("general.important"),description:o("dangerZone.updateMasterPassword.modal.importantNote"+("create"===Wt?"Create":"remove"===Wt?"Remove":"")),type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsx(Pe.Item,{style:{marginBottom:0},children:e.jsxs(Ae,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(Se,{onClick:()=>{Ht(!1),Xt.resetFields(),Yt(Qt)},"data-testid":"system-master-password-cancel-button",children:o("dangerZone.updateMasterPassword.modal.cancel")}),e.jsx(Se,{type:"primary",danger:!0,htmlType:"submit",loading:Es.isPending,disabled:Es.isPending,"data-testid":"system-master-password-submit-button",children:o(`dangerZone.updateMasterPassword.modal.submit${Wt.charAt(0).toUpperCase()+Wt.slice(1)}`)})]})})]})}),e.jsx(Ue,{title:"Reset Bridge Authorization",open:Zt.open,onCancel:()=>Ot({open:!1,bridgeName:"",isCloudManaged:!1}),footer:[e.jsx(Se,{onClick:()=>Ot({open:!1,bridgeName:"",isCloudManaged:!1}),children:"Cancel"},"cancel"),e.jsx(Se,{type:"primary",danger:!0,loading:jr.isPending,onClick:async()=>{try{await jr.mutateAsync({bridgeName:Zt.bridgeName,isCloudManaged:Zt.isCloudManaged}),Ot({open:!1,bridgeName:"",isCloudManaged:!1})}catch(e){}},children:"Reset Authorization"},"reset")],children:e.jsxs(Ae,{direction:"vertical",style:{width:"100%"},size:16,children:[e.jsx(Ge,{message:"Warning",description:`Are you sure you want to reset authorization for bridge "${Zt.bridgeName}"? This will generate new credentials.`,type:"warning",showIcon:!0}),e.jsx(Pe,{layout:"vertical",children:e.jsx(Pe.Item,{label:"Cloud Management",help:"Check this box if this bridge should be managed by cloud services. Only Global Bridges can be cloud managed.",children:e.jsx(Qe,{checked:Zt.isCloudManaged,onChange:e=>Ot(t=>({...t,isCloudManaged:e.target.checked})),children:"Enable Cloud Management"})})})]})}),e.jsx(Ue,{open:ts,closable:!1,footer:null,className:P.Medium,children:e.jsx($e,{status:"success",title:o(`dangerZone.updateMasterPassword.success.title${Jt.charAt(0).toUpperCase()+Jt.slice(1)}`),subTitle:e.jsxs(Ae,{direction:"vertical",size:24,style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(_e.Paragraph,{children:o("dangerZone.updateMasterPassword.success.nextSteps")}),e.jsxs("ol",{style:{textAlign:"left",paddingLeft:20},children:[e.jsx("li",{children:o("dangerZone.updateMasterPassword.success.step1")}),e.jsx("li",{children:o("dangerZone.updateMasterPassword.success.step2"+("remove"===Jt?"Remove":""))}),e.jsx("li",{children:o("dangerZone.updateMasterPassword.success.step3"+("remove"===Jt?"Remove":""))}),e.jsx("li",{children:o("dangerZone.updateMasterPassword.success.step4"+("remove"===Jt?"Remove":""))})]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(_e.Title,{level:4,children:o("dangerZone.updateMasterPassword.success.redirecting")}),e.jsx(_e.Title,{level:1,type:"danger",children:rs}),e.jsx(_e.Text,{type:"secondary",children:o("dangerZone.updateMasterPassword.success.seconds")})]}),e.jsx(Se,{type:"primary",size:"large",block:!0,onClick:()=>{f(B()),j("/login")},children:o("dangerZone.updateMasterPassword.success.loginNow")})]})})}),e.jsx(Ue,{title:"Change Password",open:K,onCancel:()=>{H(!1),Ee.resetFields()},footer:null,className:P.Medium,children:e.jsxs(Pe,{form:Ee,layout:"vertical",onFinish:async e=>{if(y?.email)try{await Zs.mutateAsync({userEmail:y.email,newPassword:e.newPassword}),H(!1),Ee.resetFields();let t=3;const s=Ue.success({title:"Password Changed Successfully",content:`Your password has been changed. You will be logged out in ${t} seconds...`,okText:"Logout Now",onOk:()=>{f(B()),j("/login")}}),r=setInterval(()=>{t--,s.update({content:`Your password has been changed. You will be logged out in ${t} seconds...`}),0===t&&(clearInterval(r),s.destroy(),f(B()),j("/login"))},1e3)}catch(t){}},autoComplete:"off",children:[e.jsx(Ge,{message:"Password Requirements",description:e.jsxs("ul",{style:{margin:"8px 0 0 20px",fontSize:14},children:[e.jsx("li",{children:"At least 8 characters long"}),e.jsx("li",{children:"Contains at least one uppercase letter"}),e.jsx("li",{children:"Contains at least one lowercase letter"}),e.jsx("li",{children:"Contains at least one number"}),e.jsx("li",{children:"Contains at least one special character (@$!%*?&)"})]}),type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsx(Pe.Item,{label:"New Password",name:"newPassword",rules:[{required:!0,message:"Please enter your new password"},{min:8,message:"Password must be at least 8 characters long"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,message:"Password must contain uppercase, lowercase, number and special character"}],children:e.jsx(Te.Password,{placeholder:"Enter new password",size:"large",autoComplete:"new-password"})}),e.jsx(Pe.Item,{label:"Confirm New Password",name:"confirmPassword",dependencies:["newPassword"],rules:[{required:!0,message:"Please confirm your new password"},({getFieldValue:e})=>({validator:(t,s)=>s&&e("newPassword")!==s?Promise.reject(new Error("Passwords do not match")):Promise.resolve()})],children:e.jsx(Te.Password,{placeholder:"Confirm new password",size:"large",autoComplete:"new-password"})}),e.jsx(Pe.Item,{style:{marginBottom:0,marginTop:24},children:e.jsxs(Ae,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(Se,{onClick:()=>{H(!1),Ee.resetFields()},children:"Cancel"}),e.jsx(Se,{type:"primary",htmlType:"submit",loading:Zs.isPending,children:"Change Password"})]})})]})}),e.jsx(us,{open:X,onCancel:()=>Q(!1)}),e.jsx(Ue,{title:o("dangerZone.importData.modal.title"),open:is,onCancel:()=>{os(!1),ds(null),Ns.resetFields(),ks("skip")},footer:null,className:P.Medium,children:e.jsxs(Pe,{form:Ns,layout:"vertical",onFinish:async e=>{if(ls)try{const e=await ls.text();try{JSON.parse(e)}catch{return void F("error",o("dangerZone.importData.modal.invalidFile"))}await Ds.mutateAsync({companyDataJson:e,importMode:cs}),os(!1),ds(null),Ns.resetFields()}catch(t){}else F("error",o("dangerZone.importData.modal.fileRequired"))},children:[e.jsx(Ge,{message:o("dangerZone.importData.modal.warning"),description:o("dangerZone.importData.modal.warningText"),type:"warning",showIcon:!0,style:{marginBottom:24}}),e.jsx(Pe.Item,{label:o("dangerZone.importData.modal.selectFile"),required:!0,children:e.jsx(We,{beforeUpload:e=>(ds(e),!1),onRemove:()=>ds(null),maxCount:1,accept:".json",children:e.jsx(Se,{icon:e.jsx(de,{}),children:ls?ls.name:o("dangerZone.importData.modal.selectFile")})})}),e.jsx(Pe.Item,{label:o("dangerZone.importData.modal.importMode"),children:e.jsx(Xe.Group,{value:cs,onChange:e=>ks(e.target.value),children:e.jsxs(Ae,{direction:"vertical",children:[e.jsx(Xe,{value:"skip",children:e.jsxs(Ae,{direction:"vertical",size:0,children:[e.jsx(Cs,{strong:!0,children:o("dangerZone.importData.modal.modeSkip")}),e.jsx(Cs,{type:"secondary",style:{fontSize:12},children:o("dangerZone.importData.modal.modeSkipDesc")})]})}),e.jsx(Xe,{value:"override",children:e.jsxs(Ae,{direction:"vertical",size:0,children:[e.jsx(Cs,{strong:!0,children:o("dangerZone.importData.modal.modeOverride")}),e.jsx(Cs,{type:"secondary",style:{fontSize:12},children:o("dangerZone.importData.modal.modeOverrideDesc")})]})})]})})}),e.jsx(Pe.Item,{style:{marginBottom:0,marginTop:32},children:e.jsxs(Ae,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(Se,{onClick:()=>{os(!1),ds(null),Ns.resetFields(),ks("skip")},children:o("dangerZone.importData.modal.cancel")}),e.jsx(Se,{type:"primary",htmlType:"submit",loading:Ds.isPending,disabled:!ls,children:o("dangerZone.importData.modal.import")})]})})]})})]})};export{ks as default};

import{f as e,g as t}from"./chunk-DZuWtVpy.js";import{r as a,a as r,b as s,c as i,u as o,m as d,s as n,D as c,i as l,I as u,H as m,g as f,U as p,K as y,Y as x,t as j}from"../index-DRw3QGwP.js";import{j as h}from"./chunk-DXw4Pgvm.js";import{a as g,E as v}from"./chunk-B_NpgxeU.js";import{C as b,D as S}from"./chunk-BBZh1mru.js";import{D as w}from"./chunk-ByBA-QfE.js";import{C as k}from"./chunk-VqVOANjS.js";import{F as C}from"./chunk-Bi9uqbqU.js";import{F as R}from"./chunk-BfcM5WvO.js";import{a as O}from"./chunk-xSw6NTs2.js";import{u as L}from"./chunk-CM3g5OHp.js";import{a as I,g as T,T as _,M as z,p as A,i as D,D as M,B as $,w as B,W as U}from"./chunk-CSjZqX98.js";var N,E,H,P={exports:{}},X={},F={};function V(){if(N)return F;N=1,Object.defineProperty(F,"__esModule",{value:!0});return F.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},F}function G(){if(E)return X;E=1;var t=a().default,o=r().default;Object.defineProperty(X,"__esModule",{value:!0}),X.default=void 0;var d=o(s()),n=t(e()),c=o(V()),l=o(i()),u=function(e,t){return n.createElement(l.default,(0,d.default)({},e,{ref:t,icon:c.default}))},m=n.forwardRef(u);return X.default=m,X}function J(){return H||(H=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a;const r=(a=G())&&a.__esModule?a:{default:a};t.default=r,e.exports=r}(P,P.exports)),P.exports}const Z=t(J());var K,W,Y,q={exports:{}},Q={},ee={};function te(){if(K)return ee;K=1,Object.defineProperty(ee,"__esModule",{value:!0});return ee.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"},ee}function ae(){if(W)return Q;W=1;var t=a().default,o=r().default;Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var d=o(s()),n=t(e()),c=o(te()),l=o(i()),u=function(e,t){return n.createElement(l.default,(0,d.default)({},e,{ref:t,icon:c.default}))},m=n.forwardRef(u);return Q.default=m,Q}function re(){return Y||(Y=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a;const r=(a=ae())&&a.__esModule?a:{default:a};t.default=r,e.exports=r}(q,q.exports)),q.exports}const se=t(re()),{Text:ie}=_,oe=({open:e,onCancel:t,entityType:a,entityIdentifier:r,entityName:s})=>{const{t:i}=L(["resources","common"]),_=o(),{data:N,isLoading:E,error:H}=g(a,r,e),P=e=>{switch(e){case"plus-circle":return h.jsx(Z,{style:{color:"#52c41a"}});case"edit":return h.jsx(v,{style:{color:"#1890ff"}});case"trash":return h.jsx(j,{style:{color:"#ff4d4f"}});case"lock":return h.jsx(x,{style:{color:"#fa8c16"}});case"key":return h.jsx(y,{style:{color:"#722ed1"}});case"users":return h.jsx(p,{style:{color:"#13c2c2"}});case"check-circle":return h.jsx(f,{style:{color:"#52c41a"}});case"x-circle":return h.jsx(k,{style:{color:"#ff4d4f"}});case"database":return h.jsx(S,{style:{color:"#1890ff"}});case"hdd":return h.jsx(m,{style:{color:"#fa8c16"}});case"copy":return h.jsx(b,{style:{color:"#722ed1"}});default:return h.jsx(u,{style:{color:"#1890ff"}})}},X=e=>{switch(e){case"Created":return"green";case"Updated":case"Renamed":case"Assigned to Cluster":case"Assigned to Image":case"Assigned to Clone":return"blue";case"Deleted":return"red";case"Activated":return"cyan";case"Deactivated":case"Removed from Cluster":case"Removed from Clone":return"orange";case"Security Update":case"Security Setting":return"gold";case"Completed":return"success";case"Cancelled":return"error";case"Reassigned Image":return"purple";default:return"default"}},F=[{title:i("audit.action"),key:"action",width:150,render:(e,t,a)=>h.jsxs(I,{"data-testid":`audit-trace-action-${a}`,children:[P(t.iconHint),h.jsx(T,{color:X(t.actionType),"data-testid":`audit-trace-action-tag-${a}`,children:t.actionType})]})},{title:i("audit.details"),dataIndex:"details",key:"details",ellipsis:!0},{title:i("audit.performedBy"),dataIndex:"performedBy",key:"performedBy",width:200,render:(e,t,a)=>h.jsx("span",{"data-testid":`audit-trace-performed-by-${a}`,children:e||i("audit.system")})},{title:i("audit.timestamp"),dataIndex:"timestamp",key:"timestamp",width:200,render:(e,t,a)=>h.jsxs(I,{direction:"vertical",size:0,"data-testid":`audit-trace-timestamp-${a}`,children:[h.jsx(ie,{children:O(e,"datetime")}),h.jsx(ie,{type:"secondary",style:{fontSize:12},children:t.timeAgo})]})}];return h.jsx(z,{title:h.jsxs(I,{children:[h.jsx(l,{}),i("audit.title",{name:s||r})]}),open:e,onCancel:t,style:d(c.DIMENSIONS.MODAL_WIDTH_XL),footer:null,destroyOnHidden:!0,"data-testid":"audit-trace-modal",children:E?h.jsxs("div",{style:{textAlign:"center",padding:`${n("XXXL")}px 0`},"data-testid":"audit-trace-loading",children:[h.jsx(A,{size:"large"}),h.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:i("common:general.loading")})]}):H?h.jsx(D,{message:i("audit.error"),description:H instanceof Error?H.message:i("audit.errorLoading"),type:"error",showIcon:!0,"data-testid":"audit-trace-error-alert"}):N?h.jsxs(h.Fragment,{children:[N.summary&&h.jsxs(I,{direction:"vertical",size:n("MD"),style:{width:"100%",marginBottom:n("LG")},"data-testid":"audit-trace-summary",children:[h.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[h.jsxs(I,{size:n("XL"),children:[h.jsxs(I,{direction:"vertical",size:0,"data-testid":"audit-trace-total-records",children:[h.jsx(ie,{type:"secondary",children:i("audit.totalRecords")}),h.jsx(ie,{strong:!0,style:{fontSize:c.FONT_SIZE.XL},children:N.summary.totalAuditRecords})]}),h.jsxs(I,{direction:"vertical",size:0,"data-testid":"audit-trace-visible-records",children:[h.jsx(ie,{type:"secondary",children:i("audit.visibleRecords")}),h.jsx(ie,{strong:!0,style:{fontSize:c.FONT_SIZE.XL},children:N.summary.visibleAuditRecords})]}),N.summary.lastActivity&&h.jsxs(I,{direction:"vertical",size:0,"data-testid":"audit-trace-last-activity",children:[h.jsx(ie,{type:"secondary",children:i("audit.lastActivity")}),h.jsx(ie,{strong:!0,children:new Date(N.summary.lastActivity).toLocaleDateString()})]})]}),h.jsx(M,{menu:{items:[{key:"csv",label:i("audit.exportCSV"),icon:h.jsx(R,{}),onClick:()=>{if(!N?.records||0===N.records.length)return;const e=[["Action","Details","Performed By","Timestamp","Time Ago"].join(","),...N.records.map(e=>[e.actionType,`"${e.details.replace(/"/g,'""')}"`,e.performedBy||"System",O(e.timestamp,"datetime"),e.timeAgo].join(","))].join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=`audit-trace-${a}-${r}-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),U.success(i("audit.exportSuccess",{format:"CSV"}))},"data-testid":"audit-trace-export-csv"},{key:"json",label:i("audit.exportJSON"),icon:h.jsx(C,{}),onClick:()=>{if(!N?.records||0===N.records.length)return;const e={entityType:a,entityIdentifier:r,entityName:s,exportDate:(new Date).toISOString(),summary:N.summary,records:N.records.map(e=>({actionType:e.actionType,details:e.details,performedBy:e.performedBy||"System",timestamp:e.timestamp,timeAgo:e.timeAgo,iconHint:e.iconHint}))},t=JSON.stringify(e,null,2),o=new Blob([t],{type:"application/json"}),d=URL.createObjectURL(o),n=document.createElement("a");n.href=d,n.download=`audit-trace-${a}-${r}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(d),U.success(i("audit.exportSuccess",{format:"JSON"}))},"data-testid":"audit-trace-export-json"}]},placement:"bottomRight","data-testid":"audit-trace-export-dropdown",children:h.jsx($,{icon:h.jsx(w,{}),"data-testid":"audit-trace-export-button",style:_.buttonSecondary,children:i("audit.export")})})]}),N.summary.hasOlderRecords&&h.jsx(D,{message:i("audit.olderRecordsNotVisible"),type:"warning",showIcon:!0,"data-testid":"audit-trace-older-records-alert"})]}),h.jsx(B,{columns:F,dataSource:N.records,rowKey:(e,t)=>`${e.timestamp}-${t}`,pagination:{pageSize:10,showSizeChanger:!1,showTotal:(e,t)=>i("common:general.showingRecords",{start:t[0],end:t[1],total:e})},scroll:{x:800},size:"small","data-testid":"audit-trace-table"}),N.summary&&h.jsx("div",{style:{marginTop:n("LG"),textAlign:"center"},"data-testid":"audit-trace-retention-info",children:h.jsx(ie,{type:"secondary",children:i("audit.retentionInfo",{days:N.summary.auditRetentionDays,tier:N.summary.subscriptionTier})})})]}):null})};export{oe as A,se as S};

import{j as e}from"./chunk-DXw4Pgvm.js";import{r as t}from"./chunk-DZuWtVpy.js";import{u as s,g as a,I as i}from"../index-DRw3QGwP.js";import{b as o,E as r}from"./chunk-B_NpgxeU.js";import{D as l}from"./chunk-ByBA-QfE.js";import{S as n,F as d}from"./chunk-Bi9uqbqU.js";import{R as c}from"./chunk-wgyboZoI.js";import{C as m}from"./chunk-VqVOANjS.js";import{L as u,S as h}from"./chunk-3FoRgEqC.js";import{F as y}from"./chunk-B22lRqIR.js";import{F as x}from"./chunk-BfcM5WvO.js";import{t as p,d as f,a as j,g,k as w,T as b,o as S,q as Y,s as v,af as k,S as D,I as T,B as C,D as H,i as M,w as z,E as O,W as L}from"./chunk-CSjZqX98.js";import{u as E}from"./chunk-CM3g5OHp.js";import"./chunk-DhsIgqDf.js";import"./chunk-B3rfJhtT.js";const{Text:N}=b,{RangePicker:I}=k,R=()=>{const{t:b}=E("system"),{token:k}=p.useToken(),R=s(),[U,A]=t.useState([f().subtract(7,"days"),f()]),[$,B]=t.useState(),[_,F]=t.useState(""),[J,V]=t.useState(25),[P,W]=t.useState(1),q=U[0]?.startOf("day").format("YYYY-MM-DDTHH:mm:ss"),G=U[1]?.endOf("day").format("YYYY-MM-DDTHH:mm:ss"),{data:K,isLoading:Z,refetch:Q,error:X,isError:ee}=o({startDate:q,endDate:G,entityFilter:$,maxRecords:1e3}),te=t=>{const s=t.toLowerCase();return s.includes("create")?e.jsx(a,{style:{color:k.colorSuccess}}):s.includes("delete")?e.jsx(m,{style:{color:k.colorError}}):s.includes("update")||s.includes("modify")?e.jsx(r,{style:{color:k.colorWarning}}):s.includes("login")||s.includes("auth")?e.jsx(u,{style:{color:k.colorPrimary}}):s.includes("export")||s.includes("import")?e.jsx(h,{style:{color:k.colorInfo}}):e.jsx(i,{style:{color:k.colorTextSecondary}})},se=e=>{const t=e.toLowerCase();return t.includes("create")?"success":t.includes("delete")?"error":t.includes("update")||t.includes("modify")?"warning":t.includes("login")||t.includes("auth")?"processing":"default"},ae=K?.filter(e=>{if(!_)return!0;const t=_.toLowerCase();return e.entityName?.toLowerCase().includes(t)||e.action?.toLowerCase().includes(t)||e.details?.toLowerCase().includes(t)||e.actionByUser?.toLowerCase().includes(t)}),ie=[{title:"Timestamp",dataIndex:"timestamp",key:"timestamp",width:180,render:e=>f(e).format("YYYY-MM-DD HH:mm:ss"),sorter:(e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime(),defaultSortOrder:"descend"},{title:e.jsxs(j,{children:["Action",e.jsx(y,{style:{opacity:.6,fontSize:"12px"}})]}),dataIndex:"action",key:"action",width:200,render:t=>e.jsxs(j,{children:[te(t),e.jsx(g,{color:se(t),children:t.replace(/_/g," ")})]}),filters:[...new Set(K?.map(e=>e.action)||[])].map(e=>({text:e.replace(/_/g," "),value:e})),onFilter:(e,t)=>t.action===e,filterIcon:t=>e.jsx(y,{style:{color:t?"#1890ff":void 0,fontSize:"14px"}})},{title:e.jsxs(j,{children:["Entity Type",e.jsx(y,{style:{opacity:.6,fontSize:"12px"}})]}),dataIndex:"entity",key:"entity",width:120,render:t=>e.jsx(g,{children:t}),filters:[...new Set(K?.map(e=>e.entity)||[])].map(e=>({text:e,value:e})),onFilter:(e,t)=>t.entity===e,filterIcon:t=>e.jsx(y,{style:{color:t?"#1890ff":void 0,fontSize:"14px"}})},{title:"Entity Name",dataIndex:"entityName",key:"entityName",width:200,ellipsis:{showTitle:!1},render:t=>e.jsx(w,{title:t,placement:"topLeft",children:e.jsx("span",{children:t})})},{title:e.jsxs(j,{children:["User",e.jsx(y,{style:{opacity:.6,fontSize:"12px"}})]}),dataIndex:"actionByUser",key:"user",width:180,filters:[...new Set(K?.map(e=>e.actionByUser)||[])].map(e=>({text:e,value:e})),onFilter:(e,t)=>t.actionByUser===e,filterIcon:t=>e.jsx(y,{style:{color:t?"#1890ff":void 0,fontSize:"14px"}})},{title:"Details",dataIndex:"details",key:"details",ellipsis:{showTitle:!1},render:t=>e.jsx(w,{title:t,placement:"topLeft",children:e.jsx(N,{type:"secondary",style:{fontSize:12},children:t})})}],oe=[...new Set(K?.map(e=>e.entity)||[])],re=[{key:"csv",label:e.jsx("span",{"data-testid":"audit-export-csv",children:"Export as CSV"}),icon:e.jsx(x,{}),onClick:()=>{if(!ae||0===ae.length)return;const e=ae.map(e=>[f(e.timestamp).format("YYYY-MM-DD HH:mm:ss"),e.action.replace(/_/g," "),e.entity,e.entityName||"",e.actionByUser,e.details||""]),t=[["Timestamp","Action","Entity Type","Entity Name","User","Details"].join(","),...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),i=URL.createObjectURL(s);a.setAttribute("href",i),a.setAttribute("download",`audit_logs_${f().format("YYYY-MM-DD_HHmmss")}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),L.success(`Exported ${ae.length} audit logs to CSV`)}},{key:"json",label:e.jsx("span",{"data-testid":"audit-export-json",children:"Export as JSON"}),icon:e.jsx(d,{}),onClick:()=>{if(!ae||0===ae.length)return;const e={exportDate:f().format("YYYY-MM-DD HH:mm:ss"),dateRange:{from:U[0]?.format("YYYY-MM-DD HH:mm:ss"),to:U[1]?.format("YYYY-MM-DD HH:mm:ss")},filters:{entityType:$||"All",searchText:_||"None"},totalRecords:ae.length,logs:ae},t=JSON.stringify(e,null,2),s=new Blob([t],{type:"application/json"}),a=document.createElement("a"),i=URL.createObjectURL(s);a.setAttribute("href",i),a.setAttribute("download",`audit_logs_${f().format("YYYY-MM-DD_HHmmss")}.json`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),L.success(`Exported ${ae.length} audit logs to JSON`)}}];return e.jsxs("div",{style:{padding:24},children:[e.jsx(S,{"data-testid":"audit-filter-card",style:{marginBottom:16},children:e.jsx(j,{direction:"vertical",size:"large",style:{width:"100%"},children:e.jsxs(Y,{gutter:[24,16],children:[e.jsx(v,{xs:24,sm:24,md:8,children:e.jsxs(j,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsx(N,{strong:!0,style:{fontSize:"14px",color:k.colorText},children:"Date Range"}),e.jsx(I,{"data-testid":"audit-filter-date",value:U,onChange:e=>A(e),style:{width:"100%"},allowClear:!1,showTime:{format:"HH:mm:ss",defaultValue:[f("00:00:00","HH:mm:ss"),f("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss",presets:[{label:"Today",value:[f().startOf("day"),f().endOf("day")]},{label:"Yesterday",value:[f().subtract(1,"day").startOf("day"),f().subtract(1,"day").endOf("day")]},{label:"Last 7 Days",value:[f().subtract(7,"day").startOf("day"),f().endOf("day")]},{label:"Last 30 Days",value:[f().subtract(30,"day").startOf("day"),f().endOf("day")]},{label:"This Month",value:[f().startOf("month"),f().endOf("month")]},{label:"Last Month",value:[f().subtract(1,"month").startOf("month"),f().subtract(1,"month").endOf("month")]}]})]})}),e.jsx(v,{xs:24,sm:12,md:6,children:e.jsxs(j,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsx(N,{strong:!0,style:{fontSize:"14px",color:k.colorText},children:"Entity Type"}),e.jsx(D,{"data-testid":"audit-filter-entity",placeholder:"All entities",allowClear:!0,value:$,onChange:B,style:{width:"100%"},options:[{label:"All Entities",value:void 0},...oe.map(e=>({label:e,value:e}))]})]})}),e.jsx(v,{xs:24,sm:12,md:6,children:e.jsxs(j,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsx(N,{strong:!0,style:{fontSize:"14px",color:k.colorText},children:"Search"}),e.jsx(T,{"data-testid":"audit-filter-search",placeholder:"Search in logs...",prefix:e.jsx(n,{}),value:_,onChange:e=>F(e.target.value),allowClear:!0,autoComplete:"off"})]})}),e.jsx(v,{xs:24,sm:12,md:2,children:e.jsxs(j,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsx(N,{strong:!0,style:{fontSize:"14px",color:"transparent"},children:"Actions"}),e.jsx(C,{"data-testid":"audit-refresh-button",icon:e.jsx(c,{}),onClick:()=>Q(),loading:Z,style:{...R.touchTarget,width:"100%"},children:"Refresh"})]})}),e.jsx(v,{xs:24,sm:12,md:2,children:e.jsxs(j,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsx(N,{strong:!0,style:{fontSize:"14px",color:"transparent"},children:"Export"}),e.jsx(w,{title:ae&&0!==ae.length?"Export audit logs as CSV or JSON":"No data available to export",children:e.jsx(H,{menu:{items:re},disabled:!ae||0===ae.length,children:e.jsx(C,{"data-testid":"audit-export-button",icon:e.jsx(l,{}),style:{...R.touchTarget,width:"100%"},children:"Export"})})})]})})]})})}),ee&&e.jsx(M,{message:"Unable to Load Audit Logs",description:X?.message||"There was an error loading audit logs. Please try refreshing or adjusting your date range.",type:"error",closable:!0,showIcon:!0,style:{marginBottom:16},action:e.jsx(C,{size:"small",style:R.touchTargetSmall,onClick:()=>Q(),loading:Z,children:"Try Again"})}),e.jsx(S,{"data-testid":"audit-table-card",children:e.jsx(z,{"data-testid":"audit-table",columns:ie,dataSource:ae,loading:Z,rowKey:e=>`${e.timestamp}-${e.action}-${e.entityName}`,pagination:{current:P,pageSize:J,total:ae?.length||0,showSizeChanger:!0,pageSizeOptions:["10","25","50","100"],showTotal:(e,t)=>`Showing ${t[0]}-${t[1]} of ${e} logs`,onChange:(e,t)=>{W(e),t!==J&&(V(t),W(1))},position:["bottomRight"],className:"audit-table-pagination"},scroll:{x:"max-content"},locale:{emptyText:e.jsx(O,{description:e.jsxs(j,{direction:"vertical",align:"center",children:[e.jsx(N,{type:"secondary",children:ee?"Unable to load audit logs":0===ae?.length&&K&&K.length>0?"No logs match your current filters":"No audit logs found for the selected date range"}),!ee&&e.jsx(C,{type:"link",style:R.touchTarget,onClick:()=>{F(""),B(void 0),A([f().subtract(30,"days"),f()])},children:"Clear filters and expand date range"})]})})}})})]})};export{R as default};

import{j as e,u as t}from"./chunk-DXw4Pgvm.js";import{f as s,g as a,r as i,R as r,u as n}from"./chunk-DZuWtVpy.js";import{r as o,a as c,b as l,c as d,j as m,e as u,g as h,f as p,M as y,s as x,h as g,k as f,D as j,l as v,u as b,I as N,m as w,n as k,H as C,i as S,o as T,p as z,A as I,G as _,q as M,t as D,W as $,P as E}from"../index-DRw3QGwP.js";import{E as B}from"./chunk-B_NpgxeU.js";import{S as V,D as R}from"./chunk-DTDP1Cya.js";import{C as F}from"./chunk-BdC_xwe5.js";import{R as O}from"./chunk-wgyboZoI.js";import{u as A,a as P,W as L,b as G,c as W,U,d as q,e as H,f as K,g as Q,h as J,i as X,j as Y,k as Z,l as ee,m as te,n as se,o as ae,p as ie,q as re,r as ne,s as oe}from"./chunk-BtQb2Rqq.js";import{I as ce}from"./chunk-BBi3KYIR.js";import{I as le}from"./chunk-Dmoq7liW.js";import{u as de,a as me,M as ue,b as he,F as pe,L as ye,c as xe,A as ge,R as fe,V as je,P as ve,T as be}from"./chunk-B4gaJ3rr.js";import{R as Ne,D as we,P as ke,Q as Ce}from"./chunk-Cg2209yc.js";import{C as Se}from"./chunk-VqVOANjS.js";import{u as Te,a as ze,C as Ie}from"./chunk-BE-GJhp2.js";import{u as _e}from"./chunk-CM3g5OHp.js";import{a as Me,T as De,g as $e,M as Ee,P as Be,i as Ve,w as Re,B as Fe,k as Oe,x as Ae,n as Pe,p as Le,U as Ge,y as We,z as Ue,S as qe,E as He,G as Ke,I as Qe,H as Je,J as Xe,K as Ye,c as Ze,N as et,O as tt,Q as st,o as at,h as it,q as rt,s as nt,u as ot,f as ct,D as lt,V as dt}from"./chunk-CSjZqX98.js";import{A as mt,S as ut}from"./chunk-B5K5IXco.js";import{T as ht}from"./chunk-Cc81kOho.js";import{C as pt}from"./chunk-DQeovWLL.js";import{l as yt}from"./chunk-B3rfJhtT.js";import{f as xt,g as gt,a as ft}from"./chunk-xSw6NTs2.js";import{D as jt,C as vt}from"./chunk-BBZh1mru.js";import{F as bt}from"./chunk-bMifum20.js";import"./chunk-DhsIgqDf.js";import"./chunk-ByBA-QfE.js";import"./chunk-DdwiD4Er.js";import"./chunk-Bi9uqbqU.js";import"./forkTokenService.ts-BgcpHq4E.js";import"./chunk-bmHtWqSc.js";import"./chunk-BfcM5WvO.js";var Nt,wt,kt,Ct={exports:{}},St={},Tt={};function zt(){if(Nt)return Tt;Nt=1,Object.defineProperty(Tt,"__esModule",{value:!0});return Tt.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder",theme:"outlined"},Tt}function It(){if(wt)return St;wt=1;var e=o().default,t=c().default;Object.defineProperty(St,"__esModule",{value:!0}),St.default=void 0;var a=t(l()),i=e(s()),r=t(zt()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return St.default=u,St}function _t(){return kt||(kt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=It())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Ct,Ct.exports)),Ct.exports}const Mt=a(_t());var Dt,$t,Et,Bt={exports:{}},Vt={},Rt={};function Ft(){if(Dt)return Rt;Dt=1,Object.defineProperty(Rt,"__esModule",{value:!0});return Rt.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},Rt}function Ot(){if($t)return Vt;$t=1;var e=o().default,t=c().default;Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.default=void 0;var a=t(l()),i=e(s()),r=t(Ft()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return Vt.default=u,Vt}function At(){return Et||(Et=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Ot())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Bt,Bt.exports)),Bt.exports}const Pt=a(At());var Lt,Gt,Wt,Ut={exports:{}},qt={},Ht={};function Kt(){if(Lt)return Ht;Lt=1,Object.defineProperty(Ht,"__esModule",{value:!0});return Ht.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},Ht}function Qt(){if(Gt)return qt;Gt=1;var e=o().default,t=c().default;Object.defineProperty(qt,"__esModule",{value:!0}),qt.default=void 0;var a=t(l()),i=e(s()),r=t(Kt()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return qt.default=u,qt}function Jt(){return Wt||(Wt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Qt())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Ut,Ut.exports)),Ut.exports}const Xt=a(Jt());var Yt,Zt,es,ts={exports:{}},ss={},as={};function is(){if(Yt)return as;Yt=1,Object.defineProperty(as,"__esModule",{value:!0});return as.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm198.4-588.1a32 32 0 00-24.5.5L414.9 415 296.4 686c-3.6 8.2-3.6 17.5 0 25.7 3.4 7.8 9.7 13.9 17.7 17 3.8 1.5 7.7 2.2 11.7 2.2 4.4 0 8.7-.9 12.8-2.7l271-118.6 118.5-271a32.06 32.06 0 00-17.7-42.7zM576.8 534.4l26.2 26.2-42.4 42.4-26.2-26.2L380 644.4 447.5 490 422 464.4l42.4-42.4 25.5 25.5L644.4 380l-67.6 154.4zM464.4 422L422 464.4l25.5 25.6 86.9 86.8 26.2 26.2 42.4-42.4-26.2-26.2-86.8-86.9z"}}]},name:"compass",theme:"outlined"},as}function rs(){if(Zt)return ss;Zt=1;var e=o().default,t=c().default;Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var a=t(l()),i=e(s()),r=t(is()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return ss.default=u,ss}function ns(){return es||(es=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=rs())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(ts,ts.exports)),ts.exports}const os=a(ns());var cs,ls,ds,ms={exports:{}},us={},hs={};function ps(){if(cs)return hs;cs=1,Object.defineProperty(hs,"__esModule",{value:!0});return hs.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},hs}function ys(){if(ls)return us;ls=1;var e=o().default,t=c().default;Object.defineProperty(us,"__esModule",{value:!0}),us.default=void 0;var a=t(l()),i=e(s()),r=t(ps()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return us.default=u,us}function xs(){return ds||(ds=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=ys())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(ms,ms.exports)),ms.exports}const gs=a(xs());async function fs(e,t=3e4){const s=Date.now();for(;Date.now()-s<t;){const t=await js(e);if(t)return t;await new Promise(e=>setTimeout(e,1e3))}return bs("Operation timeout - no response received","TIMEOUT")}async function js(e){try{const t=await m.get("/GetQueueItemTrace",{taskId:e}),s=t.resultSets?.[1]?.data?.[0];if(!s)return null;const a=s.status||s.Status;switch(a){case"COMPLETED":return function(e){const t=e.resultSets?.[3]?.data?.[0];if(!t?.vaultContent)return vs("Hello function completed successfully","COMPLETED");try{const e=JSON.parse(t.vaultContent);return e.result&&"string"==typeof e.result&&e.result.includes("Error")?bs(e.result,"COMPLETED",e):vs(e.result||"Hello function completed successfully","COMPLETED",e)}catch{return vs("Hello function completed","COMPLETED")}}(t);case"FAILED":case"CANCELLED":return function(e,t){const s=e.lastFailureReason||e.LastFailureReason||"Operation failed";return bs(s,t)}(s,a);default:return null}}catch(t){return null}}function vs(e,t,s){return{success:!0,message:e,status:t,responseData:s}}function bs(e,t,s){return{success:!1,message:e,status:t,responseData:s}}function Ns(e){const{buildQueueVault:t}=A();de();const s=Te(),{data:a}=P(),r=i.useCallback(async e=>{try{const i=function(e,t){if(e.teamVault&&"{}"!==e.teamVault)return e.teamVault;const s=t?.find(t=>t.teamName===e.teamName);return s?.vaultContent||"{}"}(e,a),r=await async function(e,t,s){const a=4,i="Ping connectivity test",r="ping-service",n="{}";return s({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,functionName:"ping",params:{},priority:e.priority||a,description:e.description||i,addedVia:e.addedVia||r,machineVault:e.machineVault||n,teamVault:t,repositoryVault:e.repositoryVault||n})}(e,i,t),n=await async function(e,t,s){const a=4;return s.mutateAsync({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,queueVault:t,priority:e.priority||a})}(e,r,s);return{taskId:n?.taskId,success:!!n?.taskId||!!n?.isQueued}}catch(i){return{success:!1,error:i.message||"Failed to execute ping function"}}},[t,s,a]),n=i.useCallback(async(e,t)=>r({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,priority:t?.priority,description:t?.description,addedVia:t?.addedVia,machineVault:e.vaultContent||"{}"}),[r]),o=i.useCallback(async(e,t)=>{const s=await r(e);if(!s.success||!s.taskId)return s;const a=await fs(s.taskId,t);return{...s,completionResult:a,success:a.success,error:a.success?void 0:a.message}},[r]),c=i.useCallback(async(e,t)=>o({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,priority:t?.priority,description:t?.description,addedVia:t?.addedVia,machineVault:e.vaultContent||"{}"},t?.timeout),[o]);return{executePing:r,executePingForMachine:n,executePingAndWait:o,executePingForMachineAndWait:c,waitForQueueItemCompletion:fs,isLoading:s.isPending}}const{Text:ws}=De,ks=({open:t,onClose:s,machines:a})=>{const{t:r}=_e(["machines","common"]),{theme:n}=u(),[o,c]=i.useState([]),[l,d]=i.useState(!1),[m,b]=i.useState(0),[N,w]=i.useState(-1),{executePingForMachine:k,waitForQueueItemCompletion:C}=Ns();i.useEffect(()=>{if(t&&a.length>0){const e=a.map(e=>({machineName:e.machineName,teamName:e.teamName,bridgeName:e.bridgeName,status:"pending"}));c(e),b(0),w(-1)}},[t,a]);const S=e=>e.success?r("machines:connectionSuccessful"):"TIMEOUT"===e.status?r("machines:testTimeout"):e.message||r("machines:connectionFailed"),T=async(e,t)=>{const s=Date.now();c(e=>e.map((e,s)=>s===t?{...e,status:"testing",timestamp:(new Date).toISOString()}:e));try{const a=await k(e,{priority:4,description:"Connectivity test",addedVia:"connectivity-test"});if(!a.success||!a.taskId)throw new Error(a.error||"Failed to create test task");{c(e=>e.map((e,s)=>s===t?{...e,taskId:a.taskId}:e));const e=await C(a.taskId),i=Date.now()-s;c(s=>s.map((s,a)=>a===t?{...s,status:e.success?"success":"failed",message:S(e),duration:i}:s))}}catch(a){const e=Date.now()-s;c(s=>s.map((s,i)=>i===t?{...s,status:"failed",message:a.message||"Failed to create test task",duration:e}:s))}},z=[{title:r("machines:machineName"),dataIndex:"machineName",key:"machineName",render:(t,s)=>e.jsxs(Me,{"data-testid":`connectivity-machine-${t}`,children:["testing"===s.status&&e.jsx(V,{spin:!0,style:{color:"#1890ff"},"data-testid":`connectivity-status-icon-testing-${t}`}),"success"===s.status&&e.jsx(h,{style:{color:"#52c41a"},"data-testid":`connectivity-status-icon-success-${t}`}),"failed"===s.status&&e.jsx(Se,{style:{color:"#ff4d4f"},"data-testid":`connectivity-status-icon-failed-${t}`}),"pending"===s.status&&e.jsx(p,{style:{color:"#8c8c8c"},"data-testid":`connectivity-status-icon-pending-${t}`}),e.jsx(ws,{strong:!0,children:t})]})},{title:r("machines:team"),dataIndex:"teamName",key:"teamName",render:t=>e.jsx($e,{color:"#8FBC8F",children:t})},{title:r("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",render:t=>e.jsx($e,{color:"green",children:t})},{title:r("machines:status"),dataIndex:"status",key:"status",width:120,render:(t,s)=>{const a={pending:{color:"default",text:r("machines:pending")},testing:{color:"processing",text:r("machines:testing")},success:{color:"success",text:r("machines:connected")},failed:{color:"error",text:r("machines:failed")}};return e.jsx($e,{color:a[t].color,"data-testid":`connectivity-status-tag-${s.machineName}-${t}`,children:a[t].text})}},{title:r("machines:responseTime"),dataIndex:"duration",key:"duration",width:120,render:e=>e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"-"},{title:r("machines:message"),dataIndex:"message",key:"message",ellipsis:!0,render:(t,s)=>t?e.jsx(ws,{type:"failed"===s.status?"danger":void 0,children:t}):"-"}];return e.jsx(Ee,{"data-testid":"connectivity-modal",title:e.jsxs(Me,{children:[e.jsx(L,{style:{fontSize:j.DIMENSIONS.ICON_MD}}),e.jsx("span",{style:{fontSize:f("BASE")},children:r("machines:connectivityTest")})]}),open:t,onCancel:s,className:y.ExtraLarge,destroyOnHidden:!0,footer:[e.jsx(Fe,{type:"primary",icon:e.jsx(V,{style:{fontSize:j.DIMENSIONS.ICON_SM}}),onClick:async()=>{d(!0);for(let s=0;s<a.length;s++)w(s),b(Math.round(s/a.length*100)),await T(a[s],s);b(100),d(!1),w(-1);const e=o.filter(e=>"success"===e.status).length,t=o.filter(e=>"failed"===e.status).length;0===t?v("success",r("machines:allMachinesConnected",{count:e})):v("warning",r("machines:machinesConnectedWithFailures",{successCount:e,failedCount:t}))},disabled:l||0===a.length,loading:l,style:{fontSize:f("SM")},"data-testid":"connectivity-run-test-button",children:r(l?"machines:testing":"machines:runTest")},"run"),e.jsx(Oe,{title:"Close",children:e.jsx(Fe,{icon:e.jsx(Se,{}),onClick:s,style:{borderRadius:g("LG"),fontSize:f("SM")},"data-testid":"connectivity-close-button","aria-label":"Close"},"close")},"close-tooltip")],children:e.jsxs(Me,{direction:"vertical",size:"large",style:{width:"100%"},children:[l&&e.jsxs("div",{style:{marginBottom:x("MD")},"data-testid":"connectivity-progress-container",children:[e.jsx(Be,{percent:m,status:"active",strokeColor:{"0%":"var(--color-primary)","100%":"var(--color-success)"},style:{borderRadius:g("LG")},"data-testid":"connectivity-progress-bar"}),N>=0&&N<a.length&&e.jsx(ws,{type:"secondary",style:{fontSize:f("XS"),marginTop:x("XS"),display:"block"},"data-testid":"connectivity-progress-text",children:r("machines:testingMachine",{machineName:a[N].machineName})})]}),e.jsx(Ve,{message:r("machines:connectivityTestDescription"),type:"info",showIcon:!0,icon:e.jsx(L,{style:{fontSize:j.DIMENSIONS.ICON_MD}}),style:{borderRadius:g("LG"),fontSize:f("SM")},"data-testid":"connectivity-info-alert"}),e.jsx(Re,{columns:z,dataSource:o,rowKey:"machineName",pagination:!1,scroll:{y:400},loading:0===a.length,rowClassName:e=>"testing"===e.status?"connectivity-test-active-row":"success"===e.status?"connectivity-test-success-row":"failed"===e.status?"connectivity-test-failed-row":"",style:{borderRadius:g("LG"),overflow:"hidden"},"data-testid":"connectivity-results-table"}),!l&&o.some(e=>"pending"!==e.status)&&e.jsx("div",{style:{padding:x("MD"),background:"dark"===n?"var(--color-fill-quaternary)":"var(--color-fill-tertiary)",borderRadius:g("LG")},"data-testid":"connectivity-summary-statistics",children:e.jsxs(Me,{size:"large",children:[e.jsxs("div",{"data-testid":"connectivity-total-machines",children:[e.jsxs(ws,{type:"secondary",children:[r("machines:totalMachines"),":"]})," ",e.jsx(ws,{strong:!0,children:a.length})]}),e.jsxs("div",{"data-testid":"connectivity-connected-count",children:[e.jsxs(ws,{type:"secondary",children:[r("machines:connected"),":"]})," ",e.jsx(ws,{strong:!0,style:{color:"#52c41a"},children:o.filter(e=>"success"===e.status).length})]}),e.jsxs("div",{"data-testid":"connectivity-failed-count",children:[e.jsxs(ws,{type:"secondary",children:[r("machines:failed"),":"]})," ",e.jsx(ws,{strong:!0,style:{color:"#ff4d4f"},children:o.filter(e=>"failed"===e.status).length})]}),e.jsxs("div",{"data-testid":"connectivity-average-response",children:[e.jsxs(ws,{type:"secondary",children:[r("machines:averageResponse"),":"]})," ",e.jsx(ws,{strong:!0,children:(()=>{const e=o.filter(e=>"success"===e.status&&e.duration);if(0===e.length)return"-";const t=e.reduce((e,t)=>e+(t.duration||0),0)/e.length;return t<1e3?`${Math.round(t)}ms`:`${(t/1e3).toFixed(1)}s`})()})]})]})})]})})},{Step:Cs}=Pe,{Text:Ss,Title:Ts,Paragraph:zs}=De,Is=({open:t,onClose:s,teamName:a,onImportComplete:r})=>{const{t:n}=_e(["resources","common"]),o=b(),[c,l]=i.useState(0),[d,m]=i.useState([]),[u,h]=i.useState([]),[p,y]=i.useState([]),[g,f]=i.useState(!1),[v,k]=i.useState(null),C=G(),{data:S=[]}=W(a),T=e=>{const{type:t,config:s}=e,a={drive:"drive",onedrive:"onedrive",s3:"s3",b2:"b2",mega:"mega",dropbox:"dropbox",box:"box",azureblob:"azureblob",swift:"swift",webdav:"webdav",ftp:"ftp",sftp:"sftp"}[t];if(!a)return null;const i={};return Object.entries(s).forEach(([e,t])=>{if("type"===e)i.provider=a;else{let s=t;if("string"==typeof t&&("token"===e||e.endsWith("_token"))&&t.startsWith("{"))try{s=JSON.parse(t)}catch{s=t}i[e]=s}}),i.provider||(i.provider=a),i},z=async e=>{k(null);try{const t=(e=>{const t=[],s=e.split("\n");let a=null,i={};for(const r of s){const e=r.trim();if(!e||e.startsWith("#")||e.startsWith(";"))continue;const s=e.match(/^\[(.+)\]$/);if(s)a&&i.type&&t.push({name:a,type:i.type,config:{...i}}),a=s[1],i={};else if(a){const t=e.match(/^([^=]+)=(.*)$/);if(t){const e=t[1].trim(),s=t[2].trim();try{i[e]=JSON.parse(s)}catch{i[e]=s}}}}return a&&i.type&&t.push({name:a,type:i.type,config:{...i}}),t})(await e.text());if(0===t.length)return k(n("resources:storage.import.noConfigsFound")),!1;h(t);const s=t.map(e=>{const t=S.some(t=>t.storageName===e.name);return{name:e.name,status:"pending",exists:t,selected:!t}});return y(s),l(1),!1}catch(t){return k(n("resources:storage.import.parseError")),!1}},I=()=>{l(0),m([]),h([]),y([]),f(!1),k(null),2===c&&p.some(e=>"success"===e.status)&&r?.(),s()},_=[{title:e.jsx(Ae,{checked:p.every(e=>e.selected),indeterminate:p.some(e=>e.selected)&&!p.every(e=>e.selected),onChange:e=>{return t=e.target.checked,void y(e=>e.map(e=>({...e,selected:t})));var t},disabled:2===c,"data-testid":"rclone-wizard-select-all-checkbox"}),dataIndex:"selected",key:"selected",width:50,render:(t,s,a)=>e.jsx(Ae,{checked:s.selected,onChange:()=>(e=>{y(t=>{const s=[...t];return s[e]={...s[e],selected:!s[e].selected},s})})(a),disabled:2===c,"data-testid":`rclone-wizard-config-checkbox-${s.name}`})},{title:n("resources:storage.storageName"),dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(Me,{children:[e.jsx(F,{}),e.jsx(Ss,{strong:!0,children:t}),s.exists&&e.jsx(Oe,{title:n("resources:storage.import.alreadyExists"),children:e.jsxs($e,{color:"warning",children:[e.jsx(N,{})," ",n("resources:storage.import.exists")]})})]})},{title:n("resources:storage.provider"),key:"provider",width:120,render:(t,s)=>{const a=u.find(e=>e.name===s.name);if(!a)return null;const i=a.type.charAt(0).toUpperCase()+a.type.slice(1);return e.jsx($e,{color:"blue",children:i})}},{title:n("resources:storage.import.status"),dataIndex:"status",key:"status",width:150,render:(t,s)=>{if(c<2)return null;const a={pending:{color:"default",text:n("resources:storage.import.pending")},success:{color:"success",text:n("resources:storage.import.success")},error:{color:"error",text:n("resources:storage.import.error")},skipped:{color:"warning",text:n("resources:storage.import.skipped")}}[t]||{color:"default",text:t};return e.jsxs(Me,{direction:"vertical",size:"small",children:[e.jsx($e,{color:a.color,children:a.text}),s.message&&e.jsx(Ss,{type:"secondary",style:{fontSize:12},children:s.message})]})}}];return e.jsxs(Ee,{title:e.jsxs(Me,{children:[e.jsx(F,{}),n("resources:storage.import.title")]}),open:t,onCancel:I,style:w(j.DIMENSIONS.MODAL_WIDTH_XL),footer:0===c?e.jsx(Fe,{onClick:I,"data-testid":"rclone-wizard-cancel-button",style:o.buttonSecondary,children:n("common:actions.cancel")}):1===c?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{onClick:()=>l(0),"data-testid":"rclone-wizard-back-button",style:o.buttonSecondary,children:n("common:actions.back")}),e.jsx(Fe,{onClick:I,"data-testid":"rclone-wizard-cancel-button",style:o.buttonSecondary,children:n("common:actions.cancel")}),e.jsx(Fe,{type:"primary",onClick:async()=>{f(!0);const e=u.filter((e,t)=>p[t].selected);for(let s=0;s<e.length;s++){const i=e[s],r=u.findIndex(e=>e.name===i.name);try{const e=T(i);if(!e){y(e=>{const t=[...e];return t[r]={...t[r],status:"error",message:n("resources:storage.import.unsupportedProvider",{type:i.type})},t});continue}const t=JSON.stringify(e);await C.mutateAsync({teamName:a,storageName:i.name,storageVault:t}),y(e=>{const t=[...e];return t[r]={...t[r],status:"success",message:n("resources:storage.import.imported")},t})}catch(t){y(e=>{const s=[...e];return s[r]={...s[r],status:"error",message:t.message||n("resources:storage.import.importError")},s})}}f(!1),l(2)},disabled:!p.some(e=>e.selected),loading:g,"data-testid":"rclone-wizard-import-button",style:o.buttonPrimary,children:n("resources:storage.import.importSelected")})]}):e.jsx(Fe,{type:"primary",onClick:I,"data-testid":"rclone-wizard-close-button",style:o.buttonPrimary,children:n("common:actions.close")}),children:[e.jsxs(Pe,{current:c,style:{marginBottom:x("LG")},"data-testid":"rclone-wizard-steps",children:[e.jsx(Cs,{title:n("resources:storage.import.step1")}),e.jsx(Cs,{title:n("resources:storage.import.step2")}),e.jsx(Cs,{title:n("resources:storage.import.step3")})]}),(()=>{switch(c){case 0:return e.jsxs("div",{style:{padding:"20px 0"},children:[e.jsx(Ve,{message:n("resources:storage.import.instructions"),description:e.jsxs("div",{children:[e.jsx(zs,{children:n("resources:storage.import.instructionsDetail")}),e.jsx(zs,{children:e.jsx(Ss,{code:!0,children:"rclone config file"})}),e.jsx(zs,{children:n("resources:storage.import.uploadPrompt")})]}),type:"info",showIcon:!0,icon:e.jsx(N,{}),style:{marginBottom:20}}),e.jsxs(Ge.Dragger,{accept:".conf",fileList:d,beforeUpload:z,onChange:({fileList:e})=>m(e),maxCount:1,"data-testid":"rclone-wizard-upload-dragger",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(U,{})}),e.jsx("p",{className:"ant-upload-text",children:n("resources:storage.import.dragDropText")}),e.jsx("p",{className:"ant-upload-hint",children:n("resources:storage.import.supportedFormats")})]}),v&&e.jsx(Ve,{message:v,type:"error",showIcon:!0,style:{marginTop:16}})]});case 1:return e.jsxs("div",{children:[e.jsx(Ve,{message:n("resources:storage.import.selectStorages"),description:n("resources:storage.import.selectDescription"),type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(Re,{dataSource:p,columns:_,rowKey:"name",pagination:!1,size:"small","data-testid":"rclone-wizard-config-table"})]});case 2:return e.jsx("div",{children:g?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(Le,{size:"large"}),e.jsx(Ts,{level:4,style:{marginTop:16},children:n("resources:storage.import.importing")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{message:n("resources:storage.import.complete"),description:n("resources:storage.import.completeDescription"),type:"success",showIcon:!0,style:{marginBottom:16}}),e.jsx(Re,{dataSource:p,columns:_,rowKey:"name",pagination:!1,size:"small","data-testid":"rclone-wizard-results-table"})]})});default:return null}})()]})},_s=({open:t,onCancel:s,machineName:a,teamName:r,bridgeName:n,onPullSelected:o,onClose:c,onQueueItemCreated:l})=>{const{t:d}=_e(["resources","common","machines"]),{data:m}=ze(),u=k(),h=b(),{data:p,isLoading:x}=W(r),{data:g,isLoading:f}=q(r),{data:j}=P(),{buildQueueVault:N}=A(),{mutateAsync:w}=de(),[C,S]=i.useState(!1),[T,z]=i.useState([]),[I,_]=i.useState(""),[M,D]=i.useState(""),[$,E]=i.useState(""),[B,V]=i.useState(""),[R,F]=i.useState("table"),O=i.useMemo(()=>{const e=[];return g&&g.length>0&&g.forEach(t=>{e.push({value:t.machineName,label:`${t.machineName} (Machine)`,type:"machine"})}),p&&p.length>0&&p.forEach(t=>{e.push({value:t.storageName,label:`${t.storageName} (Cloud Storage)`,type:"storage"})}),e},[g,p]);i.useEffect(()=>{!M&&a&&D(a)},[a,M]);const L=async()=>{if(M){S(!0);try{const s=O.find(e=>e.value===M),i="storage"===s?.type,o={},c=g?.find(e=>e.machineName===a);c&&c.vaultContent&&(o.machineVault=c.vaultContent);const l=j?.find(e=>e.teamName===r);if(l&&l.vaultContent&&(o.teamVault=l.vaultContent),!i&&M!==a){const t=g?.find(e=>e.machineName===M);if(t&&t.vaultContent)try{const e=JSON.parse(t.vaultContent);o.additionalMachineData={[M]:e}}catch(e){}}if(i){const t=p?.find(e=>e.storageName===M);if(t&&t.vaultContent)try{const e=JSON.parse(t.vaultContent);o.additionalStorageData={[M]:e}}catch(e){}}const m=await N({teamName:r,machineName:a,bridgeName:n,functionName:"list",params:{from:M,path:I||"",format:"json"},priority:4,description:`List files from ${M}`,addedVia:"file-browser",...o}),u=await w({teamName:r,machineName:a,bridgeName:n,queueVault:m,priority:4}),h=u.taskId||u.queueId;if(!h)throw new Error("Failed to create queue item - no taskId returned");if(u.isQueued)v("info","File listing has been queued. Please try again in a moment."),z([]);else{const s=await fs(h,3e4);if(s.success){let a=[],i="";try{const t=s.responseData?.result;if(!t&&!s.responseData)return void z([]);if("string"==typeof t)try{i=JSON.parse(t).command_output||""}catch(e){i=t}if("string"==typeof i)if(i.includes("DEBUG:")){const e=i.lastIndexOf("["),t=i.lastIndexOf("]");if(-1!==e&&-1!==t&&e<t){const s=i.substring(e,t+1);i=s}}else if(i.includes("[")){const e=i.indexOf("["),t=i.lastIndexOf("]");if(-1!==e&&-1!==t){const s=i.substring(e,t+1);i=s.replace(/\\\\/g,"\\").replace(/\\n/g,"\n")}}const r="string"==typeof i?JSON.parse(i):i;Array.isArray(r)?a=r.map(e=>({name:e.name||e.Name||"",size:parseInt(e.size||e.Size||"0"),isDirectory:void 0!==e.isDirectory?e.isDirectory:e.permissions?.startsWith("d")||e.IsDir||!1,modTime:e.date?`${e.date} ${e.time}`:e.ModTime,path:e.Path||(I?`${I}/${e.name||e.Name}`:e.name||e.Name)})):r.entries&&(a=r.entries.map(e=>({name:e.Name,size:e.Size||0,isDirectory:e.IsDir||!1,modTime:e.ModTime,mimeType:e.MimeType,path:e.Path||(I?`${I}/${e.Name}`:e.Name)})))}catch(t){if("string"==typeof i&&i.includes('"Path":')&&i.includes('"Name":')){const t=i.match(/\{[^}]+\}/g);t&&(a=t.map(t=>{try{const e=JSON.parse(t);return{name:e.Name||"",size:e.Size||0,isDirectory:e.IsDir||!1,modTime:e.ModTime,mimeType:e.MimeType,path:e.Path||(I?`${I}/${e.Name}`:e.Name)}}catch(e){return null}}).filter(e=>null!==e))}else{const e=("string"==typeof i?i:JSON.stringify(i)).trim().split("\n").filter(e=>e.trim());a=e.filter(e=>!(e.startsWith("Listing")||e.startsWith("Setting up")||e.startsWith("Error:")||e.startsWith("DEBUG:")||""===e.trim())).map(e=>{const t=e.match(/^\s*(\d+)\s+(.+)$/);if(t){const[,e,s]=t;return{name:s.trim(),size:parseInt(e),isDirectory:s.endsWith("/"),path:I?`${I}/${s.trim()}`:s.trim()}}return{name:e.trim(),size:0,isDirectory:e.endsWith("/"),path:I?`${I}/${e.trim()}`:e.trim()}})}}z(a.filter(e=>e.name))}else v("error",s.message||d("resources:remoteFiles.loadError")),z([])}}catch(s){v("error",s.message||d("resources:remoteFiles.loadError")),z([])}finally{S(!1)}}},G=e=>{_(e),E(""),z([])},U=i.useMemo(()=>B?T.filter(e=>e.name.toLowerCase().includes(B.toLowerCase())):T,[T,B]),H=[{title:d("resources:remoteFiles.name"),dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(Me,{children:[s.isDirectory?e.jsx(We,{style:{color:"#1890ff"}}):e.jsx(Ue,{style:{color:"#666"}}),s.isDirectory?e.jsx("a",{onClick:()=>G(I?`${I}/${t}`:t),"data-testid":`file-browser-folder-${t}`,children:t}):e.jsx("span",{"data-testid":`file-browser-file-${t}`,children:t})]}),sorter:(e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name)},{title:d("resources:remoteFiles.size"),dataIndex:"size",key:"size",width:120,render:(e,t)=>t.isDirectory?"-":(e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]})(e),sorter:(e,t)=>e.size-t.size},{title:d("resources:remoteFiles.modified"),dataIndex:"modTime",key:"modTime",width:200,render:e=>e?xt(e):"-",sorter:(e,t)=>e.modTime&&t.modTime?new Date(e.modTime).getTime()-new Date(t.modTime).getTime():0}],K=i.useMemo(()=>{const t=[{title:e.jsx("span",{"data-testid":"file-browser-breadcrumb-home",children:e.jsx(tt,{})}),onClick:()=>G("")}];if(I){const s=I.split("/").filter(Boolean);s.forEach((a,i)=>{const r=s.slice(0,i+1).join("/");t.push({title:e.jsx("span",{"data-testid":`file-browser-breadcrumb-${a}`,children:a}),onClick:()=>G(r)})})}return t},[I]);return e.jsx(Ee,{"data-testid":"file-browser-modal",title:e.jsxs(Me,{children:[e.jsx(et,{}),d("resources:remoteFiles.title")]}),open:t,onCancel:s,className:y.Large,footer:[e.jsx(Oe,{title:d("common:actions.cancel"),children:e.jsx(Fe,{icon:e.jsx(Ye,{}),onClick:s,style:h.touchTarget,"data-testid":"file-browser-cancel-button","aria-label":d("common:actions.cancel")})},"cancel"),e.jsx(Oe,{title:d("common:actions.refresh"),children:e.jsx(Fe,{icon:e.jsx(Ze,{}),onClick:L,loading:C,style:h.touchTarget,"data-testid":"file-browser-refresh-button","aria-label":d("common:actions.refresh")})},"refresh"),e.jsx(Oe,{title:d("resources:remoteFiles.pull"),children:e.jsx(Fe,{type:"primary",icon:e.jsx(et,{}),onClick:async()=>{if(!$)return void v("warning",d("resources:remoteFiles.selectFile"));const e=T.find(e=>e.name===$);if(e)if(o)o([e],M),s();else{const i=e,o={},c=O.find(e=>e.value===M),m="storage"===c?.type,u=g?.find(e=>e.machineName===a);u&&u.vaultContent&&(o.machineVault=u.vaultContent);const h=j?.find(e=>e.teamName===r);if(h&&h.vaultContent&&(o.teamVault=h.vaultContent),m){const e=p?.find(e=>e.storageName===M);if(e&&e.vaultContent)try{const t=JSON.parse(e.vaultContent);o.additionalStorageData={[M]:t}}catch(t){}}if(!m&&M!==a){const e=g?.find(e=>e.machineName===M);if(e&&e.vaultContent)try{const t=JSON.parse(e.vaultContent);o.additionalMachineData={[M]:t}}catch(t){}}const y=await N({teamName:r,machineName:a,bridgeName:n,functionName:"pull",params:{from:M,repo:i.name,path:I||"",sourceType:m?"storage":"machine"},priority:3,description:`Pull ${i.name} from ${M}`,addedVia:"file-browser",...o}),x=await w({teamName:r,machineName:a,bridgeName:n,queueVault:y,priority:3});x?.taskId&&l?l(x.taskId,a):x?.isQueued&&v("info",d("resources:messages.pullOperationQueued")),v("success",d("resources:remoteFiles.pullStarted")),s()}},disabled:!$,style:h.touchTarget,"data-testid":"file-browser-pull-button","aria-label":d("resources:remoteFiles.pull")})},"pull")],children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{"data-testid":"file-browser-source-container",children:[e.jsx("div",{style:{marginBottom:8,fontWeight:500},"data-testid":"file-browser-source-label",children:d("resources:remoteFiles.sourceLabel")}),e.jsxs(Me,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsxs(Me,{children:[e.jsx(qe,{style:{width:300},placeholder:d("resources:remoteFiles.selectSource"),value:M,onChange:e=>{D(e),_(""),E(""),z([])},loading:x||f,notFoundContent:x||f?e.jsx(Le,{size:"small"}):0===O.length?e.jsx(He,{image:He.PRESENTED_IMAGE_SIMPLE,description:d("resources:remoteFiles.noSources")}):null,options:O,"data-testid":"file-browser-source-select"}),e.jsx(Oe,{title:d("resources:remoteFiles.loadFiles"),children:e.jsx(Fe,{icon:e.jsx(Ke,{}),onClick:L,loading:C,disabled:!M,style:h.touchTarget,"data-testid":"file-browser-load-files-button","aria-label":d("resources:remoteFiles.loadFiles")})})]}),e.jsx(Qe.Search,{placeholder:d("common:actions.search"),value:B,onChange:e=>V(e.target.value),style:{width:250},"data-testid":"file-browser-search-input"})]})]}),I&&e.jsx(Je,{items:K,separator:e.jsx(Xe,{}),"data-testid":"file-browser-breadcrumb"}),e.jsx(Le,{spinning:C,children:0===U.length?e.jsx(He,{description:d(C?"common:general.loading":"resources:remoteFiles.noFiles"),"data-testid":"file-browser-empty-state"}):e.jsx(Re,{dataSource:U,columns:H,rowKey:"name",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(e,t)=>d("common:table.showingRecords",{start:t[0],end:t[1],total:e})},rowSelection:{type:"radio",selectedRowKeys:$?[$]:[],onChange:e=>E(e[0]||""),getCheckboxProps:e=>({disabled:e.isDirectory})},scroll:{y:400},style:u.tableContainer,"data-testid":"file-browser-table",onRow:e=>({"data-testid":`file-browser-row-${e.name}`})})}),e.jsx(Ve,{type:"info",message:d("resources:remoteFiles.info"),showIcon:!0,"data-testid":"file-browser-info-alert"})]})})},Ms=e=>{if(!e||"string"!=typeof e)return 0;const t=e.match(/^([\d.]+)\s*([KMGT]i?B?)?$/i);if(!t)return 0;const s=parseFloat(t[1]);if(isNaN(s))return 0;const a=(t[2]||"").toUpperCase();return s*({KI:1024,MI:1048576,GI:1073741824,TI:1099511627776,KIB:1024,MIB:1048576,GIB:1073741824,TIB:1099511627776}[a]||{KB:1e3,MB:1e6,GB:1e9,TB:1e12}[a]||{K:1024,M:1048576,G:1073741824,T:1099511627776,B:1}[a]||1)},Ds=(e,t,s)=>{if(e){const t=parseInt(e);if(!isNaN(t)&&t>=0)return Math.min(100,t)}if(!t||!s)return 0;const a=Ms(t),i=Ms(s);if(0===i)return 0;const r=Math.round(a/i*100);return Math.min(100,Math.max(0,r))},{Text:$s}=De,Es=({machine:t,onViewDetails:s,onManageAssignment:a})=>{const{t:i}=_e(["distributedStorage","machines"]),r=b(),n=!!t.distributedStorageClusterName,{data:o,isLoading:c}=me(t.machineName,t.teamName,!n),l=n?"CLUSTER":o?.assignmentType||"AVAILABLE",d=n?`Assigned to cluster: ${t.distributedStorageClusterName}`:o?.assignmentDetails;return c?e.jsx("div",{style:{...r.flexCenter,...r.padding.lg},"data-testid":"ds-section-loading",children:e.jsx(Le,{})}):e.jsxs(e.Fragment,{children:[e.jsx(st,{style:r.marginBottom.lg,"data-testid":"ds-section-divider",children:e.jsxs(Me,{style:r.flexCenter,children:[e.jsx(pt,{style:r.icon.medium}),e.jsx("span",{style:r.heading5,children:i("machineSection.title")})]})}),e.jsx(at,{size:"small","data-testid":"ds-section-card",style:{...r.card,border:"1px solid var(--color-border-secondary)"},children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsx($s,{type:"secondary",style:{display:"block",...r.marginBottom.xs,...r.label},"data-testid":"ds-section-assignment-label",children:i("assignment.currentAssignment")}),e.jsx(ue,{assignmentType:l,assignmentDetails:d,size:"default","data-testid":"ds-section-assignment-badge"})]}),"AVAILABLE"!==l&&d&&e.jsx(Ve,{message:e.jsx("span",{style:r.body,children:d}),type:"info",icon:"CLUSTER"===l?e.jsx(jt,{style:r.icon.small}):"IMAGE"===l?e.jsx(C,{style:r.icon.small}):"CLONE"===l?e.jsx(vt,{style:r.icon.small}):e.jsx(pt,{style:r.icon.small}),showIcon:!0,style:{borderRadius:"var(--border-radius-lg)"},"data-testid":"ds-section-assignment-alert"}),e.jsxs(Me,{children:[s&&e.jsx(Fe,{size:"small",icon:e.jsx(S,{style:r.icon.small}),onClick:s,style:{...r.buttonSecondary,...r.touchTargetSmall},"data-testid":"ds-section-history-button",children:e.jsx("span",{style:r.caption,children:i("assignment.history")})}),a&&"AVAILABLE"!==l&&e.jsx(Fe,{size:"small",type:"primary",icon:e.jsx(Ne,{style:r.icon.small}),onClick:a,style:{...r.buttonPrimary,...r.touchTargetSmall},"data-testid":"ds-section-manage-button",children:e.jsx("span",{style:r.caption,children:i("machineSection.manageAssignment")})})]}),"AVAILABLE"!==l&&e.jsx(Ve,{message:e.jsx("span",{style:r.body,children:i("warnings.exclusivity")}),type:"warning",showIcon:!0,style:{...r.marginBottom.xs,borderRadius:"var(--border-radius-lg)"},"data-testid":"ds-section-exclusivity-warning"})]})})]})},{Text:Bs,Title:Vs}=De,Rs=({machine:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=_e(["machines","resources","common","distributedStorage"]),{theme:o}=u(),c=b(),[l,d]=i.useState({open:!1,entityType:null,entityIdentifier:null}),m=i.useMemo(()=>{if(!t?.vaultStatus)return null;try{if(t.vaultStatus.trim().startsWith("jq:")||t.vaultStatus.trim().startsWith("error:")||!t.vaultStatus.trim().startsWith("{"))return null;const e=JSON.parse(t.vaultStatus);if("completed"===e.status&&e.result){let t=e.result;if(t.match(/(\}[\s\n]*$)/)){const e=t.lastIndexOf("}");e<t.length-10&&(t=t.substring(0,e+1))}const s=t.indexOf("\njq:");return s>0&&(t=t.substring(0,s)),t=t.trim(),JSON.parse(t)}}catch(e){}return null},[t]);return i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,a]),t&&s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"machine-vault-status-panel",style:r?{height:"100%",backgroundColor:"dark"===o?"#141414":"#fff",overflowY:"auto",overflowX:"hidden"}:{position:"fixed",top:0,right:s?0:"-520px",bottom:0,width:"520px",maxWidth:"100vw",backgroundColor:"dark"===o?"#141414":"#fff",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,transition:"right 0.3s ease-in-out",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),position:"sticky",top:0,backgroundColor:"dark"===o?"#141414":"#fff",zIndex:r?0:1},"data-testid":"vault-status-header",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(Me,{children:[e.jsx(pt,{style:{fontSize:24,color:"#556b2f"}}),e.jsx(Vs,{level:4,style:{margin:0},"data-testid":"vault-status-machine-name",children:t.machineName})]}),e.jsx(Fe,{type:"text",icon:e.jsx(T,{}),onClick:a,style:c.touchTarget,"data-testid":"vault-status-close"})]}),e.jsxs(Me,{wrap:!0,style:{marginTop:8},children:[e.jsxs($e,{color:"#8FBC8F",icon:e.jsx(z,{}),"data-testid":"vault-status-team-tag",children:["Team: ",t.teamName]}),e.jsxs($e,{color:"green",icon:e.jsx(I,{}),"data-testid":"vault-status-bridge-tag",children:["Bridge: ",t.bridgeName]}),t.regionName&&e.jsxs($e,{color:"purple",icon:e.jsx(_,{}),"data-testid":"vault-status-region-tag",children:["Region: ",t.regionName]}),e.jsx(it,{count:t.queueCount,style:{backgroundColor:"#52c41a"},"data-testid":"vault-status-queue-badge",children:e.jsx($e,{color:"blue",children:n("machines:queueItems")})}),e.jsxs($e,{color:"blue","data-testid":"vault-status-version-tag",children:[n("machines:vaultVersion"),": ",t.vaultVersion]})]}),t.vaultStatusTime&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(Bs,{type:"secondary",style:{fontSize:12},title:ft(t.vaultStatusTime,"datetime"),"data-testid":"vault-status-last-updated",children:[n("machines:lastUpdated"),": ",gt(t.vaultStatusTime,n)]})})]}),e.jsx("div",{style:{padding:"24px"},"data-testid":"vault-status-content",children:m?e.jsxs(e.Fragment,{children:[m.system&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[e.jsx(R,{style:{fontSize:20,color:"#556b2f"}}),e.jsx(Vs,{level:5,style:{margin:0},"data-testid":"vault-status-system-info-title",children:n("resources:repositories.systemInfo")})]}),e.jsxs(rt,{gutter:[16,16],style:c.marginBottom.md,children:[e.jsx(nt,{span:12,children:e.jsx(at,{size:"small",style:{height:"100%"},"data-testid":"vault-status-hostname-card",children:e.jsx(ot,{title:n("resources:repositories.hostname"),value:m.system.hostname,prefix:e.jsx(pt,{}),valueStyle:{fontSize:16}})})}),e.jsx(nt,{span:12,children:e.jsx(at,{size:"small",style:{height:"100%"},"data-testid":"vault-status-uptime-card",children:e.jsx(ot,{title:n("resources:repositories.uptime"),value:m.system.uptime,prefix:e.jsx(bt,{}),valueStyle:{fontSize:16}})})}),e.jsx(nt,{span:24,children:e.jsx(at,{size:"small","data-testid":"vault-status-os-info-card",children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.osName"),":"]}),e.jsx(Bs,{strong:!0,"data-testid":"vault-status-os-name",children:m.system.os_name})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.kernel"),":"]}),e.jsx(Bs,{"data-testid":"vault-status-kernel",children:m.system.kernel})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.cpu"),":"]}),e.jsxs(Bs,{"data-testid":"vault-status-cpu",children:[m.system.cpu_count," × ",m.system.cpu_model]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.systemTime"),":"]}),e.jsxs(Bs,{"data-testid":"vault-status-system-time",children:[m.system.system_time_human," (",m.system.timezone,")"]})]})]})})})]}),e.jsx(st,{style:{margin:"24px 0"},children:e.jsxs(Me,{children:[e.jsx(N,{}),n("resources:repositories.resourceUsage")]})}),e.jsxs(rt,{gutter:[16,16],style:c.marginBottom.lg,children:[e.jsx(nt,{span:24,children:e.jsxs(at,{size:"small","data-testid":"vault-status-memory-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(Me,{children:[e.jsx(jt,{style:{color:"#1890ff"}}),e.jsx(Bs,{strong:!0,children:n("resources:repositories.memory")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Bs,{children:[m.system.memory.used," / ",m.system.memory.total]})}),e.jsx(Be,{percent:Ds(void 0,m.system.memory.used,m.system.memory.total),strokeColor:"#1890ff",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(Bs,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",m.system.memory.available]})]})}),e.jsx(nt,{span:24,children:e.jsxs(at,{size:"small","data-testid":"vault-status-disk-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(Me,{children:[e.jsx(C,{style:{color:"#fa8c16"}}),e.jsx(Bs,{strong:!0,children:n("resources:repositories.rootDisk")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Bs,{children:[m.system.disk.used," / ",m.system.disk.total]})}),e.jsx(Be,{percent:Ds(m.system.disk.use_percent,m.system.disk.used,m.system.disk.total),status:(parseInt(m.system.disk.use_percent)||0)>90?"exception":"normal",strokeColor:(parseInt(m.system.disk.use_percent)||0)>90?"#ff4d4f":"#fa8c16",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(Bs,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",m.system.disk.available]})]})}),m.system.datastore?.path&&e.jsx(nt,{span:24,children:e.jsxs(at,{size:"small","data-testid":"vault-status-datastore-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(Me,{children:[e.jsx(jt,{style:{color:"#52c41a"}}),e.jsx(Bs,{strong:!0,children:n("resources:repositories.datastore")})]})}),e.jsx(Bs,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:8,wordBreak:"break-all"},children:m.system.datastore.path}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Bs,{children:[m.system.datastore.used," / ",m.system.datastore.total]})}),e.jsx(Be,{percent:Ds(m.system.datastore.use_percent,m.system.datastore.used,m.system.datastore.total),status:(parseInt(m.system.datastore.use_percent)||0)>90?"exception":"normal",strokeColor:(parseInt(m.system.datastore.use_percent)||0)>90?"#ff4d4f":"#52c41a",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(Bs,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",m.system.datastore.available]})]})})]})]}),m.network&&e.jsxs(e.Fragment,{children:[e.jsx(st,{style:{margin:"24px 0"},children:e.jsxs(Me,{children:[e.jsx(L,{}),n("resources:repositories.networkInfo")]})}),m.network.default_gateway&&e.jsx(at,{size:"small",style:{marginBottom:16},"data-testid":"vault-status-gateway-card",children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.defaultGateway"),":"]}),e.jsx(Bs,{strong:!0,"data-testid":"vault-status-gateway",children:m.network.default_gateway})]}),m.network.default_interface&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.defaultInterface"),":"]}),e.jsx(Bs,{"data-testid":"vault-status-interface",children:m.network.default_interface})]})]})}),e.jsx(ct,{dataSource:m.network.interfaces.filter(e=>"unknown"!==e.state&&"lo"!==e.name),style:c.marginBottom.lg,"data-testid":"vault-status-network-list",renderItem:t=>e.jsxs(at,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-network-${t.name}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(Me,{children:[e.jsx(os,{style:{color:"#1890ff"}}),e.jsx(Bs,{strong:!0,"data-testid":`vault-status-network-name-${t.name}`,children:t.name})]}),e.jsx($e,{color:"UP"===t.state?"success":"default","data-testid":`vault-status-network-state-${t.name}`,children:t.state})]}),e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[t.ipv4_addresses.length>0&&e.jsxs("div",{children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.ipAddresses"),":"]}),t.ipv4_addresses.map((t,s)=>e.jsx("div",{style:{marginLeft:16},children:e.jsx($e,{color:"blue","data-testid":`vault-status-ip-${t}`,children:t})},s))]}),t.mac_address&&"unknown"!==t.mac_address&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.macAddress"),":"]}),e.jsx(Bs,{style:{fontSize:12},children:t.mac_address})]}),t.mtu>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Bs,{type:"secondary",children:"MTU:"}),e.jsx(Bs,{children:t.mtu})]})]})]})})]}),m.block_devices&&m.block_devices.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(st,{style:{margin:"24px 0"},children:e.jsxs(Me,{children:[e.jsx(C,{}),n("resources:repositories.blockDevices")]})}),e.jsx(ct,{dataSource:m.block_devices,style:c.marginBottom.lg,"data-testid":"vault-status-block-devices-list",renderItem:t=>e.jsxs(at,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-block-device-${t.name}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(Me,{children:[e.jsx(C,{style:{color:"#fa8c16"}}),e.jsx(Bs,{strong:!0,"data-testid":`vault-status-device-path-${t.name}`,children:t.path})]}),e.jsxs(Me,{children:[e.jsx($e,{"data-testid":`vault-status-device-type-${t.name}`,children:t.type}),e.jsx($e,{color:"blue","data-testid":`vault-status-device-size-${t.name}`,children:t.size_human})]})]}),e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[t.model&&"Unknown"!==t.model&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.model"),":"]}),e.jsx(Bs,{style:{fontSize:12},children:t.model})]}),t.partitions.length>0&&e.jsxs("div",{children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.partitions"),":"]}),e.jsx("div",{style:{marginLeft:16,marginTop:8},children:t.partitions.map((t,s)=>e.jsx("div",{style:{marginBottom:4},children:e.jsxs(Me,{children:[e.jsx(Ie,{style:{fontSize:12}}),e.jsxs(Bs,{style:{fontSize:12},children:[t.name,": ",t.size_human,t.filesystem&&` (${t.filesystem})`,t.mountpoint&&` → ${t.mountpoint}`]})]})},s))})]})]})]})})]}),m.system_containers&&m.system_containers.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(st,{style:{margin:"24px 0"},children:e.jsxs(Me,{children:[e.jsx(Pt,{}),n("resources:repositories.systemContainers")]})}),e.jsx(ct,{dataSource:m.system_containers,style:c.marginBottom.lg,"data-testid":"vault-status-containers-list",renderItem:t=>e.jsxs(at,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-container-${t.id}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(Me,{children:[e.jsx(Pt,{style:{color:"#722ed1"}}),e.jsx(Bs,{strong:!0,"data-testid":`vault-status-container-name-${t.id}`,children:t.name})]}),e.jsx($e,{color:"running"===t.state?"success":"default","data-testid":`vault-status-container-state-${t.id}`,children:t.state})]}),e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsx(Bs,{type:"secondary",style:{fontSize:12},ellipsis:!0,children:t.image}),t.cpu_percent&&e.jsxs(Me,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(Bs,{type:"secondary",children:"CPU:"}),e.jsx(Bs,{children:t.cpu_percent})]}),t.memory_usage&&e.jsxs(Me,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.memory"),":"]}),e.jsx(Bs,{children:t.memory_usage})]})]})]})})]}),t&&e.jsx("div",{"data-testid":"vault-status-distributed-storage",children:e.jsx(Es,{machine:t,onViewDetails:()=>{d({open:!0,entityType:"Machine",entityIdentifier:t.machineName,entityName:t.machineName})}})})]}):e.jsx(He,{description:n("machines:noVaultData"),style:{marginTop:48},"data-testid":"vault-status-empty"})})]}),e.jsx(mt,{open:l.open,onCancel:()=>d({open:!1,entityType:null,entityIdentifier:null}),entityType:l.entityType,entityIdentifier:l.entityIdentifier,entityName:l.entityName})]}):null},Fs=({teamFilter:s,showActions:a=!0,className:n="",onEditMachine:o,onFunctionsMachine:c,onDeleteMachine:l,onCreateRepository:d,enabled:m=!0,onQueueItemCreated:u,expandedRowKeys:h,onExpandedRowsChange:p,refreshKeys:y,onRowClick:x,selectedMachine:g,onMachineRepositoryClick:f,onMachineContainerClick:w,onRefreshMachines:k})=>{const{t:C}=_e(["machines","common","functions","resources"]),T=t(e=>e.ui.uiMode),z="expert"===T,{executePingForMachineAndWait:I}=Ns(),$=b(),E=i.useRef(null),[V,F]=i.useState("machine"),[O,A]=i.useState([]),[P,G]=i.useState({}),[W,U]=i.useState({}),[Q,J]=i.useState(!1),[X,Y]=i.useState(null),[Z,ee]=i.useState(null),[te,se]=i.useState(!1),[ae,ie]=i.useState([]),re=void 0!==h?h:O,ne=p||A,oe=void 0!==y?y:W,[le,de]=i.useState({open:!1,entityType:null,entityIdentifier:null}),[me,ue]=i.useState({open:!1,machine:null}),[ve,be]=i.useState({open:!1,machine:null}),[ke,Ce]=i.useState(!1),[Se,Te]=i.useState(!1),[ze,Ie]=i.useState(!1),[De,Ee]=i.useState(null),[Be,Ve]=i.useState(!1);r.useEffect(()=>()=>{X&&clearTimeout(X)},[X]),r.useEffect(()=>{"simple"===T&&"machine"!==V&&F("machine")},[T,V]);const{data:Ae=[],isLoading:Pe,refetch:Le}=q(s,m),{data:Ge=[]}=H(s),We=((e,t={})=>{const{rowHeight:s=54,headerHeight:a=55,paginationHeight:r=64,containerOffset:n=32,minRows:o=5,maxRows:c=100}=t,[l,d]=i.useState(10),m=i.useRef(null),u=i.useCallback(()=>{if(!e.current)return;const t=e.current.offsetHeight-a-r-n,i=Math.floor(t/s),l=Math.max(o,Math.min(c,i));d(l)},[e,s,a,r,n,o,c]),h=i.useRef(null);return i.useEffect(()=>(h.current=yt.debounce(u,300),()=>{h.current?.cancel()}),[u]),i.useEffect(()=>{u(),e.current&&window.ResizeObserver&&(m.current=new ResizeObserver(()=>{h.current?.()}),m.current.observe(e.current));const t=()=>{h.current?.()};return window.addEventListener("resize",t),()=>{m.current&&m.current.disconnect(),window.removeEventListener("resize",t),h.current?.cancel()}},[u,e]),l})(E,{containerOffset:170,minRows:5,maxRows:50}),Ue=Ae,qe=e=>{try{if(!e.vaultStatus||e.vaultStatus.trim().startsWith("jq:")||e.vaultStatus.trim().startsWith("error:")||!e.vaultStatus.trim().startsWith("{"))return[];const t=JSON.parse(e.vaultStatus);if("completed"===t.status&&t.result){let e=t.result;if(e.match(/(\}[\s\n]*$)/)){const t=e.lastIndexOf("}");t<e.length-10&&(e=e.substring(0,t+1))}const s=e.indexOf("\njq:");s>0&&(e=e.substring(0,s)),e=e.trim();const a=JSON.parse(e);if(a?.repositories&&Array.isArray(a.repositories))return a.repositories.map(e=>{if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.name)){const t=Ge.find(t=>t.repositoryGuid===e.name);if(t)return{...e,name:t.repositoryName,repositoryGuid:t.repositoryGuid,grandGuid:t.grandGuid}}return e})}}catch(t){}return[]},Ke=i.useCallback(e=>{l&&l(e)},[l]),Qe=i.useCallback(e=>{x?x(e):(Ee(e),Ve(!0))},[x]),Je=i.useCallback(()=>{Ve(!1),Ee(null)},[]),{getFunctionsByCategory:Xe}=K(),Ye=i.useMemo(()=>Xe("machine").filter(e=>e&&!1!==e.showInMenu&&"mount"!==e.name&&"pull"!==e.name),[Xe]),Ze=r.useMemo(()=>{const t=[];return t.push({title:C("machines:machineName"),dataIndex:"machineName",key:"machineName",ellipsis:!0,sorter:(e,t)=>e.machineName.localeCompare(t.machineName),render:(t,s)=>{const a=re.includes(s.machineName);return e.jsxs(Me,{children:[e.jsx("span",{style:{display:"inline-block",width:12,transition:"transform 0.3s ease",transform:a?"rotate(90deg)":"rotate(0deg)"},"data-testid":`machine-expand-${s.machineName}`,children:e.jsx(Ne,{style:{fontSize:12,color:"#999"}})}),e.jsx(R,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})}}),x||t.push({title:C("machines:team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx($e,{color:"#8FBC8F",children:t}),sorter:(e,t)=>e.teamName.localeCompare(t.teamName)}),x||(z?t.push({title:C("machines:region"),dataIndex:"regionName",key:"regionName",width:150,ellipsis:!0,render:t=>t?e.jsx($e,{color:"purple",children:t}):"-",sorter:(e,t)=>(e.regionName||"").localeCompare(t.regionName||"")},{title:C("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",width:150,ellipsis:!0,render:t=>e.jsx($e,{color:"green",children:t}),sorter:(e,t)=>e.bridgeName.localeCompare(t.bridgeName)}):"simple"!==T&&t.push({title:C("bridges.bridge"),dataIndex:"bridgeName",key:"bridgeName",width:150,ellipsis:!0,render:t=>e.jsx($e,{color:"#8FBC8F",children:t})})),!x&&z&&M.isEnabled("assignToCluster")&&t.push({title:C("machines:assignmentStatus.title"),key:"assignmentStatus",width:180,ellipsis:!0,render:(t,s)=>e.jsx(he,{machine:s})}),x||t.push({title:C("machines:queueItems"),dataIndex:"queueCount",key:"queueCount",width:100,align:"center",sorter:(e,t)=>e.queueCount-t.queueCount,render:t=>e.jsx(it,{count:t,showZero:!0,style:{backgroundColor:t>0?"#52c41a":"#d9d9d9"}})}),a&&t.push({title:C("common:table.actions"),key:"actions",width:j.DIMENSIONS.CARD_WIDTH,render:(t,s)=>e.jsxs(Me,{children:[e.jsx(Oe,{title:C("common:actions.edit"),children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(B,{}),onClick:()=>o&&o(s),"data-testid":`machine-edit-${s.machineName}`,"aria-label":C("common:actions.edit")})}),e.jsx(lt,{"data-testid":`machine-dropdown-${s.machineName}`,menu:{items:[{key:"createRepo",label:C("machines:createRepo"),icon:e.jsx(ce,{}),onClick:()=>d&&d(s),"data-testid":`machine-create-repo-${s.machineName}`},{key:"pull",label:C("functions:functions.pull.name"),icon:e.jsx(gs,{}),onClick:()=>{ue({open:!0,machine:s})},"data-testid":`machine-pull-${s.machineName}`},{key:"functions",label:C("machines:runAction"),icon:e.jsx(pe,{}),"data-testid":`machine-functions-${s.machineName}`,children:[...Ye.map(t=>({key:`function-${t?.name||"unknown"}`,label:e.jsx("span",{title:t?.description||"",children:t?.name||"Unknown"}),onClick:()=>{c&&t?.name&&(c(s,t.name),void 0===y&&U(e=>({...e,[s.machineName]:Date.now()})))},"data-testid":`machine-function-${t?.name||"unknown"}-${s.machineName}`})),{type:"divider"},{key:"advanced",label:C("machines:advanced"),icon:e.jsx(pe,{}),onClick:()=>{c&&(c(s),void 0===y&&U(e=>({...e,[s.machineName]:Date.now()})))},"data-testid":`machine-advanced-${s.machineName}`}]},{key:"test",label:C("machines:connectivityTest"),icon:e.jsx(L,{}),onClick:async()=>{v("info",C("machines:testingConnection"));const e=await I(s,{priority:4,description:"Connectivity test",addedVia:"machine-table",timeout:15e3});e.success?v("success",C("machines:connectionSuccessful")):v("error",e.error||C("machines:connectionFailed"))},"data-testid":`machine-test-${s.machineName}`},...z&&M.isEnabled("assignToCluster")?[{key:"assignCluster",label:s.distributedStorageClusterName?C("machines:changeClusterAssignment"):C("machines:assignToCluster"),icon:e.jsx(pt,{}),onClick:()=>{be({open:!0,machine:s})},"data-testid":`machine-assign-cluster-${s.machineName}`}]:[]]},trigger:["click"],children:e.jsx(Oe,{title:C("machines:remote"),children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(pe,{}),"data-testid":`machine-remote-${s.machineName}`,"aria-label":C("machines:remote")})})}),e.jsx(Oe,{title:C("machines:trace"),children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(S,{}),onClick:()=>{de({open:!0,entityType:"Machine",entityIdentifier:s.machineName,entityName:s.machineName})},"data-testid":`machine-trace-${s.machineName}`,"aria-label":C("machines:trace")})}),e.jsx(Oe,{title:C("common:actions.delete"),children:e.jsx(Fe,{type:"primary",danger:!0,size:"small",icon:e.jsx(D,{}),onClick:()=>Ke(s),"data-testid":`machine-delete-${s.machineName}`,"aria-label":C("common:actions.delete")})}),e.jsx(ye,{machine:s.machineName,teamName:s.teamName})]})}),t},[z,T,a,C,Ke,o,c,d,I,Ye,re,y,U,be,de,ue,x]),et=z&&M.isEnabled("assignToCluster")?{selectedRowKeys:ae,onChange:e=>{ie(e)},getCheckboxProps:e=>({disabled:!1,"data-testid":`machine-checkbox-${e.machineName}`})}:void 0,tt=i.useMemo(()=>{const e={};return"machine"===V||Ue.forEach(t=>{let s="";if("bridge"===V)s=t.bridgeName;else if("team"===V)s=t.teamName;else if("region"===V)s=t.regionName||"Unknown";else{if("repository"===V){const s=qe(t);if(0===s.length)return;return void s.forEach(s=>{const a=s.name;e[a]||(e[a]=[]),e[a].find(e=>e.machineName===t.machineName)||e[a].push(t)})}if("status"===V){const e=qe(t);if(0===e.length)s="No Repositories";else{const t=e.some(e=>!e.accessible),a=e.some(e=>e.mounted&&e.docker_running),i=e.some(e=>e.mounted&&!e.docker_running),r=e.some(e=>!e.mounted);s=t?"Inaccessible":a?"Active (Running)":i?"Ready (Stopped)":r?"Not Mounted":"Unknown Status"}}else if("grand"===V){const s=qe(t);if(0===s.length)return;return void s.forEach(s=>{let a="No Grand Repository";if(s.grandGuid){const e=Ge.find(e=>e.repositoryGuid===s.grandGuid);e&&(a=e.repositoryName)}e[a]||(e[a]=[]),e[a].find(e=>e.machineName===t.machineName)||e[a].push(t)})}}s&&(e[s]||(e[s]=[]),e[s].push(t))}),e},[Ue,V,Ge,qe]);return e.jsxs("div",{className:n,children:["simple"===T?null:e.jsx("div",{style:{marginBottom:16},children:e.jsxs(Me,{wrap:!0,size:"small",children:[e.jsx(Oe,{title:C("machines:machine"),children:e.jsx(Fe,{type:"machine"===V?"primary":"default",icon:e.jsx(R,{}),onClick:()=>F("machine"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-machine","aria-label":C("machines:machine")})}),e.jsx("div",{style:{width:1,height:24,backgroundColor:"var(--color-border)",margin:"0 8px"}}),e.jsx(Oe,{title:C("machines:groupByBridge"),children:e.jsx(Fe,{type:"bridge"===V?"primary":"default",icon:e.jsx(pt,{}),onClick:()=>F("bridge"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-bridge","aria-label":C("machines:groupByBridge")})}),e.jsx(Oe,{title:C("machines:groupByTeam"),children:e.jsx(Fe,{type:"team"===V?"primary":"default",icon:e.jsx(ht,{}),onClick:()=>F("team"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-team","aria-label":C("machines:groupByTeam")})}),z&&e.jsx(Oe,{title:C("machines:groupByRegion"),children:e.jsx(Fe,{type:"region"===V?"primary":"default",icon:e.jsx(_,{}),onClick:()=>F("region"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-region","aria-label":C("machines:groupByRegion")})}),e.jsx(Oe,{title:C("machines:groupByRepository"),children:e.jsx(Fe,{type:"repository"===V?"primary":"default",icon:e.jsx(ce,{}),onClick:()=>F("repository"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-repository","aria-label":C("machines:groupByRepository")})}),e.jsx(Oe,{title:C("machines:groupByStatus"),children:e.jsx(Fe,{type:"status"===V?"primary":"default",icon:e.jsx(we,{}),onClick:()=>F("status"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-status","aria-label":C("machines:groupByStatus")})}),e.jsx(Oe,{title:C("machines:groupByGrand"),children:e.jsx(Fe,{type:"grand"===V?"primary":"default",icon:e.jsx(Xt,{}),onClick:()=>F("grand"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-grand","aria-label":C("machines:groupByGrand")})})]})}),z&&M.isEnabled("assignToCluster")&&0!==ae.length?e.jsxs("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f0f2f5",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(Me,{children:[e.jsx("span",{style:{fontWeight:500},children:C("machines:bulkActions.selected",{count:ae.length})}),e.jsx(Oe,{title:C("common:actions.clearSelection"),children:e.jsx(Fe,{size:"small",onClick:()=>ie([]),"data-testid":"machine-bulk-clear-selection","aria-label":C("common:actions.clearSelection")})})]}),e.jsxs(Me,{children:[e.jsx(Oe,{title:C("machines:bulkActions.assignToCluster"),children:e.jsx(Fe,{type:"primary",icon:e.jsx(pt,{}),onClick:()=>Ce(!0),"data-testid":"machine-bulk-assign-cluster","aria-label":C("machines:bulkActions.assignToCluster")})}),e.jsx(Oe,{title:C("machines:bulkActions.removeFromCluster"),children:e.jsx(Fe,{icon:e.jsx(pt,{}),onClick:()=>Te(!0),"data-testid":"machine-bulk-remove-cluster","aria-label":C("machines:bulkActions.removeFromCluster")})}),e.jsx(Oe,{title:C("machines:bulkActions.viewAssignmentStatus"),children:e.jsx(Fe,{icon:e.jsx(N,{}),onClick:()=>Ie(!0),"data-testid":"machine-bulk-view-status","aria-label":C("machines:bulkActions.viewAssignmentStatus")})})]})]}):null,"machine"===V?e.jsx("div",{ref:E,style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(Re,{columns:Ze,dataSource:Ue,rowKey:"machineName",loading:Pe,scroll:{x:!0,y:"calc(100vh - 400px)"},rowSelection:et,rowClassName:e=>g?.machineName===e.machineName?"ant-table-row-selected":"","data-testid":"machine-table",pagination:{pageSize:We,showSizeChanger:!1,showTotal:(e,t)=>C("common:table.showingRecords",{start:t[0],end:t[1],total:e})},onRow:e=>({"data-testid":`machine-row-${e.machineName}`,onClick:t=>{const s=t.target;if(s.closest("button")||s.closest(".ant-dropdown-trigger"))return;if(re.includes(e.machineName))ne(re.filter(t=>t!==e.machineName));else if(ne([...re,e.machineName]),G(t=>({...t,[e.machineName]:Date.now()})),k){ee(e.machineName),se(!0);const t=setTimeout(()=>{J(!0)},1e3);Y(t),k().finally(()=>{X&&clearTimeout(X),se(!1),J(!1),ee(null),Y(null)})}x&&Qe(e)},style:{cursor:"pointer",transition:"background-color 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.02)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=""}}),expandable:{expandedRowRender:t=>e.jsx(xe,{machine:t,refreshKey:oe[t.machineName],onActionComplete:()=>{void 0===y&&U(e=>({...e,[t.machineName]:Date.now()}))},onRepositoryClick:e=>f?.(t,e),onContainerClick:e=>w?.(t,e),onCreateRepository:d,isLoading:Q&&Z===t.machineName,onRefreshMachines:k,onQueueItemCreated:u},`${t.machineName}-${P[t.machineName]||0}-${oe[t.machineName]||0}`),rowExpandable:()=>!0,expandedRowKeys:re,onExpandedRowsChange:e=>{const t=e;ne(t);const s={...P};t.forEach(e=>{re.includes(e)||(s[e]=Date.now())}),G(s)},expandIcon:()=>null,expandRowByClick:!1},sticky:!0})}):(()=>{const t=()=>{switch(V){case"machine":case"repository":return"#556b2f";case"bridge":return"green";case"team":return"#8FBC8F";case"region":return"purple";case"status":return"geekblue";case"grand":return"blue";default:return"default"}};if(0===Object.keys(tt).length)return e.jsx(He,{image:He.PRESENTED_IMAGE_SIMPLE,description:C("resources:repositories.noRepositories"),style:{marginTop:48}});const s=e=>e%2==0?"rgba(0, 0, 0, 0.02)":"transparent",a=e=>e%2==0?"rgba(0, 0, 0, 0.08)":"#f0f0f0",i=e=>e%2==0?"#595959":"transparent";return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:32},children:Object.entries(tt).map(([r,n],o)=>e.jsx(at,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0"},children:[o%2==0&&e.jsx("div",{style:{width:4,height:j.DIMENSIONS.ICON_XL,backgroundColor:i(o),borderRadius:2}}),e.jsxs(Me,{children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:"bold",color:"#333",marginRight:8},children:["#",o+1]}),e.jsx($e,{color:t(),style:{fontSize:"16px",padding:"4px 16px",fontWeight:500},icon:"bridge"===V?e.jsx(pt,{}):"team"===V?e.jsx(ht,{}):"region"===V?e.jsx(_,{}):"repository"===V?e.jsx(ce,{}):"status"===V?e.jsx(we,{}):"grand"===V?e.jsx(Xt,{}):null,children:r}),e.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[n.length," ",1===n.length?C("machines:machine"):C("machines:machines")]})]})]}),styles:{body:{padding:0,backgroundColor:s(o)}},style:{borderColor:a(o),borderWidth:2,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},headStyle:{backgroundColor:s(o),borderBottom:`2px solid ${a(o)}`},children:n.map((t,s)=>e.jsx("div",{style:{borderBottom:s<n.length-1?`1px solid ${a(o)}`:"none",backgroundColor:s%2==0?"transparent":"rgba(0, 0, 0, 0.01)"},children:e.jsx(xe,{machine:t,refreshKey:oe[t.machineName],onActionComplete:()=>{void 0===y&&U(e=>({...e,[t.machineName]:Date.now()}))},onRepositoryClick:e=>f?.(t,e),onContainerClick:e=>w?.(t,e),onCreateRepository:d,hideSystemInfo:!0,isLoading:Q&&Z===t.machineName,onRefreshMachines:k,onQueueItemCreated:u},`${t.machineName}-${P[t.machineName]||0}-${oe[t.machineName]||0}`)},t.machineName))},r))})})(),e.jsx(mt,{open:le.open,onCancel:()=>de({open:!1,entityType:null,entityIdentifier:null}),entityType:le.entityType,entityIdentifier:le.entityIdentifier,entityName:le.entityName}),me.machine&&e.jsx(_s,{open:me.open,onCancel:()=>ue({open:!1,machine:null}),machineName:me.machine.machineName,teamName:me.machine.teamName,bridgeName:me.machine.bridgeName,onQueueItemCreated:u}),ve.machine&&e.jsx(ge,{open:ve.open,machine:ve.machine,onCancel:()=>be({open:!1,machine:null}),onSuccess:()=>{be({open:!1,machine:null}),Le()}}),e.jsx(ge,{open:ke,machines:Ae.filter(e=>ae.includes(e.machineName)),onCancel:()=>Ce(!1),onSuccess:()=>{Ce(!1),ie([]),Le()}}),e.jsx(fe,{open:Se,machines:Ae.filter(e=>ae.includes(e.machineName)),onCancel:()=>Te(!1),onSuccess:()=>{Te(!1),ie([]),Le()}}),e.jsx(je,{open:ze,machines:Ae.filter(e=>ae.includes(e.machineName)),onCancel:()=>Ie(!1)}),!x&&e.jsx(Rs,{machine:De,visible:Be,onClose:Je})]})},{Text:Os,Title:As}=De,Ps=({repository:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=_e(["resources","common","machines"]),{theme:o}=u(),{data:c=[]}=q(t?.teamName),l=b(),d=i.useMemo(()=>{if(!t||!c.length)return null;for(const s of c)if(s.vaultStatus)try{if(s.vaultStatus.trim().startsWith("jq:")||s.vaultStatus.trim().startsWith("error:")||!s.vaultStatus.trim().startsWith("{"))continue;const e=JSON.parse(s.vaultStatus);if("completed"===e.status&&e.result){let a=e.result;if(a.match(/(\}[\s\n]*$)/)){const e=a.lastIndexOf("}");e<a.length-10&&(a=a.substring(0,e+1))}const i=a.indexOf("\njq:");i>0&&(a=a.substring(0,i)),a=a.trim();const r=JSON.parse(a);if(r.repositories&&Array.isArray(r.repositories)){const e=r.repositories.find(e=>e.name===t.repositoryName||e.name===t.repositoryGuid);if(e){const a=[];return r.services&&Array.isArray(r.services)&&r.services.forEach(s=>{if(s.repository===e.name||s.repository===t.repositoryGuid)a.push(s);else if(s.service_name||s.unit_file){const i=(s.service_name||s.unit_file||"").match(/rediacc_([0-9a-f-]{36})_/);!i||i[1]!==t.repositoryGuid&&i[1]!==e.name||a.push(s)}}),{machine:s,repositoryData:e,systemData:r.system,services:a}}}}}catch(e){}return null},[t,c]);return i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,a]),t&&s?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"repository-detail-panel","data-testid":"repo-detail-panel",style:r?{height:"100%",backgroundColor:"dark"===o?"#141414":"#fff",overflowY:"auto",overflowX:"hidden"}:{position:"fixed",top:0,right:s?0:"-520px",bottom:0,width:"520px",maxWidth:"100vw",backgroundColor:"dark"===o?"#141414":"#fff",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,transition:"right 0.3s ease-in-out",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),position:"sticky",top:0,backgroundColor:"dark"===o?"#141414":"#fff",zIndex:r?0:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(Me,{children:[e.jsx(Mt,{style:{fontSize:24,color:"#8FBC8F"}}),e.jsx(As,{level:4,style:{margin:0},"data-testid":`repo-detail-title-${t.repositoryName}`,children:t.repositoryName})]}),e.jsx(Fe,{type:"text",icon:e.jsx(T,{}),onClick:a,style:l.touchTarget,"data-testid":"repo-detail-close"})]}),e.jsxs(Me,{wrap:!0,style:{marginTop:8},children:[e.jsxs($e,{color:"#8FBC8F",icon:e.jsx(z,{}),"data-testid":`repo-detail-team-tag-${t.repositoryName}`,children:["Team: ",t.teamName]}),d&&e.jsxs($e,{color:"green",icon:e.jsx(pt,{}),"data-testid":`repo-detail-machine-tag-${t.repositoryName}`,children:["Machine: ",d.machine.machineName]}),e.jsxs($e,{color:"blue","data-testid":`repo-detail-vault-version-tag-${t.repositoryName}`,children:[n("resources:repositories.vaultVersion"),": ",t.vaultVersion]})]})]}),e.jsx("div",{style:{padding:"24px"},"data-testid":"repo-detail-content",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},"data-testid":"repo-detail-info-section",children:[e.jsx(Mt,{style:{fontSize:20,color:"#8FBC8F"}}),e.jsx(As,{level:5,style:{margin:0},children:n("resources:repositories.repositoryInfo")})]}),e.jsx(rt,{gutter:[16,16],style:l.marginBottom.lg,children:e.jsx(nt,{span:24,children:e.jsx(at,{size:"small",style:l.card,"data-testid":"repo-detail-info-card",children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Os,{type:"secondary",children:[n("resources:repositories.repositoryGuid"),":"]}),e.jsx(Os,{copyable:!0,style:{fontSize:11,fontFamily:"monospace"},"data-testid":`repo-detail-guid-${t.repositoryName}`,children:t.repositoryGuid})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Os,{type:"secondary",children:[n("resources:repositories.status"),":"]}),e.jsxs(Me,{children:[d.repositoryData.mounted?e.jsx($e,{color:"success",icon:e.jsx(h,{}),"data-testid":`repo-detail-status-mounted-${t.repositoryName}`,children:n("resources:repositories.mounted")}):e.jsx($e,{color:"default",icon:e.jsx(ut,{}),"data-testid":`repo-detail-status-unmounted-${t.repositoryName}`,children:n("resources:repositories.notMounted")}),d.repositoryData.accessible&&e.jsx($e,{color:"green","data-testid":`repo-detail-status-accessible-${t.repositoryName}`,children:n("resources:repositories.accessible")})]})]}),d.repositoryData.has_rediaccfile&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Os,{type:"secondary",children:[n("resources:repositories.rediaccfile"),":"]}),e.jsx($e,{color:"purple","data-testid":`repo-detail-rediaccfile-${t.repositoryName}`,children:n("resources:repositories.hasRediaccfile")})]}),d.repositoryData.docker_running&&d.repositoryData.volume_status&&"none"!==d.repositoryData.volume_status&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Os,{type:"secondary",children:"Docker Volumes:"}),"safe"===d.repositoryData.volume_status?e.jsxs($e,{color:"success",icon:e.jsx(h,{}),"data-testid":`repo-detail-volume-safe-${t.repositoryName}`,children:[d.repositoryData.internal_volumes," Safe Volume",1!==d.repositoryData.internal_volumes?"s":""]}):"warning"===d.repositoryData.volume_status?e.jsxs($e,{color:"warning",icon:e.jsx($,{}),"data-testid":`repo-detail-volume-warning-${t.repositoryName}`,children:[d.repositoryData.external_volumes," External, ",d.repositoryData.internal_volumes," Internal"]}):null]})]})})})}),"warning"===d.repositoryData.volume_status&&d.repositoryData.external_volume_names&&d.repositoryData.external_volume_names.length>0&&e.jsx(Ve,{type:"warning",showIcon:!0,icon:e.jsx($,{}),message:"External Docker Volumes Detected",description:e.jsxs("div",{children:[e.jsx(Os,{children:"The following volumes are stored outside the repository:"}),e.jsx("ul",{style:{marginTop:8,marginBottom:8},children:d.repositoryData.external_volume_names.map(t=>e.jsx("li",{children:e.jsx(Os,{code:!0,children:t})},t))}),e.jsxs(Os,{type:"secondary",children:[e.jsx("strong",{children:"Warning:"})," If this repository is cloned, these volumes will be orphaned. Consider using bind mounts to ",e.jsx(Os,{code:!0,children:"$REPO_PATH"})," instead."]})]}),style:{marginBottom:16},"data-testid":`repo-detail-volume-warning-alert-${t.repositoryName}`}),e.jsx(st,{style:{margin:"24px 0"},"data-testid":"repo-detail-storage-divider",children:e.jsxs(Me,{children:[e.jsx(N,{}),n("resources:repositories.storageInfo")]})}),e.jsxs(rt,{gutter:[16,16],style:l.marginBottom.lg,children:[e.jsx(nt,{span:12,children:e.jsx(at,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-image-size-card-${t.repositoryName}`,children:e.jsx(ot,{title:n("resources:repositories.imageSize"),value:d.repositoryData.size_human,prefix:e.jsx(C,{}),valueStyle:{fontSize:16}})})}),e.jsx(nt,{span:12,children:e.jsx(at,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-last-modified-card-${t.repositoryName}`,children:e.jsx(ot,{title:n("resources:repositories.lastModified"),value:d.repositoryData.modified_human,prefix:e.jsx(p,{}),valueStyle:{fontSize:16}})})}),d.repositoryData.mounted&&d.repositoryData.disk_space&&e.jsx(nt,{span:24,children:e.jsxs(at,{size:"small","data-testid":`repo-detail-disk-usage-card-${t.repositoryName}`,children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(Me,{children:[e.jsx(jt,{style:{color:"#52c41a"}}),e.jsx(Os,{strong:!0,children:n("resources:repositories.diskUsage")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Os,{children:[d.repositoryData.disk_space.used," / ",d.repositoryData.disk_space.total]})}),e.jsx(Be,{percent:parseInt(d.repositoryData.disk_space.use_percent),status:parseInt(d.repositoryData.disk_space.use_percent)>90?"exception":"normal",strokeColor:parseInt(d.repositoryData.disk_space.use_percent)>90?"#ff4d4f":"#52c41a",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0,"data-testid":`repo-detail-disk-usage-progress-${t.repositoryName}`}),e.jsxs(Os,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",d.repositoryData.disk_space.available]})]})})]}),e.jsx(st,{style:{margin:"24px 0"},"data-testid":"repo-detail-file-paths-divider",children:e.jsxs(Me,{children:[e.jsx(Mt,{}),n("resources:repositories.filePaths")]})}),e.jsx(at,{size:"small",style:l.card,"data-testid":`repo-detail-file-paths-card-${t.repositoryName}`,children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{children:[e.jsxs(Os,{type:"secondary",children:[n("resources:repositories.imagePath"),":"]}),e.jsx(Os,{copyable:!0,style:{display:"block",fontSize:12,wordBreak:"break-all",marginTop:4},"data-testid":`repo-detail-image-path-${t.repositoryName}`,children:d.repositoryData.image_path})]}),d.repositoryData.mount_path&&e.jsxs("div",{children:[e.jsxs(Os,{type:"secondary",children:[n("resources:repositories.mountPath"),":"]}),e.jsx(Os,{copyable:!0,style:{display:"block",fontSize:12,wordBreak:"break-all",marginTop:4},"data-testid":`repo-detail-mount-path-${t.repositoryName}`,children:d.repositoryData.mount_path})]})]})}),d.repositoryData.mounted&&e.jsxs(e.Fragment,{children:[e.jsx(st,{style:{margin:"24px 0"},"data-testid":"repo-detail-activity-divider",children:e.jsxs(Me,{children:[e.jsx(bt,{}),n("resources:repositories.activity")]})}),e.jsxs(rt,{gutter:[16,16],style:l.marginBottom.lg,children:[d.repositoryData.docker_running&&e.jsx(nt,{span:12,children:e.jsx(at,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-containers-card-${t.repositoryName}`,children:e.jsx(ot,{title:n("resources:repositories.containers"),value:d.repositoryData.container_count,valueStyle:{color:"#1890ff"}})})}),d.repositoryData.has_services&&e.jsx(nt,{span:12,children:e.jsx(at,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-services-card-${t.repositoryName}`,children:e.jsx(ot,{title:n("resources:repositories.services"),value:d.repositoryData.service_count,valueStyle:{color:"#fa8c16"}})})})]})]}),d.services&&d.services.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(st,{style:{margin:"24px 0"},"data-testid":"repo-detail-services-divider",children:e.jsxs(Me,{children:[e.jsx(Ie,{}),n("resources:repositories.servicesSection")]})}),e.jsx(Me,{direction:"vertical",style:{width:"100%"},size:"middle","data-testid":"repo-detail-services-list",children:d.services.map((s,a)=>e.jsx(at,{size:"small","data-testid":`repo-detail-service-card-${t.repositoryName}-${s.name}`,style:{borderLeft:"4px solid "+("active"===s.active_state?"#52c41a":"failed"===s.active_state?"#ff4d4f":"#d9d9d9")},children:e.jsxs(rt,{gutter:[16,8],children:[e.jsx(nt,{span:24,children:e.jsxs(Me,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(Os,{strong:!0,"data-testid":`repo-detail-service-name-${t.repositoryName}-${s.name}`,children:s.name}),e.jsx($e,{"data-testid":`repo-detail-service-status-${t.repositoryName}-${s.name}`,color:"active"===s.active_state?"success":"failed"===s.active_state?"error":"default",children:s.active_state})]})}),(s.memory_human||s.main_pid||s.uptime_human)&&e.jsx(nt,{span:24,children:e.jsxs(Me,{wrap:!0,size:"middle",children:[s.memory_human&&e.jsxs("div",{children:[e.jsx(Os,{type:"secondary",style:{fontSize:11},children:"Memory"}),e.jsx("br",{}),e.jsx(Os,{style:{fontSize:12},children:s.memory_human})]}),s.main_pid&&e.jsxs("div",{children:[e.jsx(Os,{type:"secondary",style:{fontSize:11},children:"PID"}),e.jsx("br",{}),e.jsx(Os,{style:{fontSize:12},children:s.main_pid})]}),s.uptime_human&&e.jsxs("div",{children:[e.jsx(Os,{type:"secondary",style:{fontSize:11},children:"Uptime"}),e.jsx("br",{}),e.jsx(Os,{style:{fontSize:12},children:s.uptime_human})]}),void 0!==s.restarts&&e.jsxs("div",{children:[e.jsx(Os,{type:"secondary",style:{fontSize:11},children:"Restarts"}),e.jsx("br",{}),e.jsx(Os,{style:{fontSize:12},children:s.restarts})]})]})})]})},`${s.name}-${a}`))})]})]}):e.jsx(He,{description:n("resources:repositories.noRepositoryData"),style:{marginTop:48},"data-testid":"repo-detail-empty-state"})})]})}):null},{Text:Ls,Title:Gs}=De,Ws=({container:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=_e(["resources","common"]),{theme:o}=u(),c=b();i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};if(s)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,a]);const l=i.useMemo(()=>{if(!t)return null;const e=parseFloat(t.cpu_percent?.replace("%","")||"0"),s=t.memory_usage?.split(" / ")||[],a=s[0]||"0",i=s[1]||"0",r=parseFloat(t.memory_percent?.replace("%","")||"0"),n=t.net_io?.split(" / ")||[],o=n[0]||"0",c=n[1]||"0",l=t.block_io?.split(" / ")||[];return{cpu:e,memoryUsed:a,memoryTotal:i,memoryPercent:r,netIn:o,netOut:c,blockRead:l[0]||"0",blockWrite:l[1]||"0",pids:parseInt(t.pids||"0")}},[t]),d=t?.name?.startsWith("plugin-"),m=d&&t?t.name.replace("plugin-",""):null;return s&&t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:r?"16px 24px":"16px 24px 0",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),display:"flex",justifyContent:"space-between",alignItems:"center"},"data-testid":"container-detail-header",children:[e.jsx(Gs,{level:4,style:{margin:0},"data-testid":"container-detail-title",children:n(d?"resources:containers.pluginDetails":"resources:containers.containerDetails")}),!r&&e.jsx(Fe,{type:"text",icon:e.jsx(T,{}),onClick:a,style:{...c.touchTarget,marginRight:-8},"data-testid":"container-detail-close"})]}),e.jsxs("div",{style:{padding:"24px",height:r?"calc(100% - 57px)":void 0,overflow:"auto"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(Me,{size:"small",style:{marginBottom:8},children:[e.jsx($e,{color:d?"blue":"cyan",icon:d?e.jsx(I,{}):e.jsx(z,{}),"data-testid":"container-detail-name-tag",children:d?`Plugin: ${m}`:t.name}),e.jsx($e,{color:"running"===t.state?"success":"default",icon:"running"===t.state?e.jsx(ke,{}):e.jsx(ve,{}),"data-testid":"container-detail-state-tag",children:t.state})]})}),t&&e.jsxs(e.Fragment,{children:[e.jsx(at,{size:"small",style:{...c.card,marginBottom:16},"data-testid":"container-detail-basic-info",children:e.jsx(rt,{gutter:[16,16],style:c.marginBottom.lg,children:e.jsx(nt,{span:24,children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.containerID"),":"]}),e.jsx("br",{}),e.jsx(Ls,{copyable:!0,style:{fontFamily:"monospace",fontSize:12},"data-testid":"container-detail-id",children:t.id})]}),e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.image"),":"]}),e.jsx("br",{}),e.jsx(Ls,{style:{fontSize:12,wordBreak:"break-all"},"data-testid":"container-detail-image",children:t.image})]}),e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.status"),":"]}),e.jsx("br",{}),e.jsx(Ls,{style:{fontSize:12},"data-testid":"container-detail-status",children:t.status})]}),e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.created"),":"]}),e.jsx("br",{}),e.jsx(Ls,{style:{fontSize:12},"data-testid":"container-detail-created",children:t.created})]})]})})})}),e.jsx(st,{style:{margin:"24px 0"},children:e.jsxs(Me,{children:[e.jsx(pt,{}),n("resources:containers.resourceUsage")]})}),e.jsxs(rt,{gutter:[16,16],style:c.marginBottom.lg,children:[e.jsx(nt,{xs:24,sm:12,children:e.jsxs(at,{size:"small","data-testid":"container-detail-cpu-card",children:[e.jsx(ot,{title:n("resources:containers.cpuUsage"),value:l?.cpu||0,suffix:"%",valueStyle:{color:l?.cpu&&l.cpu>80?"#ff4d4f":void 0}}),e.jsx(Be,{percent:l?.cpu||0,showInfo:!1,status:l?.cpu&&l.cpu>80?"exception":"normal"})]})}),e.jsx(nt,{xs:24,sm:12,children:e.jsxs(at,{size:"small","data-testid":"container-detail-memory-card",children:[e.jsx(ot,{title:n("resources:containers.memoryUsage"),value:`${l?.memoryUsed} / ${l?.memoryTotal}`,valueStyle:{fontSize:16}}),e.jsx(Be,{percent:l?.memoryPercent||0,status:l?.memoryPercent&&l.memoryPercent>90?"exception":"normal"})]})}),e.jsx(nt,{xs:24,sm:12,children:e.jsx(at,{size:"small","data-testid":"container-detail-network-card",children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.networkIO"),":"]})}),e.jsx("div",{children:e.jsxs(Ls,{style:{fontSize:12},children:[e.jsx(L,{style:{marginRight:4}}),"↓ ",l?.netIn," / ↑ ",l?.netOut]})})]})})}),e.jsx(nt,{xs:24,sm:12,children:e.jsx(at,{size:"small","data-testid":"container-detail-block-io-card",children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.blockIO"),":"]})}),e.jsx("div",{children:e.jsxs(Ls,{style:{fontSize:12},children:[e.jsx(C,{style:{marginRight:4}}),"R: ",l?.blockRead," / W: ",l?.blockWrite]})})]})})})]}),e.jsx(st,{style:{margin:"24px 0"},children:e.jsxs(Me,{children:[e.jsx(Ie,{}),n("resources:containers.configuration")]})}),e.jsx(at,{size:"small",style:{...c.card,marginBottom:16},"data-testid":"container-detail-configuration",children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.command"),":"]}),e.jsx("br",{}),e.jsx(Ls,{code:!0,style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-command",children:t.command})]}),(t.port_mappings&&t.port_mappings.length>0||t.ports)&&e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.ports"),":"]}),e.jsx("br",{}),t.port_mappings&&t.port_mappings.length>0?e.jsx(Me,{direction:"vertical",size:"small",style:{marginTop:4},children:t.port_mappings.map((t,s)=>e.jsx($e,{color:"blue","data-testid":`container-detail-port-${s}`,children:t.host_port?`${t.host||"0.0.0.0"}:${t.host_port} → ${t.container_port}/${t.protocol}`:`${t.container_port}/${t.protocol}`},s))}):t.ports?e.jsx(Ls,{style:{fontSize:12},"data-testid":"container-detail-ports-text",children:t.ports}):null]}),e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.networks"),":"]}),e.jsx("br",{}),e.jsx($e,{color:"purple","data-testid":"container-detail-network-tag",children:t.networks})]}),e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.size"),":"]}),e.jsx("br",{}),e.jsx(Ls,{style:{fontSize:12},"data-testid":"container-detail-size",children:t.size})]}),e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.processes"),":"]}),e.jsx("br",{}),e.jsxs($e,{"data-testid":"container-detail-pids",children:[l?.pids||0," ",n("resources:containers.pids")]})]})]})}),e.jsx(st,{style:{margin:"24px 0"},children:e.jsxs(Me,{children:[e.jsx(Mt,{}),n("resources:containers.environment")]})}),e.jsx(at,{size:"small",style:c.card,"data-testid":"container-detail-environment",children:e.jsxs(Me,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.mounts"),":"]}),e.jsx("br",{}),e.jsx(Ls,{style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-mounts",children:t.mounts})]}),t.labels&&e.jsxs("div",{children:[e.jsxs(Ls,{type:"secondary",children:[n("resources:containers.labels"),":"]}),e.jsx("br",{}),e.jsx(Ls,{style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-labels",children:t.labels})]})]})})]})]})]}):null},Us=({type:t,data:s,visible:a,onClose:r,splitWidth:n,onSplitWidthChange:o})=>{const{theme:c}=u(),l=i.useRef(!1),d=i.useRef(0),m=i.useRef(0),[h,p]=i.useState(1),[y,x]=i.useState(s),[g,f]=i.useState(!1),[j,v]=i.useState(s);s!==j&&(x(s),v(s));if(i.useEffect(()=>{const e=e=>{if(!l.current)return;const t=d.current-e.clientX,s=window.innerWidth,a=Math.min(800,s-400),i=Math.max(300,Math.min(a,m.current+t));o(i)},t=()=>{l.current&&(l.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[n,o]),!a||!y)return null;const b=t||(y&&"machineName"in y?"machine":y&&"repositoryName"in y?"repository":"container");return e.jsxs("div",{style:{position:"relative",width:n,height:"100%",borderLeft:"1px solid "+("dark"===c?"#303030":"#f0f0f0"),display:"flex",flexShrink:0,opacity:h,transition:"opacity 0.3s ease"},"data-testid":"unified-detail-panel",children:[e.jsx("div",{style:{position:"absolute",left:-3,top:0,bottom:0,width:6,cursor:"ew-resize",zIndex:10,backgroundColor:"transparent"},onMouseDown:e=>{l.current=!0,d.current=e.clientX,m.current=n,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",e.preventDefault()},"data-testid":"unified-detail-resize-handle",children:e.jsx("div",{style:{position:"absolute",left:2,top:0,bottom:0,width:2,backgroundColor:"dark"===c?"#303030":"#f0f0f0",transition:"background-color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="dark"===c?"#303030":"#f0f0f0"}})}),e.jsx("div",{style:{flex:1,overflow:"hidden"},"data-testid":"unified-detail-content",children:"machine"===b?e.jsx(Rs,{machine:y,visible:a,onClose:r,splitView:!0}):"repository"===b?e.jsx(Ps,{repository:y,visible:a,onClose:r,splitView:!0}):e.jsx(Ws,{container:y,visible:a,onClose:r,splitView:!0})})]})},qs=t=>{const{type:s,selectedResource:a,onResourceSelect:r,onMachineRepositoryClick:n,onMachineContainerClick:o}=t,c=()=>{const e=window.innerWidth,t=Math.floor(.25*e);return Math.max(300,Math.min(600,t))},[l,d]=i.useState(c);i.useEffect(()=>{const e=()=>{d(c())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const m=e=>{r(e)},u=()=>{r(null)};return"machine"===s?e.jsxs("div",{style:{display:"flex",height:"100%",width:"100%",position:"relative",overflow:"hidden"},"data-testid":"split-resource-view-container",children:[e.jsx("div",{style:{width:a?`calc(100% - ${l}px)`:"100%",height:"100%",overflow:"auto",minWidth:300,transition:"width 0.3s ease-in-out"},"data-testid":"split-resource-view-left-panel",children:e.jsx(Fs,{...t,onRowClick:m,selectedMachine:a,onMachineRepositoryClick:n,onMachineContainerClick:o})}),a&&e.jsx(Us,{type:"machineName"in a?"machine":"repositoryName"in a?"repository":"container",data:a,visible:!0,onClose:u,splitWidth:l,onSplitWidthChange:d})]}):null},{Title:Hs}=De,Ks=()=>{const{t:s}=_e(["resources","machines","common"]),a=n(),o=t(e=>e.ui.uiMode),c=b(),[l,d]=i.useState([]),[u,h]=i.useState("machines"),[p,y]=i.useState(null),[x,g]=i.useState(null),[f,N]=i.useState(null),[w,k]=i.useState({open:!1,resourceType:"machine",mode:"create"}),C=()=>{switch(u){case"machines":return s("machines.createMachine");case"repositories":return s("repositories.createRepository");case"storage":return s("storage.createStorage");default:return s("general.create")}},[T,z]=i.useState(null),[I,_]=i.useState([]),[M,$]=i.useState({}),V=e=>{y(e),e&&g(null)},U=Q(),K=J(),me=X(),ue=Y(),he=Z(),ye=async(e,t)=>{const a=t[`${e}Name`],i={machine:ue,repository:De,storage:Ue},r=t=>{if("machine"===e)return`machines:${t}`;return`resources:${"repository"===e?"repositories":`${e}s`}.${t}`};Ee.confirm({title:s(r("machine"===e?"confirmDelete":`delete${e.charAt(0).toUpperCase()+e.slice(1)}`)),content:s(r("machine"===e?"deleteWarning":"confirmDelete"),{name:a,[`${e}Name`]:a}),okText:s("common:actions.delete"),okType:"danger",cancelText:s("common:actions.cancel"),onOk:async()=>{try{const n=i[e];"machine"===e?(await n.mutateAsync({teamName:t.teamName,machineName:a}),Ne()):"repository"===e?(await n.mutateAsync({teamName:t.teamName,repositoryName:a}),Se()):"storage"===e&&(await n.mutateAsync({teamName:t.teamName,storageName:a}),Pe()),v("success",s(r("deleteSuccess")))}catch(n){v("error",s(r("deleteError")))}}})},{data:xe}=ze(),{data:ge,isLoading:fe}=P(),je=ge||[],{data:ve=[],refetch:Ne}=q(l.length>0&&("machines"===u||"repositories"===u)?l:void 0,"machines"===u||"repositories"===u),{data:we=[],isLoading:ke,refetch:Se}=H(l.length>0?l:void 0),Te=ee(),Ie=te(),De=se(),Be=ae(),{data:Ve=[],isLoading:Ae,refetch:Pe}=W(l.length>0&&"storage"===u?l:void 0),Ge=G(),We=ie(),Ue=re(),qe=ne(),Ke=de(),{buildQueueVault:Qe}=A(),[Je,Xe]=i.useState({visible:!1,taskId:null,machineName:null}),[Ye,Ze]=i.useState(!1),[et,tt]=i.useState({open:!1,entityType:null,entityIdentifier:null}),[st,it]=i.useState(!1),[rt,nt]=i.useState(15),[ot,ct]=i.useState(1),[lt,ut]=i.useState(15),[ht,pt]=i.useState(1),yt=i.useRef(!1);r.useEffect(()=>{if(!fe&&!yt.current&&je&&je.length>0)if(yt.current=!0,"simple"===o){const e=je.find(e=>"Private Team"===e.teamName);d(e?["Private Team"]:[je[0].teamName])}else d([je[0].teamName])},[o,je,fe]),r.useEffect(()=>{if(a.state&&a.state.createRepository){const e=a.state;h("repositories"),e.selectedTeam&&d([e.selectedTeam]),setTimeout(()=>{xt("repository","create",{teamName:e.selectedTeam,machineName:e.selectedMachine,preselectedTemplate:e.selectedTemplate})},100),window.history.replaceState({},document.title)}},[a]);const xt=(e,t,s,a)=>{k({open:!0,resourceType:e,mode:t,data:s,creationContext:a})},gt=()=>{k({open:!1,resourceType:"machine",mode:"create"}),z(null)},ft=async(e,t)=>{if(T)try{let a,i;if("machine"===e)a=T.machineName,i=T.bridgeName;else{if(!t.selectedMachine)return;const e=xe?.machinesByTeam?.find(e=>e.teamName===T.teamName),r=e?.machines?.find(e=>e.value===t.selectedMachine);if(!r)return void v("error",s("resources:errors.machineNotFound"));a=r.value,i=r.bridgeName}const r=je.find(e=>e.teamName===T.teamName),n={teamName:T.teamName,machineName:a,bridgeName:i,functionName:t.function.name,params:t.params,priority:t.priority,description:t.description,addedVia:`${e}-table`,teamVault:r?.vaultContent||"{}"};if("machine"===e)if(n.machineVault=T.vaultContent||"{}",t.params.repo){const e=we.find(e=>e.repositoryGuid===t.params.repo);n.repositoryGuid=e?.repositoryGuid||t.params.repo,n.repositoryVault=e?.vaultContent||"{}"}else n.repositoryVault="{}";else if("repository"===e){n.repositoryGuid=T.repositoryGuid,n.repositoryVault=T.vaultContent||"{}";const e=ve.find(e=>e.machineName===a&&e.teamName===T.teamName);n.machineVault=e?.vaultContent||"{}"}else if("storage"===e){n.storageName=T.storageName,n.storageVault=T.vaultContent||"{}";const e=ve.find(e=>e.machineName===a&&e.teamName===T.teamName);n.machineVault=e?.vaultContent||"{}"}if("pull"===t.function.name){if("machine"===t.params.sourceType&&t.params.from){const e=ve.find(e=>e.machineName===t.params.from);e&&e.vaultContent&&(n.sourceMachineVault=e.vaultContent)}if("storage"===t.params.sourceType&&t.params.from){const e=Ve.find(e=>e.storageName===t.params.from);e&&e.vaultContent&&(n.sourceStorageVault=e.vaultContent)}}if("push"===t.function.name){if("machine"===t.params.destinationType&&t.params.to){const e=ve.find(e=>e.machineName===t.params.to);e&&e.vaultContent&&(n.destinationMachineVault=e.vaultContent)}if("storage"===t.params.destinationType&&t.params.to){const e=Ve.find(e=>e.storageName===t.params.to);e&&e.vaultContent&&(n.destinationStorageVault=e.vaultContent)}}const o=await Qe(n),c=await Ke.mutateAsync({teamName:T.teamName,machineName:a,bridgeName:i,queueVault:o,priority:t.priority});gt(),c?.taskId?(v("success",s(`${e}s:queueItemCreated`)),Xe({visible:!0,taskId:c.taskId,machineName:a})):c?.isQueued&&v("info",s("resources:messages.highestPriorityQueued",{resourceType:e}))}catch(a){}},jt=[{title:s("repositories.repositoryName"),dataIndex:"repositoryName",key:"repositoryName",ellipsis:!0,render:t=>e.jsxs(Me,{children:[e.jsx(ce,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:s("general.team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx($e,{color:"#8FBC8F",children:t})},..."expert"===o?[{title:s("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:t=>e.jsx($e,{children:s("common:general.versionFormat",{version:t})})}]:[],{title:s("common:table.actions"),key:"actions",width:250,render:(t,a)=>e.jsxs(Me,{children:[e.jsx(Oe,{title:s("common:actions.edit"),children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(B,{}),style:c.touchTargetSmall,"data-testid":`resources-repository-edit-${a.repositoryName}`,onClick:()=>{z(a),xt("repository","edit",a)},"aria-label":s("common:actions.edit")})}),e.jsx(Oe,{title:s("machines:trace"),children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(S,{}),style:c.touchTargetSmall,"data-testid":`resources-repository-trace-${a.repositoryName}`,onClick:()=>{tt({open:!0,entityType:"Repo",entityIdentifier:a.repositoryName,entityName:a.repositoryName})},"aria-label":s("machines:trace")})}),e.jsx(Oe,{title:s("common:actions.delete"),children:e.jsx(Fe,{type:"primary",danger:!0,size:"small",icon:e.jsx(D,{}),style:c.touchTargetSmall,"data-testid":`resources-repository-delete-${a.repositoryName}`,onClick:()=>ye("repository",a),"aria-label":s("common:actions.delete")})})]})}],vt=[{title:s("storage.storageName"),dataIndex:"storageName",key:"storageName",ellipsis:!0,render:t=>e.jsxs(Me,{children:[e.jsx(F,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:s("general.team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx($e,{color:"#8FBC8F",children:t})},..."expert"===o?[{title:s("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:t=>e.jsx($e,{children:s("common:general.versionFormat",{version:t})})}]:[],{title:s("common:table.actions"),key:"actions",width:350,render:(t,a)=>e.jsxs(Me,{children:[e.jsx(Oe,{title:s("common:actions.edit"),children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(B,{}),style:c.touchTargetSmall,"data-testid":`resources-storage-edit-${a.storageName}`,onClick:()=>{z(a),xt("storage","edit",a)},"aria-label":s("common:actions.edit")})}),e.jsx(Oe,{title:"Run",children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(pe,{}),style:c.touchTargetSmall,"data-testid":`resources-storage-run-${a.storageName}`,onClick:()=>{z(a),k({open:!0,resourceType:"storage",mode:"create",data:a})},"aria-label":"Run"})}),e.jsx(Oe,{title:s("machines:trace"),children:e.jsx(Fe,{type:"primary",size:"small",icon:e.jsx(S,{}),style:c.touchTargetSmall,"data-testid":`resources-storage-trace-${a.storageName}`,onClick:()=>{tt({open:!0,entityType:"Storage",entityIdentifier:a.storageName,entityName:a.storageName})},"aria-label":s("machines:trace")})}),e.jsx(Oe,{title:s("common:actions.delete"),children:e.jsx(Fe,{type:"primary",danger:!0,size:"small",icon:e.jsx(D,{}),style:c.touchTargetSmall,"data-testid":`resources-storage-delete-${a.storageName}`,onClick:()=>{Ee.confirm({title:s("storage.deleteStorage"),content:s("storage.confirmDelete",{storageName:a.storageName}),okText:s("general.yes"),okType:"danger",cancelText:s("general.no"),onOk:()=>ye("storage",a)})},"aria-label":s("common:actions.delete")})})]})}],bt=U.isPending||K.isPending||me.isPending||Te.isPending||Ie.isPending||Ge.isPending||We.isPending||Ke.isPending,Nt=he.isPending||Be.isPending||qe.isPending,wt=[{key:"machines",label:e.jsx(Oe,{title:s("resourceTabs.machines"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-machines",children:e.jsx(R,{style:{fontSize:j.DIMENSIONS.ICON_MD}})})}),children:e.jsx(qs,{type:"machine",teamFilter:l.length>0?l:void 0,showFilters:!0,showActions:!0,onCreateMachine:()=>xt("machine","create"),onEditMachine:e=>{z(e),xt("machine","edit",e)},onVaultMachine:e=>{z(e),xt("machine","vault",e)},onFunctionsMachine:(e,t)=>{z(e),k({open:!0,resourceType:"machine",mode:"create",data:e,preselectedFunction:t}),$(t=>({...t,[e.machineName]:Date.now()}))},onDeleteMachine:e=>ye("machine",e),onRefreshMachines:Ne,onCreateRepository:(e,t)=>{let s;e.teamName!==l[0]&&d([e.teamName]),t&&(s=JSON.stringify({credential:""})),xt("repository","create",{machineName:e.machineName,teamName:e.teamName,prefilledMachine:!0,repositoryGuid:t,vaultContent:s},t?"credentials-only":"normal")},enabled:"machines"===u,className:"full-height-machine-table",expandedRowKeys:I,onExpandedRowsChange:_,refreshKeys:M,onQueueItemCreated:(e,t)=>{Xe({visible:!0,taskId:e,machineName:t})},selectedResource:p||x||f,onResourceSelect:e=>{e&&"machineName"in e?V(e):e&&"repositoryName"in e?(V(null),g(e),N(null)):e&&"id"in e&&"state"in e?(V(null),g(null),N(e)):(V(null),g(null),N(null))},onMachineRepositoryClick:(e,t)=>{const s={repositoryName:t.name,repositoryGuid:t.originalGuid||t.name,teamName:e.teamName,vaultVersion:0,vaultContent:void 0,grandGuid:void 0},a=we.find(e=>e.repositoryName===t.name||e.repositoryGuid===t.originalGuid||e.repositoryGuid===t.name);a?(g(a),y(null)):(g(s),y(null),N(null))},onMachineContainerClick:(e,t)=>{y(null),g(null),N(t)}})},{key:"repositories",label:e.jsx(Oe,{title:s("resourceTabs.repositories"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-repositories",children:e.jsx(ce,{style:{fontSize:j.DIMENSIONS.ICON_MD}})})}),children:e.jsx(e.Fragment,{children:ke?e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(Le,{size:"large"}),e.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:s("common:general.loading")})]}):0===we.length?e.jsx(He,{description:s("repositories.noRepositories"),style:{margin:"auto"}}):e.jsx(Re,{"data-testid":"resources-repository-table",columns:jt,dataSource:we,rowKey:"repositoryName",scroll:{x:"max-content"},pagination:{current:ot,pageSize:rt,total:we?.length||0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,t)=>`${s("common:general.showingRecords",{start:t[0],end:t[1],total:e})}`,onChange:(e,t)=>{ct(e),t!==rt&&(nt(t),ct(1))},position:["bottomRight"]}})})},{key:"storage",label:e.jsx(Oe,{title:s("resourceTabs.storage"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-storage",children:e.jsx(F,{style:{fontSize:j.DIMENSIONS.ICON_MD}})})}),children:e.jsx(e.Fragment,{children:Ae?e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(Le,{size:"large"}),e.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:s("common:general.loading")})]}):0===Ve.length?e.jsx(He,{description:s("storage.noStorage"),style:{margin:"auto"}}):e.jsx(Re,{"data-testid":"resources-storage-table",columns:vt,dataSource:Ve,rowKey:"storageName",scroll:{x:"max-content"},pagination:{current:ht,pageSize:lt,total:Ve?.length||0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,t)=>`${s("common:general.showingRecords",{start:t[0],end:t[1],total:e})}`,onChange:(e,t)=>{pt(e),t!==lt&&(ut(t),pt(1))},position:["bottomRight"]}})})}],kt=e=>{if("ArrowLeft"===e.key||"ArrowRight"===e.key){e.preventDefault();const t=["machines","repositories","storage"],s=t.indexOf(u);if("ArrowLeft"===e.key){const e=s>0?s-1:t.length-1;h(t[e])}else{const e=s<t.length-1?s+1:0;h(t[e])}}};return e.jsxs(e.Fragment,{children:["simple"!==o?e.jsx("div",{style:{padding:24},children:e.jsxs(at,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:"1 1 auto",minWidth:0},children:[e.jsx(Hs,{level:4,style:{...c.heading4,margin:0,flexShrink:0},children:s("teams.teamResources")}),e.jsx(be,{"data-testid":"resources-team-selector",teams:je,selectedTeams:l,onChange:d,loading:fe,placeholder:s("teams.selectTeamToView"),style:{minWidth:250,maxWidth:400,width:"100%"}})]}),l.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,flexShrink:0},children:[e.jsx(Oe,{title:C(),children:e.jsx(Fe,{type:"primary",icon:e.jsx(E,{}),style:{...c.buttonPrimary,...c.touchTarget,background:"#556b2f",borderColor:"#556b2f"},"data-testid":`resources-create-${u.slice(0,-1)}-button`,onClick:()=>{switch(u){case"machines":xt("machine","create");break;case"repositories":xt("repository","create",void 0,"credentials-only");break;case"storage":xt("storage","create")}},"aria-label":C()})}),"storage"===u&&e.jsx(Oe,{title:s("resources:storage.import.button"),children:e.jsx(Fe,{icon:e.jsx(le,{}),style:c.touchTarget,"data-testid":"resources-import-button",onClick:()=>it(!0),"aria-label":s("resources:storage.import.button")})}),"machines"===u&&e.jsx(Oe,{title:s("machines:connectivityTest"),children:e.jsx(Fe,{icon:e.jsx(L,{}),style:c.touchTarget,"data-testid":"resources-connectivity-test-button",onClick:()=>Ze(!0),disabled:0===ve.length,"aria-label":s("machines:connectivityTest")})}),e.jsx(Oe,{title:s("common:actions.refresh"),children:e.jsx(Fe,{icon:e.jsx(O,{}),style:c.touchTarget,"data-testid":"resources-refresh-button",onClick:()=>{switch(u){case"machines":Ne(),$(e=>({...e,_global:Date.now()}));break;case"repositories":Se();break;case"storage":Pe()}},"aria-label":s("common:actions.refresh")})})]})]})}),0===l.length?e.jsx(He,{image:He.PRESENTED_IMAGE_SIMPLE,description:s("teams.selectTeamPrompt"),style:{padding:"40px 0"}}):e.jsx(dt,{activeKey:u,onChange:h,items:wt,style:{flex:1,display:"flex",flexDirection:"column"},className:"full-height-tabs",onKeyDown:kt,tabIndex:0})]})}):e.jsx("div",{style:{padding:24},children:e.jsxs(at,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsx("div",{children:e.jsx(Hs,{level:4,style:{...c.heading4,margin:0},children:s("teams.teamResources")})}),e.jsxs(Me,{children:[e.jsx(Oe,{title:C(),children:e.jsx(Fe,{type:"primary",icon:e.jsx(E,{}),style:{...c.buttonPrimary,...c.touchTarget,background:"#556b2f",borderColor:"#556b2f"},"data-testid":`resources-create-${u.slice(0,-1)}-button`,onClick:()=>{switch(u){case"machines":xt("machine","create");break;case"repositories":xt("repository","create",void 0,"credentials-only");break;case"storage":xt("storage","create")}},"aria-label":C()})}),"storage"===u&&e.jsx(Oe,{title:s("resources:storage.import.button"),children:e.jsx(Fe,{icon:e.jsx(le,{}),style:c.touchTarget,"data-testid":"resources-import-button",onClick:()=>it(!0),"aria-label":s("resources:storage.import.button")})}),"machines"===u&&e.jsx(Oe,{title:s("machines:connectivityTest"),children:e.jsx(Fe,{icon:e.jsx(L,{}),style:c.touchTarget,"data-testid":"resources-connectivity-test-button",onClick:()=>Ze(!0),disabled:0===ve.length,"aria-label":s("machines:connectivityTest")})}),e.jsx(Oe,{title:s("common:actions.refresh"),children:e.jsx(Fe,{icon:e.jsx(O,{}),style:c.touchTarget,"data-testid":"resources-refresh-button",onClick:()=>{switch(u){case"machines":Ne(),$(e=>({...e,_global:Date.now()}));break;case"repositories":Se();break;case"storage":Pe()}},"aria-label":s("common:actions.refresh")})})]})]}),e.jsx(dt,{activeKey:u,onChange:h,items:wt,style:{flex:1,display:"flex",flexDirection:"column"},className:"full-height-tabs",onKeyDown:kt,tabIndex:0})]})}),e.jsx(oe,{"data-testid":`resources-${w.resourceType}-modal`,open:w.open,onCancel:gt,resourceType:w.resourceType,mode:w.mode,existingData:w.data||T,teamFilter:l.length>0?l:void 0,creationContext:w.creationContext,onSubmit:async e=>{try{const{resourceType:a,mode:i}=w,r={machine:{create:U,updateName:K,updateVault:he},repository:{create:Te,updateName:Ie,updateVault:Be},storage:{create:Ge,updateName:We,updateVault:qe}};if("create"===i)if("repository"===a){const a=e.repositoryGuid&&""!==e.repositoryGuid.trim();if(e.machineName&&e.size&&!a){const{machineName:a,size:i,...n}=e;await r.repository.create.mutateAsync(n);try{const t=xe?.machinesByTeam?.find(t=>t.teamName===e.teamName),r=t?.machines?.find(e=>e.value===a);if(!r)return v("error",s("resources:errors.machineNotFound")),void gt();const n=je.find(t=>t.teamName===e.teamName),o=ve.find(t=>t.machineName===a&&t.teamName===e.teamName);await new Promise(e=>setTimeout(e,500));const c=await m.get("/GetTeamRepositories",{teamName:e.teamName}),l=c.resultSets[1]?.data?.find(t=>t.repoName===e.repositoryName),d=l?.vaultContent||e.repositoryVault||"{}",u=l?.repoGuid||"";if(!u)return v("error",s("resources:errors.failedToGetRepositoryGuid")),void gt();const h={repo:u,size:i};e.tmpl&&(h.tmpl=e.tmpl),e.keep_open&&(h.keep_open="true");const p=await Qe({teamName:e.teamName,machineName:r.value,bridgeName:r.bridgeName,functionName:"new",params:h,priority:3,description:`Create repository ${e.repositoryName} with size ${i}`,addedVia:"repository-creation",teamVault:n?.vaultContent||"{}",machineVault:o?.vaultContent||"{}",repositoryVault:d,repositoryGuid:u}),y=await Ke.mutateAsync({teamName:e.teamName,machineName:r.value,bridgeName:r.bridgeName,queueVault:p,priority:3});v("success",s("repositories.createSuccess")),y?.taskId?Xe({visible:!0,taskId:y.taskId,machineName:r.value}):y?.isQueued&&v("info",s("resources:messages.repositoryCreationQueued"))}catch(t){v("warning",s("repositories.repoCreatedButQueueFailed"))}}else await r.repository.create.mutateAsync(e),v("success",s("repositories.createSuccess")),gt(),Ne()}else if("machine"===a){const{autoSetup:a,...i}=e;if(await r.machine.create.mutateAsync(i),v("success",s("machines:createSuccess")),a)try{const t=je.find(t=>t.teamName===e.teamName);await new Promise(e=>setTimeout(e,500));const a=await Qe({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,functionName:"setup",params:{datastore_size:"95%",source:"apt-repo",rclone_source:"install-script",docker_source:"docker-repo",install_amd_driver:"auto",install_nvidia_driver:"auto"},priority:3,description:`Auto-setup for machine ${e.machineName}`,addedVia:"machine-creation-auto-setup",teamVault:t?.vaultContent||"{}",machineVault:e.machineVault||"{}"}),i=await Ke.mutateAsync({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,queueVault:a,priority:3});i?.taskId?(v("info",s("machines:setupQueued")),Xe({visible:!0,taskId:i.taskId,machineName:e.machineName})):i?.isQueued&&v("info",s("machines:setupQueuedForSubmission"))}catch(t){v("warning",s("machines:machineCreatedButSetupFailed"))}gt(),Ne()}else await r[a].create.mutateAsync(e),v("success",s(`${(()=>{switch(u){case"machines":return"machines";case"repositories":return"repositories";case"storage":return"storage";default:return u}})()}.createSuccess`)),gt();else{const t=`${a}Name`,s=T[t],i=e[t];if(i!==s){const e=r[a].updateName;"machine"===a?await e.mutateAsync({teamName:T.teamName,currentMachineName:s,newMachineName:i}):"repository"===a?await e.mutateAsync({teamName:T.teamName,currentRepositoryName:s,newRepositoryName:i}):"storage"===a&&await e.mutateAsync({teamName:T.teamName,currentStorageName:s,newStorageName:i})}const n=e[`${a}Vault`];if(n&&n!==T.vaultContent){const e=r[a].updateVault;"machine"===a?await e.mutateAsync({teamName:T.teamName,machineName:i||s,machineVault:n,vaultVersion:T.vaultVersion+1}):"repository"===a?await e.mutateAsync({teamName:T.teamName,repositoryName:i||s,repositoryVault:n,vaultVersion:T.vaultVersion+1}):"storage"===a&&await e.mutateAsync({teamName:T.teamName,storageName:i||s,storageVault:n,vaultVersion:T.vaultVersion+1})}"machine"===a&&e.bridgeName!==T.bridgeName&&await me.mutateAsync({teamName:T.teamName,machineName:i||s,newBridgeName:e.bridgeName})}gt()}catch(t){}},onUpdateVault:"edit"===w.mode?async(e,t)=>{if(T)try{const{resourceType:s}=w,a={machine:he,repository:Be,storage:qe}[s];"machine"===s?await a.mutateAsync({teamName:T.teamName,machineName:T.machineName,machineVault:e,vaultVersion:t}):"repository"===s?await a.mutateAsync({teamName:T.teamName,repositoryName:T.repositoryName,repositoryVault:e,vaultVersion:t}):"storage"===s&&await a.mutateAsync({teamName:T.teamName,storageName:T.storageName,storageVault:e,vaultVersion:t})}catch(s){}}:void 0,onFunctionSubmit:!w.data||"machine"!==w.resourceType&&"repository"!==w.resourceType&&"storage"!==w.resourceType?void 0:"machine"===w.resourceType?e=>ft("machine",e):"repository"===w.resourceType?e=>ft("repository",e):e=>ft("storage",e),isSubmitting:bt,isUpdatingVault:Nt,functionCategories:"machine"===w.resourceType?["machine","backup"]:"repository"===w.resourceType?["repository","backup","network"]:"storage"===w.resourceType?["backup"]:[],hiddenParams:"repository"===w.resourceType?["repo","grand"]:"storage"===w.resourceType?["storage"]:[],defaultParams:"repository"===w.resourceType&&T?{repo:T.repositoryGuid,grand:T.grandGuid||""}:"storage"===w.resourceType&&T?{storage:T.storageName}:{},preselectedFunction:w.preselectedFunction}),e.jsx(Ce,{"data-testid":"resources-queue-trace-modal",taskId:Je.taskId,visible:Je.visible,onClose:()=>{if(Xe({visible:!1,taskId:null,machineName:null}),Je.machineName){const e=Je.machineName;$(t=>({...t,[e]:Date.now()}))}else $(e=>{const t={...e};return I.forEach(e=>{t[e]=Date.now()}),t});Ne()}}),e.jsx(ks,{"data-testid":"resources-connectivity-test-modal",open:Ye,onClose:()=>Ze(!1),machines:ve,teamFilter:l}),e.jsx(mt,{"data-testid":"resources-audit-trace-modal",open:et.open,onCancel:()=>tt({open:!1,entityType:null,entityIdentifier:null}),entityType:et.entityType,entityIdentifier:et.entityIdentifier,entityName:et.entityName}),e.jsx(Is,{"data-testid":"resources-rclone-import-wizard",open:st,onClose:()=>it(!1),teamName:l[0]||"",onImportComplete:()=>{Pe(),v("success",s("resources:storage.import.successMessage"))}})]})};export{Ks as default};

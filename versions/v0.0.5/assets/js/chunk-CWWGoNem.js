import{f as e,g as t}from"./chunk-DZuWtVpy.js";import{r,a,b as s,c as i,u as o,l as d,s as n,D as c,h as l,I as u,H as m,f,U as p,K as y,P as x}from"../index-Csirb_bB.js";import{j}from"./chunk-DXw4Pgvm.js";import{D as h}from"./chunk-CXmhEeMs.js";import{a as g,E as v}from"./chunk-CThsS39k.js";import{C as b,D as S}from"./chunk-CvXGegtF.js";import{D as w}from"./chunk-B2YH6WuA.js";import{C as k}from"./chunk-DKii5wfP.js";import{F as C}from"./chunk-BLcE1TJA.js";import{F as R}from"./chunk-DLcEdvuc.js";import{a as O}from"./chunk-xSw6NTs2.js";import{u as L}from"./chunk-CM3g5OHp.js";import{a as _,g as I,T,M as z,p as A,i as D,D as M,B as $,w as B,W as U}from"./chunk-CSjZqX98.js";var N,E,H,P={exports:{}},X={},F={};function V(){if(N)return F;N=1,Object.defineProperty(F,"__esModule",{value:!0});return F.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},F}function J(){if(E)return X;E=1;var t=r().default,o=a().default;Object.defineProperty(X,"__esModule",{value:!0}),X.default=void 0;var d=o(s()),n=t(e()),c=o(V()),l=o(i()),u=function(e,t){return n.createElement(l.default,(0,d.default)({},e,{ref:t,icon:c.default}))},m=n.forwardRef(u);return X.default=m,X}function Z(){return H||(H=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r;const a=(r=J())&&r.__esModule?r:{default:r};t.default=a,e.exports=a}(P,P.exports)),P.exports}const G=t(Z());var K,W,q,Q={exports:{}},Y={},ee={};function te(){if(K)return ee;K=1,Object.defineProperty(ee,"__esModule",{value:!0});return ee.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"},ee}function re(){if(W)return Y;W=1;var t=r().default,o=a().default;Object.defineProperty(Y,"__esModule",{value:!0}),Y.default=void 0;var d=o(s()),n=t(e()),c=o(te()),l=o(i()),u=function(e,t){return n.createElement(l.default,(0,d.default)({},e,{ref:t,icon:c.default}))},m=n.forwardRef(u);return Y.default=m,Y}function ae(){return q||(q=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r;const a=(r=re())&&r.__esModule?r:{default:r};t.default=a,e.exports=a}(Q,Q.exports)),Q.exports}const se=t(ae()),{Text:ie}=T,oe=({open:e,onCancel:t,entityType:r,entityIdentifier:a,entityName:s})=>{const{t:i}=L(["resources","common"]),T=o(),{data:N,isLoading:E,error:H}=g(r,a,e),P=e=>{switch(e){case"plus-circle":return j.jsx(G,{style:{color:"#52c41a"}});case"edit":return j.jsx(v,{style:{color:"#1890ff"}});case"trash":return j.jsx(h,{style:{color:"#ff4d4f"}});case"lock":return j.jsx(x,{style:{color:"#fa8c16"}});case"key":return j.jsx(y,{style:{color:"#722ed1"}});case"users":return j.jsx(p,{style:{color:"#13c2c2"}});case"check-circle":return j.jsx(f,{style:{color:"#52c41a"}});case"x-circle":return j.jsx(k,{style:{color:"#ff4d4f"}});case"database":return j.jsx(S,{style:{color:"#1890ff"}});case"hdd":return j.jsx(m,{style:{color:"#fa8c16"}});case"copy":return j.jsx(b,{style:{color:"#722ed1"}});default:return j.jsx(u,{style:{color:"#1890ff"}})}},X=e=>{switch(e){case"Created":return"green";case"Updated":case"Renamed":case"Assigned to Cluster":case"Assigned to Image":case"Assigned to Clone":return"blue";case"Deleted":return"red";case"Activated":return"cyan";case"Deactivated":case"Removed from Cluster":case"Removed from Clone":return"orange";case"Security Update":case"Security Setting":return"gold";case"Completed":return"success";case"Cancelled":return"error";case"Reassigned Image":return"purple";default:return"default"}},F=[{title:i("audit.action"),key:"action",width:150,render:(e,t,r)=>j.jsxs(_,{"data-testid":`audit-trace-action-${r}`,children:[P(t.iconHint),j.jsx(I,{color:X(t.actionType),"data-testid":`audit-trace-action-tag-${r}`,children:t.actionType})]})},{title:i("audit.details"),dataIndex:"details",key:"details",ellipsis:!0},{title:i("audit.performedBy"),dataIndex:"performedBy",key:"performedBy",width:200,render:(e,t,r)=>j.jsx("span",{"data-testid":`audit-trace-performed-by-${r}`,children:e||i("audit.system")})},{title:i("audit.timestamp"),dataIndex:"timestamp",key:"timestamp",width:200,render:(e,t,r)=>j.jsxs(_,{direction:"vertical",size:0,"data-testid":`audit-trace-timestamp-${r}`,children:[j.jsx(ie,{children:O(e,"datetime")}),j.jsx(ie,{type:"secondary",style:{fontSize:12},children:t.timeAgo})]})}];return j.jsx(z,{title:j.jsxs(_,{children:[j.jsx(l,{}),i("audit.title",{name:s||a})]}),open:e,onCancel:t,style:d(c.DIMENSIONS.MODAL_WIDTH_XL),footer:null,destroyOnHidden:!0,"data-testid":"audit-trace-modal",children:E?j.jsxs("div",{style:{textAlign:"center",padding:`${n("XXXL")}px 0`},"data-testid":"audit-trace-loading",children:[j.jsx(A,{size:"large"}),j.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:i("common:general.loading")})]}):H?j.jsx(D,{message:i("audit.error"),description:H instanceof Error?H.message:i("audit.errorLoading"),type:"error",showIcon:!0,"data-testid":"audit-trace-error-alert"}):N?j.jsxs(j.Fragment,{children:[N.summary&&j.jsxs(_,{direction:"vertical",size:n("MD"),style:{width:"100%",marginBottom:n("LG")},"data-testid":"audit-trace-summary",children:[j.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j.jsxs(_,{size:n("XL"),children:[j.jsxs(_,{direction:"vertical",size:0,"data-testid":"audit-trace-total-records",children:[j.jsx(ie,{type:"secondary",children:i("audit.totalRecords")}),j.jsx(ie,{strong:!0,style:{fontSize:c.FONT_SIZE.XL},children:N.summary.totalAuditRecords})]}),j.jsxs(_,{direction:"vertical",size:0,"data-testid":"audit-trace-visible-records",children:[j.jsx(ie,{type:"secondary",children:i("audit.visibleRecords")}),j.jsx(ie,{strong:!0,style:{fontSize:c.FONT_SIZE.XL},children:N.summary.visibleAuditRecords})]}),N.summary.lastActivity&&j.jsxs(_,{direction:"vertical",size:0,"data-testid":"audit-trace-last-activity",children:[j.jsx(ie,{type:"secondary",children:i("audit.lastActivity")}),j.jsx(ie,{strong:!0,children:new Date(N.summary.lastActivity).toLocaleDateString()})]})]}),j.jsx(M,{menu:{items:[{key:"csv",label:i("audit.exportCSV"),icon:j.jsx(R,{}),onClick:()=>{if(!N?.records||0===N.records.length)return;const e=[["Action","Details","Performed By","Timestamp","Time Ago"].join(","),...N.records.map(e=>[e.actionType,`"${e.details.replace(/"/g,'""')}"`,e.performedBy||"System",O(e.timestamp,"datetime"),e.timeAgo].join(","))].join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=`audit-trace-${r}-${a}-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),U.success(i("audit.exportSuccess",{format:"CSV"}))},"data-testid":"audit-trace-export-csv"},{key:"json",label:i("audit.exportJSON"),icon:j.jsx(C,{}),onClick:()=>{if(!N?.records||0===N.records.length)return;const e={entityType:r,entityIdentifier:a,entityName:s,exportDate:(new Date).toISOString(),summary:N.summary,records:N.records.map(e=>({actionType:e.actionType,details:e.details,performedBy:e.performedBy||"System",timestamp:e.timestamp,timeAgo:e.timeAgo,iconHint:e.iconHint}))},t=JSON.stringify(e,null,2),o=new Blob([t],{type:"application/json"}),d=URL.createObjectURL(o),n=document.createElement("a");n.href=d,n.download=`audit-trace-${r}-${a}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(d),U.success(i("audit.exportSuccess",{format:"JSON"}))},"data-testid":"audit-trace-export-json"}]},placement:"bottomRight","data-testid":"audit-trace-export-dropdown",children:j.jsx($,{icon:j.jsx(w,{}),"data-testid":"audit-trace-export-button",style:T.buttonSecondary,children:i("audit.export")})})]}),N.summary.hasOlderRecords&&j.jsx(D,{message:i("audit.olderRecordsNotVisible"),type:"warning",showIcon:!0,"data-testid":"audit-trace-older-records-alert"})]}),j.jsx(B,{columns:F,dataSource:N.records,rowKey:(e,t)=>`${e.timestamp}-${t}`,pagination:{pageSize:10,showSizeChanger:!1,showTotal:(e,t)=>i("common:general.showingRecords",{start:t[0],end:t[1],total:e})},scroll:{x:800},size:"small","data-testid":"audit-trace-table"}),N.summary&&j.jsx("div",{style:{marginTop:n("LG"),textAlign:"center"},"data-testid":"audit-trace-retention-info",children:j.jsx(ie,{type:"secondary",children:i("audit.retentionInfo",{days:N.summary.auditRetentionDays,tier:N.summary.subscriptionTier})})})]}):null})};export{oe as A,se as S};

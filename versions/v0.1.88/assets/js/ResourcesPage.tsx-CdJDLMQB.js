import{j as e,u as t}from"./chunk-C4F6eAY2.js";import{f as s,g as a,r as i,R as r,u as n}from"./chunk-DZuWtVpy.js";import{r as o,a as l,b as c,c as d,i as m,e as u,g as p,C as h,M as y,s as x,f,j as g,D as j,k as v,u as b,I as N,l as w,m as k,H as C,h as S,A as T,n as z,G as I,o as _,p as M,W as D,P as $}from"../index-CfsZZh96.js";import{E}from"./chunk-Ch0v19eE.js";import{S as B,D as V}from"./chunk-5M3axm5N.js";import{C as R}from"./chunk-DvVwFnga.js";import{R as F}from"./chunk-DhncJ1y2.js";import{u as P,a as O,W as A,b as L,c as G,U as W,d as H,e as U,f as q,g as K,h as Q,i as J,j as X,k as Y,l as Z,m as ee,n as te,o as se,p as ae,q as ie,r as re,s as ne}from"./chunk-Dr9r_xoI.js";import{I as oe}from"./chunk-DkKJkm2J.js";import{I as le}from"./chunk-DCc66Z6G.js";import{u as ce,a as de,M as me,b as ue,F as pe,L as he,c as ye,A as xe,R as fe,V as ge,P as je,T as ve}from"./chunk-ZdhpQJ5J.js";import{R as be,D as Ne,P as we,Q as ke}from"./chunk-CEL0BnnF.js";import{C as Ce}from"./chunk-CCODhVgY.js";import{u as Se,a as Te,C as ze}from"./chunk-pvOY9slE.js";import{u as Ie}from"./chunk-C_1cO1th.js";import{a as _e,T as Me,h as De,M as $e,P as Ee,j as Be,w as Ve,B as Re,l as Fe,y as Pe,o as Oe,q as Ae,U as Le,z as Ge,G as We,S as He,E as Ue,H as qe,I as Ke,J as Qe,K as Je,N as Xe,c as Ye,O as Ze,Q as et,V as tt,p as st,i as at,s as it,u as rt,v as nt,g as ot,D as lt,W as ct}from"./chunk-DcXv3kLI.js";import{A as dt,S as mt}from"./chunk-BKtMAwVS.js";import{T as ut}from"./chunk-BUdBWF1b.js";import{C as pt}from"./chunk-CPN3uOn4.js";import{l as ht}from"./chunk-lGptOMHx.js";import{f as yt,g as xt,a as ft}from"./chunk-xSw6NTs2.js";import{D as gt,C as jt}from"./chunk-BcJSIpOJ.js";import{F as vt}from"./chunk-RwzM4RZb.js";import"./chunk-oDcFv_qo.js";import"./chunk-nKvXPuD_.js";import"./chunk-BxYn_9Tr.js";import"./forkTokenService.ts-DNTRKH3c.js";import"./chunk-DkdaP6b5.js";var bt,Nt,wt,kt={exports:{}},Ct={},St={};function Tt(){if(bt)return St;bt=1,Object.defineProperty(St,"__esModule",{value:!0});return St.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder",theme:"outlined"},St}function zt(){if(Nt)return Ct;Nt=1;var e=o().default,t=l().default;Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.default=void 0;var a=t(c()),i=e(s()),r=t(Tt()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return Ct.default=u,Ct}function It(){return wt||(wt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=zt())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(kt,kt.exports)),kt.exports}const _t=a(It());var Mt,Dt,$t,Et={exports:{}},Bt={},Vt={};function Rt(){if(Mt)return Vt;Mt=1,Object.defineProperty(Vt,"__esModule",{value:!0});return Vt.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},Vt}function Ft(){if(Dt)return Bt;Dt=1;var e=o().default,t=l().default;Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.default=void 0;var a=t(c()),i=e(s()),r=t(Rt()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return Bt.default=u,Bt}function Pt(){return $t||($t=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Ft())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Et,Et.exports)),Et.exports}const Ot=a(Pt());var At,Lt,Gt,Wt={exports:{}},Ht={},Ut={};function qt(){if(At)return Ut;At=1,Object.defineProperty(Ut,"__esModule",{value:!0});return Ut.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},Ut}function Kt(){if(Lt)return Ht;Lt=1;var e=o().default,t=l().default;Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.default=void 0;var a=t(c()),i=e(s()),r=t(qt()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return Ht.default=u,Ht}function Qt(){return Gt||(Gt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Kt())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Wt,Wt.exports)),Wt.exports}const Jt=a(Qt());var Xt,Yt,Zt,es={exports:{}},ts={},ss={};function as(){if(Xt)return ss;Xt=1,Object.defineProperty(ss,"__esModule",{value:!0});return ss.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M533.2 492.3L277.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H188c-6.7 0-10.4 7.7-6.3 12.9L447.1 512 181.7 851.1A7.98 7.98 0 00188 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5zm304 0L581.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H492c-6.7 0-10.4 7.7-6.3 12.9L751.1 512 485.7 851.1A7.98 7.98 0 00492 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5z"}}]},name:"double-right",theme:"outlined"},ss}function is(){if(Yt)return ts;Yt=1;var e=o().default,t=l().default;Object.defineProperty(ts,"__esModule",{value:!0}),ts.default=void 0;var a=t(c()),i=e(s()),r=t(as()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return ts.default=u,ts}function rs(){return Zt||(Zt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=is())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(es,es.exports)),es.exports}const ns=a(rs());var os,ls,cs,ds={exports:{}},ms={},us={};function ps(){if(os)return us;os=1,Object.defineProperty(us,"__esModule",{value:!0});return us.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M272.9 512l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L186.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H532c6.7 0 10.4-7.7 6.3-12.9L272.9 512zm304 0l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L490.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H836c6.7 0 10.4-7.7 6.3-12.9L576.9 512z"}}]},name:"double-left",theme:"outlined"},us}function hs(){if(ls)return ms;ls=1;var e=o().default,t=l().default;Object.defineProperty(ms,"__esModule",{value:!0}),ms.default=void 0;var a=t(c()),i=e(s()),r=t(ps()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return ms.default=u,ms}function ys(){return cs||(cs=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=hs())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(ds,ds.exports)),ds.exports}const xs=a(ys());var fs,gs,js,vs={exports:{}},bs={},Ns={};function ws(){if(fs)return Ns;fs=1,Object.defineProperty(Ns,"__esModule",{value:!0});return Ns.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm198.4-588.1a32 32 0 00-24.5.5L414.9 415 296.4 686c-3.6 8.2-3.6 17.5 0 25.7 3.4 7.8 9.7 13.9 17.7 17 3.8 1.5 7.7 2.2 11.7 2.2 4.4 0 8.7-.9 12.8-2.7l271-118.6 118.5-271a32.06 32.06 0 00-17.7-42.7zM576.8 534.4l26.2 26.2-42.4 42.4-26.2-26.2L380 644.4 447.5 490 422 464.4l42.4-42.4 25.5 25.5L644.4 380l-67.6 154.4zM464.4 422L422 464.4l25.5 25.6 86.9 86.8 26.2 26.2 42.4-42.4-26.2-26.2-86.8-86.9z"}}]},name:"compass",theme:"outlined"},Ns}function ks(){if(gs)return bs;gs=1;var e=o().default,t=l().default;Object.defineProperty(bs,"__esModule",{value:!0}),bs.default=void 0;var a=t(c()),i=e(s()),r=t(ws()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return bs.default=u,bs}function Cs(){return js||(js=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=ks())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(vs,vs.exports)),vs.exports}const Ss=a(Cs());var Ts,zs,Is,_s={exports:{}},Ms={},Ds={};function $s(){if(Ts)return Ds;Ts=1,Object.defineProperty(Ds,"__esModule",{value:!0});return Ds.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},Ds}function Es(){if(zs)return Ms;zs=1;var e=o().default,t=l().default;Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.default=void 0;var a=t(c()),i=e(s()),r=t($s()),n=t(d()),m=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},u=i.forwardRef(m);return Ms.default=u,Ms}function Bs(){return Is||(Is=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Es())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(_s,_s.exports)),_s.exports}const Vs=a(Bs());async function Rs(e,t=3e4){const s=Date.now();for(;Date.now()-s<t;){const t=await Fs(e);if(t)return t;await new Promise(e=>setTimeout(e,1e3))}return Os("Operation timeout - no response received","TIMEOUT")}async function Fs(e){try{const t=await m.get("/GetQueueItemTrace",{taskId:e}),s=t.resultSets?.[1]?.data?.[0];if(!s)return null;const a=s.status||s.Status;switch(a){case"COMPLETED":return function(e){const t=e.resultSets?.[3]?.data?.[0];if(!t?.vaultContent)return Ps("Hello function completed successfully","COMPLETED");try{const e=JSON.parse(t.vaultContent);return e.result&&"string"==typeof e.result&&e.result.includes("Error")?Os(e.result,"COMPLETED",e):Ps(e.result||"Hello function completed successfully","COMPLETED",e)}catch{return Ps("Hello function completed","COMPLETED")}}(t);case"FAILED":case"CANCELLED":return function(e,t){const s=e.lastFailureReason||e.LastFailureReason||"Operation failed";return Os(s,t)}(s,a);default:return null}}catch(t){return null}}function Ps(e,t,s){return{success:!0,message:e,status:t,responseData:s}}function Os(e,t,s){return{success:!1,message:e,status:t,responseData:s}}function As(e){const{buildQueueVault:t}=P();ce();const s=Se(),{data:a}=O(),r=i.useCallback(async e=>{try{const i=function(e,t){if(e.teamVault&&"{}"!==e.teamVault)return e.teamVault;const s=t?.find(t=>t.teamName===e.teamName);return s?.vaultContent||"{}"}(e,a),r=await async function(e,t,s){const a=4,i="Ping connectivity test",r="ping-service",n="{}";return s({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,functionName:"ping",params:{},priority:e.priority||a,description:e.description||i,addedVia:e.addedVia||r,machineVault:e.machineVault||n,teamVault:t,repositoryVault:e.repositoryVault||n})}(e,i,t),n=await async function(e,t,s){const a=4;return s.mutateAsync({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,queueVault:t,priority:e.priority||a})}(e,r,s);return{taskId:n?.taskId,success:!!n?.taskId||!!n?.isQueued}}catch(i){return{success:!1,error:i.message||"Failed to execute ping function"}}},[t,s,a]),n=i.useCallback(async(e,t)=>r({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,priority:t?.priority,description:t?.description,addedVia:t?.addedVia,machineVault:e.vaultContent||"{}"}),[r]),o=i.useCallback(async(e,t)=>{const s=await r(e);if(!s.success||!s.taskId)return s;const a=await Rs(s.taskId,t);return{...s,completionResult:a,success:a.success,error:a.success?void 0:a.message}},[r]),l=i.useCallback(async(e,t)=>o({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,priority:t?.priority,description:t?.description,addedVia:t?.addedVia,machineVault:e.vaultContent||"{}"},t?.timeout),[o]);return{executePing:r,executePingForMachine:n,executePingAndWait:o,executePingForMachineAndWait:l,waitForQueueItemCompletion:Rs,isLoading:s.isPending}}const{Text:Ls}=Me,Gs=({open:t,onClose:s,machines:a})=>{const{t:r}=Ie(["machines","common"]),{theme:n}=u(),[o,l]=i.useState([]),[c,d]=i.useState(!1),[m,b]=i.useState(0),[N,w]=i.useState(-1),{executePingForMachine:k,waitForQueueItemCompletion:C}=As();i.useEffect(()=>{if(t&&a.length>0){const e=a.map(e=>({machineName:e.machineName,teamName:e.teamName,bridgeName:e.bridgeName,status:"pending"}));l(e),b(0),w(-1)}},[t,a]);const S=e=>e.success?r("machines:connectionSuccessful"):"TIMEOUT"===e.status?r("machines:testTimeout"):e.message||r("machines:connectionFailed"),T=async(e,t)=>{const s=Date.now();l(e=>e.map((e,s)=>s===t?{...e,status:"testing",timestamp:(new Date).toISOString()}:e));try{const a=await k(e,{priority:4,description:"Connectivity test",addedVia:"connectivity-test"});if(!a.success||!a.taskId)throw new Error(a.error||"Failed to create test task");{l(e=>e.map((e,s)=>s===t?{...e,taskId:a.taskId}:e));const e=await C(a.taskId),i=Date.now()-s;l(s=>s.map((s,a)=>a===t?{...s,status:e.success?"success":"failed",message:S(e),duration:i}:s))}}catch(a){const e=Date.now()-s;l(s=>s.map((s,i)=>i===t?{...s,status:"failed",message:a.message||"Failed to create test task",duration:e}:s))}},z=[{title:r("machines:machineName"),dataIndex:"machineName",key:"machineName",render:(t,s)=>e.jsxs(_e,{"data-testid":`connectivity-machine-${t}`,children:["testing"===s.status&&e.jsx(B,{spin:!0,style:{color:"#1890ff"},"data-testid":`connectivity-status-icon-testing-${t}`}),"success"===s.status&&e.jsx(p,{style:{color:"#52c41a"},"data-testid":`connectivity-status-icon-success-${t}`}),"failed"===s.status&&e.jsx(Ce,{style:{color:"#ff4d4f"},"data-testid":`connectivity-status-icon-failed-${t}`}),"pending"===s.status&&e.jsx(h,{style:{color:"#8c8c8c"},"data-testid":`connectivity-status-icon-pending-${t}`}),e.jsx(Ls,{strong:!0,children:t})]})},{title:r("machines:team"),dataIndex:"teamName",key:"teamName",render:t=>e.jsx(De,{color:"#8FBC8F",children:t})},{title:r("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",render:t=>e.jsx(De,{color:"green",children:t})},{title:r("machines:status"),dataIndex:"status",key:"status",width:120,render:(t,s)=>{const a={pending:{color:"default",text:r("machines:pending")},testing:{color:"processing",text:r("machines:testing")},success:{color:"success",text:r("machines:connected")},failed:{color:"error",text:r("machines:failed")}};return e.jsx(De,{color:a[t].color,"data-testid":`connectivity-status-tag-${s.machineName}-${t}`,children:a[t].text})}},{title:r("machines:responseTime"),dataIndex:"duration",key:"duration",width:120,render:e=>e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"-"},{title:r("machines:message"),dataIndex:"message",key:"message",ellipsis:!0,render:(t,s)=>t?e.jsx(Ls,{type:"failed"===s.status?"danger":void 0,children:t}):"-"}];return e.jsx($e,{"data-testid":"connectivity-modal",title:e.jsxs(_e,{children:[e.jsx(A,{style:{fontSize:j.DIMENSIONS.ICON_MD}}),e.jsx("span",{style:{fontSize:g("BASE")},children:r("machines:connectivityTest")})]}),open:t,onCancel:s,className:y.ExtraLarge,destroyOnHidden:!0,footer:[e.jsx(Re,{type:"primary",icon:e.jsx(B,{style:{fontSize:j.DIMENSIONS.ICON_SM}}),onClick:async()=>{d(!0);for(let s=0;s<a.length;s++)w(s),b(Math.round(s/a.length*100)),await T(a[s],s);b(100),d(!1),w(-1);const e=o.filter(e=>"success"===e.status).length,t=o.filter(e=>"failed"===e.status).length;0===t?v("success",r("machines:allMachinesConnected",{count:e})):v("warning",r("machines:machinesConnectedWithFailures",{successCount:e,failedCount:t}))},disabled:c||0===a.length,loading:c,style:{fontSize:g("SM")},"data-testid":"connectivity-run-test-button",children:r(c?"machines:testing":"machines:runTest")},"run"),e.jsx(Fe,{title:"Close",children:e.jsx(Re,{icon:e.jsx(Ce,{}),onClick:s,style:{borderRadius:f("LG"),fontSize:g("SM")},"data-testid":"connectivity-close-button","aria-label":"Close"},"close")},"close-tooltip")],children:e.jsxs(_e,{direction:"vertical",size:"large",style:{width:"100%"},children:[c&&e.jsxs("div",{style:{marginBottom:x("MD")},"data-testid":"connectivity-progress-container",children:[e.jsx(Ee,{percent:m,status:"active",strokeColor:{"0%":"var(--color-primary)","100%":"var(--color-success)"},style:{borderRadius:f("LG")},"data-testid":"connectivity-progress-bar"}),N>=0&&N<a.length&&e.jsx(Ls,{type:"secondary",style:{fontSize:g("XS"),marginTop:x("XS"),display:"block"},"data-testid":"connectivity-progress-text",children:r("machines:testingMachine",{machineName:a[N].machineName})})]}),e.jsx(Be,{message:r("machines:connectivityTestDescription"),type:"info",showIcon:!0,icon:e.jsx(A,{style:{fontSize:j.DIMENSIONS.ICON_MD}}),style:{borderRadius:f("LG"),fontSize:g("SM")},"data-testid":"connectivity-info-alert"}),e.jsx(Ve,{columns:z,dataSource:o,rowKey:"machineName",pagination:!1,scroll:{y:400},loading:0===a.length,rowClassName:e=>"testing"===e.status?"connectivity-test-active-row":"success"===e.status?"connectivity-test-success-row":"failed"===e.status?"connectivity-test-failed-row":"",style:{borderRadius:f("LG"),overflow:"hidden"},"data-testid":"connectivity-results-table"}),!c&&o.some(e=>"pending"!==e.status)&&e.jsx("div",{style:{padding:x("MD"),background:"dark"===n?"var(--color-fill-quaternary)":"var(--color-fill-tertiary)",borderRadius:f("LG")},"data-testid":"connectivity-summary-statistics",children:e.jsxs(_e,{size:"large",children:[e.jsxs("div",{"data-testid":"connectivity-total-machines",children:[e.jsxs(Ls,{type:"secondary",children:[r("machines:totalMachines"),":"]})," ",e.jsx(Ls,{strong:!0,children:a.length})]}),e.jsxs("div",{"data-testid":"connectivity-connected-count",children:[e.jsxs(Ls,{type:"secondary",children:[r("machines:connected"),":"]})," ",e.jsx(Ls,{strong:!0,style:{color:"#52c41a"},children:o.filter(e=>"success"===e.status).length})]}),e.jsxs("div",{"data-testid":"connectivity-failed-count",children:[e.jsxs(Ls,{type:"secondary",children:[r("machines:failed"),":"]})," ",e.jsx(Ls,{strong:!0,style:{color:"#ff4d4f"},children:o.filter(e=>"failed"===e.status).length})]}),e.jsxs("div",{"data-testid":"connectivity-average-response",children:[e.jsxs(Ls,{type:"secondary",children:[r("machines:averageResponse"),":"]})," ",e.jsx(Ls,{strong:!0,children:(()=>{const e=o.filter(e=>"success"===e.status&&e.duration);if(0===e.length)return"-";const t=e.reduce((e,t)=>e+(t.duration||0),0)/e.length;return t<1e3?`${Math.round(t)}ms`:`${(t/1e3).toFixed(1)}s`})()})]})]})})]})})},{Step:Ws}=Oe,{Text:Hs,Title:Us,Paragraph:qs}=Me,Ks=({open:t,onClose:s,teamName:a,onImportComplete:r})=>{const{t:n}=Ie(["resources","common"]),o=b(),[l,c]=i.useState(0),[d,m]=i.useState([]),[u,p]=i.useState([]),[h,y]=i.useState([]),[f,g]=i.useState(!1),[v,k]=i.useState(null),C=L(),{data:S=[]}=G(a),T=e=>{const{type:t,config:s}=e,a={drive:"drive",onedrive:"onedrive",s3:"s3",b2:"b2",mega:"mega",dropbox:"dropbox",box:"box",azureblob:"azureblob",swift:"swift",webdav:"webdav",ftp:"ftp",sftp:"sftp"}[t];if(!a)return null;const i={};return Object.entries(s).forEach(([e,t])=>{if("type"===e)i.provider=a;else{let s=t;if("string"==typeof t&&("token"===e||e.endsWith("_token"))&&t.startsWith("{"))try{s=JSON.parse(t)}catch{s=t}i[e]=s}}),i.provider||(i.provider=a),i},z=async e=>{k(null);try{const t=(e=>{const t=[],s=e.split("\n");let a=null,i={};for(const r of s){const e=r.trim();if(!e||e.startsWith("#")||e.startsWith(";"))continue;const s=e.match(/^\[(.+)\]$/);if(s)a&&i.type&&t.push({name:a,type:i.type,config:{...i}}),a=s[1],i={};else if(a){const t=e.match(/^([^=]+)=(.*)$/);if(t){const e=t[1].trim(),s=t[2].trim();try{i[e]=JSON.parse(s)}catch{i[e]=s}}}}return a&&i.type&&t.push({name:a,type:i.type,config:{...i}}),t})(await e.text());if(0===t.length)return k(n("resources:storage.import.noConfigsFound")),!1;p(t);const s=t.map(e=>{const t=S.some(t=>t.storageName===e.name);return{name:e.name,status:"pending",exists:t,selected:!t}});return y(s),c(1),!1}catch(t){return k(n("resources:storage.import.parseError")),!1}},I=()=>{c(0),m([]),p([]),y([]),g(!1),k(null),2===l&&h.some(e=>"success"===e.status)&&r?.(),s()},_=[{title:e.jsx(Pe,{checked:h.every(e=>e.selected),indeterminate:h.some(e=>e.selected)&&!h.every(e=>e.selected),onChange:e=>{return t=e.target.checked,void y(e=>e.map(e=>({...e,selected:t})));var t},disabled:2===l,"data-testid":"rclone-wizard-select-all-checkbox"}),dataIndex:"selected",key:"selected",width:50,render:(t,s,a)=>e.jsx(Pe,{checked:s.selected,onChange:()=>(e=>{y(t=>{const s=[...t];return s[e]={...s[e],selected:!s[e].selected},s})})(a),disabled:2===l,"data-testid":`rclone-wizard-config-checkbox-${s.name}`})},{title:n("resources:storage.storageName"),dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(_e,{children:[e.jsx(R,{}),e.jsx(Hs,{strong:!0,children:t}),s.exists&&e.jsx(Fe,{title:n("resources:storage.import.alreadyExists"),children:e.jsxs(De,{color:"warning",children:[e.jsx(N,{})," ",n("resources:storage.import.exists")]})})]})},{title:n("resources:storage.provider"),key:"provider",width:120,render:(t,s)=>{const a=u.find(e=>e.name===s.name);if(!a)return null;const i=a.type.charAt(0).toUpperCase()+a.type.slice(1);return e.jsx(De,{color:"blue",children:i})}},{title:n("resources:storage.import.status"),dataIndex:"status",key:"status",width:150,render:(t,s)=>{if(l<2)return null;const a={pending:{color:"default",text:n("resources:storage.import.pending")},success:{color:"success",text:n("resources:storage.import.success")},error:{color:"error",text:n("resources:storage.import.error")},skipped:{color:"warning",text:n("resources:storage.import.skipped")}}[t]||{color:"default",text:t};return e.jsxs(_e,{direction:"vertical",size:"small",children:[e.jsx(De,{color:a.color,children:a.text}),s.message&&e.jsx(Hs,{type:"secondary",style:{fontSize:12},children:s.message})]})}}];return e.jsxs($e,{title:e.jsxs(_e,{children:[e.jsx(R,{}),n("resources:storage.import.title")]}),open:t,onCancel:I,style:w(j.DIMENSIONS.MODAL_WIDTH_XL),footer:0===l?e.jsx(Re,{onClick:I,"data-testid":"rclone-wizard-cancel-button",style:o.buttonSecondary,children:n("common:actions.cancel")}):1===l?e.jsxs(e.Fragment,{children:[e.jsx(Re,{onClick:()=>c(0),"data-testid":"rclone-wizard-back-button",style:o.buttonSecondary,children:n("common:actions.back")}),e.jsx(Re,{onClick:I,"data-testid":"rclone-wizard-cancel-button",style:o.buttonSecondary,children:n("common:actions.cancel")}),e.jsx(Re,{type:"primary",onClick:async()=>{g(!0);const e=u.filter((e,t)=>h[t].selected);for(let s=0;s<e.length;s++){const i=e[s],r=u.findIndex(e=>e.name===i.name);try{const e=T(i);if(!e){y(e=>{const t=[...e];return t[r]={...t[r],status:"error",message:n("resources:storage.import.unsupportedProvider",{type:i.type})},t});continue}const t=JSON.stringify(e);await C.mutateAsync({teamName:a,storageName:i.name,storageVault:t}),y(e=>{const t=[...e];return t[r]={...t[r],status:"success",message:n("resources:storage.import.imported")},t})}catch(t){y(e=>{const s=[...e];return s[r]={...s[r],status:"error",message:t.message||n("resources:storage.import.importError")},s})}}g(!1),c(2)},disabled:!h.some(e=>e.selected),loading:f,"data-testid":"rclone-wizard-import-button",style:o.buttonPrimary,children:n("resources:storage.import.importSelected")})]}):e.jsx(Re,{type:"primary",onClick:I,"data-testid":"rclone-wizard-close-button",style:o.buttonPrimary,children:n("common:actions.close")}),children:[e.jsxs(Oe,{current:l,style:{marginBottom:x("LG")},"data-testid":"rclone-wizard-steps",children:[e.jsx(Ws,{title:n("resources:storage.import.step1")}),e.jsx(Ws,{title:n("resources:storage.import.step2")}),e.jsx(Ws,{title:n("resources:storage.import.step3")})]}),(()=>{switch(l){case 0:return e.jsxs("div",{style:{padding:"20px 0"},children:[e.jsx(Be,{message:n("resources:storage.import.instructions"),description:e.jsxs("div",{children:[e.jsx(qs,{children:n("resources:storage.import.instructionsDetail")}),e.jsx(qs,{children:e.jsx(Hs,{code:!0,children:"rclone config file"})}),e.jsx(qs,{children:n("resources:storage.import.uploadPrompt")})]}),type:"info",showIcon:!0,icon:e.jsx(N,{}),style:{marginBottom:20}}),e.jsxs(Le.Dragger,{accept:".conf",fileList:d,beforeUpload:z,onChange:({fileList:e})=>m(e),maxCount:1,"data-testid":"rclone-wizard-upload-dragger",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(W,{})}),e.jsx("p",{className:"ant-upload-text",children:n("resources:storage.import.dragDropText")}),e.jsx("p",{className:"ant-upload-hint",children:n("resources:storage.import.supportedFormats")})]}),v&&e.jsx(Be,{message:v,type:"error",showIcon:!0,style:{marginTop:16}})]});case 1:return e.jsxs("div",{children:[e.jsx(Be,{message:n("resources:storage.import.selectStorages"),description:n("resources:storage.import.selectDescription"),type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(Ve,{dataSource:h,columns:_,rowKey:"name",pagination:!1,size:"small","data-testid":"rclone-wizard-config-table"})]});case 2:return e.jsx("div",{children:f?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(Ae,{size:"large"}),e.jsx(Us,{level:4,style:{marginTop:16},children:n("resources:storage.import.importing")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{message:n("resources:storage.import.complete"),description:n("resources:storage.import.completeDescription"),type:"success",showIcon:!0,style:{marginBottom:16}}),e.jsx(Ve,{dataSource:h,columns:_,rowKey:"name",pagination:!1,size:"small","data-testid":"rclone-wizard-results-table"})]})});default:return null}})()]})},Qs=({open:t,onCancel:s,machineName:a,teamName:r,bridgeName:n,onPullSelected:o,onClose:l,onQueueItemCreated:c})=>{const{t:d}=Ie(["resources","common","machines"]),{data:m}=Te(),u=k(),p=b(),{data:h,isLoading:x}=G(r),{data:f,isLoading:g}=H(r),{data:j}=O(),{buildQueueVault:N}=P(),{mutateAsync:w}=ce(),[C,S]=i.useState(!1),[T,z]=i.useState([]),[I,_]=i.useState(""),[M,D]=i.useState(""),[$,E]=i.useState(""),[B,V]=i.useState(""),[R,F]=i.useState("table"),A=i.useMemo(()=>{const e=[];return f&&f.length>0&&f.forEach(t=>{e.push({value:t.machineName,label:`${t.machineName} (Machine)`,type:"machine"})}),h&&h.length>0&&h.forEach(t=>{e.push({value:t.storageName,label:`${t.storageName} (Cloud Storage)`,type:"storage"})}),e},[f,h]);i.useEffect(()=>{!M&&a&&D(a)},[a,M]);const L=async()=>{if(M){S(!0);try{const s=A.find(e=>e.value===M),i="storage"===s?.type,o={},l=f?.find(e=>e.machineName===a);l&&l.vaultContent&&(o.machineVault=l.vaultContent);const c=j?.find(e=>e.teamName===r);if(c&&c.vaultContent&&(o.teamVault=c.vaultContent),!i&&M!==a){const t=f?.find(e=>e.machineName===M);if(t&&t.vaultContent)try{const e=JSON.parse(t.vaultContent);o.additionalMachineData={[M]:e}}catch(e){}}if(i){const t=h?.find(e=>e.storageName===M);if(t&&t.vaultContent)try{const e=JSON.parse(t.vaultContent);o.additionalStorageData={[M]:e}}catch(e){}}const m=await N({teamName:r,machineName:a,bridgeName:n,functionName:"list",params:{from:M,path:I||"",format:"json"},priority:4,description:`List files from ${M}`,addedVia:"file-browser",...o}),u=await w({teamName:r,machineName:a,bridgeName:n,queueVault:m,priority:4}),p=u.taskId||u.queueId;if(!p)throw new Error("Failed to create queue item - no taskId returned");if(u.isQueued)v("info","File listing has been queued. Please try again in a moment."),z([]);else{const s=await Rs(p,3e4);if(s.success){let a=[],i="";try{const t=s.responseData?.result;if(!t&&!s.responseData)return void z([]);if("string"==typeof t)try{i=JSON.parse(t).command_output||""}catch(e){i=t}if("string"==typeof i)if(i.includes("DEBUG:")){const e=i.lastIndexOf("["),t=i.lastIndexOf("]");if(-1!==e&&-1!==t&&e<t){const s=i.substring(e,t+1);i=s}}else if(i.includes("[")){const e=i.indexOf("["),t=i.lastIndexOf("]");if(-1!==e&&-1!==t){const s=i.substring(e,t+1);i=s.replace(/\\\\/g,"\\").replace(/\\n/g,"\n")}}const r="string"==typeof i?JSON.parse(i):i;Array.isArray(r)?a=r.map(e=>({name:e.name||e.Name||"",size:parseInt(e.size||e.Size||"0"),isDirectory:void 0!==e.isDirectory?e.isDirectory:e.permissions?.startsWith("d")||e.IsDir||!1,modTime:e.date?`${e.date} ${e.time}`:e.ModTime,path:e.Path||(I?`${I}/${e.name||e.Name}`:e.name||e.Name)})):r.entries&&(a=r.entries.map(e=>({name:e.Name,size:e.Size||0,isDirectory:e.IsDir||!1,modTime:e.ModTime,mimeType:e.MimeType,path:e.Path||(I?`${I}/${e.Name}`:e.Name)})))}catch(t){if("string"==typeof i&&i.includes('"Path":')&&i.includes('"Name":')){const t=i.match(/\{[^}]+\}/g);t&&(a=t.map(t=>{try{const e=JSON.parse(t);return{name:e.Name||"",size:e.Size||0,isDirectory:e.IsDir||!1,modTime:e.ModTime,mimeType:e.MimeType,path:e.Path||(I?`${I}/${e.Name}`:e.Name)}}catch(e){return null}}).filter(e=>null!==e))}else{const e=("string"==typeof i?i:JSON.stringify(i)).trim().split("\n").filter(e=>e.trim());a=e.filter(e=>!(e.startsWith("Listing")||e.startsWith("Setting up")||e.startsWith("Error:")||e.startsWith("DEBUG:")||""===e.trim())).map(e=>{const t=e.match(/^\s*(\d+)\s+(.+)$/);if(t){const[,e,s]=t;return{name:s.trim(),size:parseInt(e),isDirectory:s.endsWith("/"),path:I?`${I}/${s.trim()}`:s.trim()}}return{name:e.trim(),size:0,isDirectory:e.endsWith("/"),path:I?`${I}/${e.trim()}`:e.trim()}})}}z(a.filter(e=>e.name))}else v("error",s.message||d("resources:remoteFiles.loadError")),z([])}}catch(s){v("error",s.message||d("resources:remoteFiles.loadError")),z([])}finally{S(!1)}}},W=e=>{_(e),E(""),z([])},U=i.useMemo(()=>B?T.filter(e=>e.name.toLowerCase().includes(B.toLowerCase())):T,[T,B]),q=[{title:d("resources:remoteFiles.name"),dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(_e,{children:[s.isDirectory?e.jsx(Ge,{style:{color:"#1890ff"}}):e.jsx(We,{style:{color:"#666"}}),s.isDirectory?e.jsx("a",{onClick:()=>W(I?`${I}/${t}`:t),"data-testid":`file-browser-folder-${t}`,children:t}):e.jsx("span",{"data-testid":`file-browser-file-${t}`,children:t})]}),sorter:(e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name)},{title:d("resources:remoteFiles.size"),dataIndex:"size",key:"size",width:120,render:(e,t)=>t.isDirectory?"-":(e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]})(e),sorter:(e,t)=>e.size-t.size},{title:d("resources:remoteFiles.modified"),dataIndex:"modTime",key:"modTime",width:200,render:e=>e?yt(e):"-",sorter:(e,t)=>e.modTime&&t.modTime?new Date(e.modTime).getTime()-new Date(t.modTime).getTime():0}],K=i.useMemo(()=>{const t=[{title:e.jsx("span",{"data-testid":"file-browser-breadcrumb-home",children:e.jsx(et,{})}),onClick:()=>W("")}];if(I){const s=I.split("/").filter(Boolean);s.forEach((a,i)=>{const r=s.slice(0,i+1).join("/");t.push({title:e.jsx("span",{"data-testid":`file-browser-breadcrumb-${a}`,children:a}),onClick:()=>W(r)})})}return t},[I]);return e.jsx($e,{"data-testid":"file-browser-modal",title:e.jsxs(_e,{children:[e.jsx(Ze,{}),d("resources:remoteFiles.title")]}),open:t,onCancel:s,className:y.Large,footer:[e.jsx(Fe,{title:d("common:actions.cancel"),children:e.jsx(Re,{icon:e.jsx(Xe,{}),onClick:s,style:p.touchTarget,"data-testid":"file-browser-cancel-button","aria-label":d("common:actions.cancel")})},"cancel"),e.jsx(Fe,{title:d("common:actions.refresh"),children:e.jsx(Re,{icon:e.jsx(Ye,{}),onClick:L,loading:C,style:p.touchTarget,"data-testid":"file-browser-refresh-button","aria-label":d("common:actions.refresh")})},"refresh"),e.jsx(Fe,{title:d("resources:remoteFiles.pull"),children:e.jsx(Re,{type:"primary",icon:e.jsx(Ze,{}),onClick:async()=>{if(!$)return void v("warning",d("resources:remoteFiles.selectFile"));const e=T.find(e=>e.name===$);if(e)if(o)o([e],M),s();else{const i=e,o={},l=A.find(e=>e.value===M),m="storage"===l?.type,u=f?.find(e=>e.machineName===a);u&&u.vaultContent&&(o.machineVault=u.vaultContent);const p=j?.find(e=>e.teamName===r);if(p&&p.vaultContent&&(o.teamVault=p.vaultContent),m){const e=h?.find(e=>e.storageName===M);if(e&&e.vaultContent)try{const t=JSON.parse(e.vaultContent);o.additionalStorageData={[M]:t}}catch(t){}}if(!m&&M!==a){const e=f?.find(e=>e.machineName===M);if(e&&e.vaultContent)try{const t=JSON.parse(e.vaultContent);o.additionalMachineData={[M]:t}}catch(t){}}const y=await N({teamName:r,machineName:a,bridgeName:n,functionName:"pull",params:{from:M,repo:i.name,path:I||"",sourceType:m?"storage":"machine"},priority:3,description:`Pull ${i.name} from ${M}`,addedVia:"file-browser",...o}),x=await w({teamName:r,machineName:a,bridgeName:n,queueVault:y,priority:3});x?.taskId&&c?c(x.taskId,a):x?.isQueued&&v("info",d("resources:messages.pullOperationQueued")),v("success",d("resources:remoteFiles.pullStarted")),s()}},disabled:!$,style:p.touchTarget,"data-testid":"file-browser-pull-button","aria-label":d("resources:remoteFiles.pull")})},"pull")],children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{"data-testid":"file-browser-source-container",children:[e.jsx("div",{style:{marginBottom:8,fontWeight:500},"data-testid":"file-browser-source-label",children:d("resources:remoteFiles.sourceLabel")}),e.jsxs(_e,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsxs(_e,{children:[e.jsx(He,{style:{width:300},placeholder:d("resources:remoteFiles.selectSource"),value:M,onChange:e=>{D(e),_(""),E(""),z([])},loading:x||g,notFoundContent:x||g?e.jsx(Ae,{size:"small"}):0===A.length?e.jsx(Ue,{image:Ue.PRESENTED_IMAGE_SIMPLE,description:d("resources:remoteFiles.noSources")}):null,options:A,"data-testid":"file-browser-source-select"}),e.jsx(Fe,{title:d("resources:remoteFiles.loadFiles"),children:e.jsx(Re,{icon:e.jsx(qe,{}),onClick:L,loading:C,disabled:!M,style:p.touchTarget,"data-testid":"file-browser-load-files-button","aria-label":d("resources:remoteFiles.loadFiles")})})]}),e.jsx(Ke.Search,{placeholder:d("common:actions.search"),value:B,onChange:e=>V(e.target.value),style:{width:250},"data-testid":"file-browser-search-input"})]})]}),I&&e.jsx(Qe,{items:K,separator:e.jsx(Je,{}),"data-testid":"file-browser-breadcrumb"}),e.jsx(Ae,{spinning:C,children:0===U.length?e.jsx(Ue,{description:d(C?"common:general.loading":"resources:remoteFiles.noFiles"),"data-testid":"file-browser-empty-state"}):e.jsx(Ve,{dataSource:U,columns:q,rowKey:"name",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(e,t)=>d("common:table.showingRecords",{start:t[0],end:t[1],total:e})},rowSelection:{type:"radio",selectedRowKeys:$?[$]:[],onChange:e=>E(e[0]||""),getCheckboxProps:e=>({disabled:e.isDirectory})},scroll:{y:400},style:u.tableContainer,"data-testid":"file-browser-table",onRow:e=>({"data-testid":`file-browser-row-${e.name}`})})}),e.jsx(Be,{type:"info",message:d("resources:remoteFiles.info"),showIcon:!0,"data-testid":"file-browser-info-alert"})]})})},Js=e=>{if(!e||"string"!=typeof e)return 0;const t=e.match(/^([\d.]+)\s*([KMGT]i?B?)?$/i);if(!t)return 0;const s=parseFloat(t[1]);if(isNaN(s))return 0;const a=(t[2]||"").toUpperCase();return s*({KI:1024,MI:1048576,GI:1073741824,TI:1099511627776,KIB:1024,MIB:1048576,GIB:1073741824,TIB:1099511627776}[a]||{KB:1e3,MB:1e6,GB:1e9,TB:1e12}[a]||{K:1024,M:1048576,G:1073741824,T:1099511627776,B:1}[a]||1)},Xs=(e,t,s)=>{if(e){const t=parseInt(e);if(!isNaN(t)&&t>=0)return Math.min(100,t)}if(!t||!s)return 0;const a=Js(t),i=Js(s);if(0===i)return 0;const r=Math.round(a/i*100);return Math.min(100,Math.max(0,r))},{Text:Ys}=Me,Zs=({machine:t,onViewDetails:s,onManageAssignment:a})=>{const{t:i}=Ie(["distributedStorage","machines"]),r=b(),n=!!t.distributedStorageClusterName,{data:o,isLoading:l}=de(t.machineName,t.teamName,!n),c=n?"CLUSTER":o?.assignmentType||"AVAILABLE",d=n?`Assigned to cluster: ${t.distributedStorageClusterName}`:o?.assignmentDetails;return l?e.jsx("div",{style:{...r.flexCenter,...r.padding.lg},"data-testid":"ds-section-loading",children:e.jsx(Ae,{})}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{style:r.marginBottom.lg,"data-testid":"ds-section-divider",children:e.jsxs(_e,{style:r.flexCenter,children:[e.jsx(pt,{style:r.icon.medium}),e.jsx("span",{style:r.heading5,children:i("machineSection.title")})]})}),e.jsx(st,{size:"small","data-testid":"ds-section-card",style:{...r.card,border:"1px solid var(--color-border-secondary)"},children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsx(Ys,{type:"secondary",style:{display:"block",...r.marginBottom.xs,...r.label},"data-testid":"ds-section-assignment-label",children:i("assignment.currentAssignment")}),e.jsx(me,{assignmentType:c,assignmentDetails:d,size:"default","data-testid":"ds-section-assignment-badge"})]}),"AVAILABLE"!==c&&d&&e.jsx(Be,{message:e.jsx("span",{style:r.body,children:d}),type:"info",icon:"CLUSTER"===c?e.jsx(gt,{style:r.icon.small}):"IMAGE"===c?e.jsx(C,{style:r.icon.small}):"CLONE"===c?e.jsx(jt,{style:r.icon.small}):e.jsx(pt,{style:r.icon.small}),showIcon:!0,style:{borderRadius:"var(--border-radius-lg)"},"data-testid":"ds-section-assignment-alert"}),e.jsxs(_e,{children:[s&&e.jsx(Re,{size:"small",icon:e.jsx(S,{style:r.icon.small}),onClick:s,style:{...r.buttonSecondary,...r.touchTargetSmall},"data-testid":"ds-section-history-button",children:e.jsx("span",{style:r.caption,children:i("assignment.history")})}),a&&"AVAILABLE"!==c&&e.jsx(Re,{size:"small",type:"primary",icon:e.jsx(be,{style:r.icon.small}),onClick:a,style:{...r.buttonPrimary,...r.touchTargetSmall},"data-testid":"ds-section-manage-button",children:e.jsx("span",{style:r.caption,children:i("machineSection.manageAssignment")})})]}),"AVAILABLE"!==c&&e.jsx(Be,{message:e.jsx("span",{style:r.body,children:i("warnings.exclusivity")}),type:"warning",showIcon:!0,style:{...r.marginBottom.xs,borderRadius:"var(--border-radius-lg)"},"data-testid":"ds-section-exclusivity-warning"})]})})]})},{Text:ea,Title:ta}=Me,sa=({machine:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=Ie(["machines","resources","common","distributedStorage"]),{theme:o}=u(),l=b(),[c,d]=i.useState({open:!1,entityType:null,entityIdentifier:null}),m=i.useMemo(()=>{if(!t?.vaultStatus)return null;try{if(t.vaultStatus.trim().startsWith("jq:")||t.vaultStatus.trim().startsWith("error:")||!t.vaultStatus.trim().startsWith("{"))return null;const e=JSON.parse(t.vaultStatus);if("completed"===e.status&&e.result){let t=e.result;if(t.match(/(\}[\s\n]*$)/)){const e=t.lastIndexOf("}");e<t.length-10&&(t=t.substring(0,e+1))}const s=t.indexOf("\njq:");return s>0&&(t=t.substring(0,s)),t=t.trim(),JSON.parse(t)}}catch(e){}return null},[t]);return i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,a]),t&&s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"machine-vault-status-panel",style:r?{height:"100%",backgroundColor:"dark"===o?"#141414":"#fff",overflowY:"auto",overflowX:"hidden"}:{position:"fixed",top:0,right:s?0:"-520px",bottom:0,width:"520px",maxWidth:"100vw",backgroundColor:"dark"===o?"#141414":"#fff",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,transition:"right 0.3s ease-in-out",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),position:"sticky",top:0,backgroundColor:"dark"===o?"#141414":"#fff",zIndex:r?0:1},"data-testid":"vault-status-header",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(_e,{children:[e.jsx(pt,{style:{fontSize:24,color:"#556b2f"}}),e.jsx(ta,{level:4,style:{margin:0},"data-testid":"vault-status-machine-name",children:t.machineName})]}),e.jsx(Re,{type:"text",icon:e.jsx(ns,{}),onClick:a,style:l.touchTarget,"data-testid":"vault-status-collapse","aria-label":"Collapse Panel"})]}),e.jsxs(_e,{wrap:!0,style:{marginTop:8},children:[e.jsxs(De,{color:"#8FBC8F",icon:e.jsx(T,{}),"data-testid":"vault-status-team-tag",children:["Team: ",t.teamName]}),e.jsxs(De,{color:"green",icon:e.jsx(z,{}),"data-testid":"vault-status-bridge-tag",children:["Bridge: ",t.bridgeName]}),t.regionName&&e.jsxs(De,{color:"purple",icon:e.jsx(I,{}),"data-testid":"vault-status-region-tag",children:["Region: ",t.regionName]}),e.jsx(at,{count:t.queueCount,style:{backgroundColor:"#52c41a"},"data-testid":"vault-status-queue-badge",children:e.jsx(De,{color:"blue",children:n("machines:queueItems")})}),e.jsxs(De,{color:"blue","data-testid":"vault-status-version-tag",children:[n("machines:vaultVersion"),": ",t.vaultVersion]})]}),t.vaultStatusTime&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(ea,{type:"secondary",style:{fontSize:12},title:ft(t.vaultStatusTime,"datetime"),"data-testid":"vault-status-last-updated",children:[n("machines:lastUpdated"),": ",xt(t.vaultStatusTime,n)]})})]}),e.jsx("div",{style:{padding:"24px"},"data-testid":"vault-status-content",children:m?e.jsxs(e.Fragment,{children:[m.system&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[e.jsx(V,{style:{fontSize:20,color:"#556b2f"}}),e.jsx(ta,{level:5,style:{margin:0},"data-testid":"vault-status-system-info-title",children:n("resources:repositories.systemInfo")})]}),e.jsxs(it,{gutter:[16,16],style:l.marginBottom.md,children:[e.jsx(rt,{span:12,children:e.jsx(st,{size:"small",style:{height:"100%"},"data-testid":"vault-status-hostname-card",children:e.jsx(nt,{title:n("resources:repositories.hostname"),value:m.system.hostname,prefix:e.jsx(pt,{}),valueStyle:{fontSize:16}})})}),e.jsx(rt,{span:12,children:e.jsx(st,{size:"small",style:{height:"100%"},"data-testid":"vault-status-uptime-card",children:e.jsx(nt,{title:n("resources:repositories.uptime"),value:m.system.uptime,prefix:e.jsx(vt,{}),valueStyle:{fontSize:16}})})}),e.jsx(rt,{span:24,children:e.jsx(st,{size:"small","data-testid":"vault-status-os-info-card",children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.osName"),":"]}),e.jsx(ea,{strong:!0,"data-testid":"vault-status-os-name",children:m.system.os_name})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.kernel"),":"]}),e.jsx(ea,{"data-testid":"vault-status-kernel",children:m.system.kernel})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.cpu"),":"]}),e.jsxs(ea,{"data-testid":"vault-status-cpu",children:[m.system.cpu_count," × ",m.system.cpu_model]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.systemTime"),":"]}),e.jsxs(ea,{"data-testid":"vault-status-system-time",children:[m.system.system_time_human," (",m.system.timezone,")"]})]})]})})})]}),e.jsx(tt,{style:{margin:"24px 0"},children:e.jsxs(_e,{children:[e.jsx(N,{}),n("resources:repositories.resourceUsage")]})}),e.jsxs(it,{gutter:[16,16],style:l.marginBottom.lg,children:[e.jsx(rt,{span:24,children:e.jsxs(st,{size:"small","data-testid":"vault-status-memory-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(_e,{children:[e.jsx(gt,{style:{color:"#1890ff"}}),e.jsx(ea,{strong:!0,children:n("resources:repositories.memory")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(ea,{children:[m.system.memory.used," / ",m.system.memory.total]})}),e.jsx(Ee,{percent:Xs(void 0,m.system.memory.used,m.system.memory.total),strokeColor:"#1890ff",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(ea,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",m.system.memory.available]})]})}),e.jsx(rt,{span:24,children:e.jsxs(st,{size:"small","data-testid":"vault-status-disk-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(_e,{children:[e.jsx(C,{style:{color:"#fa8c16"}}),e.jsx(ea,{strong:!0,children:n("resources:repositories.rootDisk")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(ea,{children:[m.system.disk.used," / ",m.system.disk.total]})}),e.jsx(Ee,{percent:Xs(m.system.disk.use_percent,m.system.disk.used,m.system.disk.total),status:(parseInt(m.system.disk.use_percent)||0)>90?"exception":"normal",strokeColor:(parseInt(m.system.disk.use_percent)||0)>90?"#ff4d4f":"#fa8c16",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(ea,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",m.system.disk.available]})]})}),m.system.datastore?.path&&e.jsx(rt,{span:24,children:e.jsxs(st,{size:"small","data-testid":"vault-status-datastore-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(_e,{children:[e.jsx(gt,{style:{color:"#52c41a"}}),e.jsx(ea,{strong:!0,children:n("resources:repositories.datastore")})]})}),e.jsx(ea,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:8,wordBreak:"break-all"},children:m.system.datastore.path}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(ea,{children:[m.system.datastore.used," / ",m.system.datastore.total]})}),e.jsx(Ee,{percent:Xs(m.system.datastore.use_percent,m.system.datastore.used,m.system.datastore.total),status:(parseInt(m.system.datastore.use_percent)||0)>90?"exception":"normal",strokeColor:(parseInt(m.system.datastore.use_percent)||0)>90?"#ff4d4f":"#52c41a",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(ea,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",m.system.datastore.available]})]})})]})]}),m.network&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{style:{margin:"24px 0"},children:e.jsxs(_e,{children:[e.jsx(A,{}),n("resources:repositories.networkInfo")]})}),m.network.default_gateway&&e.jsx(st,{size:"small",style:{marginBottom:16},"data-testid":"vault-status-gateway-card",children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.defaultGateway"),":"]}),e.jsx(ea,{strong:!0,"data-testid":"vault-status-gateway",children:m.network.default_gateway})]}),m.network.default_interface&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.defaultInterface"),":"]}),e.jsx(ea,{"data-testid":"vault-status-interface",children:m.network.default_interface})]})]})}),e.jsx(ot,{dataSource:m.network.interfaces.filter(e=>"unknown"!==e.state&&"lo"!==e.name),style:l.marginBottom.lg,"data-testid":"vault-status-network-list",renderItem:t=>e.jsxs(st,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-network-${t.name}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(_e,{children:[e.jsx(Ss,{style:{color:"#1890ff"}}),e.jsx(ea,{strong:!0,"data-testid":`vault-status-network-name-${t.name}`,children:t.name})]}),e.jsx(De,{color:"UP"===t.state?"success":"default","data-testid":`vault-status-network-state-${t.name}`,children:t.state})]}),e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[t.ipv4_addresses.length>0&&e.jsxs("div",{children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.ipAddresses"),":"]}),t.ipv4_addresses.map((t,s)=>e.jsx("div",{style:{marginLeft:16},children:e.jsx(De,{color:"blue","data-testid":`vault-status-ip-${t}`,children:t})},s))]}),t.mac_address&&"unknown"!==t.mac_address&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.macAddress"),":"]}),e.jsx(ea,{style:{fontSize:12},children:t.mac_address})]}),t.mtu>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(ea,{type:"secondary",children:"MTU:"}),e.jsx(ea,{children:t.mtu})]})]})]})})]}),m.block_devices&&m.block_devices.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{style:{margin:"24px 0"},children:e.jsxs(_e,{children:[e.jsx(C,{}),n("resources:repositories.blockDevices")]})}),e.jsx(ot,{dataSource:m.block_devices,style:l.marginBottom.lg,"data-testid":"vault-status-block-devices-list",renderItem:t=>e.jsxs(st,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-block-device-${t.name}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(_e,{children:[e.jsx(C,{style:{color:"#fa8c16"}}),e.jsx(ea,{strong:!0,"data-testid":`vault-status-device-path-${t.name}`,children:t.path})]}),e.jsxs(_e,{children:[e.jsx(De,{"data-testid":`vault-status-device-type-${t.name}`,children:t.type}),e.jsx(De,{color:"blue","data-testid":`vault-status-device-size-${t.name}`,children:t.size_human})]})]}),e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[t.model&&"Unknown"!==t.model&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.model"),":"]}),e.jsx(ea,{style:{fontSize:12},children:t.model})]}),t.partitions.length>0&&e.jsxs("div",{children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.partitions"),":"]}),e.jsx("div",{style:{marginLeft:16,marginTop:8},children:t.partitions.map((t,s)=>e.jsx("div",{style:{marginBottom:4},children:e.jsxs(_e,{children:[e.jsx(ze,{style:{fontSize:12}}),e.jsxs(ea,{style:{fontSize:12},children:[t.name,": ",t.size_human,t.filesystem&&` (${t.filesystem})`,t.mountpoint&&` → ${t.mountpoint}`]})]})},s))})]})]})]})})]}),m.system_containers&&m.system_containers.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{style:{margin:"24px 0"},children:e.jsxs(_e,{children:[e.jsx(Ot,{}),n("resources:repositories.systemContainers")]})}),e.jsx(ot,{dataSource:m.system_containers,style:l.marginBottom.lg,"data-testid":"vault-status-containers-list",renderItem:t=>e.jsxs(st,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-container-${t.id}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(_e,{children:[e.jsx(Ot,{style:{color:"#722ed1"}}),e.jsx(ea,{strong:!0,"data-testid":`vault-status-container-name-${t.id}`,children:t.name})]}),e.jsx(De,{color:"running"===t.state?"success":"default","data-testid":`vault-status-container-state-${t.id}`,children:t.state})]}),e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsx(ea,{type:"secondary",style:{fontSize:12},ellipsis:!0,children:t.image}),t.cpu_percent&&e.jsxs(_e,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(ea,{type:"secondary",children:"CPU:"}),e.jsx(ea,{children:t.cpu_percent})]}),t.memory_usage&&e.jsxs(_e,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsxs(ea,{type:"secondary",children:[n("resources:repositories.memory"),":"]}),e.jsx(ea,{children:t.memory_usage})]})]})]})})]}),t&&e.jsx("div",{"data-testid":"vault-status-distributed-storage",children:e.jsx(Zs,{machine:t,onViewDetails:()=>{d({open:!0,entityType:"Machine",entityIdentifier:t.machineName,entityName:t.machineName})}})})]}):e.jsx(Ue,{description:n("machines:noVaultData"),style:{marginTop:48},"data-testid":"vault-status-empty"})})]}),e.jsx(dt,{open:c.open,onCancel:()=>d({open:!1,entityType:null,entityIdentifier:null}),entityType:c.entityType,entityIdentifier:c.entityIdentifier,entityName:c.entityName})]}):null},aa=({teamFilter:s,showActions:a=!0,className:n="",onEditMachine:o,onFunctionsMachine:l,onDeleteMachine:c,onCreateRepository:d,enabled:m=!0,onQueueItemCreated:u,expandedRowKeys:p,onExpandedRowsChange:h,refreshKeys:y,onRowClick:x,selectedMachine:f,onMachineRepositoryClick:g,onMachineContainerClick:w,onRefreshMachines:k})=>{const{t:C}=Ie(["machines","common","functions","resources"]),T=t(e=>e.ui.uiMode),z="expert"===T,{executePingForMachineAndWait:D}=As(),$=b(),B=i.useRef(null),[R,F]=i.useState("machine"),[P,O]=i.useState([]),[L,G]=i.useState({}),[W,K]=i.useState({}),[Q,J]=i.useState(!1),[X,Y]=i.useState(null),[Z,ee]=i.useState(null),[te,se]=i.useState(!1),[ae,ie]=i.useState([]),re=void 0!==p?p:P,ne=h||O,le=void 0!==y?y:W,[ce,de]=i.useState({open:!1,entityType:null,entityIdentifier:null}),[me,je]=i.useState({open:!1,machine:null}),[ve,we]=i.useState({open:!1,machine:null}),[ke,Ce]=i.useState(!1),[Se,Te]=i.useState(!1),[ze,Me]=i.useState(!1),[$e,Ee]=i.useState(null),[Be,Pe]=i.useState(!1);r.useEffect(()=>()=>{X&&clearTimeout(X)},[X]),r.useEffect(()=>{"simple"===T&&"machine"!==R&&F("machine")},[T,R]);const{data:Oe=[],isLoading:Ae,refetch:Le}=H(s,m),{data:Ge=[]}=U(s),We=((e,t={})=>{const{rowHeight:s=54,headerHeight:a=55,paginationHeight:r=64,containerOffset:n=32,minRows:o=5,maxRows:l=100}=t,[c,d]=i.useState(10),m=i.useRef(null),u=i.useCallback(()=>{if(!e.current)return;const t=e.current.offsetHeight-a-r-n,i=Math.floor(t/s),c=Math.max(o,Math.min(l,i));d(c)},[e,s,a,r,n,o,l]),p=i.useRef(null);return i.useEffect(()=>(p.current=ht.debounce(u,300),()=>{p.current?.cancel()}),[u]),i.useEffect(()=>{u(),e.current&&window.ResizeObserver&&(m.current=new ResizeObserver(()=>{p.current?.()}),m.current.observe(e.current));const t=()=>{p.current?.()};return window.addEventListener("resize",t),()=>{m.current&&m.current.disconnect(),window.removeEventListener("resize",t),p.current?.cancel()}},[u,e]),c})(B,{containerOffset:170,minRows:5,maxRows:50}),He=Oe,qe=e=>{try{if(!e.vaultStatus||e.vaultStatus.trim().startsWith("jq:")||e.vaultStatus.trim().startsWith("error:")||!e.vaultStatus.trim().startsWith("{"))return[];const t=JSON.parse(e.vaultStatus);if("completed"===t.status&&t.result){let e=t.result;if(e.match(/(\}[\s\n]*$)/)){const t=e.lastIndexOf("}");t<e.length-10&&(e=e.substring(0,t+1))}const s=e.indexOf("\njq:");s>0&&(e=e.substring(0,s)),e=e.trim();const a=JSON.parse(e);if(a?.repositories&&Array.isArray(a.repositories))return a.repositories.map(e=>{if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.name)){const t=Ge.find(t=>t.repositoryGuid===e.name);if(t)return{...e,name:t.repositoryName,repositoryGuid:t.repositoryGuid,grandGuid:t.grandGuid}}return e})}}catch(t){}return[]},Ke=i.useCallback(e=>{c&&c(e)},[c]),Qe=i.useCallback(e=>{x?x(e):(Ee(e),Pe(!0))},[x]),Je=i.useCallback(()=>{Pe(!1),Ee(null)},[]),{getFunctionsByCategory:Xe}=q(),Ye=i.useMemo(()=>Xe("machine").filter(e=>e&&!1!==e.showInMenu&&"mount"!==e.name&&"pull"!==e.name),[Xe]),Ze=r.useMemo(()=>{const t=[];return t.push({title:C("machines:machineName"),dataIndex:"machineName",key:"machineName",ellipsis:!0,sorter:(e,t)=>e.machineName.localeCompare(t.machineName),render:(t,s)=>{const a=re.includes(s.machineName);return e.jsxs(_e,{children:[e.jsx("span",{style:{display:"inline-block",width:12,transition:"transform 0.3s ease",transform:a?"rotate(90deg)":"rotate(0deg)"},"data-testid":`machine-expand-${s.machineName}`,children:e.jsx(be,{style:{fontSize:12,color:"#999"}})}),e.jsx(V,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})}}),x||t.push({title:C("machines:team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx(De,{color:"#8FBC8F",children:t}),sorter:(e,t)=>e.teamName.localeCompare(t.teamName)}),x||(z?t.push({title:C("machines:region"),dataIndex:"regionName",key:"regionName",width:150,ellipsis:!0,render:t=>t?e.jsx(De,{color:"purple",children:t}):"-",sorter:(e,t)=>(e.regionName||"").localeCompare(t.regionName||"")},{title:C("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",width:150,ellipsis:!0,render:t=>e.jsx(De,{color:"green",children:t}),sorter:(e,t)=>e.bridgeName.localeCompare(t.bridgeName)}):"simple"!==T&&t.push({title:C("bridges.bridge"),dataIndex:"bridgeName",key:"bridgeName",width:150,ellipsis:!0,render:t=>e.jsx(De,{color:"#8FBC8F",children:t})})),!x&&z&&_.isEnabled("assignToCluster")&&t.push({title:C("machines:assignmentStatus.title"),key:"assignmentStatus",width:180,ellipsis:!0,render:(t,s)=>e.jsx(ue,{machine:s})}),x||t.push({title:C("machines:queueItems"),dataIndex:"queueCount",key:"queueCount",width:100,align:"center",sorter:(e,t)=>e.queueCount-t.queueCount,render:t=>e.jsx(at,{count:t,showZero:!0,style:{backgroundColor:t>0?"#52c41a":"#d9d9d9"}})}),a&&t.push({title:C("common:table.actions"),key:"actions",width:j.DIMENSIONS.CARD_WIDTH,render:(t,s)=>e.jsxs(_e,{children:[e.jsx(Fe,{title:C("common:actions.edit"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(E,{}),onClick:()=>o&&o(s),"data-testid":`machine-edit-${s.machineName}`,"aria-label":C("common:actions.edit")})}),e.jsx(lt,{"data-testid":`machine-dropdown-${s.machineName}`,menu:{items:[{key:"createRepo",label:C("machines:createRepo"),icon:e.jsx(oe,{}),onClick:()=>d&&d(s),"data-testid":`machine-create-repo-${s.machineName}`},{key:"pull",label:C("functions:functions.pull.name"),icon:e.jsx(Vs,{}),onClick:()=>{je({open:!0,machine:s})},"data-testid":`machine-pull-${s.machineName}`},{key:"functions",label:C("machines:runAction"),icon:e.jsx(pe,{}),"data-testid":`machine-functions-${s.machineName}`,children:[...Ye.map(t=>({key:`function-${t?.name||"unknown"}`,label:e.jsx("span",{title:t?.description||"",children:t?.name||"Unknown"}),onClick:()=>{l&&t?.name&&(l(s,t.name),void 0===y&&K(e=>({...e,[s.machineName]:Date.now()})))},"data-testid":`machine-function-${t?.name||"unknown"}-${s.machineName}`})),{type:"divider"},{key:"advanced",label:C("machines:advanced"),icon:e.jsx(pe,{}),onClick:()=>{l&&(l(s),void 0===y&&K(e=>({...e,[s.machineName]:Date.now()})))},"data-testid":`machine-advanced-${s.machineName}`}]},{key:"test",label:C("machines:connectivityTest"),icon:e.jsx(A,{}),onClick:async()=>{v("info",C("machines:testingConnection"));const e=await D(s,{priority:4,description:"Connectivity test",addedVia:"machine-table",timeout:15e3});e.success?v("success",C("machines:connectionSuccessful")):v("error",e.error||C("machines:connectionFailed"))},"data-testid":`machine-test-${s.machineName}`},...z&&_.isEnabled("assignToCluster")?[{key:"assignCluster",label:s.distributedStorageClusterName?C("machines:changeClusterAssignment"):C("machines:assignToCluster"),icon:e.jsx(pt,{}),onClick:()=>{we({open:!0,machine:s})},"data-testid":`machine-assign-cluster-${s.machineName}`}]:[]]},trigger:["click"],children:e.jsx(Fe,{title:C("machines:remote"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(pe,{}),"data-testid":`machine-remote-${s.machineName}`,"aria-label":C("machines:remote")})})}),e.jsx(Fe,{title:C("machines:trace"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(S,{}),onClick:()=>{de({open:!0,entityType:"Machine",entityIdentifier:s.machineName,entityName:s.machineName})},"data-testid":`machine-trace-${s.machineName}`,"aria-label":C("machines:trace")})}),e.jsx(Fe,{title:C("common:actions.delete"),children:e.jsx(Re,{type:"primary",danger:!0,size:"small",icon:e.jsx(M,{}),onClick:()=>Ke(s),"data-testid":`machine-delete-${s.machineName}`,"aria-label":C("common:actions.delete")})}),e.jsx(he,{machine:s.machineName,teamName:s.teamName})]})}),t},[z,T,a,C,Ke,o,l,d,D,Ye,re,y,K,we,de,je,x]),et=z&&_.isEnabled("assignToCluster")?{selectedRowKeys:ae,onChange:e=>{ie(e)},getCheckboxProps:e=>({disabled:!1,"data-testid":`machine-checkbox-${e.machineName}`})}:void 0,tt=i.useMemo(()=>{const e={};return"machine"===R||He.forEach(t=>{let s="";if("bridge"===R)s=t.bridgeName;else if("team"===R)s=t.teamName;else if("region"===R)s=t.regionName||"Unknown";else{if("repository"===R){const s=qe(t);if(0===s.length)return;return void s.forEach(s=>{const a=s.name;e[a]||(e[a]=[]),e[a].find(e=>e.machineName===t.machineName)||e[a].push(t)})}if("status"===R){const e=qe(t);if(0===e.length)s="No Repositories";else{const t=e.some(e=>!e.accessible),a=e.some(e=>e.mounted&&e.docker_running),i=e.some(e=>e.mounted&&!e.docker_running),r=e.some(e=>!e.mounted);s=t?"Inaccessible":a?"Active (Running)":i?"Ready (Stopped)":r?"Not Mounted":"Unknown Status"}}else if("grand"===R){const s=qe(t);if(0===s.length)return;return void s.forEach(s=>{let a="No Grand Repository";if(s.grandGuid){const e=Ge.find(e=>e.repositoryGuid===s.grandGuid);e&&(a=e.repositoryName)}e[a]||(e[a]=[]),e[a].find(e=>e.machineName===t.machineName)||e[a].push(t)})}}s&&(e[s]||(e[s]=[]),e[s].push(t))}),e},[He,R,Ge,qe]);return e.jsxs("div",{className:n,children:["simple"===T?null:e.jsx("div",{style:{marginBottom:16},children:e.jsxs(_e,{wrap:!0,size:"small",children:[e.jsx(Fe,{title:C("machines:machine"),children:e.jsx(Re,{type:"machine"===R?"primary":"default",icon:e.jsx(V,{}),onClick:()=>F("machine"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-machine","aria-label":C("machines:machine")})}),e.jsx("div",{style:{width:1,height:24,backgroundColor:"var(--color-border)",margin:"0 8px"}}),e.jsx(Fe,{title:C("machines:groupByBridge"),children:e.jsx(Re,{type:"bridge"===R?"primary":"default",icon:e.jsx(pt,{}),onClick:()=>F("bridge"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-bridge","aria-label":C("machines:groupByBridge")})}),e.jsx(Fe,{title:C("machines:groupByTeam"),children:e.jsx(Re,{type:"team"===R?"primary":"default",icon:e.jsx(ut,{}),onClick:()=>F("team"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-team","aria-label":C("machines:groupByTeam")})}),z&&e.jsx(Fe,{title:C("machines:groupByRegion"),children:e.jsx(Re,{type:"region"===R?"primary":"default",icon:e.jsx(I,{}),onClick:()=>F("region"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-region","aria-label":C("machines:groupByRegion")})}),e.jsx(Fe,{title:C("machines:groupByRepository"),children:e.jsx(Re,{type:"repository"===R?"primary":"default",icon:e.jsx(oe,{}),onClick:()=>F("repository"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-repository","aria-label":C("machines:groupByRepository")})}),e.jsx(Fe,{title:C("machines:groupByStatus"),children:e.jsx(Re,{type:"status"===R?"primary":"default",icon:e.jsx(Ne,{}),onClick:()=>F("status"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-status","aria-label":C("machines:groupByStatus")})}),e.jsx(Fe,{title:C("machines:groupByGrand"),children:e.jsx(Re,{type:"grand"===R?"primary":"default",icon:e.jsx(Jt,{}),onClick:()=>F("grand"),style:$.touchTargetSmall,"data-testid":"machine-view-toggle-grand","aria-label":C("machines:groupByGrand")})})]})}),z&&_.isEnabled("assignToCluster")&&0!==ae.length?e.jsxs("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f0f2f5",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(_e,{children:[e.jsx("span",{style:{fontWeight:500},children:C("machines:bulkActions.selected",{count:ae.length})}),e.jsx(Fe,{title:C("common:actions.clearSelection"),children:e.jsx(Re,{size:"small",onClick:()=>ie([]),"data-testid":"machine-bulk-clear-selection","aria-label":C("common:actions.clearSelection")})})]}),e.jsxs(_e,{children:[e.jsx(Fe,{title:C("machines:bulkActions.assignToCluster"),children:e.jsx(Re,{type:"primary",icon:e.jsx(pt,{}),onClick:()=>Ce(!0),"data-testid":"machine-bulk-assign-cluster","aria-label":C("machines:bulkActions.assignToCluster")})}),e.jsx(Fe,{title:C("machines:bulkActions.removeFromCluster"),children:e.jsx(Re,{icon:e.jsx(pt,{}),onClick:()=>Te(!0),"data-testid":"machine-bulk-remove-cluster","aria-label":C("machines:bulkActions.removeFromCluster")})}),e.jsx(Fe,{title:C("machines:bulkActions.viewAssignmentStatus"),children:e.jsx(Re,{icon:e.jsx(N,{}),onClick:()=>Me(!0),"data-testid":"machine-bulk-view-status","aria-label":C("machines:bulkActions.viewAssignmentStatus")})})]})]}):null,"machine"===R?e.jsx("div",{ref:B,style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(Ve,{columns:Ze,dataSource:He,rowKey:"machineName",loading:Ae,scroll:{x:!0,y:"calc(100vh - 400px)"},rowSelection:et,rowClassName:e=>f?.machineName===e.machineName?"ant-table-row-selected":"","data-testid":"machine-table",pagination:{pageSize:We,showSizeChanger:!1,showTotal:(e,t)=>C("common:table.showingRecords",{start:t[0],end:t[1],total:e})},onRow:e=>({"data-testid":`machine-row-${e.machineName}`,onClick:t=>{const s=t.target;if(s.closest("button")||s.closest(".ant-dropdown-trigger"))return;if(re.includes(e.machineName))ne(re.filter(t=>t!==e.machineName));else if(ne([...re,e.machineName]),G(t=>({...t,[e.machineName]:Date.now()})),k){ee(e.machineName),se(!0);const t=setTimeout(()=>{J(!0)},1e3);Y(t),k().finally(()=>{X&&clearTimeout(X),se(!1),J(!1),ee(null),Y(null)})}x&&Qe(e)},style:{cursor:"pointer",transition:"background-color 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.02)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=""}}),expandable:{expandedRowRender:t=>e.jsx(ye,{machine:t,refreshKey:le[t.machineName],onActionComplete:()=>{void 0===y&&K(e=>({...e,[t.machineName]:Date.now()}))},onRepositoryClick:e=>g?.(t,e),onContainerClick:e=>w?.(t,e),onCreateRepository:d,isLoading:Q&&Z===t.machineName,onRefreshMachines:k,onQueueItemCreated:u},`${t.machineName}-${L[t.machineName]||0}-${le[t.machineName]||0}`),rowExpandable:()=>!0,expandedRowKeys:re,onExpandedRowsChange:e=>{const t=e;ne(t);const s={...L};t.forEach(e=>{re.includes(e)||(s[e]=Date.now())}),G(s)},expandIcon:()=>null,expandRowByClick:!1},sticky:!0})}):(()=>{const t=()=>{switch(R){case"machine":case"repository":return"#556b2f";case"bridge":return"green";case"team":return"#8FBC8F";case"region":return"purple";case"status":return"geekblue";case"grand":return"blue";default:return"default"}};if(0===Object.keys(tt).length)return e.jsx(Ue,{image:Ue.PRESENTED_IMAGE_SIMPLE,description:C("resources:repositories.noRepositories"),style:{marginTop:48}});const s=e=>e%2==0?"rgba(0, 0, 0, 0.02)":"transparent",a=e=>e%2==0?"rgba(0, 0, 0, 0.08)":"#f0f0f0",i=e=>e%2==0?"#595959":"transparent";return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:32},children:Object.entries(tt).map(([r,n],o)=>e.jsx(st,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0"},children:[o%2==0&&e.jsx("div",{style:{width:4,height:j.DIMENSIONS.ICON_XL,backgroundColor:i(o),borderRadius:2}}),e.jsxs(_e,{children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:"bold",color:"#333",marginRight:8},children:["#",o+1]}),e.jsx(De,{color:t(),style:{fontSize:"16px",padding:"4px 16px",fontWeight:500},icon:"bridge"===R?e.jsx(pt,{}):"team"===R?e.jsx(ut,{}):"region"===R?e.jsx(I,{}):"repository"===R?e.jsx(oe,{}):"status"===R?e.jsx(Ne,{}):"grand"===R?e.jsx(Jt,{}):null,children:r}),e.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[n.length," ",1===n.length?C("machines:machine"):C("machines:machines")]})]})]}),styles:{body:{padding:0,backgroundColor:s(o)}},style:{borderColor:a(o),borderWidth:2,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},headStyle:{backgroundColor:s(o),borderBottom:`2px solid ${a(o)}`},children:n.map((t,s)=>e.jsx("div",{style:{borderBottom:s<n.length-1?`1px solid ${a(o)}`:"none",backgroundColor:s%2==0?"transparent":"rgba(0, 0, 0, 0.01)"},children:e.jsx(ye,{machine:t,refreshKey:le[t.machineName],onActionComplete:()=>{void 0===y&&K(e=>({...e,[t.machineName]:Date.now()}))},onRepositoryClick:e=>g?.(t,e),onContainerClick:e=>w?.(t,e),onCreateRepository:d,hideSystemInfo:!0,isLoading:Q&&Z===t.machineName,onRefreshMachines:k,onQueueItemCreated:u},`${t.machineName}-${L[t.machineName]||0}-${le[t.machineName]||0}`)},t.machineName))},r))})})(),e.jsx(dt,{open:ce.open,onCancel:()=>de({open:!1,entityType:null,entityIdentifier:null}),entityType:ce.entityType,entityIdentifier:ce.entityIdentifier,entityName:ce.entityName}),me.machine&&e.jsx(Qs,{open:me.open,onCancel:()=>je({open:!1,machine:null}),machineName:me.machine.machineName,teamName:me.machine.teamName,bridgeName:me.machine.bridgeName,onQueueItemCreated:u}),ve.machine&&e.jsx(xe,{open:ve.open,machine:ve.machine,onCancel:()=>we({open:!1,machine:null}),onSuccess:()=>{we({open:!1,machine:null}),Le()}}),e.jsx(xe,{open:ke,machines:Oe.filter(e=>ae.includes(e.machineName)),onCancel:()=>Ce(!1),onSuccess:()=>{Ce(!1),ie([]),Le()}}),e.jsx(fe,{open:Se,machines:Oe.filter(e=>ae.includes(e.machineName)),onCancel:()=>Te(!1),onSuccess:()=>{Te(!1),ie([]),Le()}}),e.jsx(ge,{open:ze,machines:Oe.filter(e=>ae.includes(e.machineName)),onCancel:()=>Me(!1)}),!x&&e.jsx(sa,{machine:$e,visible:Be,onClose:Je})]})},{Text:ia,Title:ra}=Me,na=({repository:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=Ie(["resources","common","machines"]),{theme:o}=u(),{data:l=[]}=H(t?.teamName),c=b(),d=i.useMemo(()=>{if(!t||!l.length)return null;for(const s of l)if(s.vaultStatus)try{if(s.vaultStatus.trim().startsWith("jq:")||s.vaultStatus.trim().startsWith("error:")||!s.vaultStatus.trim().startsWith("{"))continue;const e=JSON.parse(s.vaultStatus);if("completed"===e.status&&e.result){let a=e.result;if(a.match(/(\}[\s\n]*$)/)){const e=a.lastIndexOf("}");e<a.length-10&&(a=a.substring(0,e+1))}const i=a.indexOf("\njq:");i>0&&(a=a.substring(0,i)),a=a.trim();const r=JSON.parse(a);if(r.repositories&&Array.isArray(r.repositories)){const e=r.repositories.find(e=>e.name===t.repositoryName||e.name===t.repositoryGuid);if(e){const a=[];return r.services&&Array.isArray(r.services)&&r.services.forEach(s=>{if(s.repository===e.name||s.repository===t.repositoryGuid)a.push(s);else if(s.service_name||s.unit_file){const i=(s.service_name||s.unit_file||"").match(/rediacc_([0-9a-f-]{36})_/);!i||i[1]!==t.repositoryGuid&&i[1]!==e.name||a.push(s)}}),{machine:s,repositoryData:e,systemData:r.system,services:a}}}}}catch(e){}return null},[t,l]);return i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,a]),t&&s?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"repository-detail-panel","data-testid":"repo-detail-panel",style:r?{height:"100%",backgroundColor:"dark"===o?"#141414":"#fff",overflowY:"auto",overflowX:"hidden"}:{position:"fixed",top:0,right:s?0:"-520px",bottom:0,width:"520px",maxWidth:"100vw",backgroundColor:"dark"===o?"#141414":"#fff",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,transition:"right 0.3s ease-in-out",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),position:"sticky",top:0,backgroundColor:"dark"===o?"#141414":"#fff",zIndex:r?0:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(_e,{children:[e.jsx(_t,{style:{fontSize:24,color:"#8FBC8F"}}),e.jsx(ra,{level:4,style:{margin:0},"data-testid":`repo-detail-title-${t.repositoryName}`,children:t.repositoryName})]}),e.jsx(Re,{type:"text",icon:e.jsx(ns,{}),onClick:a,style:c.touchTarget,"data-testid":"repo-detail-collapse","aria-label":"Collapse Panel"})]}),e.jsxs(_e,{wrap:!0,style:{marginTop:8},children:[e.jsxs(De,{color:"#8FBC8F",icon:e.jsx(T,{}),"data-testid":`repo-detail-team-tag-${t.repositoryName}`,children:["Team: ",t.teamName]}),d&&e.jsxs(De,{color:"green",icon:e.jsx(pt,{}),"data-testid":`repo-detail-machine-tag-${t.repositoryName}`,children:["Machine: ",d.machine.machineName]}),e.jsxs(De,{color:"blue","data-testid":`repo-detail-vault-version-tag-${t.repositoryName}`,children:[n("resources:repositories.vaultVersion"),": ",t.vaultVersion]})]})]}),e.jsx("div",{style:{padding:"24px"},"data-testid":"repo-detail-content",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},"data-testid":"repo-detail-info-section",children:[e.jsx(_t,{style:{fontSize:20,color:"#8FBC8F"}}),e.jsx(ra,{level:5,style:{margin:0},children:n("resources:repositories.repositoryInfo")})]}),e.jsx(it,{gutter:[16,16],style:c.marginBottom.lg,children:e.jsx(rt,{span:24,children:e.jsx(st,{size:"small",style:c.card,"data-testid":"repo-detail-info-card",children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ia,{type:"secondary",children:[n("resources:repositories.repositoryGuid"),":"]}),e.jsx(ia,{copyable:!0,style:{fontSize:11,fontFamily:"monospace"},"data-testid":`repo-detail-guid-${t.repositoryName}`,children:t.repositoryGuid})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ia,{type:"secondary",children:[n("resources:repositories.status"),":"]}),e.jsxs(_e,{children:[d.repositoryData.mounted?e.jsx(De,{color:"success",icon:e.jsx(p,{}),"data-testid":`repo-detail-status-mounted-${t.repositoryName}`,children:n("resources:repositories.mounted")}):e.jsx(De,{color:"default",icon:e.jsx(mt,{}),"data-testid":`repo-detail-status-unmounted-${t.repositoryName}`,children:n("resources:repositories.notMounted")}),d.repositoryData.accessible&&e.jsx(De,{color:"green","data-testid":`repo-detail-status-accessible-${t.repositoryName}`,children:n("resources:repositories.accessible")})]})]}),d.repositoryData.has_rediaccfile&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ia,{type:"secondary",children:[n("resources:repositories.rediaccfile"),":"]}),e.jsx(De,{color:"purple","data-testid":`repo-detail-rediaccfile-${t.repositoryName}`,children:n("resources:repositories.hasRediaccfile")})]}),d.repositoryData.docker_running&&d.repositoryData.volume_status&&"none"!==d.repositoryData.volume_status&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(ia,{type:"secondary",children:"Docker Volumes:"}),"safe"===d.repositoryData.volume_status?e.jsxs(De,{color:"success",icon:e.jsx(p,{}),"data-testid":`repo-detail-volume-safe-${t.repositoryName}`,children:[d.repositoryData.internal_volumes," Safe Volume",1!==d.repositoryData.internal_volumes?"s":""]}):"warning"===d.repositoryData.volume_status?e.jsxs(De,{color:"warning",icon:e.jsx(D,{}),"data-testid":`repo-detail-volume-warning-${t.repositoryName}`,children:[d.repositoryData.external_volumes," External, ",d.repositoryData.internal_volumes," Internal"]}):null]})]})})})}),"warning"===d.repositoryData.volume_status&&d.repositoryData.external_volume_names&&d.repositoryData.external_volume_names.length>0&&e.jsx(Be,{type:"warning",showIcon:!0,icon:e.jsx(D,{}),message:"External Docker Volumes Detected",description:e.jsxs("div",{children:[e.jsx(ia,{children:"The following volumes are stored outside the repository:"}),e.jsx("ul",{style:{marginTop:8,marginBottom:8},children:d.repositoryData.external_volume_names.map(t=>e.jsx("li",{children:e.jsx(ia,{code:!0,children:t})},t))}),e.jsxs(ia,{type:"secondary",children:[e.jsx("strong",{children:"Warning:"})," If this repository is cloned, these volumes will be orphaned. Consider using bind mounts to ",e.jsx(ia,{code:!0,children:"$REPO_PATH"})," instead."]})]}),style:{marginBottom:16},"data-testid":`repo-detail-volume-warning-alert-${t.repositoryName}`}),e.jsx(tt,{style:{margin:"24px 0"},"data-testid":"repo-detail-storage-divider",children:e.jsxs(_e,{children:[e.jsx(N,{}),n("resources:repositories.storageInfo")]})}),e.jsxs(it,{gutter:[16,16],style:c.marginBottom.lg,children:[e.jsx(rt,{span:12,children:e.jsx(st,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-image-size-card-${t.repositoryName}`,children:e.jsx(nt,{title:n("resources:repositories.imageSize"),value:d.repositoryData.size_human,prefix:e.jsx(C,{}),valueStyle:{fontSize:16}})})}),e.jsx(rt,{span:12,children:e.jsx(st,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-last-modified-card-${t.repositoryName}`,children:e.jsx(nt,{title:n("resources:repositories.lastModified"),value:d.repositoryData.modified_human,prefix:e.jsx(h,{}),valueStyle:{fontSize:16}})})}),d.repositoryData.mounted&&d.repositoryData.disk_space&&e.jsx(rt,{span:24,children:e.jsxs(st,{size:"small","data-testid":`repo-detail-disk-usage-card-${t.repositoryName}`,children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(_e,{children:[e.jsx(gt,{style:{color:"#52c41a"}}),e.jsx(ia,{strong:!0,children:n("resources:repositories.diskUsage")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(ia,{children:[d.repositoryData.disk_space.used," / ",d.repositoryData.disk_space.total]})}),e.jsx(Ee,{percent:parseInt(d.repositoryData.disk_space.use_percent),status:parseInt(d.repositoryData.disk_space.use_percent)>90?"exception":"normal",strokeColor:parseInt(d.repositoryData.disk_space.use_percent)>90?"#ff4d4f":"#52c41a",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0,"data-testid":`repo-detail-disk-usage-progress-${t.repositoryName}`}),e.jsxs(ia,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",d.repositoryData.disk_space.available]})]})})]}),e.jsx(tt,{style:{margin:"24px 0"},"data-testid":"repo-detail-file-paths-divider",children:e.jsxs(_e,{children:[e.jsx(_t,{}),n("resources:repositories.filePaths")]})}),e.jsx(st,{size:"small",style:c.card,"data-testid":`repo-detail-file-paths-card-${t.repositoryName}`,children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{children:[e.jsxs(ia,{type:"secondary",children:[n("resources:repositories.imagePath"),":"]}),e.jsx(ia,{copyable:!0,style:{display:"block",fontSize:12,wordBreak:"break-all",marginTop:4},"data-testid":`repo-detail-image-path-${t.repositoryName}`,children:d.repositoryData.image_path})]}),d.repositoryData.mount_path&&e.jsxs("div",{children:[e.jsxs(ia,{type:"secondary",children:[n("resources:repositories.mountPath"),":"]}),e.jsx(ia,{copyable:!0,style:{display:"block",fontSize:12,wordBreak:"break-all",marginTop:4},"data-testid":`repo-detail-mount-path-${t.repositoryName}`,children:d.repositoryData.mount_path})]})]})}),d.repositoryData.mounted&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{style:{margin:"24px 0"},"data-testid":"repo-detail-activity-divider",children:e.jsxs(_e,{children:[e.jsx(vt,{}),n("resources:repositories.activity")]})}),e.jsxs(it,{gutter:[16,16],style:c.marginBottom.lg,children:[d.repositoryData.docker_running&&e.jsx(rt,{span:12,children:e.jsx(st,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-containers-card-${t.repositoryName}`,children:e.jsx(nt,{title:n("resources:repositories.containers"),value:d.repositoryData.container_count,valueStyle:{color:"#1890ff"}})})}),d.repositoryData.has_services&&e.jsx(rt,{span:12,children:e.jsx(st,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-services-card-${t.repositoryName}`,children:e.jsx(nt,{title:n("resources:repositories.services"),value:d.repositoryData.service_count,valueStyle:{color:"#fa8c16"}})})})]})]}),d.services&&d.services.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{style:{margin:"24px 0"},"data-testid":"repo-detail-services-divider",children:e.jsxs(_e,{children:[e.jsx(ze,{}),n("resources:repositories.servicesSection")]})}),e.jsx(_e,{direction:"vertical",style:{width:"100%"},size:"middle","data-testid":"repo-detail-services-list",children:d.services.map((s,a)=>e.jsx(st,{size:"small","data-testid":`repo-detail-service-card-${t.repositoryName}-${s.name}`,style:{borderLeft:"4px solid "+("active"===s.active_state?"#52c41a":"failed"===s.active_state?"#ff4d4f":"#d9d9d9")},children:e.jsxs(it,{gutter:[16,8],children:[e.jsx(rt,{span:24,children:e.jsxs(_e,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(ia,{strong:!0,"data-testid":`repo-detail-service-name-${t.repositoryName}-${s.name}`,children:s.name}),e.jsx(De,{"data-testid":`repo-detail-service-status-${t.repositoryName}-${s.name}`,color:"active"===s.active_state?"success":"failed"===s.active_state?"error":"default",children:s.active_state})]})}),(s.memory_human||s.main_pid||s.uptime_human)&&e.jsx(rt,{span:24,children:e.jsxs(_e,{wrap:!0,size:"middle",children:[s.memory_human&&e.jsxs("div",{children:[e.jsx(ia,{type:"secondary",style:{fontSize:11},children:"Memory"}),e.jsx("br",{}),e.jsx(ia,{style:{fontSize:12},children:s.memory_human})]}),s.main_pid&&e.jsxs("div",{children:[e.jsx(ia,{type:"secondary",style:{fontSize:11},children:"PID"}),e.jsx("br",{}),e.jsx(ia,{style:{fontSize:12},children:s.main_pid})]}),s.uptime_human&&e.jsxs("div",{children:[e.jsx(ia,{type:"secondary",style:{fontSize:11},children:"Uptime"}),e.jsx("br",{}),e.jsx(ia,{style:{fontSize:12},children:s.uptime_human})]}),void 0!==s.restarts&&e.jsxs("div",{children:[e.jsx(ia,{type:"secondary",style:{fontSize:11},children:"Restarts"}),e.jsx("br",{}),e.jsx(ia,{style:{fontSize:12},children:s.restarts})]})]})})]})},`${s.name}-${a}`))})]})]}):e.jsx(Ue,{description:n("resources:repositories.noRepositoryData"),style:{marginTop:48},"data-testid":"repo-detail-empty-state"})})]})}):null},{Text:oa,Title:la}=Me,ca=({container:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=Ie(["resources","common"]),{theme:o}=u(),l=b();i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};if(s)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,a]);const c=i.useMemo(()=>{if(!t)return null;const e=parseFloat(t.cpu_percent?.replace("%","")||"0"),s=t.memory_usage?.split(" / ")||[],a=s[0]||"0",i=s[1]||"0",r=parseFloat(t.memory_percent?.replace("%","")||"0"),n=t.net_io?.split(" / ")||[],o=n[0]||"0",l=n[1]||"0",c=t.block_io?.split(" / ")||[];return{cpu:e,memoryUsed:a,memoryTotal:i,memoryPercent:r,netIn:o,netOut:l,blockRead:c[0]||"0",blockWrite:c[1]||"0",pids:parseInt(t.pids||"0")}},[t]),d=t?.name?.startsWith("plugin-"),m=d&&t?t.name.replace("plugin-",""):null;return s&&t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container-detail-panel","data-testid":"container-detail-panel",style:r?{height:"100%",backgroundColor:"dark"===o?"#141414":"#fff",overflowY:"auto",overflowX:"hidden"}:{position:"fixed",top:0,right:s?0:"-520px",bottom:0,width:"520px",maxWidth:"100vw",backgroundColor:"dark"===o?"#141414":"#fff",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,transition:"right 0.3s ease-in-out",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),position:"sticky",top:0,backgroundColor:"dark"===o?"#141414":"#fff",zIndex:r?0:1},"data-testid":"container-detail-header",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(_e,{children:[d?e.jsx(z,{style:{fontSize:24,color:"#1890ff"}}):e.jsx(T,{style:{fontSize:24,color:"#52c41a"}}),e.jsx(la,{level:4,style:{margin:0},"data-testid":"container-detail-title",children:d?m:t.name})]}),e.jsx(Re,{type:"text",icon:e.jsx(ns,{}),onClick:a,style:l.touchTarget,"data-testid":"container-detail-collapse","aria-label":"Collapse Panel"})]}),e.jsxs(_e,{wrap:!0,style:{marginTop:8},children:[e.jsx(De,{color:"running"===t.state?"success":"default",icon:"running"===t.state?e.jsx(we,{}):e.jsx(je,{}),"data-testid":"container-detail-state-tag",children:t.state}),e.jsxs(De,{color:"blue",icon:e.jsx(_t,{}),"data-testid":"container-detail-repo-tag",children:["Repository: ",t.repository]})]})]}),e.jsx("div",{style:{padding:"24px"},"data-testid":"container-detail-content",children:t&&e.jsxs(e.Fragment,{children:[e.jsx(st,{size:"small",style:{...l.card,marginBottom:16},"data-testid":"container-detail-basic-info",children:e.jsx(it,{gutter:[16,16],style:l.marginBottom.lg,children:e.jsx(rt,{span:24,children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.containerID"),":"]}),e.jsx("br",{}),e.jsx(oa,{copyable:!0,style:{fontFamily:"monospace",fontSize:12},"data-testid":"container-detail-id",children:t.id})]}),e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.image"),":"]}),e.jsx("br",{}),e.jsx(oa,{style:{fontSize:12,wordBreak:"break-all"},"data-testid":"container-detail-image",children:t.image})]}),e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.status"),":"]}),e.jsx("br",{}),e.jsx(oa,{style:{fontSize:12},"data-testid":"container-detail-status",children:t.status})]}),e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.created"),":"]}),e.jsx("br",{}),e.jsx(oa,{style:{fontSize:12},"data-testid":"container-detail-created",children:t.created})]})]})})})}),e.jsx(tt,{style:{margin:"24px 0"},children:e.jsxs(_e,{children:[e.jsx(pt,{}),n("resources:containers.resourceUsage")]})}),e.jsxs(it,{gutter:[16,16],style:l.marginBottom.lg,children:[e.jsx(rt,{xs:24,sm:12,children:e.jsxs(st,{size:"small","data-testid":"container-detail-cpu-card",children:[e.jsx(nt,{title:n("resources:containers.cpuUsage"),value:c?.cpu||0,suffix:"%",valueStyle:{color:c?.cpu&&c.cpu>80?"#ff4d4f":void 0}}),e.jsx(Ee,{percent:c?.cpu||0,showInfo:!1,status:c?.cpu&&c.cpu>80?"exception":"normal"})]})}),e.jsx(rt,{xs:24,sm:12,children:e.jsxs(st,{size:"small","data-testid":"container-detail-memory-card",children:[e.jsx(nt,{title:n("resources:containers.memoryUsage"),value:`${c?.memoryUsed} / ${c?.memoryTotal}`,valueStyle:{fontSize:16}}),e.jsx(Ee,{percent:c?.memoryPercent||0,status:c?.memoryPercent&&c.memoryPercent>90?"exception":"normal"})]})}),e.jsx(rt,{xs:24,sm:12,children:e.jsx(st,{size:"small","data-testid":"container-detail-network-card",children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:e.jsxs(oa,{type:"secondary",children:[n("resources:containers.networkIO"),":"]})}),e.jsx("div",{children:e.jsxs(oa,{style:{fontSize:12},children:[e.jsx(A,{style:{marginRight:4}}),"↓ ",c?.netIn," / ↑ ",c?.netOut]})})]})})}),e.jsx(rt,{xs:24,sm:12,children:e.jsx(st,{size:"small","data-testid":"container-detail-block-io-card",children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:e.jsxs(oa,{type:"secondary",children:[n("resources:containers.blockIO"),":"]})}),e.jsx("div",{children:e.jsxs(oa,{style:{fontSize:12},children:[e.jsx(C,{style:{marginRight:4}}),"R: ",c?.blockRead," / W: ",c?.blockWrite]})})]})})})]}),e.jsx(tt,{style:{margin:"24px 0"},children:e.jsxs(_e,{children:[e.jsx(ze,{}),n("resources:containers.configuration")]})}),e.jsx(st,{size:"small",style:{...l.card,marginBottom:16},"data-testid":"container-detail-configuration",children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.command"),":"]}),e.jsx("br",{}),e.jsx(oa,{code:!0,style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-command",children:t.command})]}),(t.port_mappings&&t.port_mappings.length>0||t.ports)&&e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.ports"),":"]}),e.jsx("br",{}),t.port_mappings&&t.port_mappings.length>0?e.jsx(_e,{direction:"vertical",size:"small",style:{marginTop:4},children:t.port_mappings.map((t,s)=>e.jsx(De,{color:"blue","data-testid":`container-detail-port-${s}`,children:t.host_port?`${t.host||"0.0.0.0"}:${t.host_port} → ${t.container_port}/${t.protocol}`:`${t.container_port}/${t.protocol}`},s))}):t.ports?e.jsx(oa,{style:{fontSize:12},"data-testid":"container-detail-ports-text",children:t.ports}):null]}),e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.networks"),":"]}),e.jsx("br",{}),e.jsx(De,{color:"purple","data-testid":"container-detail-network-tag",children:t.networks})]}),e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.size"),":"]}),e.jsx("br",{}),e.jsx(oa,{style:{fontSize:12},"data-testid":"container-detail-size",children:t.size})]}),e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.processes"),":"]}),e.jsx("br",{}),e.jsxs(De,{"data-testid":"container-detail-pids",children:[c?.pids||0," ",n("resources:containers.pids")]})]})]})}),e.jsx(tt,{style:{margin:"24px 0"},children:e.jsxs(_e,{children:[e.jsx(_t,{}),n("resources:containers.environment")]})}),e.jsx(st,{size:"small",style:l.card,"data-testid":"container-detail-environment",children:e.jsxs(_e,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.mounts"),":"]}),e.jsx("br",{}),e.jsx(oa,{style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-mounts",children:t.mounts})]}),t.labels&&e.jsxs("div",{children:[e.jsxs(oa,{type:"secondary",children:[n("resources:containers.labels"),":"]}),e.jsx("br",{}),e.jsx(oa,{style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-labels",children:t.labels})]})]})})]})})]})}):null},da=({type:t,data:s,visible:a,onClose:r,splitWidth:n,onSplitWidthChange:o,isCollapsed:l=!1,onToggleCollapse:c,collapsedWidth:d=50})=>{const{theme:m}=u(),p=b(),h=i.useRef(!1),y=i.useRef(0),x=i.useRef(0),[f,g]=i.useState(1),[j,v]=i.useState(s),[N,w]=i.useState(!1),[k,C]=i.useState(s);s!==k&&(v(s),C(s));if(i.useEffect(()=>{const e=e=>{if(!h.current)return;const t=y.current-e.clientX,s=window.innerWidth,a=Math.min(800,s-400),i=Math.max(300,Math.min(a,x.current+t));o(i)},t=()=>{h.current&&(h.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[n,o]),!a||!j)return null;const S=t||(j&&"machineName"in j?"machine":j&&"repositoryName"in j?"repository":"container"),T=l?d:n;return e.jsxs("div",{style:{position:"relative",width:T,height:"100%",borderLeft:"1px solid "+("dark"===m?"#303030":"#f0f0f0"),display:"flex",flexShrink:0,opacity:f,transition:"width 0.3s ease-in-out, opacity 0.3s ease"},"data-testid":"unified-detail-panel",children:[!l&&e.jsx("div",{style:{position:"absolute",left:-3,top:0,bottom:0,width:6,cursor:"ew-resize",zIndex:10,backgroundColor:"transparent"},onMouseDown:e=>{h.current=!0,y.current=e.clientX,x.current=n,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",e.preventDefault()},"data-testid":"unified-detail-resize-handle",children:e.jsx("div",{style:{position:"absolute",left:2,top:0,bottom:0,width:2,backgroundColor:"dark"===m?"#303030":"#f0f0f0",transition:"background-color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="dark"===m?"#303030":"#f0f0f0"}})}),l?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:"100%",padding:"16px 0",gap:16},"data-testid":"unified-detail-collapsed",children:[e.jsx(Fe,{title:"Expand Panel",placement:"left",children:e.jsx(Re,{type:"text",icon:e.jsx(xs,{}),onClick:c,style:{...p.touchTarget,display:"flex",alignItems:"center",justifyContent:"center"},"data-testid":"unified-detail-expand-button","aria-label":"Expand Panel"})}),(()=>{switch(S){case"machine":return e.jsx(V,{style:{fontSize:20,color:"#556b2f"}});case"repository":return e.jsx(oe,{style:{fontSize:20,color:"#8FBC8F"}});case"container":return e.jsx(Ot,{style:{fontSize:20,color:"#1890ff"}})}})()]}):e.jsx("div",{style:{flex:1,overflow:"hidden"},"data-testid":"unified-detail-content",children:"machine"===S?e.jsx(sa,{machine:j,visible:a,onClose:c||r,splitView:!0}):"repository"===S?e.jsx(na,{repository:j,visible:a,onClose:c||r,splitView:!0}):e.jsx(ca,{container:j,visible:a,onClose:c||r,splitView:!0})})]})},ma=t=>{const{type:s,selectedResource:a,onResourceSelect:r,onMachineRepositoryClick:n,onMachineContainerClick:o,isPanelCollapsed:l=!0,onTogglePanelCollapse:c}=t,d=()=>{const e=window.innerWidth,t=Math.floor(.25*e);return Math.max(300,Math.min(600,t))},[m,u]=i.useState(d);i.useEffect(()=>{const e=()=>{u(d())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const p=e=>{r(e)},h=()=>{r(null)},y=l?50:m;return"machine"===s?e.jsxs("div",{style:{display:"flex",height:"100%",width:"100%",position:"relative",overflow:"hidden"},"data-testid":"split-resource-view-container",children:[e.jsx("div",{style:{width:a?`calc(100% - ${y}px)`:"100%",height:"100%",overflow:"auto",minWidth:300,transition:"width 0.3s ease-in-out"},"data-testid":"split-resource-view-left-panel",children:e.jsx(aa,{...t,onRowClick:p,selectedMachine:a,onMachineRepositoryClick:n,onMachineContainerClick:o})}),a&&e.jsx(da,{type:"machineName"in a?"machine":"repositoryName"in a?"repository":"container",data:a,visible:!0,onClose:h,splitWidth:m,onSplitWidthChange:u,isCollapsed:l,onToggleCollapse:c,collapsedWidth:50})]}):null},{Title:ua}=Me,pa=()=>{const{t:s}=Ie(["resources","machines","common"]),a=n(),o=t(e=>e.ui.uiMode),l=b(),[c,d]=i.useState([]),[u,p]=i.useState("machines"),[h,y]=i.useState(null),[x,f]=i.useState(null),[g,N]=i.useState(null),[w,k]=i.useState(!0),[C,T]=i.useState({open:!1,resourceType:"machine",mode:"create"}),z=()=>{switch(u){case"machines":return s("machines.createMachine");case"repositories":return s("repositories.createRepository");case"storage":return s("storage.createStorage");default:return s("general.create")}},[I,D]=i.useState(null),[B,W]=i.useState([]),[q,de]=i.useState({}),me=e=>{y(e),e&&(f(null),N(null))},ue=K(),he=Q(),ye=J(),xe=X(),fe=Y(),ge=async(e,t)=>{const a=t[`${e}Name`],i={machine:xe,repository:Le,storage:Je},r=t=>{if("machine"===e)return`machines:${t}`;return`resources:${"repository"===e?"repositories":`${e}s`}.${t}`};$e.confirm({title:s(r("machine"===e?"confirmDelete":`delete${e.charAt(0).toUpperCase()+e.slice(1)}`)),content:s(r("machine"===e?"deleteWarning":"confirmDelete"),{name:a,[`${e}Name`]:a}),okText:s("common:actions.delete"),okType:"danger",cancelText:s("common:actions.cancel"),onOk:async()=>{try{const n=i[e];"machine"===e?(await n.mutateAsync({teamName:t.teamName,machineName:a}),Se()):"repository"===e?(await n.mutateAsync({teamName:t.teamName,repositoryName:a}),Ee()):"storage"===e&&(await n.mutateAsync({teamName:t.teamName,storageName:a}),qe()),v("success",s(r("deleteSuccess")))}catch(n){v("error",s(r("deleteError")))}}})},{data:je}=Te(),{data:be,isLoading:Ne}=O(),we=be||[],{data:Ce=[],refetch:Se}=H(c.length>0&&("machines"===u||"repositories"===u)?c:void 0,"machines"===u||"repositories"===u),{data:ze=[],isLoading:Me,refetch:Ee}=U(c.length>0?c:void 0),Be=r.useMemo(()=>ze.filter(e=>!e.grandGuid||e.grandGuid===e.repositoryGuid),[ze]),Pe=Z(),Oe=ee(),Le=te(),Ge=se(),{data:We=[],isLoading:He,refetch:qe}=G(c.length>0&&"storage"===u?c:void 0),Ke=L(),Qe=ae(),Je=ie(),Xe=re(),Ye=ce(),{buildQueueVault:Ze}=P(),[et,tt]=i.useState({visible:!1,taskId:null,machineName:null}),[at,it]=i.useState(!1),[rt,nt]=i.useState({open:!1,entityType:null,entityIdentifier:null}),[ot,lt]=i.useState(!1),[mt,ut]=i.useState(15),[pt,ht]=i.useState(1),[yt,xt]=i.useState(15),[ft,gt]=i.useState(1),jt=i.useRef(!1);r.useEffect(()=>{if(!Ne&&!jt.current&&we&&we.length>0)if(jt.current=!0,"simple"===o){const e=we.find(e=>"Private Team"===e.teamName);d(e?["Private Team"]:[we[0].teamName])}else d([we[0].teamName])},[o,we,Ne]),r.useEffect(()=>{if(a.state&&a.state.createRepository){const e=a.state;p("repositories"),e.selectedTeam&&d([e.selectedTeam]),setTimeout(()=>{vt("repository","create",{teamName:e.selectedTeam,machineName:e.selectedMachine,preselectedTemplate:e.selectedTemplate})},100),window.history.replaceState({},document.title)}},[a]);const vt=(e,t,s,a)=>{T({open:!0,resourceType:e,mode:t,data:s,creationContext:a})},bt=()=>{T({open:!1,resourceType:"machine",mode:"create"}),D(null)},Nt=async(e,t)=>{if(I)try{let a,i;if("machine"===e)a=I.machineName,i=I.bridgeName;else{if(!t.selectedMachine)return;const e=je?.machinesByTeam?.find(e=>e.teamName===I.teamName),r=e?.machines?.find(e=>e.value===t.selectedMachine);if(!r)return void v("error",s("resources:errors.machineNotFound"));a=r.value,i=r.bridgeName}const r=we.find(e=>e.teamName===I.teamName),n={teamName:I.teamName,machineName:a,bridgeName:i,functionName:t.function.name,params:t.params,priority:t.priority,description:t.description,addedVia:`${e}-table`,teamVault:r?.vaultContent||"{}"};if("machine"===e)if(n.machineVault=I.vaultContent||"{}",t.params.repo){const e=ze.find(e=>e.repositoryGuid===t.params.repo);n.repositoryGuid=e?.repositoryGuid||t.params.repo,n.repositoryVault=e?.vaultContent||"{}"}else n.repositoryVault="{}";else if("repository"===e){n.repositoryGuid=I.repositoryGuid,n.repositoryVault=I.vaultContent||"{}";const e=Ce.find(e=>e.machineName===a&&e.teamName===I.teamName);n.machineVault=e?.vaultContent||"{}"}else if("storage"===e){n.storageName=I.storageName,n.storageVault=I.vaultContent||"{}";const e=Ce.find(e=>e.machineName===a&&e.teamName===I.teamName);n.machineVault=e?.vaultContent||"{}"}if("pull"===t.function.name){if("machine"===t.params.sourceType&&t.params.from){const e=Ce.find(e=>e.machineName===t.params.from);e&&e.vaultContent&&(n.sourceMachineVault=e.vaultContent)}if("storage"===t.params.sourceType&&t.params.from){const e=We.find(e=>e.storageName===t.params.from);e&&e.vaultContent&&(n.sourceStorageVault=e.vaultContent)}}if("push"===t.function.name){if("machine"===t.params.destinationType&&t.params.to){const e=Ce.find(e=>e.machineName===t.params.to);e&&e.vaultContent&&(n.destinationMachineVault=e.vaultContent)}if("storage"===t.params.destinationType&&t.params.to){const e=We.find(e=>e.storageName===t.params.to);e&&e.vaultContent&&(n.destinationStorageVault=e.vaultContent)}}const o=await Ze(n),l=await Ye.mutateAsync({teamName:I.teamName,machineName:a,bridgeName:i,queueVault:o,priority:t.priority});bt(),l?.taskId?(v("success",s(`${e}s:queueItemCreated`)),tt({visible:!0,taskId:l.taskId,machineName:a})):l?.isQueued&&v("info",s("resources:messages.highestPriorityQueued",{resourceType:e}))}catch(a){}},wt=[{title:s("repositories.repositoryName"),dataIndex:"repositoryName",key:"repositoryName",ellipsis:!0,render:t=>e.jsxs(_e,{children:[e.jsx(oe,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:s("general.team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx(De,{color:"#8FBC8F",children:t})},..._.isEnabled("vaultVersionColumns")?[{title:s("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:t=>e.jsx(De,{children:s("common:general.versionFormat",{version:t})})}]:[],{title:s("common:table.actions"),key:"actions",width:250,render:(t,a)=>e.jsxs(_e,{children:[e.jsx(Fe,{title:s("common:actions.edit"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(E,{}),style:l.touchTargetSmall,"data-testid":`resources-repository-edit-${a.repositoryName}`,onClick:()=>{D(a),vt("repository","edit",a)},"aria-label":s("common:actions.edit")})}),e.jsx(Fe,{title:s("machines:trace"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(S,{}),style:l.touchTargetSmall,"data-testid":`resources-repository-trace-${a.repositoryName}`,onClick:()=>{nt({open:!0,entityType:"Repo",entityIdentifier:a.repositoryName,entityName:a.repositoryName})},"aria-label":s("machines:trace")})}),e.jsx(Fe,{title:s("common:actions.delete"),children:e.jsx(Re,{type:"primary",danger:!0,size:"small",icon:e.jsx(M,{}),style:l.touchTargetSmall,"data-testid":`resources-repository-delete-${a.repositoryName}`,onClick:()=>ge("repository",a),"aria-label":s("common:actions.delete")})})]})}],kt=[{title:s("storage.storageName"),dataIndex:"storageName",key:"storageName",ellipsis:!0,render:t=>e.jsxs(_e,{children:[e.jsx(R,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:s("general.team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx(De,{color:"#8FBC8F",children:t})},..._.isEnabled("vaultVersionColumns")?[{title:s("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:t=>e.jsx(De,{children:s("common:general.versionFormat",{version:t})})}]:[],{title:s("common:table.actions"),key:"actions",width:350,render:(t,a)=>e.jsxs(_e,{children:[e.jsx(Fe,{title:s("common:actions.edit"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(E,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-edit-${a.storageName}`,onClick:()=>{D(a),vt("storage","edit",a)},"aria-label":s("common:actions.edit")})}),e.jsx(Fe,{title:"Run",children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(pe,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-run-${a.storageName}`,onClick:()=>{D(a),T({open:!0,resourceType:"storage",mode:"create",data:a})},"aria-label":"Run"})}),e.jsx(Fe,{title:s("machines:trace"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(S,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-trace-${a.storageName}`,onClick:()=>{nt({open:!0,entityType:"Storage",entityIdentifier:a.storageName,entityName:a.storageName})},"aria-label":s("machines:trace")})}),e.jsx(Fe,{title:s("common:actions.delete"),children:e.jsx(Re,{type:"primary",danger:!0,size:"small",icon:e.jsx(M,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-delete-${a.storageName}`,onClick:()=>{$e.confirm({title:s("storage.deleteStorage"),content:s("storage.confirmDelete",{storageName:a.storageName}),okText:s("general.yes"),okType:"danger",cancelText:s("general.no"),onOk:()=>ge("storage",a)})},"aria-label":s("common:actions.delete")})})]})}],Ct=ue.isPending||he.isPending||ye.isPending||Pe.isPending||Oe.isPending||Ke.isPending||Qe.isPending||Ye.isPending,St=fe.isPending||Ge.isPending||Xe.isPending,Tt=[{key:"machines",label:e.jsx(Fe,{title:s("resourceTabs.machines"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-machines",children:e.jsx(V,{style:{fontSize:j.DIMENSIONS.ICON_MD}})})}),children:e.jsx(ma,{type:"machine",teamFilter:c.length>0?c:void 0,showFilters:!0,showActions:!0,onCreateMachine:()=>vt("machine","create"),onEditMachine:e=>{D(e),vt("machine","edit",e)},onVaultMachine:e=>{D(e),vt("machine","vault",e)},onFunctionsMachine:(e,t)=>{D(e),T({open:!0,resourceType:"machine",mode:"create",data:e,preselectedFunction:t}),de(t=>({...t,[e.machineName]:Date.now()}))},onDeleteMachine:e=>ge("machine",e),onRefreshMachines:Se,onCreateRepository:(e,t)=>{let s;e.teamName!==c[0]&&d([e.teamName]),t&&(s=JSON.stringify({credential:""})),vt("repository","create",{machineName:e.machineName,teamName:e.teamName,prefilledMachine:!0,repositoryGuid:t,vaultContent:s},t?"credentials-only":"normal")},enabled:"machines"===u,className:"full-height-machine-table",expandedRowKeys:B,onExpandedRowsChange:W,refreshKeys:q,onQueueItemCreated:(e,t)=>{tt({visible:!0,taskId:e,machineName:t})},selectedResource:h||x||g,onResourceSelect:e=>{e&&"machineName"in e?me(e):e&&"repositoryName"in e?(me(null),f(e),N(null)):e&&"id"in e&&"state"in e?(me(null),f(null),N(e)):(me(null),f(null),N(null))},onMachineRepositoryClick:(e,t)=>{const s={repositoryName:t.name,repositoryGuid:t.originalGuid||t.name,teamName:e.teamName,vaultVersion:0,vaultContent:void 0,grandGuid:void 0},a=ze.find(e=>e.repositoryName===t.name||e.repositoryGuid===t.originalGuid||e.repositoryGuid===t.name);a?(f(a),y(null),N(null)):(f(s),y(null),N(null))},onMachineContainerClick:(e,t)=>{y(null),f(null),N(t)},isPanelCollapsed:w,onTogglePanelCollapse:()=>{k(!w)}})},{key:"repositories",label:e.jsx(Fe,{title:s("resourceTabs.repositories"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-repositories",children:e.jsx(oe,{style:{fontSize:j.DIMENSIONS.ICON_MD}})})}),children:e.jsx(e.Fragment,{children:Me?e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(Ae,{size:"large"}),e.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:s("common:general.loading")})]}):0===Be.length?e.jsx(Ue,{description:s("repositories.noRepositories"),style:{margin:"auto"}}):e.jsx(Ve,{"data-testid":"resources-repository-table",columns:wt,dataSource:Be,rowKey:"repositoryName",scroll:{x:"max-content"},pagination:{current:pt,pageSize:mt,total:Be?.length||0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,t)=>`${s("common:general.showingRecords",{start:t[0],end:t[1],total:e})}`,onChange:(e,t)=>{ht(e),t!==mt&&(ut(t),ht(1))},position:["bottomRight"]}})})},{key:"storage",label:e.jsx(Fe,{title:s("resourceTabs.storage"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-storage",children:e.jsx(R,{style:{fontSize:j.DIMENSIONS.ICON_MD}})})}),children:e.jsx(e.Fragment,{children:He?e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(Ae,{size:"large"}),e.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:s("common:general.loading")})]}):0===We.length?e.jsx(Ue,{description:s("storage.noStorage"),style:{margin:"auto"}}):e.jsx(Ve,{"data-testid":"resources-storage-table",columns:kt,dataSource:We,rowKey:"storageName",scroll:{x:"max-content"},pagination:{current:ft,pageSize:yt,total:We?.length||0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,t)=>`${s("common:general.showingRecords",{start:t[0],end:t[1],total:e})}`,onChange:(e,t)=>{gt(e),t!==yt&&(xt(t),gt(1))},position:["bottomRight"]}})})}],zt=e=>{if("ArrowLeft"===e.key||"ArrowRight"===e.key){e.preventDefault();const t=["machines","repositories","storage"],s=t.indexOf(u);if("ArrowLeft"===e.key){const e=s>0?s-1:t.length-1;p(t[e])}else{const e=s<t.length-1?s+1:0;p(t[e])}}};return e.jsxs(e.Fragment,{children:["simple"!==o?e.jsx("div",{style:{padding:24},children:e.jsxs(st,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:"1 1 auto",minWidth:0},children:[e.jsx(ua,{level:4,style:{...l.heading4,margin:0,flexShrink:0},children:s("teams.teamResources")}),e.jsx(ve,{"data-testid":"resources-team-selector",teams:we,selectedTeams:c,onChange:d,loading:Ne,placeholder:s("teams.selectTeamToView"),style:{minWidth:250,maxWidth:400,width:"100%"}})]}),c.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,flexShrink:0},children:[e.jsx(Fe,{title:z(),children:e.jsx(Re,{type:"primary",icon:e.jsx($,{}),style:{...l.buttonPrimary,...l.touchTarget,background:"#556b2f",borderColor:"#556b2f"},"data-testid":`resources-create-${u.slice(0,-1)}-button`,onClick:()=>{switch(u){case"machines":vt("machine","create");break;case"repositories":vt("repository","create",void 0,"credentials-only");break;case"storage":vt("storage","create")}},"aria-label":z()})}),"storage"===u&&e.jsx(Fe,{title:s("resources:storage.import.button"),children:e.jsx(Re,{icon:e.jsx(le,{}),style:l.touchTarget,"data-testid":"resources-import-button",onClick:()=>lt(!0),"aria-label":s("resources:storage.import.button")})}),"machines"===u&&e.jsx(Fe,{title:s("machines:connectivityTest"),children:e.jsx(Re,{icon:e.jsx(A,{}),style:l.touchTarget,"data-testid":"resources-connectivity-test-button",onClick:()=>it(!0),disabled:0===Ce.length,"aria-label":s("machines:connectivityTest")})}),e.jsx(Fe,{title:s("common:actions.refresh"),children:e.jsx(Re,{icon:e.jsx(F,{}),style:l.touchTarget,"data-testid":"resources-refresh-button",onClick:()=>{switch(u){case"machines":Se(),de(e=>({...e,_global:Date.now()}));break;case"repositories":Ee();break;case"storage":qe()}},"aria-label":s("common:actions.refresh")})})]})]})}),0===c.length?e.jsx(Ue,{image:Ue.PRESENTED_IMAGE_SIMPLE,description:s("teams.selectTeamPrompt"),style:{padding:"40px 0"}}):e.jsx(ct,{activeKey:u,onChange:p,items:Tt,style:{flex:1,display:"flex",flexDirection:"column"},className:"full-height-tabs",onKeyDown:zt,tabIndex:0})]})}):e.jsx("div",{style:{padding:24},children:e.jsxs(st,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsx("div",{children:e.jsx(ua,{level:4,style:{...l.heading4,margin:0},children:s("teams.teamResources")})}),e.jsxs(_e,{children:[e.jsx(Fe,{title:z(),children:e.jsx(Re,{type:"primary",icon:e.jsx($,{}),style:{...l.buttonPrimary,...l.touchTarget,background:"#556b2f",borderColor:"#556b2f"},"data-testid":`resources-create-${u.slice(0,-1)}-button`,onClick:()=>{switch(u){case"machines":vt("machine","create");break;case"repositories":vt("repository","create",void 0,"credentials-only");break;case"storage":vt("storage","create")}},"aria-label":z()})}),"storage"===u&&e.jsx(Fe,{title:s("resources:storage.import.button"),children:e.jsx(Re,{icon:e.jsx(le,{}),style:l.touchTarget,"data-testid":"resources-import-button",onClick:()=>lt(!0),"aria-label":s("resources:storage.import.button")})}),"machines"===u&&e.jsx(Fe,{title:s("machines:connectivityTest"),children:e.jsx(Re,{icon:e.jsx(A,{}),style:l.touchTarget,"data-testid":"resources-connectivity-test-button",onClick:()=>it(!0),disabled:0===Ce.length,"aria-label":s("machines:connectivityTest")})}),e.jsx(Fe,{title:s("common:actions.refresh"),children:e.jsx(Re,{icon:e.jsx(F,{}),style:l.touchTarget,"data-testid":"resources-refresh-button",onClick:()=>{switch(u){case"machines":Se(),de(e=>({...e,_global:Date.now()}));break;case"repositories":Ee();break;case"storage":qe()}},"aria-label":s("common:actions.refresh")})})]})]}),e.jsx(ct,{activeKey:u,onChange:p,items:Tt,style:{flex:1,display:"flex",flexDirection:"column"},className:"full-height-tabs",onKeyDown:zt,tabIndex:0})]})}),e.jsx(ne,{"data-testid":`resources-${C.resourceType}-modal`,open:C.open,onCancel:bt,resourceType:C.resourceType,mode:C.mode,existingData:C.data||I,teamFilter:c.length>0?c:void 0,creationContext:C.creationContext,onSubmit:async e=>{try{const{resourceType:a,mode:i}=C,r={machine:{create:ue,updateName:he,updateVault:fe},repository:{create:Pe,updateName:Oe,updateVault:Ge},storage:{create:Ke,updateName:Qe,updateVault:Xe}};if("create"===i)if("repository"===a){const a=e.repositoryGuid&&""!==e.repositoryGuid.trim();if(e.machineName&&e.size&&!a){const{machineName:a,size:i,...n}=e;await r.repository.create.mutateAsync(n);try{const t=je?.machinesByTeam?.find(t=>t.teamName===e.teamName),r=t?.machines?.find(e=>e.value===a);if(!r)return v("error",s("resources:errors.machineNotFound")),void bt();const n=we.find(t=>t.teamName===e.teamName),o=Ce.find(t=>t.machineName===a&&t.teamName===e.teamName);await new Promise(e=>setTimeout(e,500));const l=await m.get("/GetTeamRepositories",{teamName:e.teamName}),c=l.resultSets[1]?.data?.find(t=>t.repoName===e.repositoryName),d=c?.vaultContent||e.repositoryVault||"{}",u=c?.repoGuid||"";if(!u)return v("error",s("resources:errors.failedToGetRepositoryGuid")),void bt();const p={repo:u,size:i};e.tmpl&&(p.tmpl=e.tmpl),e.keep_open&&(p.keep_open="true");const h=await Ze({teamName:e.teamName,machineName:r.value,bridgeName:r.bridgeName,functionName:"new",params:p,priority:3,description:`Create repository ${e.repositoryName} with size ${i}`,addedVia:"repository-creation",teamVault:n?.vaultContent||"{}",machineVault:o?.vaultContent||"{}",repositoryVault:d,repositoryGuid:u}),y=await Ye.mutateAsync({teamName:e.teamName,machineName:r.value,bridgeName:r.bridgeName,queueVault:h,priority:3});v("success",s("repositories.createSuccess")),y?.taskId?tt({visible:!0,taskId:y.taskId,machineName:r.value}):y?.isQueued&&v("info",s("resources:messages.repositoryCreationQueued"))}catch(t){v("warning",s("repositories.repoCreatedButQueueFailed"))}}else await r.repository.create.mutateAsync(e),v("success",s("repositories.createSuccess")),bt(),Se()}else if("machine"===a){const{autoSetup:a,...i}=e;if(await r.machine.create.mutateAsync(i),v("success",s("machines:createSuccess")),a)try{const t=we.find(t=>t.teamName===e.teamName);await new Promise(e=>setTimeout(e,500));const a=await Ze({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,functionName:"setup",params:{datastore_size:"95%",source:"apt-repo",rclone_source:"install-script",docker_source:"docker-repo",install_amd_driver:"auto",install_nvidia_driver:"auto"},priority:3,description:`Auto-setup for machine ${e.machineName}`,addedVia:"machine-creation-auto-setup",teamVault:t?.vaultContent||"{}",machineVault:e.machineVault||"{}"}),i=await Ye.mutateAsync({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,queueVault:a,priority:3});i?.taskId?(v("info",s("machines:setupQueued")),tt({visible:!0,taskId:i.taskId,machineName:e.machineName})):i?.isQueued&&v("info",s("machines:setupQueuedForSubmission"))}catch(t){v("warning",s("machines:machineCreatedButSetupFailed"))}bt(),Se()}else await r[a].create.mutateAsync(e),v("success",s(`${(()=>{switch(u){case"machines":return"machines";case"repositories":return"repositories";case"storage":return"storage";default:return u}})()}.createSuccess`)),bt();else{const t=`${a}Name`,s=I[t],i=e[t];if(i!==s){const e=r[a].updateName;"machine"===a?await e.mutateAsync({teamName:I.teamName,currentMachineName:s,newMachineName:i}):"repository"===a?await e.mutateAsync({teamName:I.teamName,currentRepositoryName:s,newRepositoryName:i}):"storage"===a&&await e.mutateAsync({teamName:I.teamName,currentStorageName:s,newStorageName:i})}const n=e[`${a}Vault`];if(n&&n!==I.vaultContent){const e=r[a].updateVault;"machine"===a?await e.mutateAsync({teamName:I.teamName,machineName:i||s,machineVault:n,vaultVersion:I.vaultVersion+1}):"repository"===a?await e.mutateAsync({teamName:I.teamName,repositoryName:i||s,repositoryVault:n,vaultVersion:I.vaultVersion+1}):"storage"===a&&await e.mutateAsync({teamName:I.teamName,storageName:i||s,storageVault:n,vaultVersion:I.vaultVersion+1})}"machine"===a&&e.bridgeName!==I.bridgeName&&await ye.mutateAsync({teamName:I.teamName,machineName:i||s,newBridgeName:e.bridgeName})}bt()}catch(t){}},onUpdateVault:"edit"===C.mode?async(e,t)=>{if(I)try{const{resourceType:s}=C,a={machine:fe,repository:Ge,storage:Xe}[s];"machine"===s?await a.mutateAsync({teamName:I.teamName,machineName:I.machineName,machineVault:e,vaultVersion:t}):"repository"===s?await a.mutateAsync({teamName:I.teamName,repositoryName:I.repositoryName,repositoryVault:e,vaultVersion:t}):"storage"===s&&await a.mutateAsync({teamName:I.teamName,storageName:I.storageName,storageVault:e,vaultVersion:t})}catch(s){}}:void 0,onFunctionSubmit:!C.data||"machine"!==C.resourceType&&"repository"!==C.resourceType&&"storage"!==C.resourceType?void 0:"machine"===C.resourceType?e=>Nt("machine",e):"repository"===C.resourceType?e=>Nt("repository",e):e=>Nt("storage",e),isSubmitting:Ct,isUpdatingVault:St,functionCategories:"machine"===C.resourceType?["machine","backup"]:"repository"===C.resourceType?["repository","backup","network"]:"storage"===C.resourceType?["backup"]:[],hiddenParams:"repository"===C.resourceType?["repo","grand"]:"storage"===C.resourceType?["storage"]:[],defaultParams:"repository"===C.resourceType&&I?{repo:I.repositoryGuid,grand:I.grandGuid||""}:"storage"===C.resourceType&&I?{storage:I.storageName}:{},preselectedFunction:C.preselectedFunction}),e.jsx(ke,{"data-testid":"resources-queue-trace-modal",taskId:et.taskId,visible:et.visible,onClose:()=>{if(tt({visible:!1,taskId:null,machineName:null}),et.machineName){const e=et.machineName;de(t=>({...t,[e]:Date.now()}))}else de(e=>{const t={...e};return B.forEach(e=>{t[e]=Date.now()}),t});Se()}}),e.jsx(Gs,{"data-testid":"resources-connectivity-test-modal",open:at,onClose:()=>it(!1),machines:Ce,teamFilter:c}),e.jsx(dt,{"data-testid":"resources-audit-trace-modal",open:rt.open,onCancel:()=>nt({open:!1,entityType:null,entityIdentifier:null}),entityType:rt.entityType,entityIdentifier:rt.entityIdentifier,entityName:rt.entityName}),e.jsx(Ks,{"data-testid":"resources-rclone-import-wizard",open:ot,onClose:()=>lt(!1),teamName:c[0]||"",onImportComplete:()=>{qe(),v("success",s("resources:storage.import.successMessage"))}})]})};export{pa as default};

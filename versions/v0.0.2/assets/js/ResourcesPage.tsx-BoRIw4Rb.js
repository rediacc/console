import{j as e,u as t}from"./chunk-DXw4Pgvm.js";import{f as s,g as a,r as i,R as r,u as n}from"./chunk-DZuWtVpy.js";import{u as o,a as c,C as l,P as d}from"./chunk-CMzkycnz.js";import{u as m,a as u,W as h,b as p,c as y,U as x,d as g,e as f,f as j,D as v,g as b,h as N,i as w,j as k,k as C,l as S,m as T,n as I,o as z,p as _,q as M,r as D,s as $}from"./chunk-JCM2pSop.js";import{E as B}from"./chunk-Dnu9xUqP.js";import{S as V,D as R}from"./chunk-C3Tfp-nJ.js";import{C as E}from"./chunk-Dy481HSu.js";import{r as F,a as A,b as O,c as P,i as L,e as G,f as W,C as U,M as q,s as K,g as Q,j as H,D as J,k as X,u as Y,I as Z,l as ee,m as te,H as se,h as ae,n as ie,A as re,G as ne,W as oe}from"../index-B3FT8ctU.js";import{R as ce}from"./chunk-M50ozRiD.js";import{I as le}from"./chunk-JJUV5cNj.js";import{I as de}from"./chunk-CgAX8KOs.js";import{u as me,a as ue,M as he,b as pe,F as ye,L as xe,c as ge,A as fe,R as je,V as ve,P as be,T as Ne}from"./chunk-B0hcii1a.js";import{R as we,D as ke,P as Ce,Q as Se}from"./chunk-s3dYLYFu.js";import{C as Te}from"./chunk-DFbv_hOH.js";import{u as Ie}from"./chunk-CM3g5OHp.js";import{a as ze,T as _e,g as Me,M as De,P as $e,i as Be,w as Ve,B as Re,k as Ee,x as Fe,n as Ae,p as Oe,U as Pe,y as Le,z as Ge,S as We,E as Ue,G as qe,I as Ke,H as Qe,J as He,K as Je,c as Xe,N as Ye,O as Ze,Q as et,o as tt,h as st,q as at,s as it,u as rt,f as nt,D as ot,V as ct}from"./chunk-CSjZqX98.js";import{A as lt,S as dt}from"./chunk-CowBgAm-.js";import{A as mt,T as ut}from"./chunk-DhEUYI1K.js";import{C as ht}from"./chunk-CX8KJc1y.js";import{u as pt}from"./chunk-DDWBViKw.js";import{f as yt,g as xt,a as gt}from"./chunk-xSw6NTs2.js";import{D as ft,C as jt}from"./chunk-BRA5XoPQ.js";import{F as vt}from"./chunk-9L0NiR9u.js";import"./chunk-ClABev_d.js";import"./chunk-BgyVHrjw.js";import"./chunk-DpkGg2rz.js";import"./chunk-C5_Erus5.js";import"./chunk-CbzVZTuA.js";import"./forkTokenService.ts-B1LSi9mD.js";import"./chunk-Br54SeHt.js";import"./chunk-bI5TGTC5.js";var bt,Nt,wt,kt={exports:{}},Ct={},St={};function Tt(){if(bt)return St;bt=1,Object.defineProperty(St,"__esModule",{value:!0});return St.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder",theme:"outlined"},St}function It(){if(Nt)return Ct;Nt=1;var e=F().default,t=A().default;Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.default=void 0;var a=t(O()),i=e(s()),r=t(Tt()),n=t(P()),o=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},c=i.forwardRef(o);return Ct.default=c,Ct}function zt(){return wt||(wt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=It())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(kt,kt.exports)),kt.exports}const _t=a(zt());var Mt,Dt,$t,Bt={exports:{}},Vt={},Rt={};function Et(){if(Mt)return Rt;Mt=1,Object.defineProperty(Rt,"__esModule",{value:!0});return Rt.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},Rt}function Ft(){if(Dt)return Vt;Dt=1;var e=F().default,t=A().default;Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.default=void 0;var a=t(O()),i=e(s()),r=t(Et()),n=t(P()),o=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},c=i.forwardRef(o);return Vt.default=c,Vt}function At(){return $t||($t=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Ft())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Bt,Bt.exports)),Bt.exports}const Ot=a(At());var Pt,Lt,Gt,Wt={exports:{}},Ut={},qt={};function Kt(){if(Pt)return qt;Pt=1,Object.defineProperty(qt,"__esModule",{value:!0});return qt.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},qt}function Qt(){if(Lt)return Ut;Lt=1;var e=F().default,t=A().default;Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var a=t(O()),i=e(s()),r=t(Kt()),n=t(P()),o=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},c=i.forwardRef(o);return Ut.default=c,Ut}function Ht(){return Gt||(Gt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=Qt())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(Wt,Wt.exports)),Wt.exports}const Jt=a(Ht());var Xt,Yt,Zt,es={exports:{}},ts={},ss={};function as(){if(Xt)return ss;Xt=1,Object.defineProperty(ss,"__esModule",{value:!0});return ss.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm198.4-588.1a32 32 0 00-24.5.5L414.9 415 296.4 686c-3.6 8.2-3.6 17.5 0 25.7 3.4 7.8 9.7 13.9 17.7 17 3.8 1.5 7.7 2.2 11.7 2.2 4.4 0 8.7-.9 12.8-2.7l271-118.6 118.5-271a32.06 32.06 0 00-17.7-42.7zM576.8 534.4l26.2 26.2-42.4 42.4-26.2-26.2L380 644.4 447.5 490 422 464.4l42.4-42.4 25.5 25.5L644.4 380l-67.6 154.4zM464.4 422L422 464.4l25.5 25.6 86.9 86.8 26.2 26.2 42.4-42.4-26.2-26.2-86.8-86.9z"}}]},name:"compass",theme:"outlined"},ss}function is(){if(Yt)return ts;Yt=1;var e=F().default,t=A().default;Object.defineProperty(ts,"__esModule",{value:!0}),ts.default=void 0;var a=t(O()),i=e(s()),r=t(as()),n=t(P()),o=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},c=i.forwardRef(o);return ts.default=c,ts}function rs(){return Zt||(Zt=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=is())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(es,es.exports)),es.exports}const ns=a(rs());var os,cs,ls,ds={exports:{}},ms={},us={};function hs(){if(os)return us;os=1,Object.defineProperty(us,"__esModule",{value:!0});return us.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},us}function ps(){if(cs)return ms;cs=1;var e=F().default,t=A().default;Object.defineProperty(ms,"__esModule",{value:!0}),ms.default=void 0;var a=t(O()),i=e(s()),r=t(hs()),n=t(P()),o=function(e,t){return i.createElement(n.default,(0,a.default)({},e,{ref:t,icon:r.default}))},c=i.forwardRef(o);return ms.default=c,ms}function ys(){return ls||(ls=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s;const a=(s=ps())&&s.__esModule?s:{default:s};t.default=a,e.exports=a}(ds,ds.exports)),ds.exports}const xs=a(ys());async function gs(e,t=3e4){const s=Date.now();for(;Date.now()-s<t;){const t=await fs(e);if(t)return t;await new Promise(e=>setTimeout(e,1e3))}return vs("Operation timeout - no response received","TIMEOUT")}async function fs(e){try{const t=await L.get("/GetQueueItemTrace",{taskId:e}),s=t.resultSets?.[1]?.data?.[0];if(!s)return null;const a=s.status||s.Status;switch(a){case"COMPLETED":return function(e){const t=e.resultSets?.[3]?.data?.[0];if(!t?.vaultContent)return js("Hello function completed successfully","COMPLETED");try{const e=JSON.parse(t.vaultContent);return e.result&&"string"==typeof e.result&&e.result.includes("Error")?vs(e.result,"COMPLETED",e):js(e.result||"Hello function completed successfully","COMPLETED",e)}catch{return js("Hello function completed","COMPLETED")}}(t);case"FAILED":case"CANCELLED":return function(e,t){const s=e.lastFailureReason||e.LastFailureReason||"Operation failed";return vs(s,t)}(s,a);default:return null}}catch(t){return null}}function js(e,t,s){return{success:!0,message:e,status:t,responseData:s}}function vs(e,t,s){return{success:!1,message:e,status:t,responseData:s}}function bs(e){const{buildQueueVault:t}=m();me();const s=o(),{data:a}=u(),r=i.useCallback(async e=>{try{const i=function(e,t){if(e.teamVault&&"{}"!==e.teamVault)return e.teamVault;const s=t?.find(t=>t.teamName===e.teamName);return s?.vaultContent||"{}"}(e,a),r=await async function(e,t,s){const a=4,i="Ping connectivity test",r="ping-service",n="{}";return s({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,functionName:"ping",params:{},priority:e.priority||a,description:e.description||i,addedVia:e.addedVia||r,machineVault:e.machineVault||n,teamVault:t,repositoryVault:e.repositoryVault||n})}(e,i,t),n=await async function(e,t,s){const a=4;return s.mutateAsync({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,queueVault:t,priority:e.priority||a})}(e,r,s);return{taskId:n?.taskId,success:!!n?.taskId||!!n?.isQueued}}catch(i){return{success:!1,error:i.message||"Failed to execute ping function"}}},[t,s,a]),n=i.useCallback(async(e,t)=>r({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,priority:t?.priority,description:t?.description,addedVia:t?.addedVia,machineVault:e.vaultContent||"{}"}),[r]),c=i.useCallback(async(e,t)=>{const s=await r(e);if(!s.success||!s.taskId)return s;const a=await gs(s.taskId,t);return{...s,completionResult:a,success:a.success,error:a.success?void 0:a.message}},[r]),l=i.useCallback(async(e,t)=>c({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,priority:t?.priority,description:t?.description,addedVia:t?.addedVia,machineVault:e.vaultContent||"{}"},t?.timeout),[c]);return{executePing:r,executePingForMachine:n,executePingAndWait:c,executePingForMachineAndWait:l,waitForQueueItemCompletion:gs,isLoading:s.isPending}}const{Text:Ns}=_e,ws=({open:t,onClose:s,machines:a})=>{const{t:r}=Ie(["machines","common"]),{theme:n}=G(),[o,c]=i.useState([]),[l,d]=i.useState(!1),[m,u]=i.useState(0),[p,y]=i.useState(-1),{executePingForMachine:x,waitForQueueItemCompletion:g}=bs();i.useEffect(()=>{if(t&&a.length>0){const e=a.map(e=>({machineName:e.machineName,teamName:e.teamName,bridgeName:e.bridgeName,status:"pending"}));c(e),u(0),y(-1)}},[t,a]);const f=e=>e.success?r("machines:connectionSuccessful"):"TIMEOUT"===e.status?r("machines:testTimeout"):e.message||r("machines:connectionFailed"),j=async(e,t)=>{const s=Date.now();c(e=>e.map((e,s)=>s===t?{...e,status:"testing",timestamp:(new Date).toISOString()}:e));try{const a=await x(e,{priority:4,description:"Connectivity test",addedVia:"connectivity-test"});if(!a.success||!a.taskId)throw new Error(a.error||"Failed to create test task");{c(e=>e.map((e,s)=>s===t?{...e,taskId:a.taskId}:e));const e=await g(a.taskId),i=Date.now()-s;c(s=>s.map((s,a)=>a===t?{...s,status:e.success?"success":"failed",message:f(e),duration:i}:s))}}catch(a){const e=Date.now()-s;c(s=>s.map((s,i)=>i===t?{...s,status:"failed",message:a.message||"Failed to create test task",duration:e}:s))}},v=[{title:r("machines:machineName"),dataIndex:"machineName",key:"machineName",render:(t,s)=>e.jsxs(ze,{"data-testid":`connectivity-machine-${t}`,children:["testing"===s.status&&e.jsx(V,{spin:!0,style:{color:"#1890ff"},"data-testid":`connectivity-status-icon-testing-${t}`}),"success"===s.status&&e.jsx(W,{style:{color:"#52c41a"},"data-testid":`connectivity-status-icon-success-${t}`}),"failed"===s.status&&e.jsx(Te,{style:{color:"#ff4d4f"},"data-testid":`connectivity-status-icon-failed-${t}`}),"pending"===s.status&&e.jsx(U,{style:{color:"#8c8c8c"},"data-testid":`connectivity-status-icon-pending-${t}`}),e.jsx(Ns,{strong:!0,children:t})]})},{title:r("machines:team"),dataIndex:"teamName",key:"teamName",render:t=>e.jsx(Me,{color:"#8FBC8F",children:t})},{title:r("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",render:t=>e.jsx(Me,{color:"green",children:t})},{title:r("machines:status"),dataIndex:"status",key:"status",width:120,render:(t,s)=>{const a={pending:{color:"default",text:r("machines:pending")},testing:{color:"processing",text:r("machines:testing")},success:{color:"success",text:r("machines:connected")},failed:{color:"error",text:r("machines:failed")}};return e.jsx(Me,{color:a[t].color,"data-testid":`connectivity-status-tag-${s.machineName}-${t}`,children:a[t].text})}},{title:r("machines:responseTime"),dataIndex:"duration",key:"duration",width:120,render:e=>e?e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`:"-"},{title:r("machines:message"),dataIndex:"message",key:"message",ellipsis:!0,render:(t,s)=>t?e.jsx(Ns,{type:"failed"===s.status?"danger":void 0,children:t}):"-"}];return e.jsx(De,{"data-testid":"connectivity-modal",title:e.jsxs(ze,{children:[e.jsx(h,{style:{fontSize:J.DIMENSIONS.ICON_MD}}),e.jsx("span",{style:{fontSize:H("BASE")},children:r("machines:connectivityTest")})]}),open:t,onCancel:s,className:q.ExtraLarge,destroyOnHidden:!0,footer:[e.jsx(Re,{type:"primary",icon:e.jsx(V,{style:{fontSize:J.DIMENSIONS.ICON_SM}}),onClick:async()=>{d(!0);for(let s=0;s<a.length;s++)y(s),u(Math.round(s/a.length*100)),await j(a[s],s);u(100),d(!1),y(-1);const e=o.filter(e=>"success"===e.status).length,t=o.filter(e=>"failed"===e.status).length;0===t?X("success",r("machines:allMachinesConnected",{count:e})):X("warning",r("machines:machinesConnectedWithFailures",{successCount:e,failedCount:t}))},disabled:l||0===a.length,loading:l,style:{fontSize:H("SM")},"data-testid":"connectivity-run-test-button",children:r(l?"machines:testing":"machines:runTest")},"run"),e.jsx(Ee,{title:"Close",children:e.jsx(Re,{icon:e.jsx(Te,{}),onClick:s,style:{borderRadius:Q("LG"),fontSize:H("SM")},"data-testid":"connectivity-close-button","aria-label":"Close"},"close")},"close-tooltip")],children:e.jsxs(ze,{direction:"vertical",size:"large",style:{width:"100%"},children:[l&&e.jsxs("div",{style:{marginBottom:K("MD")},"data-testid":"connectivity-progress-container",children:[e.jsx($e,{percent:m,status:"active",strokeColor:{"0%":"var(--color-primary)","100%":"var(--color-success)"},style:{borderRadius:Q("LG")},"data-testid":"connectivity-progress-bar"}),p>=0&&p<a.length&&e.jsx(Ns,{type:"secondary",style:{fontSize:H("XS"),marginTop:K("XS"),display:"block"},"data-testid":"connectivity-progress-text",children:r("machines:testingMachine",{machineName:a[p].machineName})})]}),e.jsx(Be,{message:r("machines:connectivityTestDescription"),type:"info",showIcon:!0,icon:e.jsx(h,{style:{fontSize:J.DIMENSIONS.ICON_MD}}),style:{borderRadius:Q("LG"),fontSize:H("SM")},"data-testid":"connectivity-info-alert"}),e.jsx(Ve,{columns:v,dataSource:o,rowKey:"machineName",pagination:!1,scroll:{y:400},loading:0===a.length,rowClassName:e=>"testing"===e.status?"connectivity-test-active-row":"success"===e.status?"connectivity-test-success-row":"failed"===e.status?"connectivity-test-failed-row":"",style:{borderRadius:Q("LG"),overflow:"hidden"},"data-testid":"connectivity-results-table"}),!l&&o.some(e=>"pending"!==e.status)&&e.jsx("div",{style:{padding:K("MD"),background:"dark"===n?"var(--color-fill-quaternary)":"var(--color-fill-tertiary)",borderRadius:Q("LG")},"data-testid":"connectivity-summary-statistics",children:e.jsxs(ze,{size:"large",children:[e.jsxs("div",{"data-testid":"connectivity-total-machines",children:[e.jsxs(Ns,{type:"secondary",children:[r("machines:totalMachines"),":"]})," ",e.jsx(Ns,{strong:!0,children:a.length})]}),e.jsxs("div",{"data-testid":"connectivity-connected-count",children:[e.jsxs(Ns,{type:"secondary",children:[r("machines:connected"),":"]})," ",e.jsx(Ns,{strong:!0,style:{color:"#52c41a"},children:o.filter(e=>"success"===e.status).length})]}),e.jsxs("div",{"data-testid":"connectivity-failed-count",children:[e.jsxs(Ns,{type:"secondary",children:[r("machines:failed"),":"]})," ",e.jsx(Ns,{strong:!0,style:{color:"#ff4d4f"},children:o.filter(e=>"failed"===e.status).length})]}),e.jsxs("div",{"data-testid":"connectivity-average-response",children:[e.jsxs(Ns,{type:"secondary",children:[r("machines:averageResponse"),":"]})," ",e.jsx(Ns,{strong:!0,children:(()=>{const e=o.filter(e=>"success"===e.status&&e.duration);if(0===e.length)return"-";const t=e.reduce((e,t)=>e+(t.duration||0),0)/e.length;return t<1e3?`${Math.round(t)}ms`:`${(t/1e3).toFixed(1)}s`})()})]})]})})]})})},{Step:ks}=Ae,{Text:Cs,Title:Ss,Paragraph:Ts}=_e,Is=({open:t,onClose:s,teamName:a,onImportComplete:r})=>{const{t:n}=Ie(["resources","common"]),o=Y(),[c,l]=i.useState(0),[d,m]=i.useState([]),[u,h]=i.useState([]),[g,f]=i.useState([]),[j,v]=i.useState(!1),[b,N]=i.useState(null),w=p(),{data:k=[]}=y(a),C=e=>{const{type:t,config:s}=e,a={drive:"drive",onedrive:"onedrive",s3:"s3",b2:"b2",mega:"mega",dropbox:"dropbox",box:"box",azureblob:"azureblob",swift:"swift",webdav:"webdav",ftp:"ftp",sftp:"sftp"}[t];if(!a)return null;const i={};return Object.entries(s).forEach(([e,t])=>{if("type"===e)i.provider=a;else{let s=t;if("string"==typeof t&&("token"===e||e.endsWith("_token"))&&t.startsWith("{"))try{s=JSON.parse(t)}catch{s=t}i[e]=s}}),i.provider||(i.provider=a),i},S=async e=>{N(null);try{const t=(e=>{const t=[],s=e.split("\n");let a=null,i={};for(const r of s){const e=r.trim();if(!e||e.startsWith("#")||e.startsWith(";"))continue;const s=e.match(/^\[(.+)\]$/);if(s)a&&i.type&&t.push({name:a,type:i.type,config:{...i}}),a=s[1],i={};else if(a){const t=e.match(/^([^=]+)=(.*)$/);if(t){const e=t[1].trim(),s=t[2].trim();try{i[e]=JSON.parse(s)}catch{i[e]=s}}}}return a&&i.type&&t.push({name:a,type:i.type,config:{...i}}),t})(await e.text());if(0===t.length)return N(n("resources:storage.import.noConfigsFound")),!1;h(t);const s=t.map(e=>{const t=k.some(t=>t.storageName===e.name);return{name:e.name,status:"pending",exists:t,selected:!t}});return f(s),l(1),!1}catch(t){return N(n("resources:storage.import.parseError")),!1}},T=()=>{l(0),m([]),h([]),f([]),v(!1),N(null),2===c&&g.some(e=>"success"===e.status)&&r?.(),s()},I=[{title:e.jsx(Fe,{checked:g.every(e=>e.selected),indeterminate:g.some(e=>e.selected)&&!g.every(e=>e.selected),onChange:e=>{return t=e.target.checked,void f(e=>e.map(e=>({...e,selected:t})));var t},disabled:2===c,"data-testid":"rclone-wizard-select-all-checkbox"}),dataIndex:"selected",key:"selected",width:50,render:(t,s,a)=>e.jsx(Fe,{checked:s.selected,onChange:()=>(e=>{f(t=>{const s=[...t];return s[e]={...s[e],selected:!s[e].selected},s})})(a),disabled:2===c,"data-testid":`rclone-wizard-config-checkbox-${s.name}`})},{title:n("resources:storage.storageName"),dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(ze,{children:[e.jsx(E,{}),e.jsx(Cs,{strong:!0,children:t}),s.exists&&e.jsx(Ee,{title:n("resources:storage.import.alreadyExists"),children:e.jsxs(Me,{color:"warning",children:[e.jsx(Z,{})," ",n("resources:storage.import.exists")]})})]})},{title:n("resources:storage.provider"),key:"provider",width:120,render:(t,s)=>{const a=u.find(e=>e.name===s.name);if(!a)return null;const i=a.type.charAt(0).toUpperCase()+a.type.slice(1);return e.jsx(Me,{color:"blue",children:i})}},{title:n("resources:storage.import.status"),dataIndex:"status",key:"status",width:150,render:(t,s)=>{if(c<2)return null;const a={pending:{color:"default",text:n("resources:storage.import.pending")},success:{color:"success",text:n("resources:storage.import.success")},error:{color:"error",text:n("resources:storage.import.error")},skipped:{color:"warning",text:n("resources:storage.import.skipped")}}[t]||{color:"default",text:t};return e.jsxs(ze,{direction:"vertical",size:"small",children:[e.jsx(Me,{color:a.color,children:a.text}),s.message&&e.jsx(Cs,{type:"secondary",style:{fontSize:12},children:s.message})]})}}];return e.jsxs(De,{title:e.jsxs(ze,{children:[e.jsx(E,{}),n("resources:storage.import.title")]}),open:t,onCancel:T,style:ee(J.DIMENSIONS.MODAL_WIDTH_XL),footer:0===c?e.jsx(Re,{onClick:T,"data-testid":"rclone-wizard-cancel-button",style:o.buttonSecondary,children:n("common:actions.cancel")}):1===c?e.jsxs(e.Fragment,{children:[e.jsx(Re,{onClick:()=>l(0),"data-testid":"rclone-wizard-back-button",style:o.buttonSecondary,children:n("common:actions.back")}),e.jsx(Re,{onClick:T,"data-testid":"rclone-wizard-cancel-button",style:o.buttonSecondary,children:n("common:actions.cancel")}),e.jsx(Re,{type:"primary",onClick:async()=>{v(!0);const e=u.filter((e,t)=>g[t].selected);for(let s=0;s<e.length;s++){const i=e[s],r=u.findIndex(e=>e.name===i.name);try{const e=C(i);if(!e){f(e=>{const t=[...e];return t[r]={...t[r],status:"error",message:n("resources:storage.import.unsupportedProvider",{type:i.type})},t});continue}const t=JSON.stringify(e);await w.mutateAsync({teamName:a,storageName:i.name,storageVault:t}),f(e=>{const t=[...e];return t[r]={...t[r],status:"success",message:n("resources:storage.import.imported")},t})}catch(t){f(e=>{const s=[...e];return s[r]={...s[r],status:"error",message:t.message||n("resources:storage.import.importError")},s})}}v(!1),l(2)},disabled:!g.some(e=>e.selected),loading:j,"data-testid":"rclone-wizard-import-button",style:o.buttonPrimary,children:n("resources:storage.import.importSelected")})]}):e.jsx(Re,{type:"primary",onClick:T,"data-testid":"rclone-wizard-close-button",style:o.buttonPrimary,children:n("common:actions.close")}),children:[e.jsxs(Ae,{current:c,style:{marginBottom:K("LG")},"data-testid":"rclone-wizard-steps",children:[e.jsx(ks,{title:n("resources:storage.import.step1")}),e.jsx(ks,{title:n("resources:storage.import.step2")}),e.jsx(ks,{title:n("resources:storage.import.step3")})]}),(()=>{switch(c){case 0:return e.jsxs("div",{style:{padding:"20px 0"},children:[e.jsx(Be,{message:n("resources:storage.import.instructions"),description:e.jsxs("div",{children:[e.jsx(Ts,{children:n("resources:storage.import.instructionsDetail")}),e.jsx(Ts,{children:e.jsx(Cs,{code:!0,children:"rclone config file"})}),e.jsx(Ts,{children:n("resources:storage.import.uploadPrompt")})]}),type:"info",showIcon:!0,icon:e.jsx(Z,{}),style:{marginBottom:20}}),e.jsxs(Pe.Dragger,{accept:".conf",fileList:d,beforeUpload:S,onChange:({fileList:e})=>m(e),maxCount:1,"data-testid":"rclone-wizard-upload-dragger",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(x,{})}),e.jsx("p",{className:"ant-upload-text",children:n("resources:storage.import.dragDropText")}),e.jsx("p",{className:"ant-upload-hint",children:n("resources:storage.import.supportedFormats")})]}),b&&e.jsx(Be,{message:b,type:"error",showIcon:!0,style:{marginTop:16}})]});case 1:return e.jsxs("div",{children:[e.jsx(Be,{message:n("resources:storage.import.selectStorages"),description:n("resources:storage.import.selectDescription"),type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(Ve,{dataSource:g,columns:I,rowKey:"name",pagination:!1,size:"small","data-testid":"rclone-wizard-config-table"})]});case 2:return e.jsx("div",{children:j?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(Oe,{size:"large"}),e.jsx(Ss,{level:4,style:{marginTop:16},children:n("resources:storage.import.importing")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{message:n("resources:storage.import.complete"),description:n("resources:storage.import.completeDescription"),type:"success",showIcon:!0,style:{marginBottom:16}}),e.jsx(Ve,{dataSource:g,columns:I,rowKey:"name",pagination:!1,size:"small","data-testid":"rclone-wizard-results-table"})]})});default:return null}})()]})},zs=({open:t,onCancel:s,machineName:a,teamName:r,bridgeName:n,onPullSelected:o,onClose:l,onQueueItemCreated:d})=>{const{t:h}=Ie(["resources","common","machines"]),{data:p}=c(),x=te(),f=Y(),{data:j,isLoading:v}=y(r),{data:b,isLoading:N}=g(r),{data:w}=u(),{buildQueueVault:k}=m(),{mutateAsync:C}=me(),[S,T]=i.useState(!1),[I,z]=i.useState([]),[_,M]=i.useState(""),[D,$]=i.useState(""),[B,V]=i.useState(""),[R,E]=i.useState(""),[F,A]=i.useState("table"),O=i.useMemo(()=>{const e=[];return b&&b.length>0&&b.forEach(t=>{e.push({value:t.machineName,label:`${t.machineName} (Machine)`,type:"machine"})}),j&&j.length>0&&j.forEach(t=>{e.push({value:t.storageName,label:`${t.storageName} (Cloud Storage)`,type:"storage"})}),e},[b,j]);i.useEffect(()=>{!D&&a&&$(a)},[a,D]);const P=async()=>{if(D){T(!0);try{const s=O.find(e=>e.value===D),i="storage"===s?.type,o={},c=b?.find(e=>e.machineName===a);c&&c.vaultContent&&(o.machineVault=c.vaultContent);const l=w?.find(e=>e.teamName===r);if(l&&l.vaultContent&&(o.teamVault=l.vaultContent),!i&&D!==a){const t=b?.find(e=>e.machineName===D);if(t&&t.vaultContent)try{const e=JSON.parse(t.vaultContent);o.additionalMachineData={[D]:e}}catch(e){}}if(i){const t=j?.find(e=>e.storageName===D);if(t&&t.vaultContent)try{const e=JSON.parse(t.vaultContent);o.additionalStorageData={[D]:e}}catch(e){}}const d=await k({teamName:r,machineName:a,bridgeName:n,functionName:"list",params:{from:D,path:_||"",format:"json"},priority:4,description:`List files from ${D}`,addedVia:"file-browser",...o}),m=await C({teamName:r,machineName:a,bridgeName:n,queueVault:d,priority:4}),u=m.taskId||m.queueId;if(!u)throw new Error("Failed to create queue item - no taskId returned");if(m.isQueued)X("info","File listing has been queued. Please try again in a moment."),z([]);else{const s=await gs(u,3e4);if(s.success){let a=[],i="";try{const t=s.responseData?.result;if(!t&&!s.responseData)return void z([]);if("string"==typeof t)try{i=JSON.parse(t).command_output||""}catch(e){i=t}if("string"==typeof i)if(i.includes("DEBUG:")){const e=i.lastIndexOf("["),t=i.lastIndexOf("]");if(-1!==e&&-1!==t&&e<t){const s=i.substring(e,t+1);i=s}}else if(i.includes("[")){const e=i.indexOf("["),t=i.lastIndexOf("]");if(-1!==e&&-1!==t){const s=i.substring(e,t+1);i=s.replace(/\\\\/g,"\\").replace(/\\n/g,"\n")}}const r="string"==typeof i?JSON.parse(i):i;Array.isArray(r)?a=r.map(e=>({name:e.name||e.Name||"",size:parseInt(e.size||e.Size||"0"),isDirectory:void 0!==e.isDirectory?e.isDirectory:e.permissions?.startsWith("d")||e.IsDir||!1,modTime:e.date?`${e.date} ${e.time}`:e.ModTime,path:e.Path||(_?`${_}/${e.name||e.Name}`:e.name||e.Name)})):r.entries&&(a=r.entries.map(e=>({name:e.Name,size:e.Size||0,isDirectory:e.IsDir||!1,modTime:e.ModTime,mimeType:e.MimeType,path:e.Path||(_?`${_}/${e.Name}`:e.Name)})))}catch(t){if("string"==typeof i&&i.includes('"Path":')&&i.includes('"Name":')){const t=i.match(/\{[^}]+\}/g);t&&(a=t.map(t=>{try{const e=JSON.parse(t);return{name:e.Name||"",size:e.Size||0,isDirectory:e.IsDir||!1,modTime:e.ModTime,mimeType:e.MimeType,path:e.Path||(_?`${_}/${e.Name}`:e.Name)}}catch(e){return null}}).filter(e=>null!==e))}else{const e=("string"==typeof i?i:JSON.stringify(i)).trim().split("\n").filter(e=>e.trim());a=e.filter(e=>!(e.startsWith("Listing")||e.startsWith("Setting up")||e.startsWith("Error:")||e.startsWith("DEBUG:")||""===e.trim())).map(e=>{const t=e.match(/^\s*(\d+)\s+(.+)$/);if(t){const[,e,s]=t;return{name:s.trim(),size:parseInt(e),isDirectory:s.endsWith("/"),path:_?`${_}/${s.trim()}`:s.trim()}}return{name:e.trim(),size:0,isDirectory:e.endsWith("/"),path:_?`${_}/${e.trim()}`:e.trim()}})}}z(a.filter(e=>e.name))}else X("error",s.message||h("resources:remoteFiles.loadError")),z([])}}catch(s){X("error",s.message||h("resources:remoteFiles.loadError")),z([])}finally{T(!1)}}},L=e=>{M(e),V(""),z([])},G=i.useMemo(()=>R?I.filter(e=>e.name.toLowerCase().includes(R.toLowerCase())):I,[I,R]),W=[{title:h("resources:remoteFiles.name"),dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(ze,{children:[s.isDirectory?e.jsx(Le,{style:{color:"#1890ff"}}):e.jsx(Ge,{style:{color:"#666"}}),s.isDirectory?e.jsx("a",{onClick:()=>L(_?`${_}/${t}`:t),"data-testid":`file-browser-folder-${t}`,children:t}):e.jsx("span",{"data-testid":`file-browser-file-${t}`,children:t})]}),sorter:(e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name)},{title:h("resources:remoteFiles.size"),dataIndex:"size",key:"size",width:120,render:(e,t)=>t.isDirectory?"-":(e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]})(e),sorter:(e,t)=>e.size-t.size},{title:h("resources:remoteFiles.modified"),dataIndex:"modTime",key:"modTime",width:200,render:e=>e?yt(e):"-",sorter:(e,t)=>e.modTime&&t.modTime?new Date(e.modTime).getTime()-new Date(t.modTime).getTime():0}],U=i.useMemo(()=>{const t=[{title:e.jsx("span",{"data-testid":"file-browser-breadcrumb-home",children:e.jsx(Ze,{})}),onClick:()=>L("")}];if(_){const s=_.split("/").filter(Boolean);s.forEach((a,i)=>{const r=s.slice(0,i+1).join("/");t.push({title:e.jsx("span",{"data-testid":`file-browser-breadcrumb-${a}`,children:a}),onClick:()=>L(r)})})}return t},[_]);return e.jsx(De,{"data-testid":"file-browser-modal",title:e.jsxs(ze,{children:[e.jsx(Ye,{}),h("resources:remoteFiles.title")]}),open:t,onCancel:s,className:q.Large,footer:[e.jsx(Ee,{title:h("common:actions.cancel"),children:e.jsx(Re,{icon:e.jsx(Je,{}),onClick:s,style:f.touchTarget,"data-testid":"file-browser-cancel-button","aria-label":h("common:actions.cancel")})},"cancel"),e.jsx(Ee,{title:h("common:actions.refresh"),children:e.jsx(Re,{icon:e.jsx(Xe,{}),onClick:P,loading:S,style:f.touchTarget,"data-testid":"file-browser-refresh-button","aria-label":h("common:actions.refresh")})},"refresh"),e.jsx(Ee,{title:h("resources:remoteFiles.pull"),children:e.jsx(Re,{type:"primary",icon:e.jsx(Ye,{}),onClick:async()=>{if(!B)return void X("warning",h("resources:remoteFiles.selectFile"));const e=I.find(e=>e.name===B);if(e)if(o)o([e],D),s();else{const i=e,o={},c=O.find(e=>e.value===D),l="storage"===c?.type,m=b?.find(e=>e.machineName===a);m&&m.vaultContent&&(o.machineVault=m.vaultContent);const u=w?.find(e=>e.teamName===r);if(u&&u.vaultContent&&(o.teamVault=u.vaultContent),l){const e=j?.find(e=>e.storageName===D);if(e&&e.vaultContent)try{const t=JSON.parse(e.vaultContent);o.additionalStorageData={[D]:t}}catch(t){}}if(!l&&D!==a){const e=b?.find(e=>e.machineName===D);if(e&&e.vaultContent)try{const t=JSON.parse(e.vaultContent);o.additionalMachineData={[D]:t}}catch(t){}}const p=await k({teamName:r,machineName:a,bridgeName:n,functionName:"pull",params:{from:D,repo:i.name,path:_||"",sourceType:l?"storage":"machine"},priority:3,description:`Pull ${i.name} from ${D}`,addedVia:"file-browser",...o}),y=await C({teamName:r,machineName:a,bridgeName:n,queueVault:p,priority:3});y?.taskId&&d?d(y.taskId,a):y?.isQueued&&X("info",h("resources:messages.pullOperationQueued")),X("success",h("resources:remoteFiles.pullStarted")),s()}},disabled:!B,style:f.touchTarget,"data-testid":"file-browser-pull-button","aria-label":h("resources:remoteFiles.pull")})},"pull")],children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{"data-testid":"file-browser-source-container",children:[e.jsx("div",{style:{marginBottom:8,fontWeight:500},"data-testid":"file-browser-source-label",children:h("resources:remoteFiles.sourceLabel")}),e.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsxs(ze,{children:[e.jsx(We,{style:{width:300},placeholder:h("resources:remoteFiles.selectSource"),value:D,onChange:e=>{$(e),M(""),V(""),z([])},loading:v||N,notFoundContent:v||N?e.jsx(Oe,{size:"small"}):0===O.length?e.jsx(Ue,{image:Ue.PRESENTED_IMAGE_SIMPLE,description:h("resources:remoteFiles.noSources")}):null,options:O,"data-testid":"file-browser-source-select"}),e.jsx(Ee,{title:h("resources:remoteFiles.loadFiles"),children:e.jsx(Re,{icon:e.jsx(qe,{}),onClick:P,loading:S,disabled:!D,style:f.touchTarget,"data-testid":"file-browser-load-files-button","aria-label":h("resources:remoteFiles.loadFiles")})})]}),e.jsx(Ke.Search,{placeholder:h("common:actions.search"),value:R,onChange:e=>E(e.target.value),style:{width:250},"data-testid":"file-browser-search-input"})]})]}),_&&e.jsx(Qe,{items:U,separator:e.jsx(He,{}),"data-testid":"file-browser-breadcrumb"}),e.jsx(Oe,{spinning:S,children:0===G.length?e.jsx(Ue,{description:h(S?"common:general.loading":"resources:remoteFiles.noFiles"),"data-testid":"file-browser-empty-state"}):e.jsx(Ve,{dataSource:G,columns:W,rowKey:"name",pagination:{pageSize:10,showSizeChanger:!0,showTotal:(e,t)=>h("common:table.showingRecords",{start:t[0],end:t[1],total:e})},rowSelection:{type:"radio",selectedRowKeys:B?[B]:[],onChange:e=>V(e[0]||""),getCheckboxProps:e=>({disabled:e.isDirectory})},scroll:{y:400},style:x.tableContainer,"data-testid":"file-browser-table",onRow:e=>({"data-testid":`file-browser-row-${e.name}`})})}),e.jsx(Be,{type:"info",message:h("resources:remoteFiles.info"),showIcon:!0,"data-testid":"file-browser-info-alert"})]})})},_s=e=>{if(!e||"string"!=typeof e)return 0;const t=e.match(/^([\d.]+)\s*([KMGT]i?B?)?$/i);if(!t)return 0;const s=parseFloat(t[1]);if(isNaN(s))return 0;const a=(t[2]||"").toUpperCase();return s*({KI:1024,MI:1048576,GI:1073741824,TI:1099511627776,KIB:1024,MIB:1048576,GIB:1073741824,TIB:1099511627776}[a]||{KB:1e3,MB:1e6,GB:1e9,TB:1e12}[a]||{K:1024,M:1048576,G:1073741824,T:1099511627776,B:1}[a]||1)},Ms=(e,t,s)=>{if(e){const t=parseInt(e);if(!isNaN(t)&&t>=0)return Math.min(100,t)}if(!t||!s)return 0;const a=_s(t),i=_s(s);if(0===i)return 0;const r=Math.round(a/i*100);return Math.min(100,Math.max(0,r))},{Text:Ds}=_e,$s=({machine:t,onViewDetails:s,onManageAssignment:a})=>{const{t:i}=Ie(["distributedStorage","machines"]),r=Y(),n=!!t.distributedStorageClusterName,{data:o,isLoading:c}=ue(t.machineName,t.teamName,!n),l=n?"CLUSTER":o?.assignmentType||"AVAILABLE",d=n?`Assigned to cluster: ${t.distributedStorageClusterName}`:o?.assignmentDetails;return c?e.jsx("div",{style:{...r.flexCenter,...r.padding.lg},"data-testid":"ds-section-loading",children:e.jsx(Oe,{})}):e.jsxs(e.Fragment,{children:[e.jsx(et,{style:r.marginBottom.lg,"data-testid":"ds-section-divider",children:e.jsxs(ze,{style:r.flexCenter,children:[e.jsx(ht,{style:r.icon.medium}),e.jsx("span",{style:r.heading5,children:i("machineSection.title")})]})}),e.jsx(tt,{size:"small","data-testid":"ds-section-card",style:{...r.card,border:"1px solid var(--color-border-secondary)"},children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsx(Ds,{type:"secondary",style:{display:"block",...r.marginBottom.xs,...r.label},"data-testid":"ds-section-assignment-label",children:i("assignment.currentAssignment")}),e.jsx(he,{assignmentType:l,assignmentDetails:d,size:"default","data-testid":"ds-section-assignment-badge"})]}),"AVAILABLE"!==l&&d&&e.jsx(Be,{message:e.jsx("span",{style:r.body,children:d}),type:"info",icon:"CLUSTER"===l?e.jsx(ft,{style:r.icon.small}):"IMAGE"===l?e.jsx(se,{style:r.icon.small}):"CLONE"===l?e.jsx(jt,{style:r.icon.small}):e.jsx(ht,{style:r.icon.small}),showIcon:!0,style:{borderRadius:"var(--border-radius-lg)"},"data-testid":"ds-section-assignment-alert"}),e.jsxs(ze,{children:[s&&e.jsx(Re,{size:"small",icon:e.jsx(ae,{style:r.icon.small}),onClick:s,style:{...r.buttonSecondary,...r.touchTargetSmall},"data-testid":"ds-section-history-button",children:e.jsx("span",{style:r.caption,children:i("assignment.history")})}),a&&"AVAILABLE"!==l&&e.jsx(Re,{size:"small",type:"primary",icon:e.jsx(we,{style:r.icon.small}),onClick:a,style:{...r.buttonPrimary,...r.touchTargetSmall},"data-testid":"ds-section-manage-button",children:e.jsx("span",{style:r.caption,children:i("machineSection.manageAssignment")})})]}),"AVAILABLE"!==l&&e.jsx(Be,{message:e.jsx("span",{style:r.body,children:i("warnings.exclusivity")}),type:"warning",showIcon:!0,style:{...r.marginBottom.xs,borderRadius:"var(--border-radius-lg)"},"data-testid":"ds-section-exclusivity-warning"})]})})]})},{Text:Bs,Title:Vs}=_e,Rs=({machine:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=Ie(["machines","resources","common","distributedStorage"]),{theme:o}=G(),c=Y(),[d,m]=i.useState({open:!1,entityType:null,entityIdentifier:null}),u=i.useMemo(()=>{if(!t?.vaultStatus)return null;try{if(t.vaultStatus.trim().startsWith("jq:")||t.vaultStatus.trim().startsWith("error:")||!t.vaultStatus.trim().startsWith("{"))return null;const e=JSON.parse(t.vaultStatus);if("completed"===e.status&&e.result){let t=e.result;if(t.match(/(\}[\s\n]*$)/)){const e=t.lastIndexOf("}");e<t.length-10&&(t=t.substring(0,e+1))}const s=t.indexOf("\njq:");return s>0&&(t=t.substring(0,s)),t=t.trim(),JSON.parse(t)}}catch(e){}return null},[t]);return i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,a]),t&&s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"machine-vault-status-panel",style:r?{height:"100%",backgroundColor:"dark"===o?"#141414":"#fff",overflowY:"auto",overflowX:"hidden"}:{position:"fixed",top:0,right:s?0:"-520px",bottom:0,width:"520px",maxWidth:"100vw",backgroundColor:"dark"===o?"#141414":"#fff",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,transition:"right 0.3s ease-in-out",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),position:"sticky",top:0,backgroundColor:"dark"===o?"#141414":"#fff",zIndex:r?0:1},"data-testid":"vault-status-header",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(ze,{children:[e.jsx(ht,{style:{fontSize:24,color:"#556b2f"}}),e.jsx(Vs,{level:4,style:{margin:0},"data-testid":"vault-status-machine-name",children:t.machineName})]}),e.jsx(Re,{type:"text",icon:e.jsx(ie,{}),onClick:a,style:c.touchTarget,"data-testid":"vault-status-close"})]}),e.jsxs(ze,{wrap:!0,style:{marginTop:8},children:[e.jsxs(Me,{color:"#8FBC8F",icon:e.jsx(re,{}),"data-testid":"vault-status-team-tag",children:["Team: ",t.teamName]}),e.jsxs(Me,{color:"green",icon:e.jsx(mt,{}),"data-testid":"vault-status-bridge-tag",children:["Bridge: ",t.bridgeName]}),t.regionName&&e.jsxs(Me,{color:"purple",icon:e.jsx(ne,{}),"data-testid":"vault-status-region-tag",children:["Region: ",t.regionName]}),e.jsx(st,{count:t.queueCount,style:{backgroundColor:"#52c41a"},"data-testid":"vault-status-queue-badge",children:e.jsx(Me,{color:"blue",children:n("machines:queueItems")})}),e.jsxs(Me,{color:"blue","data-testid":"vault-status-version-tag",children:[n("machines:vaultVersion"),": ",t.vaultVersion]})]}),t.vaultStatusTime&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(Bs,{type:"secondary",style:{fontSize:12},title:gt(t.vaultStatusTime,"datetime"),"data-testid":"vault-status-last-updated",children:[n("machines:lastUpdated"),": ",xt(t.vaultStatusTime,n)]})})]}),e.jsx("div",{style:{padding:"24px"},"data-testid":"vault-status-content",children:u?e.jsxs(e.Fragment,{children:[u.system&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[e.jsx(R,{style:{fontSize:20,color:"#556b2f"}}),e.jsx(Vs,{level:5,style:{margin:0},"data-testid":"vault-status-system-info-title",children:n("resources:repositories.systemInfo")})]}),e.jsxs(at,{gutter:[16,16],style:c.marginBottom.md,children:[e.jsx(it,{span:12,children:e.jsx(tt,{size:"small",style:{height:"100%"},"data-testid":"vault-status-hostname-card",children:e.jsx(rt,{title:n("resources:repositories.hostname"),value:u.system.hostname,prefix:e.jsx(ht,{}),valueStyle:{fontSize:16}})})}),e.jsx(it,{span:12,children:e.jsx(tt,{size:"small",style:{height:"100%"},"data-testid":"vault-status-uptime-card",children:e.jsx(rt,{title:n("resources:repositories.uptime"),value:u.system.uptime,prefix:e.jsx(vt,{}),valueStyle:{fontSize:16}})})}),e.jsx(it,{span:24,children:e.jsx(tt,{size:"small","data-testid":"vault-status-os-info-card",children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.osName"),":"]}),e.jsx(Bs,{strong:!0,"data-testid":"vault-status-os-name",children:u.system.os_name})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.kernel"),":"]}),e.jsx(Bs,{"data-testid":"vault-status-kernel",children:u.system.kernel})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.cpu"),":"]}),e.jsxs(Bs,{"data-testid":"vault-status-cpu",children:[u.system.cpu_count," × ",u.system.cpu_model]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.systemTime"),":"]}),e.jsxs(Bs,{"data-testid":"vault-status-system-time",children:[u.system.system_time_human," (",u.system.timezone,")"]})]})]})})})]}),e.jsx(et,{style:{margin:"24px 0"},children:e.jsxs(ze,{children:[e.jsx(Z,{}),n("resources:repositories.resourceUsage")]})}),e.jsxs(at,{gutter:[16,16],style:c.marginBottom.lg,children:[e.jsx(it,{span:24,children:e.jsxs(tt,{size:"small","data-testid":"vault-status-memory-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(ze,{children:[e.jsx(ft,{style:{color:"#1890ff"}}),e.jsx(Bs,{strong:!0,children:n("resources:repositories.memory")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Bs,{children:[u.system.memory.used," / ",u.system.memory.total]})}),e.jsx($e,{percent:Ms(void 0,u.system.memory.used,u.system.memory.total),strokeColor:"#1890ff",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(Bs,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",u.system.memory.available]})]})}),e.jsx(it,{span:24,children:e.jsxs(tt,{size:"small","data-testid":"vault-status-disk-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(ze,{children:[e.jsx(se,{style:{color:"#fa8c16"}}),e.jsx(Bs,{strong:!0,children:n("resources:repositories.rootDisk")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Bs,{children:[u.system.disk.used," / ",u.system.disk.total]})}),e.jsx($e,{percent:Ms(u.system.disk.use_percent,u.system.disk.used,u.system.disk.total),status:(parseInt(u.system.disk.use_percent)||0)>90?"exception":"normal",strokeColor:(parseInt(u.system.disk.use_percent)||0)>90?"#ff4d4f":"#fa8c16",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(Bs,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",u.system.disk.available]})]})}),u.system.datastore?.path&&e.jsx(it,{span:24,children:e.jsxs(tt,{size:"small","data-testid":"vault-status-datastore-card",children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(ze,{children:[e.jsx(ft,{style:{color:"#52c41a"}}),e.jsx(Bs,{strong:!0,children:n("resources:repositories.datastore")})]})}),e.jsx(Bs,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:8,wordBreak:"break-all"},children:u.system.datastore.path}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Bs,{children:[u.system.datastore.used," / ",u.system.datastore.total]})}),e.jsx($e,{percent:Ms(u.system.datastore.use_percent,u.system.datastore.used,u.system.datastore.total),status:(parseInt(u.system.datastore.use_percent)||0)>90?"exception":"normal",strokeColor:(parseInt(u.system.datastore.use_percent)||0)>90?"#ff4d4f":"#52c41a",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0}),e.jsxs(Bs,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",u.system.datastore.available]})]})})]})]}),u.network&&e.jsxs(e.Fragment,{children:[e.jsx(et,{style:{margin:"24px 0"},children:e.jsxs(ze,{children:[e.jsx(h,{}),n("resources:repositories.networkInfo")]})}),u.network.default_gateway&&e.jsx(tt,{size:"small",style:{marginBottom:16},"data-testid":"vault-status-gateway-card",children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.defaultGateway"),":"]}),e.jsx(Bs,{strong:!0,"data-testid":"vault-status-gateway",children:u.network.default_gateway})]}),u.network.default_interface&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.defaultInterface"),":"]}),e.jsx(Bs,{"data-testid":"vault-status-interface",children:u.network.default_interface})]})]})}),e.jsx(nt,{dataSource:u.network.interfaces.filter(e=>"unknown"!==e.state&&"lo"!==e.name),style:c.marginBottom.lg,"data-testid":"vault-status-network-list",renderItem:t=>e.jsxs(tt,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-network-${t.name}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(ze,{children:[e.jsx(ns,{style:{color:"#1890ff"}}),e.jsx(Bs,{strong:!0,"data-testid":`vault-status-network-name-${t.name}`,children:t.name})]}),e.jsx(Me,{color:"UP"===t.state?"success":"default","data-testid":`vault-status-network-state-${t.name}`,children:t.state})]}),e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[t.ipv4_addresses.length>0&&e.jsxs("div",{children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.ipAddresses"),":"]}),t.ipv4_addresses.map((t,s)=>e.jsx("div",{style:{marginLeft:16},children:e.jsx(Me,{color:"blue","data-testid":`vault-status-ip-${t}`,children:t})},s))]}),t.mac_address&&"unknown"!==t.mac_address&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.macAddress"),":"]}),e.jsx(Bs,{style:{fontSize:12},children:t.mac_address})]}),t.mtu>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Bs,{type:"secondary",children:"MTU:"}),e.jsx(Bs,{children:t.mtu})]})]})]})})]}),u.block_devices&&u.block_devices.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(et,{style:{margin:"24px 0"},children:e.jsxs(ze,{children:[e.jsx(se,{}),n("resources:repositories.blockDevices")]})}),e.jsx(nt,{dataSource:u.block_devices,style:c.marginBottom.lg,"data-testid":"vault-status-block-devices-list",renderItem:t=>e.jsxs(tt,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-block-device-${t.name}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(ze,{children:[e.jsx(se,{style:{color:"#fa8c16"}}),e.jsx(Bs,{strong:!0,"data-testid":`vault-status-device-path-${t.name}`,children:t.path})]}),e.jsxs(ze,{children:[e.jsx(Me,{"data-testid":`vault-status-device-type-${t.name}`,children:t.type}),e.jsx(Me,{color:"blue","data-testid":`vault-status-device-size-${t.name}`,children:t.size_human})]})]}),e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[t.model&&"Unknown"!==t.model&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.model"),":"]}),e.jsx(Bs,{style:{fontSize:12},children:t.model})]}),t.partitions.length>0&&e.jsxs("div",{children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.partitions"),":"]}),e.jsx("div",{style:{marginLeft:16,marginTop:8},children:t.partitions.map((t,s)=>e.jsx("div",{style:{marginBottom:4},children:e.jsxs(ze,{children:[e.jsx(l,{style:{fontSize:12}}),e.jsxs(Bs,{style:{fontSize:12},children:[t.name,": ",t.size_human,t.filesystem&&` (${t.filesystem})`,t.mountpoint&&` → ${t.mountpoint}`]})]})},s))})]})]})]})})]}),u.system_containers&&u.system_containers.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(et,{style:{margin:"24px 0"},children:e.jsxs(ze,{children:[e.jsx(Ot,{}),n("resources:repositories.systemContainers")]})}),e.jsx(nt,{dataSource:u.system_containers,style:c.marginBottom.lg,"data-testid":"vault-status-containers-list",renderItem:t=>e.jsxs(tt,{size:"small",style:{marginBottom:12},"data-testid":`vault-status-container-${t.id}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs(ze,{children:[e.jsx(Ot,{style:{color:"#722ed1"}}),e.jsx(Bs,{strong:!0,"data-testid":`vault-status-container-name-${t.id}`,children:t.name})]}),e.jsx(Me,{color:"running"===t.state?"success":"default","data-testid":`vault-status-container-state-${t.id}`,children:t.state})]}),e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsx(Bs,{type:"secondary",style:{fontSize:12},ellipsis:!0,children:t.image}),t.cpu_percent&&e.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(Bs,{type:"secondary",children:"CPU:"}),e.jsx(Bs,{children:t.cpu_percent})]}),t.memory_usage&&e.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsxs(Bs,{type:"secondary",children:[n("resources:repositories.memory"),":"]}),e.jsx(Bs,{children:t.memory_usage})]})]})]})})]}),t&&e.jsx("div",{"data-testid":"vault-status-distributed-storage",children:e.jsx($s,{machine:t,onViewDetails:()=>{m({open:!0,entityType:"Machine",entityIdentifier:t.machineName,entityName:t.machineName})}})})]}):e.jsx(Ue,{description:n("machines:noVaultData"),style:{marginTop:48},"data-testid":"vault-status-empty"})})]}),e.jsx(lt,{open:d.open,onCancel:()=>m({open:!1,entityType:null,entityIdentifier:null}),entityType:d.entityType,entityIdentifier:d.entityIdentifier,entityName:d.entityName})]}):null},Es=({teamFilter:s,showActions:a=!0,className:n="",onEditMachine:o,onFunctionsMachine:c,onDeleteMachine:l,onCreateRepository:d,enabled:m=!0,onQueueItemCreated:u,expandedRowKeys:p,onExpandedRowsChange:y,refreshKeys:x,onRowClick:b,selectedMachine:N,onMachineRepositoryClick:w,onMachineContainerClick:k,onRefreshMachines:C})=>{const{t:S}=Ie(["machines","common","functions","resources"]),T=t(e=>e.ui.uiMode),I="expert"===T,{executePingForMachineAndWait:z}=bs(),_=Y(),M=i.useRef(null),[D,$]=i.useState("machine"),[V,E]=i.useState([]),[F,A]=i.useState({}),[O,P]=i.useState({}),[L,G]=i.useState(!1),[W,U]=i.useState(null),[q,K]=i.useState(null),[Q,H]=i.useState(!1),[ee,te]=i.useState([]),se=void 0!==p?p:V,ie=y||E,re=void 0!==x?x:O,[oe,ce]=i.useState({open:!1,entityType:null,entityIdentifier:null}),[de,me]=i.useState({open:!1,machine:null}),[ue,he]=i.useState({open:!1,machine:null}),[be,Ne]=i.useState(!1),[Ce,Se]=i.useState(!1),[Te,_e]=i.useState(!1),[De,$e]=i.useState(null),[Be,Fe]=i.useState(!1);r.useEffect(()=>()=>{W&&clearTimeout(W)},[W]);const{data:Ae=[],isLoading:Oe,refetch:Pe}=g(s,m),{data:Le=[]}=f(s),Ge=pt(M,{containerOffset:170,minRows:5,maxRows:50}),We=Ae,qe=e=>{try{if(!e.vaultStatus||e.vaultStatus.trim().startsWith("jq:")||e.vaultStatus.trim().startsWith("error:")||!e.vaultStatus.trim().startsWith("{"))return[];const t=JSON.parse(e.vaultStatus);if("completed"===t.status&&t.result){let e=t.result;if(e.match(/(\}[\s\n]*$)/)){const t=e.lastIndexOf("}");t<e.length-10&&(e=e.substring(0,t+1))}const s=e.indexOf("\njq:");s>0&&(e=e.substring(0,s)),e=e.trim();const a=JSON.parse(e);if(a?.repositories&&Array.isArray(a.repositories))return a.repositories.map(e=>{if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.name)){const t=Le.find(t=>t.repositoryGuid===e.name);if(t)return{...e,name:t.repositoryName,repositoryGuid:t.repositoryGuid,grandGuid:t.grandGuid}}return e})}}catch(t){}return[]},Ke=i.useCallback(e=>{l&&l(e)},[l]),Qe=i.useCallback(e=>{b?b(e):($e(e),Fe(!0))},[b]),He=i.useCallback(()=>{Fe(!1),$e(null)},[]),{getFunctionsByCategory:Je}=j(),Xe=i.useMemo(()=>Je("machine").filter(e=>e&&!1!==e.showInMenu&&"mount"!==e.name&&"pull"!==e.name),[Je]),Ye=r.useMemo(()=>{const t=[];return t.push({title:S("machines:machineName"),dataIndex:"machineName",key:"machineName",ellipsis:!0,sorter:(e,t)=>e.machineName.localeCompare(t.machineName),render:(t,s)=>{const a=se.includes(s.machineName);return e.jsxs(ze,{children:[e.jsx("span",{style:{display:"inline-block",width:12,transition:"transform 0.3s ease",transform:a?"rotate(90deg)":"rotate(0deg)"},"data-testid":`machine-expand-${s.machineName}`,children:e.jsx(we,{style:{fontSize:12,color:"#999"}})}),e.jsx(R,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})}}),b||t.push({title:S("machines:team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx(Me,{color:"#8FBC8F",children:t}),sorter:(e,t)=>e.teamName.localeCompare(t.teamName)}),b||(I?t.push({title:S("machines:region"),dataIndex:"regionName",key:"regionName",width:150,ellipsis:!0,render:t=>t?e.jsx(Me,{color:"purple",children:t}):"-",sorter:(e,t)=>(e.regionName||"").localeCompare(t.regionName||"")},{title:S("machines:bridge"),dataIndex:"bridgeName",key:"bridgeName",width:150,ellipsis:!0,render:t=>e.jsx(Me,{color:"green",children:t}),sorter:(e,t)=>e.bridgeName.localeCompare(t.bridgeName)}):"simple"!==T&&t.push({title:S("bridges.bridge"),dataIndex:"bridgeName",key:"bridgeName",width:150,ellipsis:!0,render:t=>e.jsx(Me,{color:"#8FBC8F",children:t})})),!b&&I&&t.push({title:S("machines:assignmentStatus.title"),key:"assignmentStatus",width:180,ellipsis:!0,render:(t,s)=>e.jsx(pe,{machine:s})}),b||t.push({title:S("machines:queueItems"),dataIndex:"queueCount",key:"queueCount",width:100,align:"center",sorter:(e,t)=>e.queueCount-t.queueCount,render:t=>e.jsx(st,{count:t,showZero:!0,style:{backgroundColor:t>0?"#52c41a":"#d9d9d9"}})}),a&&t.push({title:S("common:table.actions"),key:"actions",width:J.DIMENSIONS.CARD_WIDTH,render:(t,s)=>e.jsxs(ze,{children:[e.jsx(Ee,{title:S("common:actions.edit"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(B,{}),onClick:()=>o&&o(s),"data-testid":`machine-edit-${s.machineName}`,"aria-label":S("common:actions.edit")})}),e.jsx(ot,{"data-testid":`machine-dropdown-${s.machineName}`,menu:{items:[{key:"createRepo",label:S("machines:createRepo"),icon:e.jsx(le,{}),onClick:()=>d&&d(s),"data-testid":`machine-create-repo-${s.machineName}`},{key:"pull",label:S("functions:functions.pull.name"),icon:e.jsx(xs,{}),onClick:()=>{me({open:!0,machine:s})},"data-testid":`machine-pull-${s.machineName}`},{key:"functions",label:S("machines:runAction"),icon:e.jsx(ye,{}),"data-testid":`machine-functions-${s.machineName}`,children:[...Xe.map(t=>({key:`function-${t?.name||"unknown"}`,label:e.jsx("span",{title:t?.description||"",children:t?.name||"Unknown"}),onClick:()=>{c&&t?.name&&(c(s,t.name),void 0===x&&P(e=>({...e,[s.machineName]:Date.now()})))},"data-testid":`machine-function-${t?.name||"unknown"}-${s.machineName}`})),{type:"divider"},{key:"advanced",label:S("machines:advanced"),icon:e.jsx(ye,{}),onClick:()=>{c&&(c(s),void 0===x&&P(e=>({...e,[s.machineName]:Date.now()})))},"data-testid":`machine-advanced-${s.machineName}`}]},{key:"test",label:S("machines:connectivityTest"),icon:e.jsx(h,{}),onClick:async()=>{X("info",S("machines:testingConnection"));const e=await z(s,{priority:4,description:"Connectivity test",addedVia:"machine-table",timeout:15e3});e.success?X("success",S("machines:connectionSuccessful")):X("error",e.error||S("machines:connectionFailed"))},"data-testid":`machine-test-${s.machineName}`},...I?[{key:"assignCluster",label:s.distributedStorageClusterName?S("machines:changeClusterAssignment"):S("machines:assignToCluster"),icon:e.jsx(ht,{}),onClick:()=>{he({open:!0,machine:s})},"data-testid":`machine-assign-cluster-${s.machineName}`}]:[]]},trigger:["click"],children:e.jsx(Ee,{title:S("machines:remote"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(ye,{}),"data-testid":`machine-remote-${s.machineName}`,"aria-label":S("machines:remote")})})}),e.jsx(Ee,{title:S("machines:trace"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(ae,{}),onClick:()=>{ce({open:!0,entityType:"Machine",entityIdentifier:s.machineName,entityName:s.machineName})},"data-testid":`machine-trace-${s.machineName}`,"aria-label":S("machines:trace")})}),e.jsx(Ee,{title:S("common:actions.delete"),children:e.jsx(Re,{type:"primary",danger:!0,size:"small",icon:e.jsx(v,{}),onClick:()=>Ke(s),"data-testid":`machine-delete-${s.machineName}`,"aria-label":S("common:actions.delete")})}),e.jsx(xe,{machine:s.machineName,teamName:s.teamName})]})}),t},[I,T,a,S,Ke,o,c,d,z,Xe,se,x,P,he,ce,me]),Ze=I?{selectedRowKeys:ee,onChange:e=>{te(e)},getCheckboxProps:e=>({disabled:!1,"data-testid":`machine-checkbox-${e.machineName}`})}:void 0,et=i.useMemo(()=>{const e={};return"machine"===D||We.forEach(t=>{let s="";if("bridge"===D)s=t.bridgeName;else if("team"===D)s=t.teamName;else if("region"===D)s=t.regionName||"Unknown";else{if("repository"===D){const s=qe(t);if(0===s.length)return;return void s.forEach(s=>{const a=s.name;e[a]||(e[a]=[]),e[a].find(e=>e.machineName===t.machineName)||e[a].push(t)})}if("status"===D){const e=qe(t);if(0===e.length)s="No Repositories";else{const t=e.some(e=>!e.accessible),a=e.some(e=>e.mounted&&e.docker_running),i=e.some(e=>e.mounted&&!e.docker_running),r=e.some(e=>!e.mounted);s=t?"Inaccessible":a?"Active (Running)":i?"Ready (Stopped)":r?"Not Mounted":"Unknown Status"}}else if("grand"===D){const s=qe(t);if(0===s.length)return;return void s.forEach(s=>{let a="No Grand Repository";if(s.grandGuid){const e=Le.find(e=>e.repositoryGuid===s.grandGuid);e&&(a=e.repositoryName)}e[a]||(e[a]=[]),e[a].find(e=>e.machineName===t.machineName)||e[a].push(t)})}}s&&(e[s]||(e[s]=[]),e[s].push(t))}),e},[We,D,Le]);return e.jsxs("div",{className:n,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(ze,{wrap:!0,size:"small",children:[e.jsx(Ee,{title:S("machines:machine"),children:e.jsx(Re,{type:"machine"===D?"primary":"default",icon:e.jsx(R,{}),onClick:()=>$("machine"),style:_.touchTargetSmall,"data-testid":"machine-view-toggle-machine","aria-label":S("machines:machine")})}),e.jsx("div",{style:{width:1,height:24,backgroundColor:"var(--color-border)",margin:"0 8px"}}),e.jsx(Ee,{title:S("machines:groupByBridge"),children:e.jsx(Re,{type:"bridge"===D?"primary":"default",icon:e.jsx(ht,{}),onClick:()=>$("bridge"),style:_.touchTargetSmall,"data-testid":"machine-view-toggle-bridge","aria-label":S("machines:groupByBridge")})}),e.jsx(Ee,{title:S("machines:groupByTeam"),children:e.jsx(Re,{type:"team"===D?"primary":"default",icon:e.jsx(ut,{}),onClick:()=>$("team"),style:_.touchTargetSmall,"data-testid":"machine-view-toggle-team","aria-label":S("machines:groupByTeam")})}),I&&e.jsx(Ee,{title:S("machines:groupByRegion"),children:e.jsx(Re,{type:"region"===D?"primary":"default",icon:e.jsx(ne,{}),onClick:()=>$("region"),style:_.touchTargetSmall,"data-testid":"machine-view-toggle-region","aria-label":S("machines:groupByRegion")})}),e.jsx(Ee,{title:S("machines:groupByRepository"),children:e.jsx(Re,{type:"repository"===D?"primary":"default",icon:e.jsx(le,{}),onClick:()=>$("repository"),style:_.touchTargetSmall,"data-testid":"machine-view-toggle-repository","aria-label":S("machines:groupByRepository")})}),e.jsx(Ee,{title:S("machines:groupByStatus"),children:e.jsx(Re,{type:"status"===D?"primary":"default",icon:e.jsx(ke,{}),onClick:()=>$("status"),style:_.touchTargetSmall,"data-testid":"machine-view-toggle-status","aria-label":S("machines:groupByStatus")})}),e.jsx(Ee,{title:S("machines:groupByGrand"),children:e.jsx(Re,{type:"grand"===D?"primary":"default",icon:e.jsx(Jt,{}),onClick:()=>$("grand"),style:_.touchTargetSmall,"data-testid":"machine-view-toggle-grand","aria-label":S("machines:groupByGrand")})})]})}),I&&0!==ee.length?e.jsxs("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#f0f2f5",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(ze,{children:[e.jsx("span",{style:{fontWeight:500},children:S("machines:bulkActions.selected",{count:ee.length})}),e.jsx(Ee,{title:S("common:actions.clearSelection"),children:e.jsx(Re,{size:"small",onClick:()=>te([]),"data-testid":"machine-bulk-clear-selection","aria-label":S("common:actions.clearSelection")})})]}),e.jsxs(ze,{children:[e.jsx(Ee,{title:S("machines:bulkActions.assignToCluster"),children:e.jsx(Re,{type:"primary",icon:e.jsx(ht,{}),onClick:()=>Ne(!0),"data-testid":"machine-bulk-assign-cluster","aria-label":S("machines:bulkActions.assignToCluster")})}),e.jsx(Ee,{title:S("machines:bulkActions.removeFromCluster"),children:e.jsx(Re,{icon:e.jsx(ht,{}),onClick:()=>Se(!0),"data-testid":"machine-bulk-remove-cluster","aria-label":S("machines:bulkActions.removeFromCluster")})}),e.jsx(Ee,{title:S("machines:bulkActions.viewAssignmentStatus"),children:e.jsx(Re,{icon:e.jsx(Z,{}),onClick:()=>_e(!0),"data-testid":"machine-bulk-view-status","aria-label":S("machines:bulkActions.viewAssignmentStatus")})})]})]}):null,"machine"===D?e.jsx("div",{ref:M,style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(Ve,{columns:Ye,dataSource:We,rowKey:"machineName",loading:Oe,scroll:{x:!0,y:"calc(100vh - 400px)"},rowSelection:Ze,rowClassName:e=>N?.machineName===e.machineName?"ant-table-row-selected":"","data-testid":"machine-table",pagination:{pageSize:Ge,showSizeChanger:!1,showTotal:(e,t)=>S("common:table.showingRecords",{start:t[0],end:t[1],total:e})},onRow:e=>({"data-testid":`machine-row-${e.machineName}`,onClick:t=>{const s=t.target;if(s.closest("button")||s.closest(".ant-dropdown-trigger"))return;if(se.includes(e.machineName))ie(se.filter(t=>t!==e.machineName));else if(ie([...se,e.machineName]),A(t=>({...t,[e.machineName]:Date.now()})),C){K(e.machineName),H(!0);const t=setTimeout(()=>{G(!0)},1e3);U(t),C().finally(()=>{W&&clearTimeout(W),H(!1),G(!1),K(null),U(null)})}b&&Qe(e)},style:{cursor:"pointer",transition:"background-color 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.02)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=""}}),expandable:{expandedRowRender:t=>e.jsx(ge,{machine:t,refreshKey:re[t.machineName],onActionComplete:()=>{void 0===x&&P(e=>({...e,[t.machineName]:Date.now()}))},onRepositoryClick:e=>w?.(t,e),onContainerClick:e=>k?.(t,e),onCreateRepository:d,isLoading:L&&q===t.machineName,onRefreshMachines:C,onQueueItemCreated:u},`${t.machineName}-${F[t.machineName]||0}-${re[t.machineName]||0}`),rowExpandable:()=>!0,expandedRowKeys:se,onExpandedRowsChange:e=>{const t=e;ie(t);const s={...F};t.forEach(e=>{se.includes(e)||(s[e]=Date.now())}),A(s)},expandIcon:()=>null,expandRowByClick:!1},sticky:!0})}):(()=>{const t=()=>{switch(D){case"machine":case"repository":return"#556b2f";case"bridge":return"green";case"team":return"#8FBC8F";case"region":return"purple";case"status":return"geekblue";case"grand":return"blue";default:return"default"}};if(0===Object.keys(et).length)return e.jsx(Ue,{image:Ue.PRESENTED_IMAGE_SIMPLE,description:S("resources:repositories.noRepositories"),style:{marginTop:48}});const s=e=>e%2==0?"rgba(0, 0, 0, 0.02)":"transparent",a=e=>e%2==0?"rgba(0, 0, 0, 0.08)":"#f0f0f0",i=e=>e%2==0?"#595959":"transparent";return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:32},children:Object.entries(et).map(([r,n],o)=>e.jsx(tt,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0"},children:[o%2==0&&e.jsx("div",{style:{width:4,height:J.DIMENSIONS.ICON_XL,backgroundColor:i(o),borderRadius:2}}),e.jsxs(ze,{children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:"bold",color:"#333",marginRight:8},children:["#",o+1]}),e.jsx(Me,{color:t(),style:{fontSize:"16px",padding:"4px 16px",fontWeight:500},icon:"bridge"===D?e.jsx(ht,{}):"team"===D?e.jsx(ut,{}):"region"===D?e.jsx(ne,{}):"repository"===D?e.jsx(le,{}):"status"===D?e.jsx(ke,{}):"grand"===D?e.jsx(Jt,{}):null,children:r}),e.jsxs("span",{style:{fontSize:"14px",color:"#666"},children:[n.length," ",1===n.length?S("machines:machine"):S("machines:machines")]})]})]}),styles:{body:{padding:0,backgroundColor:s(o)}},style:{borderColor:a(o),borderWidth:2,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},headStyle:{backgroundColor:s(o),borderBottom:`2px solid ${a(o)}`},children:n.map((t,s)=>e.jsx("div",{style:{borderBottom:s<n.length-1?`1px solid ${a(o)}`:"none",backgroundColor:s%2==0?"transparent":"rgba(0, 0, 0, 0.01)"},children:e.jsx(ge,{machine:t,refreshKey:re[t.machineName],onActionComplete:()=>{void 0===x&&P(e=>({...e,[t.machineName]:Date.now()}))},onRepositoryClick:e=>w?.(t,e),onContainerClick:e=>k?.(t,e),onCreateRepository:d,hideSystemInfo:!0,isLoading:L&&q===t.machineName,onRefreshMachines:C,onQueueItemCreated:u},`${t.machineName}-${F[t.machineName]||0}-${re[t.machineName]||0}`)},t.machineName))},r))})})(),e.jsx(lt,{open:oe.open,onCancel:()=>ce({open:!1,entityType:null,entityIdentifier:null}),entityType:oe.entityType,entityIdentifier:oe.entityIdentifier,entityName:oe.entityName}),de.machine&&e.jsx(zs,{open:de.open,onCancel:()=>me({open:!1,machine:null}),machineName:de.machine.machineName,teamName:de.machine.teamName,bridgeName:de.machine.bridgeName,onQueueItemCreated:u}),ue.machine&&e.jsx(fe,{open:ue.open,machine:ue.machine,onCancel:()=>he({open:!1,machine:null}),onSuccess:()=>{he({open:!1,machine:null}),Pe()}}),e.jsx(fe,{open:be,machines:Ae.filter(e=>ee.includes(e.machineName)),onCancel:()=>Ne(!1),onSuccess:()=>{Ne(!1),te([]),Pe()}}),e.jsx(je,{open:Ce,machines:Ae.filter(e=>ee.includes(e.machineName)),onCancel:()=>Se(!1),onSuccess:()=>{Se(!1),te([]),Pe()}}),e.jsx(ve,{open:Te,machines:Ae.filter(e=>ee.includes(e.machineName)),onCancel:()=>_e(!1)}),!b&&e.jsx(Rs,{machine:De,visible:Be,onClose:He})]})},{Text:Fs,Title:As}=_e,Os=({repository:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=Ie(["resources","common","machines"]),{theme:o}=G(),{data:c=[]}=g(t?.teamName),d=Y(),m=i.useMemo(()=>{if(!t||!c.length)return null;for(const s of c)if(s.vaultStatus)try{if(s.vaultStatus.trim().startsWith("jq:")||s.vaultStatus.trim().startsWith("error:")||!s.vaultStatus.trim().startsWith("{"))continue;const e=JSON.parse(s.vaultStatus);if("completed"===e.status&&e.result){let a=e.result;if(a.match(/(\}[\s\n]*$)/)){const e=a.lastIndexOf("}");e<a.length-10&&(a=a.substring(0,e+1))}const i=a.indexOf("\njq:");i>0&&(a=a.substring(0,i)),a=a.trim();const r=JSON.parse(a);if(r.repositories&&Array.isArray(r.repositories)){const e=r.repositories.find(e=>e.name===t.repositoryName||e.name===t.repositoryGuid);if(e){const a=[];return r.services&&Array.isArray(r.services)&&r.services.forEach(s=>{if(s.repository===e.name||s.repository===t.repositoryGuid)a.push(s);else if(s.service_name||s.unit_file){const i=(s.service_name||s.unit_file||"").match(/rediacc_([0-9a-f-]{36})_/);!i||i[1]!==t.repositoryGuid&&i[1]!==e.name||a.push(s)}}),{machine:s,repositoryData:e,systemData:r.system,services:a}}}}}catch(e){}return null},[t,c]);return i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,a]),t&&s?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"repository-detail-panel","data-testid":"repo-detail-panel",style:r?{height:"100%",backgroundColor:"dark"===o?"#141414":"#fff",overflowY:"auto",overflowX:"hidden"}:{position:"fixed",top:0,right:s?0:"-520px",bottom:0,width:"520px",maxWidth:"100vw",backgroundColor:"dark"===o?"#141414":"#fff",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,transition:"right 0.3s ease-in-out",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),position:"sticky",top:0,backgroundColor:"dark"===o?"#141414":"#fff",zIndex:r?0:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(ze,{children:[e.jsx(_t,{style:{fontSize:24,color:"#8FBC8F"}}),e.jsx(As,{level:4,style:{margin:0},"data-testid":`repo-detail-title-${t.repositoryName}`,children:t.repositoryName})]}),e.jsx(Re,{type:"text",icon:e.jsx(ie,{}),onClick:a,style:d.touchTarget,"data-testid":"repo-detail-close"})]}),e.jsxs(ze,{wrap:!0,style:{marginTop:8},children:[e.jsxs(Me,{color:"#8FBC8F",icon:e.jsx(re,{}),"data-testid":`repo-detail-team-tag-${t.repositoryName}`,children:["Team: ",t.teamName]}),m&&e.jsxs(Me,{color:"green",icon:e.jsx(ht,{}),"data-testid":`repo-detail-machine-tag-${t.repositoryName}`,children:["Machine: ",m.machine.machineName]}),e.jsxs(Me,{color:"blue","data-testid":`repo-detail-vault-version-tag-${t.repositoryName}`,children:[n("resources:repositories.vaultVersion"),": ",t.vaultVersion]})]})]}),e.jsx("div",{style:{padding:"24px"},"data-testid":"repo-detail-content",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},"data-testid":"repo-detail-info-section",children:[e.jsx(_t,{style:{fontSize:20,color:"#8FBC8F"}}),e.jsx(As,{level:5,style:{margin:0},children:n("resources:repositories.repositoryInfo")})]}),e.jsx(at,{gutter:[16,16],style:d.marginBottom.lg,children:e.jsx(it,{span:24,children:e.jsx(tt,{size:"small",style:d.card,"data-testid":"repo-detail-info-card",children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Fs,{type:"secondary",children:[n("resources:repositories.repositoryGuid"),":"]}),e.jsx(Fs,{copyable:!0,style:{fontSize:11,fontFamily:"monospace"},"data-testid":`repo-detail-guid-${t.repositoryName}`,children:t.repositoryGuid})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Fs,{type:"secondary",children:[n("resources:repositories.status"),":"]}),e.jsxs(ze,{children:[m.repositoryData.mounted?e.jsx(Me,{color:"success",icon:e.jsx(W,{}),"data-testid":`repo-detail-status-mounted-${t.repositoryName}`,children:n("resources:repositories.mounted")}):e.jsx(Me,{color:"default",icon:e.jsx(dt,{}),"data-testid":`repo-detail-status-unmounted-${t.repositoryName}`,children:n("resources:repositories.notMounted")}),m.repositoryData.accessible&&e.jsx(Me,{color:"green","data-testid":`repo-detail-status-accessible-${t.repositoryName}`,children:n("resources:repositories.accessible")})]})]}),m.repositoryData.has_rediaccfile&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Fs,{type:"secondary",children:[n("resources:repositories.rediaccfile"),":"]}),e.jsx(Me,{color:"purple","data-testid":`repo-detail-rediaccfile-${t.repositoryName}`,children:n("resources:repositories.hasRediaccfile")})]}),m.repositoryData.docker_running&&m.repositoryData.volume_status&&"none"!==m.repositoryData.volume_status&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Fs,{type:"secondary",children:"Docker Volumes:"}),"safe"===m.repositoryData.volume_status?e.jsxs(Me,{color:"success",icon:e.jsx(W,{}),"data-testid":`repo-detail-volume-safe-${t.repositoryName}`,children:[m.repositoryData.internal_volumes," Safe Volume",1!==m.repositoryData.internal_volumes?"s":""]}):"warning"===m.repositoryData.volume_status?e.jsxs(Me,{color:"warning",icon:e.jsx(oe,{}),"data-testid":`repo-detail-volume-warning-${t.repositoryName}`,children:[m.repositoryData.external_volumes," External, ",m.repositoryData.internal_volumes," Internal"]}):null]})]})})})}),"warning"===m.repositoryData.volume_status&&m.repositoryData.external_volume_names&&m.repositoryData.external_volume_names.length>0&&e.jsx(Be,{type:"warning",showIcon:!0,icon:e.jsx(oe,{}),message:"External Docker Volumes Detected",description:e.jsxs("div",{children:[e.jsx(Fs,{children:"The following volumes are stored outside the repository:"}),e.jsx("ul",{style:{marginTop:8,marginBottom:8},children:m.repositoryData.external_volume_names.map(t=>e.jsx("li",{children:e.jsx(Fs,{code:!0,children:t})},t))}),e.jsxs(Fs,{type:"secondary",children:[e.jsx("strong",{children:"Warning:"})," If this repository is cloned, these volumes will be orphaned. Consider using bind mounts to ",e.jsx(Fs,{code:!0,children:"$REPO_PATH"})," instead."]})]}),style:{marginBottom:16},"data-testid":`repo-detail-volume-warning-alert-${t.repositoryName}`}),e.jsx(et,{style:{margin:"24px 0"},"data-testid":"repo-detail-storage-divider",children:e.jsxs(ze,{children:[e.jsx(Z,{}),n("resources:repositories.storageInfo")]})}),e.jsxs(at,{gutter:[16,16],style:d.marginBottom.lg,children:[e.jsx(it,{span:12,children:e.jsx(tt,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-image-size-card-${t.repositoryName}`,children:e.jsx(rt,{title:n("resources:repositories.imageSize"),value:m.repositoryData.size_human,prefix:e.jsx(se,{}),valueStyle:{fontSize:16}})})}),e.jsx(it,{span:12,children:e.jsx(tt,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-last-modified-card-${t.repositoryName}`,children:e.jsx(rt,{title:n("resources:repositories.lastModified"),value:m.repositoryData.modified_human,prefix:e.jsx(U,{}),valueStyle:{fontSize:16}})})}),m.repositoryData.mounted&&m.repositoryData.disk_space&&e.jsx(it,{span:24,children:e.jsxs(tt,{size:"small","data-testid":`repo-detail-disk-usage-card-${t.repositoryName}`,children:[e.jsx("div",{style:{marginBottom:12},children:e.jsxs(ze,{children:[e.jsx(ft,{style:{color:"#52c41a"}}),e.jsx(Fs,{strong:!0,children:n("resources:repositories.diskUsage")})]})}),e.jsx("div",{style:{marginBottom:8},children:e.jsxs(Fs,{children:[m.repositoryData.disk_space.used," / ",m.repositoryData.disk_space.total]})}),e.jsx($e,{percent:parseInt(m.repositoryData.disk_space.use_percent),status:parseInt(m.repositoryData.disk_space.use_percent)>90?"exception":"normal",strokeColor:parseInt(m.repositoryData.disk_space.use_percent)>90?"#ff4d4f":"#52c41a",trailColor:"dark"===o?"rgba(255,255,255,0.08)":void 0,"data-testid":`repo-detail-disk-usage-progress-${t.repositoryName}`}),e.jsxs(Fs,{type:"secondary",style:{fontSize:12},children:[n("resources:repositories.available"),": ",m.repositoryData.disk_space.available]})]})})]}),e.jsx(et,{style:{margin:"24px 0"},"data-testid":"repo-detail-file-paths-divider",children:e.jsxs(ze,{children:[e.jsx(_t,{}),n("resources:repositories.filePaths")]})}),e.jsx(tt,{size:"small",style:d.card,"data-testid":`repo-detail-file-paths-card-${t.repositoryName}`,children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{children:[e.jsxs(Fs,{type:"secondary",children:[n("resources:repositories.imagePath"),":"]}),e.jsx(Fs,{copyable:!0,style:{display:"block",fontSize:12,wordBreak:"break-all",marginTop:4},"data-testid":`repo-detail-image-path-${t.repositoryName}`,children:m.repositoryData.image_path})]}),m.repositoryData.mount_path&&e.jsxs("div",{children:[e.jsxs(Fs,{type:"secondary",children:[n("resources:repositories.mountPath"),":"]}),e.jsx(Fs,{copyable:!0,style:{display:"block",fontSize:12,wordBreak:"break-all",marginTop:4},"data-testid":`repo-detail-mount-path-${t.repositoryName}`,children:m.repositoryData.mount_path})]})]})}),m.repositoryData.mounted&&e.jsxs(e.Fragment,{children:[e.jsx(et,{style:{margin:"24px 0"},"data-testid":"repo-detail-activity-divider",children:e.jsxs(ze,{children:[e.jsx(vt,{}),n("resources:repositories.activity")]})}),e.jsxs(at,{gutter:[16,16],style:d.marginBottom.lg,children:[m.repositoryData.docker_running&&e.jsx(it,{span:12,children:e.jsx(tt,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-containers-card-${t.repositoryName}`,children:e.jsx(rt,{title:n("resources:repositories.containers"),value:m.repositoryData.container_count,valueStyle:{color:"#1890ff"}})})}),m.repositoryData.has_services&&e.jsx(it,{span:12,children:e.jsx(tt,{size:"small",style:{height:"100%"},"data-testid":`repo-detail-services-card-${t.repositoryName}`,children:e.jsx(rt,{title:n("resources:repositories.services"),value:m.repositoryData.service_count,valueStyle:{color:"#fa8c16"}})})})]})]}),m.services&&m.services.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(et,{style:{margin:"24px 0"},"data-testid":"repo-detail-services-divider",children:e.jsxs(ze,{children:[e.jsx(l,{}),n("resources:repositories.servicesSection")]})}),e.jsx(ze,{direction:"vertical",style:{width:"100%"},size:"middle","data-testid":"repo-detail-services-list",children:m.services.map((s,a)=>e.jsx(tt,{size:"small","data-testid":`repo-detail-service-card-${t.repositoryName}-${s.name}`,style:{borderLeft:"4px solid "+("active"===s.active_state?"#52c41a":"failed"===s.active_state?"#ff4d4f":"#d9d9d9")},children:e.jsxs(at,{gutter:[16,8],children:[e.jsx(it,{span:24,children:e.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(Fs,{strong:!0,"data-testid":`repo-detail-service-name-${t.repositoryName}-${s.name}`,children:s.name}),e.jsx(Me,{"data-testid":`repo-detail-service-status-${t.repositoryName}-${s.name}`,color:"active"===s.active_state?"success":"failed"===s.active_state?"error":"default",children:s.active_state})]})}),(s.memory_human||s.main_pid||s.uptime_human)&&e.jsx(it,{span:24,children:e.jsxs(ze,{wrap:!0,size:"middle",children:[s.memory_human&&e.jsxs("div",{children:[e.jsx(Fs,{type:"secondary",style:{fontSize:11},children:"Memory"}),e.jsx("br",{}),e.jsx(Fs,{style:{fontSize:12},children:s.memory_human})]}),s.main_pid&&e.jsxs("div",{children:[e.jsx(Fs,{type:"secondary",style:{fontSize:11},children:"PID"}),e.jsx("br",{}),e.jsx(Fs,{style:{fontSize:12},children:s.main_pid})]}),s.uptime_human&&e.jsxs("div",{children:[e.jsx(Fs,{type:"secondary",style:{fontSize:11},children:"Uptime"}),e.jsx("br",{}),e.jsx(Fs,{style:{fontSize:12},children:s.uptime_human})]}),void 0!==s.restarts&&e.jsxs("div",{children:[e.jsx(Fs,{type:"secondary",style:{fontSize:11},children:"Restarts"}),e.jsx("br",{}),e.jsx(Fs,{style:{fontSize:12},children:s.restarts})]})]})})]})},`${s.name}-${a}`))})]})]}):e.jsx(Ue,{description:n("resources:repositories.noRepositoryData"),style:{marginTop:48},"data-testid":"repo-detail-empty-state"})})]})}):null},{Text:Ps,Title:Ls}=_e,Gs=({container:t,visible:s,onClose:a,splitView:r=!1})=>{const{t:n}=Ie(["resources","common"]),{theme:o}=G(),c=Y();i.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&a()};if(s)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,a]);const d=i.useMemo(()=>{if(!t)return null;const e=parseFloat(t.cpu_percent?.replace("%","")||"0"),s=t.memory_usage?.split(" / ")||[],a=s[0]||"0",i=s[1]||"0",r=parseFloat(t.memory_percent?.replace("%","")||"0"),n=t.net_io?.split(" / ")||[],o=n[0]||"0",c=n[1]||"0",l=t.block_io?.split(" / ")||[];return{cpu:e,memoryUsed:a,memoryTotal:i,memoryPercent:r,netIn:o,netOut:c,blockRead:l[0]||"0",blockWrite:l[1]||"0",pids:parseInt(t.pids||"0")}},[t]),m=t?.name?.startsWith("plugin-"),u=m&&t?t.name.replace("plugin-",""):null;return s&&t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:r?"16px 24px":"16px 24px 0",borderBottom:"1px solid "+("dark"===o?"#303030":"#f0f0f0"),display:"flex",justifyContent:"space-between",alignItems:"center"},"data-testid":"container-detail-header",children:[e.jsx(Ls,{level:4,style:{margin:0},"data-testid":"container-detail-title",children:n(m?"resources:containers.pluginDetails":"resources:containers.containerDetails")}),!r&&e.jsx(Re,{type:"text",icon:e.jsx(ie,{}),onClick:a,style:{...c.touchTarget,marginRight:-8},"data-testid":"container-detail-close"})]}),e.jsxs("div",{style:{padding:"24px",height:r?"calc(100% - 57px)":void 0,overflow:"auto"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(ze,{size:"small",style:{marginBottom:8},children:[e.jsx(Me,{color:m?"blue":"cyan",icon:m?e.jsx(mt,{}):e.jsx(re,{}),"data-testid":"container-detail-name-tag",children:m?`Plugin: ${u}`:t.name}),e.jsx(Me,{color:"running"===t.state?"success":"default",icon:"running"===t.state?e.jsx(Ce,{}):e.jsx(be,{}),"data-testid":"container-detail-state-tag",children:t.state})]})}),t&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:"small",style:{...c.card,marginBottom:16},"data-testid":"container-detail-basic-info",children:e.jsx(at,{gutter:[16,16],style:c.marginBottom.lg,children:e.jsx(it,{span:24,children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.containerID"),":"]}),e.jsx("br",{}),e.jsx(Ps,{copyable:!0,style:{fontFamily:"monospace",fontSize:12},"data-testid":"container-detail-id",children:t.id})]}),e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.image"),":"]}),e.jsx("br",{}),e.jsx(Ps,{style:{fontSize:12,wordBreak:"break-all"},"data-testid":"container-detail-image",children:t.image})]}),e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.status"),":"]}),e.jsx("br",{}),e.jsx(Ps,{style:{fontSize:12},"data-testid":"container-detail-status",children:t.status})]}),e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.created"),":"]}),e.jsx("br",{}),e.jsx(Ps,{style:{fontSize:12},"data-testid":"container-detail-created",children:t.created})]})]})})})}),e.jsx(et,{style:{margin:"24px 0"},children:e.jsxs(ze,{children:[e.jsx(ht,{}),n("resources:containers.resourceUsage")]})}),e.jsxs(at,{gutter:[16,16],style:c.marginBottom.lg,children:[e.jsx(it,{xs:24,sm:12,children:e.jsxs(tt,{size:"small","data-testid":"container-detail-cpu-card",children:[e.jsx(rt,{title:n("resources:containers.cpuUsage"),value:d?.cpu||0,suffix:"%",valueStyle:{color:d?.cpu&&d.cpu>80?"#ff4d4f":void 0}}),e.jsx($e,{percent:d?.cpu||0,showInfo:!1,status:d?.cpu&&d.cpu>80?"exception":"normal"})]})}),e.jsx(it,{xs:24,sm:12,children:e.jsxs(tt,{size:"small","data-testid":"container-detail-memory-card",children:[e.jsx(rt,{title:n("resources:containers.memoryUsage"),value:`${d?.memoryUsed} / ${d?.memoryTotal}`,valueStyle:{fontSize:16}}),e.jsx($e,{percent:d?.memoryPercent||0,status:d?.memoryPercent&&d.memoryPercent>90?"exception":"normal"})]})}),e.jsx(it,{xs:24,sm:12,children:e.jsx(tt,{size:"small","data-testid":"container-detail-network-card",children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.networkIO"),":"]})}),e.jsx("div",{children:e.jsxs(Ps,{style:{fontSize:12},children:[e.jsx(h,{style:{marginRight:4}}),"↓ ",d?.netIn," / ↑ ",d?.netOut]})})]})})}),e.jsx(it,{xs:24,sm:12,children:e.jsx(tt,{size:"small","data-testid":"container-detail-block-io-card",children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.blockIO"),":"]})}),e.jsx("div",{children:e.jsxs(Ps,{style:{fontSize:12},children:[e.jsx(se,{style:{marginRight:4}}),"R: ",d?.blockRead," / W: ",d?.blockWrite]})})]})})})]}),e.jsx(et,{style:{margin:"24px 0"},children:e.jsxs(ze,{children:[e.jsx(l,{}),n("resources:containers.configuration")]})}),e.jsx(tt,{size:"small",style:{...c.card,marginBottom:16},"data-testid":"container-detail-configuration",children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.command"),":"]}),e.jsx("br",{}),e.jsx(Ps,{code:!0,style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-command",children:t.command})]}),(t.port_mappings&&t.port_mappings.length>0||t.ports)&&e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.ports"),":"]}),e.jsx("br",{}),t.port_mappings&&t.port_mappings.length>0?e.jsx(ze,{direction:"vertical",size:"small",style:{marginTop:4},children:t.port_mappings.map((t,s)=>e.jsx(Me,{color:"blue","data-testid":`container-detail-port-${s}`,children:t.host_port?`${t.host||"0.0.0.0"}:${t.host_port} → ${t.container_port}/${t.protocol}`:`${t.container_port}/${t.protocol}`},s))}):t.ports?e.jsx(Ps,{style:{fontSize:12},"data-testid":"container-detail-ports-text",children:t.ports}):null]}),e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.networks"),":"]}),e.jsx("br",{}),e.jsx(Me,{color:"purple","data-testid":"container-detail-network-tag",children:t.networks})]}),e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.size"),":"]}),e.jsx("br",{}),e.jsx(Ps,{style:{fontSize:12},"data-testid":"container-detail-size",children:t.size})]}),e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.processes"),":"]}),e.jsx("br",{}),e.jsxs(Me,{"data-testid":"container-detail-pids",children:[d?.pids||0," ",n("resources:containers.pids")]})]})]})}),e.jsx(et,{style:{margin:"24px 0"},children:e.jsxs(ze,{children:[e.jsx(_t,{}),n("resources:containers.environment")]})}),e.jsx(tt,{size:"small",style:c.card,"data-testid":"container-detail-environment",children:e.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.mounts"),":"]}),e.jsx("br",{}),e.jsx(Ps,{style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-mounts",children:t.mounts})]}),t.labels&&e.jsxs("div",{children:[e.jsxs(Ps,{type:"secondary",children:[n("resources:containers.labels"),":"]}),e.jsx("br",{}),e.jsx(Ps,{style:{fontSize:11,wordBreak:"break-all"},"data-testid":"container-detail-labels",children:t.labels})]})]})})]})]})]}):null},Ws=({type:t,data:s,visible:a,onClose:r,splitWidth:n,onSplitWidthChange:o})=>{const{theme:c}=G(),l=i.useRef(!1),d=i.useRef(0),m=i.useRef(0),[u,h]=i.useState(1),[p,y]=i.useState(s),[x,g]=i.useState(!1),f=i.useRef(s);i.useEffect(()=>{if(!s||!f.current)return y(s),h(1),void(f.current=s);("machineName"in f.current?f.current.machineName:"repositoryName"in f.current?f.current.repositoryName:"id"in f.current?f.current.id:null)!==("machineName"in s?s.machineName:"repositoryName"in s?s.repositoryName:"id"in s?s.id:null)?(y(s),h(1),g(!1),f.current=s):(y(s),f.current=s)},[s]);if(i.useEffect(()=>{const e=e=>{if(!l.current)return;const t=d.current-e.clientX,s=window.innerWidth,a=Math.min(800,s-400),i=Math.max(300,Math.min(a,m.current+t));o(i)},t=()=>{l.current&&(l.current=!1,document.body.style.cursor="",document.body.style.userSelect="")};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[n,o]),!a||!p)return null;const j=t||(p&&"machineName"in p?"machine":p&&"repositoryName"in p?"repository":"container");return e.jsxs("div",{style:{position:"relative",width:n,height:"100%",borderLeft:"1px solid "+("dark"===c?"#303030":"#f0f0f0"),display:"flex",flexShrink:0,opacity:u,transition:"opacity 0.3s ease"},"data-testid":"unified-detail-panel",children:[e.jsx("div",{style:{position:"absolute",left:-3,top:0,bottom:0,width:6,cursor:"ew-resize",zIndex:10,backgroundColor:"transparent"},onMouseDown:e=>{l.current=!0,d.current=e.clientX,m.current=n,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",e.preventDefault()},"data-testid":"unified-detail-resize-handle",children:e.jsx("div",{style:{position:"absolute",left:2,top:0,bottom:0,width:2,backgroundColor:"dark"===c?"#303030":"#f0f0f0",transition:"background-color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="dark"===c?"#303030":"#f0f0f0"}})}),e.jsx("div",{style:{flex:1,overflow:"hidden"},"data-testid":"unified-detail-content",children:"machine"===j?e.jsx(Rs,{machine:p,visible:a,onClose:r,splitView:!0}):"repository"===j?e.jsx(Os,{repository:p,visible:a,onClose:r,splitView:!0}):e.jsx(Gs,{container:p,visible:a,onClose:r,splitView:!0})})]})},Us=t=>{const{type:s,selectedResource:a,onResourceSelect:r,onMachineRepositoryClick:n,onMachineContainerClick:o}=t,c=()=>{const e=window.innerWidth,t=Math.floor(.25*e);return Math.max(300,Math.min(600,t))},[l,d]=i.useState(c);i.useEffect(()=>{const e=()=>{d(c())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const m=e=>{r(e)},u=()=>{r(null)};return"machine"===s?e.jsxs("div",{style:{display:"flex",height:"100%",width:"100%",position:"relative",overflow:"hidden"},"data-testid":"split-resource-view-container",children:[e.jsx("div",{style:{width:a?`calc(100% - ${l}px)`:"100%",height:"100%",overflow:"auto",minWidth:300,transition:"width 0.3s ease-in-out"},"data-testid":"split-resource-view-left-panel",children:e.jsx(Es,{...t,onRowClick:m,selectedMachine:a,onMachineRepositoryClick:n,onMachineContainerClick:o})}),a&&e.jsx(Ws,{type:"machineName"in a?"machine":"repositoryName"in a?"repository":"container",data:a,visible:!0,onClose:u,splitWidth:l,onSplitWidthChange:d})]}):null},{Title:qs}=_e,Ks=()=>{const{t:s}=Ie(["resources","machines","common"]),a=n(),o=t(e=>e.ui.uiMode),l=Y(),[x,j]=i.useState([]),[V,F]=i.useState("machines"),[A,O]=i.useState(null),[P,G]=i.useState(null),[W,U]=i.useState(null),[q,K]=i.useState({open:!1,resourceType:"machine",mode:"create"}),Q=i.useRef(null),H=i.useRef(null),Z=()=>{switch(V){case"machines":return s("machines.createMachine");case"repositories":return s("repositories.createRepository");case"storage":return s("storage.createStorage");default:return s("general.create")}},[ee,te]=i.useState(null),[se,ie]=i.useState([]),[re,ne]=i.useState({}),oe=e=>{O(e),e&&G(null)},ue=b(),he=N(),pe=w(),xe=k(),ge=C(),fe=async(e,t)=>{const a=t[`${e}Name`],i={machine:xe,repository:Ae,storage:Qe},r=t=>{if("machine"===e)return`machines:${t}`;return`resources:${"repository"===e?"repositories":`${e}s`}.${t}`};De.confirm({title:s(r("machine"===e?"confirmDelete":`delete${e.charAt(0).toUpperCase()+e.slice(1)}`)),content:s(r("machine"===e?"deleteWarning":"confirmDelete"),{name:a,[`${e}Name`]:a}),okText:s("common:actions.delete"),okType:"danger",cancelText:s("common:actions.cancel"),onOk:async()=>{try{const n=i[e];"machine"===e?(await n.mutateAsync({teamName:t.teamName,machineName:a}),Ce()):"repository"===e?(await n.mutateAsync({teamName:t.teamName,repositoryName:a}),$e()):"storage"===e&&(await n.mutateAsync({teamName:t.teamName,storageName:a}),We()),X("success",s(r("deleteSuccess")))}catch(n){X("error",s(r("deleteError")))}}})},{data:je}=c(),{data:ve,isLoading:be}=u(),we=ve||[],{data:ke=[],refetch:Ce}=g(x.length>0&&("machines"===V||"repositories"===V)?x:void 0,"machines"===V||"repositories"===V),{data:Te=[],isLoading:_e,refetch:$e}=f(x.length>0?x:void 0),Be=S(),Fe=T(),Ae=I(),Pe=z(),{data:Le=[],isLoading:Ge,refetch:We}=y(x.length>0&&"storage"===V?x:void 0),qe=p(),Ke=_(),Qe=M(),He=D(),Je=me(),{buildQueueVault:Xe}=m(),[Ye,Ze]=i.useState({visible:!1,taskId:null,machineName:null}),[et,st]=i.useState(!1),[rt,nt]=i.useState({open:!1,entityType:null,entityIdentifier:null}),[ot,dt]=i.useState(!1),mt=pt(Q,{containerOffset:220,minRows:5,maxRows:50,rowHeight:55}),ut=pt(H,{containerOffset:220,minRows:5,maxRows:50,rowHeight:55}),ht=i.useRef(!1);r.useEffect(()=>{if(!be&&!ht.current&&we&&we.length>0)if(ht.current=!0,"simple"===o){const e=we.find(e=>"Private Team"===e.teamName);j(e?["Private Team"]:[we[0].teamName])}else j([we[0].teamName])},[o,we,be]),r.useEffect(()=>{if(a.state&&a.state.createRepository){const e=a.state;F("repositories"),e.selectedTeam&&j([e.selectedTeam]),setTimeout(()=>{yt("repository","create",{teamName:e.selectedTeam,machineName:e.selectedMachine,preselectedTemplate:e.selectedTemplate})},100),window.history.replaceState({},document.title)}},[a]);const yt=(e,t,s,a)=>{K({open:!0,resourceType:e,mode:t,data:s,creationContext:a})},xt=()=>{K({open:!1,resourceType:"machine",mode:"create"}),te(null)},gt=async(e,t)=>{if(ee)try{let a,i;if("machine"===e)a=ee.machineName,i=ee.bridgeName;else{if(!t.selectedMachine)return;const e=je?.machinesByTeam?.find(e=>e.teamName===ee.teamName),r=e?.machines?.find(e=>e.value===t.selectedMachine);if(!r)return void X("error",s("resources:errors.machineNotFound"));a=r.value,i=r.bridgeName}const r=we.find(e=>e.teamName===ee.teamName),n={teamName:ee.teamName,machineName:a,bridgeName:i,functionName:t.function.name,params:t.params,priority:t.priority,description:t.description,addedVia:`${e}-table`,teamVault:r?.vaultContent||"{}"};if("machine"===e)if(n.machineVault=ee.vaultContent||"{}",t.params.repo){const e=Te.find(e=>e.repositoryGuid===t.params.repo);n.repositoryGuid=e?.repositoryGuid||t.params.repo,n.repositoryVault=e?.vaultContent||"{}"}else n.repositoryVault="{}";else if("repository"===e){n.repositoryGuid=ee.repositoryGuid,n.repositoryVault=ee.vaultContent||"{}";const e=ke.find(e=>e.machineName===a&&e.teamName===ee.teamName);n.machineVault=e?.vaultContent||"{}"}else if("storage"===e){n.storageName=ee.storageName,n.storageVault=ee.vaultContent||"{}";const e=ke.find(e=>e.machineName===a&&e.teamName===ee.teamName);n.machineVault=e?.vaultContent||"{}"}if("pull"===t.function.name){if("machine"===t.params.sourceType&&t.params.from){const e=ke.find(e=>e.machineName===t.params.from);e&&e.vaultContent&&(n.sourceMachineVault=e.vaultContent)}if("storage"===t.params.sourceType&&t.params.from){const e=Le.find(e=>e.storageName===t.params.from);e&&e.vaultContent&&(n.sourceStorageVault=e.vaultContent)}}if("push"===t.function.name){if("machine"===t.params.destinationType&&t.params.to){const e=ke.find(e=>e.machineName===t.params.to);e&&e.vaultContent&&(n.destinationMachineVault=e.vaultContent)}if("storage"===t.params.destinationType&&t.params.to){const e=Le.find(e=>e.storageName===t.params.to);e&&e.vaultContent&&(n.destinationStorageVault=e.vaultContent)}}const o=await Xe(n),c=await Je.mutateAsync({teamName:ee.teamName,machineName:a,bridgeName:i,queueVault:o,priority:t.priority});xt(),c?.taskId?(X("success",s(`${e}s:queueItemCreated`)),Ze({visible:!0,taskId:c.taskId,machineName:a})):c?.isQueued&&X("info",s("resources:messages.highestPriorityQueued",{resourceType:e}))}catch(a){}},ft=[{title:s("repositories.repositoryName"),dataIndex:"repositoryName",key:"repositoryName",ellipsis:!0,render:t=>e.jsxs(ze,{children:[e.jsx(le,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:s("general.team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx(Me,{color:"#8FBC8F",children:t})},..."expert"===o?[{title:s("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:t=>e.jsx(Me,{children:s("common:general.versionFormat",{version:t})})}]:[],{title:s("common:table.actions"),key:"actions",width:250,render:(t,a)=>e.jsxs(ze,{children:[e.jsx(Ee,{title:s("common:actions.edit"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(B,{}),style:l.touchTargetSmall,"data-testid":`resources-repository-edit-${a.repositoryName}`,onClick:()=>{te(a),yt("repository","edit",a)},"aria-label":s("common:actions.edit")})}),e.jsx(Ee,{title:s("machines:trace"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(ae,{}),style:l.touchTargetSmall,"data-testid":`resources-repository-trace-${a.repositoryName}`,onClick:()=>{nt({open:!0,entityType:"Repo",entityIdentifier:a.repositoryName,entityName:a.repositoryName})},"aria-label":s("machines:trace")})}),e.jsx(Ee,{title:s("common:actions.delete"),children:e.jsx(Re,{type:"primary",danger:!0,size:"small",icon:e.jsx(v,{}),style:l.touchTargetSmall,"data-testid":`resources-repository-delete-${a.repositoryName}`,onClick:()=>fe("repository",a),"aria-label":s("common:actions.delete")})})]})}],jt=[{title:s("storage.storageName"),dataIndex:"storageName",key:"storageName",ellipsis:!0,render:t=>e.jsxs(ze,{children:[e.jsx(E,{style:{color:"#556b2f"}}),e.jsx("strong",{children:t})]})},{title:s("general.team"),dataIndex:"teamName",key:"teamName",width:150,ellipsis:!0,render:t=>e.jsx(Me,{color:"#8FBC8F",children:t})},..."expert"===o?[{title:s("general.vaultVersion"),dataIndex:"vaultVersion",key:"vaultVersion",width:100,align:"center",render:t=>e.jsx(Me,{children:s("common:general.versionFormat",{version:t})})}]:[],{title:s("common:table.actions"),key:"actions",width:350,render:(t,a)=>e.jsxs(ze,{children:[e.jsx(Ee,{title:s("common:actions.edit"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(B,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-edit-${a.storageName}`,onClick:()=>{te(a),yt("storage","edit",a)},"aria-label":s("common:actions.edit")})}),e.jsx(Ee,{title:"Run",children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(ye,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-run-${a.storageName}`,onClick:()=>{te(a),K({open:!0,resourceType:"storage",mode:"create",data:a})},"aria-label":"Run"})}),e.jsx(Ee,{title:s("machines:trace"),children:e.jsx(Re,{type:"primary",size:"small",icon:e.jsx(ae,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-trace-${a.storageName}`,onClick:()=>{nt({open:!0,entityType:"Storage",entityIdentifier:a.storageName,entityName:a.storageName})},"aria-label":s("machines:trace")})}),e.jsx(Ee,{title:s("common:actions.delete"),children:e.jsx(Re,{type:"primary",danger:!0,size:"small",icon:e.jsx(v,{}),style:l.touchTargetSmall,"data-testid":`resources-storage-delete-${a.storageName}`,onClick:()=>{De.confirm({title:s("storage.deleteStorage"),content:s("storage.confirmDelete",{storageName:a.storageName}),okText:s("general.yes"),okType:"danger",cancelText:s("general.no"),onOk:()=>fe("storage",a)})},"aria-label":s("common:actions.delete")})})]})}],vt=ue.isPending||he.isPending||pe.isPending||Be.isPending||Fe.isPending||qe.isPending||Ke.isPending||Je.isPending,bt=ge.isPending||Pe.isPending||He.isPending,Nt=[{key:"machines",label:e.jsx(Ee,{title:s("resourceTabs.machines"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-machines",children:e.jsx(R,{style:{fontSize:J.DIMENSIONS.ICON_MD}})})}),children:e.jsx(Us,{type:"machine",teamFilter:x.length>0?x:void 0,showFilters:!0,showActions:!0,onCreateMachine:()=>yt("machine","create"),onEditMachine:e=>{te(e),yt("machine","edit",e)},onVaultMachine:e=>{te(e),yt("machine","vault",e)},onFunctionsMachine:(e,t)=>{te(e),K({open:!0,resourceType:"machine",mode:"create",data:e,preselectedFunction:t}),ne(t=>({...t,[e.machineName]:Date.now()}))},onDeleteMachine:e=>fe("machine",e),onRefreshMachines:Ce,onCreateRepository:(e,t)=>{let s;e.teamName!==x[0]&&j([e.teamName]),t&&(s=JSON.stringify({credential:""})),yt("repository","create",{machineName:e.machineName,teamName:e.teamName,prefilledMachine:!0,repositoryGuid:t,vaultContent:s},t?"credentials-only":"normal")},enabled:"machines"===V,className:"full-height-machine-table",expandedRowKeys:se,onExpandedRowsChange:ie,refreshKeys:re,onQueueItemCreated:(e,t)=>{Ze({visible:!0,taskId:e,machineName:t})},selectedResource:A||P||W,onResourceSelect:e=>{e&&"machineName"in e?oe(e):e&&"repositoryName"in e?(oe(null),G(e),U(null)):e&&"id"in e&&"state"in e?(oe(null),G(null),U(e)):(oe(null),G(null),U(null))},onMachineRepositoryClick:(e,t)=>{const s={repositoryName:t.name,repositoryGuid:t.originalGuid||t.name,teamName:e.teamName,vaultVersion:0,vaultContent:void 0,grandGuid:void 0},a=Te.find(e=>e.repositoryName===t.name||e.repositoryGuid===t.originalGuid||e.repositoryGuid===t.name);a?(G(a),O(null)):(G(s),O(null),U(null))},onMachineContainerClick:(e,t)=>{O(null),G(null),U(t)}})},{key:"repositories",label:e.jsx(Ee,{title:s("resourceTabs.repositories"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-repositories",children:e.jsx(le,{style:{fontSize:J.DIMENSIONS.ICON_MD}})})}),children:e.jsx("div",{ref:Q,style:{height:"100%",display:"flex",flexDirection:"column"},children:_e?e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(Oe,{size:"large"}),e.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:s("common:general.loading")})]}):0===Te.length?e.jsx(Ue,{description:s("repositories.noRepositories"),style:{margin:"auto"}}):e.jsx(Ve,{"data-testid":"resources-repository-table",columns:ft,dataSource:Te,rowKey:"repositoryName",scroll:{x:"max-content"},pagination:{total:Te?.length||0,pageSize:mt,showSizeChanger:!1,showTotal:(e,t)=>`${s("common:general.showingRecords",{start:t[0],end:t[1],total:e})}`,position:["bottomRight"]},style:{flex:1},sticky:!0})})},{key:"storage",label:e.jsx(Ee,{title:s("resourceTabs.storage"),placement:"top",children:e.jsx("span",{"data-testid":"resources-tab-storage",children:e.jsx(E,{style:{fontSize:J.DIMENSIONS.ICON_MD}})})}),children:e.jsx("div",{ref:H,style:{height:"100%",display:"flex",flexDirection:"column"},children:Ge?e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(Oe,{size:"large"}),e.jsx("div",{style:{marginTop:16,color:"var(--ant-color-text-secondary)"},children:s("common:general.loading")})]}):0===Le.length?e.jsx(Ue,{description:s("storage.noStorage"),style:{margin:"auto"}}):e.jsx(Ve,{"data-testid":"resources-storage-table",columns:jt,dataSource:Le,rowKey:"storageName",scroll:{x:"max-content"},pagination:{total:Le?.length||0,pageSize:ut,showSizeChanger:!1,showTotal:(e,t)=>`${s("common:general.showingRecords",{start:t[0],end:t[1],total:e})}`,position:["bottomRight"]},style:{flex:1},sticky:!0})})}],wt={...l.container,height:"calc(100vh - 64px - 48px)",overflow:"hidden",...l.flexColumn},kt={...l.card,height:"100%",...l.flexColumn},Ct={flex:1,overflow:"hidden",...l.padding.md,...l.flexColumn},St=e=>{if("ArrowLeft"===e.key||"ArrowRight"===e.key){e.preventDefault();const t=["machines","repositories","storage"],s=t.indexOf(V);if("ArrowLeft"===e.key){const e=s>0?s-1:t.length-1;F(t[e])}else{const e=s<t.length-1?s+1:0;F(t[e])}}};return e.jsxs(e.Fragment,{children:["simple"!==o?e.jsx(at,{gutter:0,style:wt,children:e.jsx(it,{span:24,style:{height:"100%"},children:e.jsxs(tt,{style:kt,styles:{body:Ct},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:"1 1 auto",minWidth:0},children:[e.jsx(qs,{level:4,style:{...l.heading4,margin:0,flexShrink:0},children:s("teams.teamResources")}),e.jsx(Ne,{"data-testid":"resources-team-selector",teams:we,selectedTeams:x,onChange:j,loading:be,placeholder:s("teams.selectTeamToView"),style:{minWidth:250,maxWidth:400,width:"100%"}})]}),x.length>0&&e.jsxs("div",{style:{display:"flex",gap:8,flexShrink:0},children:[e.jsx(Ee,{title:Z(),children:e.jsx(Re,{type:"primary",icon:e.jsx(d,{}),style:{...l.buttonPrimary,...l.touchTarget,background:"#556b2f",borderColor:"#556b2f"},"data-testid":`resources-create-${V.slice(0,-1)}-button`,onClick:()=>{switch(V){case"machines":yt("machine","create");break;case"repositories":yt("repository","create",void 0,"credentials-only");break;case"storage":yt("storage","create")}},"aria-label":Z()})}),"storage"===V&&e.jsx(Ee,{title:s("resources:storage.import.button"),children:e.jsx(Re,{icon:e.jsx(de,{}),style:l.touchTarget,"data-testid":"resources-import-button",onClick:()=>dt(!0),"aria-label":s("resources:storage.import.button")})}),"machines"===V&&e.jsx(Ee,{title:s("machines:connectivityTest"),children:e.jsx(Re,{icon:e.jsx(h,{}),style:l.touchTarget,"data-testid":"resources-connectivity-test-button",onClick:()=>st(!0),disabled:0===ke.length,"aria-label":s("machines:connectivityTest")})}),e.jsx(Ee,{title:s("common:actions.refresh"),children:e.jsx(Re,{icon:e.jsx(ce,{}),style:l.touchTarget,"data-testid":"resources-refresh-button",onClick:()=>{switch(V){case"machines":Ce(),ne(e=>({...e,_global:Date.now()}));break;case"repositories":$e();break;case"storage":We()}},"aria-label":s("common:actions.refresh")})})]})]})}),0===x.length?e.jsx(Ue,{image:Ue.PRESENTED_IMAGE_SIMPLE,description:s("teams.selectTeamPrompt"),style:{padding:"40px 0"}}):e.jsx(ct,{activeKey:V,onChange:F,items:Nt,style:{flex:1,display:"flex",flexDirection:"column"},className:"full-height-tabs",onKeyDown:St,tabIndex:0})]})})}):e.jsx(at,{gutter:0,style:wt,children:e.jsx(it,{span:24,style:{height:"100%"},children:e.jsxs(tt,{style:kt,styles:{body:Ct},children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsx("div",{children:e.jsx(qs,{level:4,style:{...l.heading4,margin:0},children:s("teams.teamResources")})}),e.jsxs(ze,{children:[e.jsx(Ee,{title:Z(),children:e.jsx(Re,{type:"primary",icon:e.jsx(d,{}),style:{...l.buttonPrimary,...l.touchTarget,background:"#556b2f",borderColor:"#556b2f"},"data-testid":`resources-create-${V.slice(0,-1)}-button`,onClick:()=>{switch(V){case"machines":yt("machine","create");break;case"repositories":yt("repository","create",void 0,"credentials-only");break;case"storage":yt("storage","create")}},"aria-label":Z()})}),"storage"===V&&e.jsx(Ee,{title:s("resources:storage.import.button"),children:e.jsx(Re,{icon:e.jsx(de,{}),style:l.touchTarget,"data-testid":"resources-import-button",onClick:()=>dt(!0),"aria-label":s("resources:storage.import.button")})}),"machines"===V&&e.jsx(Ee,{title:s("machines:connectivityTest"),children:e.jsx(Re,{icon:e.jsx(h,{}),style:l.touchTarget,"data-testid":"resources-connectivity-test-button",onClick:()=>st(!0),disabled:0===ke.length,"aria-label":s("machines:connectivityTest")})}),e.jsx(Ee,{title:s("common:actions.refresh"),children:e.jsx(Re,{icon:e.jsx(ce,{}),style:l.touchTarget,"data-testid":"resources-refresh-button",onClick:()=>{switch(V){case"machines":Ce(),ne(e=>({...e,_global:Date.now()}));break;case"repositories":$e();break;case"storage":We()}},"aria-label":s("common:actions.refresh")})})]})]}),e.jsx(ct,{activeKey:V,onChange:F,items:Nt,style:{flex:1,display:"flex",flexDirection:"column"},className:"full-height-tabs",onKeyDown:St,tabIndex:0})]})})}),e.jsx($,{"data-testid":`resources-${q.resourceType}-modal`,open:q.open,onCancel:xt,resourceType:q.resourceType,mode:q.mode,existingData:q.data||ee,teamFilter:x.length>0?x:void 0,creationContext:q.creationContext,onSubmit:async e=>{try{const{resourceType:a,mode:i}=q,r={machine:{create:ue,updateName:he,updateVault:ge},repository:{create:Be,updateName:Fe,updateVault:Pe},storage:{create:qe,updateName:Ke,updateVault:He}};if("create"===i)if("repository"===a){const a=e.repositoryGuid&&""!==e.repositoryGuid.trim();if(e.machineName&&e.size&&!a){const{machineName:a,size:i,...n}=e;await r.repository.create.mutateAsync(n);try{const t=je?.machinesByTeam?.find(t=>t.teamName===e.teamName),r=t?.machines?.find(e=>e.value===a);if(!r)return X("error",s("resources:errors.machineNotFound")),void xt();const n=we.find(t=>t.teamName===e.teamName),o=ke.find(t=>t.machineName===a&&t.teamName===e.teamName);await new Promise(e=>setTimeout(e,500));const c=await L.get("/GetTeamRepositories",{teamName:e.teamName}),l=c.resultSets[1]?.data?.find(t=>t.repoName===e.repositoryName),d=l?.vaultContent||e.repositoryVault||"{}",m=l?.repoGuid||"";if(!m)return X("error",s("resources:errors.failedToGetRepositoryGuid")),void xt();const u={repo:m,size:i};e.tmpl&&(u.tmpl=e.tmpl),e.keep_open&&(u.keep_open="true");const h=await Xe({teamName:e.teamName,machineName:r.value,bridgeName:r.bridgeName,functionName:"new",params:u,priority:3,description:`Create repository ${e.repositoryName} with size ${i}`,addedVia:"repository-creation",teamVault:n?.vaultContent||"{}",machineVault:o?.vaultContent||"{}",repositoryVault:d,repositoryGuid:m}),p=await Je.mutateAsync({teamName:e.teamName,machineName:r.value,bridgeName:r.bridgeName,queueVault:h,priority:3});X("success",s("repositories.createSuccess")),p?.taskId?Ze({visible:!0,taskId:p.taskId,machineName:r.value}):p?.isQueued&&X("info",s("resources:messages.repositoryCreationQueued"))}catch(t){X("warning",s("repositories.repoCreatedButQueueFailed"))}}else await r.repository.create.mutateAsync(e),X("success",s("repositories.createSuccess")),xt(),Ce()}else if("machine"===a){const{autoSetup:a,...i}=e;if(await r.machine.create.mutateAsync(i),X("success",s("machines:createSuccess")),a)try{const t=we.find(t=>t.teamName===e.teamName);await new Promise(e=>setTimeout(e,500));const a=await Xe({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,functionName:"setup",params:{datastore_size:"95%",source:"apt-repo",rclone_source:"install-script",docker_source:"docker-repo",install_amd_driver:"auto",install_nvidia_driver:"auto"},priority:3,description:`Auto-setup for machine ${e.machineName}`,addedVia:"machine-creation-auto-setup",teamVault:t?.vaultContent||"{}",machineVault:e.machineVault||"{}"}),i=await Je.mutateAsync({teamName:e.teamName,machineName:e.machineName,bridgeName:e.bridgeName,queueVault:a,priority:3});i?.taskId?(X("info",s("machines:setupQueued")),Ze({visible:!0,taskId:i.taskId,machineName:e.machineName})):i?.isQueued&&X("info",s("machines:setupQueuedForSubmission"))}catch(t){X("warning",s("machines:machineCreatedButSetupFailed"))}xt(),Ce()}else await r[a].create.mutateAsync(e),X("success",s(`${(()=>{switch(V){case"machines":return"machines";case"repositories":return"repositories";case"storage":return"storage";default:return V}})()}.createSuccess`)),xt();else{const t=`${a}Name`,s=ee[t],i=e[t];if(i!==s){const e=r[a].updateName;"machine"===a?await e.mutateAsync({teamName:ee.teamName,currentMachineName:s,newMachineName:i}):"repository"===a?await e.mutateAsync({teamName:ee.teamName,currentRepositoryName:s,newRepositoryName:i}):"storage"===a&&await e.mutateAsync({teamName:ee.teamName,currentStorageName:s,newStorageName:i})}const n=e[`${a}Vault`];if(n&&n!==ee.vaultContent){const e=r[a].updateVault;"machine"===a?await e.mutateAsync({teamName:ee.teamName,machineName:i||s,machineVault:n,vaultVersion:ee.vaultVersion+1}):"repository"===a?await e.mutateAsync({teamName:ee.teamName,repositoryName:i||s,repositoryVault:n,vaultVersion:ee.vaultVersion+1}):"storage"===a&&await e.mutateAsync({teamName:ee.teamName,storageName:i||s,storageVault:n,vaultVersion:ee.vaultVersion+1})}"machine"===a&&e.bridgeName!==ee.bridgeName&&await pe.mutateAsync({teamName:ee.teamName,machineName:i||s,newBridgeName:e.bridgeName})}xt()}catch(t){}},onUpdateVault:"edit"===q.mode?async(e,t)=>{if(ee)try{const{resourceType:s}=q,a={machine:ge,repository:Pe,storage:He}[s];"machine"===s?await a.mutateAsync({teamName:ee.teamName,machineName:ee.machineName,machineVault:e,vaultVersion:t}):"repository"===s?await a.mutateAsync({teamName:ee.teamName,repositoryName:ee.repositoryName,repositoryVault:e,vaultVersion:t}):"storage"===s&&await a.mutateAsync({teamName:ee.teamName,storageName:ee.storageName,storageVault:e,vaultVersion:t})}catch(s){}}:void 0,onFunctionSubmit:!q.data||"machine"!==q.resourceType&&"repository"!==q.resourceType&&"storage"!==q.resourceType?void 0:"machine"===q.resourceType?e=>gt("machine",e):"repository"===q.resourceType?e=>gt("repository",e):e=>gt("storage",e),isSubmitting:vt,isUpdatingVault:bt,functionCategories:"machine"===q.resourceType?["machine","backup"]:"repository"===q.resourceType?["repository","backup","network"]:"storage"===q.resourceType?["backup"]:[],hiddenParams:"repository"===q.resourceType?["repo","grand"]:"storage"===q.resourceType?["storage"]:[],defaultParams:"repository"===q.resourceType&&ee?{repo:ee.repositoryGuid,grand:ee.grandGuid||""}:"storage"===q.resourceType&&ee?{storage:ee.storageName}:{},preselectedFunction:q.preselectedFunction}),e.jsx(Se,{"data-testid":"resources-queue-trace-modal",taskId:Ye.taskId,visible:Ye.visible,onClose:()=>{if(Ze({visible:!1,taskId:null,machineName:null}),Ye.machineName){const e=Ye.machineName;ne(t=>({...t,[e]:Date.now()}))}else ne(e=>{const t={...e};return se.forEach(e=>{t[e]=Date.now()}),t});Ce()}}),e.jsx(ws,{"data-testid":"resources-connectivity-test-modal",open:et,onClose:()=>st(!1),machines:ke,teamFilter:x}),e.jsx(lt,{"data-testid":"resources-audit-trace-modal",open:rt.open,onCancel:()=>nt({open:!1,entityType:null,entityIdentifier:null}),entityType:rt.entityType,entityIdentifier:rt.entityIdentifier,entityName:rt.entityName}),e.jsx(Is,{"data-testid":"resources-rclone-import-wizard",open:ot,onClose:()=>dt(!1),teamName:x[0]||"",onImportComplete:()=>{We(),X("success",s("resources:storage.import.successMessage"))}})]})};export{Ks as default};

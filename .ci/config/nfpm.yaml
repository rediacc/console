# nfpm package configuration template
# Used by build-linux-pkg.sh to create deb, rpm, apk, and archlinux packages.
# Values are injected via environment variables at build time.
#
# Docs: https://nfpm.goreleaser.com/docs/configuration/

name: "${PKG_NAME}"
arch: "${NFPM_ARCH}"
platform: linux
version: "${VERSION}"
section: "${PKG_SECTION}"
priority: "${PKG_PRIORITY}"
maintainer: "${PKG_MAINTAINER}"
description: "${PKG_DESCRIPTION}"
homepage: "${PKG_HOMEPAGE}"
license: "Proprietary"
vendor: "Rediacc"

contents:
  - src: "${BINARY_PATH}"
    dst: "/usr/local/bin/${PKG_BINARY_NAME}"
    expand: true
    file_info:
      mode: 0755

# ---------------------------------------------------------------------------
# Format-specific overrides
# ---------------------------------------------------------------------------

rpm:
  group: "Applications/System"
  compression: zstd
  signature:
    # key_file is set via NFPM_RPM_KEY_FILE env var from build-linux-pkg.sh.
    # Passphrase via $NFPM_RPM_PASSPHRASE. When key_file is empty, nfpm skips signing.
    key_file: "${NFPM_RPM_KEY_FILE}"

deb:
  compression: zstd
  signature:
    # key_file is set via NFPM_DEB_KEY_FILE env var from build-linux-pkg.sh.
    # Passphrase via $NFPM_DEB_PASSPHRASE. When key_file is empty, nfpm skips signing.
    key_file: "${NFPM_DEB_KEY_FILE}"
    type: origin

apk:
  signature:
    # key_file is set via NFPM_APK_KEY_FILE env var from build-linux-pkg.sh.
    # Uses RSA keys (not GPG). Passphrase via $NFPM_APK_PASSPHRASE.
    key_file: "${NFPM_APK_KEY_FILE}"

archlinux:
  pkgbase: "${PKG_NAME}"
  packager: "${PKG_MAINTAINER}"

# ---------------------------------------------------------------------------
# Per-format dependency overrides
# ---------------------------------------------------------------------------
# The 'depends' field is overridable â€” use 'overrides' to set format-specific
# dependencies without affecting other formats.

overrides:
  apk:
    # The CLI is a Node.js SEA binary linked against glibc + libstdc++.
    # Alpine uses musl, so gcompat (glibc shim) and libstdc++ are required.
    depends:
      - gcompat
      - libstdc++
